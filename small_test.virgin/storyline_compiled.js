function Elapsed(){return(new Date).getTime()-g_nStartTime}function ParseXML(){}function TaskQueue(){this.tasks=[],this.timeout=50,this.tick()}function MatrixTransform(){this.reset()}function Scoring(){this.scorerefs={}}function AOClient(){this.endpoint="http://"+window.location.host+"/services/content/api.asmx",(-1<location.href.indexOf("localhost")||0==location.host.indexOf("192.168."))&&(this.endpoint="/AOMock/AO.asmx"),this.apiVersion="0.0",this.sendcount=0}function LMSClient(){}function LMSManager(){this.hasTinCan=this.hasLMS=this.hasAO=!1,this.viewedSlides={}}function QuizData(t,e){this.strQuizId=t,this.strQuizName=e,this.arrQuestions=[],this.dtmFinished=new Date,this.strStatus="",this.nScore=0,this.nPassingScore=80,this.nMinScore=0,this.nMaxScore=100,this.nPtScore=0,this.nPtMax=100,this.AddQuestionResult=function(t){for(var e=!1,i=0;i<this.arrQuestions.length;i++)this.arrQuestions[i].nQuestionNumber==t.nQuestionNumber&&(this.arrQuestions[i]=t,e=!0);e||this.arrQuestions.push(t)}}function ContentResults(){this.dtmFinished=new Date,this.nPassingScore=80,this.nScore=0,this.strStatus="incomplete",this.strType="quiz"}function QuestionResults(t,e,i,r,a,s,n,o,l,h,p,c,d){this.strId=t,this.strLMSId=e,this.strType=i,this.strCorrectResponse=r,this.strUserResponse=a,this.nLatency=s,this.strStatus=n,this.nPoints=o,this.strCompletedTime=l,this.nWeight=h,this.nQuestionNumber=p,this.strDescription=c,this.bTracked=d}function GetTime(t){var e="",e=t.getHours(),i=t.getMinutes(),r=""+i,t=t.getSeconds(),a=""+t;return 10>i&&(r="0"+i),10>t&&(a="0"+t),e+":"+r+":"+a}function GetDate(t){var e="";return e=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()}function AlertError(t){console.log("TinCan error: "+t)}function ppTinCanRequest(t,e,i,r,a){this.MessageType=t,this.Method=e,this.Data=i,this.Url=r,this.Callback=a}function ppTinCanComm(t){this.m_listParams={},this.m_listCustomParams={},this.m_jsActor={},this.m_strQueryString=t,this.ParseQueryString(this.m_strQueryString),this.m_bStopPosting=this.m_bWaitingTinCanResponse=!1,this.m_arrTinCanMsgQueue=[],this.m_pfnFatalError=AlertError,this.m_bIE=document.all&&-1!=navigator.appVersion.indexOf("MSIE")?!0:!1}function ppResponsePair(t,e){this.Choice=t,this.Statement=e}function ppTinCanApi(t){this.m_tcComm=new ppTinCanComm(t)}function TinCanClient(){}function bwChunk(t){this.m_strRemainder="",this.m_nLength=-1,this.m_strChunkData=this.m_strData="",this.m_nOffset=0,this.isNothing=""==t;var e="",i=0,e=0,r=t,e=t.charAt(0);"~"==e?(i=parseInt(t.charAt(1)),e=t.substr(2,i),e=bwChunk.UBaseNto10(e),t=t.substr(2+i),this.m_nLength=2+i+e):(t=t.substr(1),e=bwChunk.UBaseNto10(e),this.m_nLength=1+e),e>0&&(this.m_strData=t.substr(0,e),t=t.substr(e)),this.m_strChunkData=r.substr(0,r.length-t.length),this.m_strRemainder=t}function PathLib(){}function BezierPath(t){t?this.setPoints(t):this.points=[]}function BitMask(t,e,i,r,a){this.isOpaque=t,this.width=e||0,this.height=i||0,this.sourceWidth=r||this.width,this.sourceHeight=a||this.height}function ppRect(t,e,i,r){this.left=t,this.top=e,this.right=i,this.bottom=r}function ppGraphics(t){ppArt.currentFudge=0,this.m_nXOffset=-t.left,this.m_nYOffset=-t.top,this.m_nWidth=t.right-t.left+1,this.m_nHeight=t.bottom-t.top+1,this.m_bForMask=!1,this.m_nFillYPos=this.m_nFillXPos=this.m_nFillRotation=0,this.m_nFillScaleY=this.m_nFillScaleX=1,this.m_bRotatedFill=!1,0>=this.m_nWidth&&(this.m_nWidth=1),0>=this.m_nHeight&&(this.m_nHeight=1),this.m_ptOffset={x:0,y:0},this.m_bLineDrawn=this.m_bStrokeStarted=this.m_bFillStarted=!1,this.m_nCurYPos=this.m_nCurXPos=0,this.m_arrShadows=[],this.m_bHasInnerShadow=this.m_bHasShadow=!1,this.m_arrStrokeCanvases=[],this.m_oFillCanvas=document.createElement("canvas"),this.m_oStrokeCanvas=document.createElement("canvas"),this.m_oFillCanvas.width=this.m_nWidth,this.m_oFillCanvas.height=this.m_nHeight,this.m_oStrokeCanvas.width=this.m_nWidth,this.m_oStrokeCanvas.height=this.m_nHeight,this.m_oFillContext=this.m_oFillCanvas.getContext("2d"),this.m_oStrokeContext=this.m_oStrokeCanvas.getContext("2d"),this.m_arrStrokeCanvases.push(this.m_oStrokeCanvas),this.lineJoin=this.lineWidth=this.strokeStyle=this.fillStyle=null}function AddFont(t,e){var i=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",$(r).load(function(){e(t)}),r.src=t,i.appendChild(r)}function RegisterFonts(t){"string"==typeof t&&(t=t.replace(/[\u000a\u000b\u000c\u000d\u0085\u2028\u2029]/g,""),t=t.replace(/&#x[0-8bcef];/gi,""));var e=null;window.ActiveXObject?(e=new ActiveXObject("Microsoft.XMLDOM"),e.loadXML(t)):e=(new DOMParser).parseFromString(t,"text/xml");for(var t=e.getElementsByTagName("font"),e=null,i=0;i<t.length;i++)e=new ppFont(t[i]),g_listFonts[e.Id]=e}function ppFont(t){this.m_xmlData=null,this.m_listGlyphs={},this.m_bFontReady=!1,this.CMD_LINE="%",this.CMD_MOVE="^",this.CMD_CURVE="#",this.CMD_LINE_E="!",this.CMD_MOVE_E="(",this.CMD_CURVE_E=")",this.BASE_NUMBER=64,this.BASE_POW=6,this.m_o64to10={v0:0,v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8,v9:9,va:10,vb:11,vc:12,vd:13,ve:14,vf:15,vg:16,vh:17,vi:18,vj:19,vk:20,vl:21,vm:22,vn:23,vo:24,vp:25,vq:26,vr:27,vs:28,vt:29,vu:30,vv:31,vw:32,vx:33,vy:34,vz:35,vA:36,vB:37,vC:38,vD:39,vE:40,vF:41,vG:42,vH:43,vI:44,vJ:45,vK:46,vL:47,vM:48,vN:49,vO:50,vP:51,vQ:52,vR:53,vS:54,vT:55,vU:56,vV:57,vW:58,vX:59,vY:60,vZ:61,v_:62,v$:63},this.Name=this.GetAttrStr(t,"name"),this.Id=this.GetAttrStr(t,"id"),this.m_xmlData=t.getElementsByTagName("g"),this.m_bFontReady=!0}function ppFontLib(t,e){this.m_strFontUrl=e,null==t&&(t=""),this.m_strBasePath=t}function ppGlyphCmd(t,e,i,r,a){this.cmd=t,this.x1=e,this.y1=i,this.x2=r,this.y2=a}function ppTextLib(t){if(this.m_bHasXML=!1,null!=t)try{this.m_xmlData=t.getElementsByTagName("textdata"),this.m_bHasXML=!0}catch(e){this.m_bHasXML=!1}else ppDebug.debug_trace("Text data is null")}function ppImageLib(){this.m_listImages={},this.m_nCount=0}function ResourcesPanel(){}function GlossaryPanel(){}function TranscriptPanel(){}function CustomStyleSheet(){this.rules=[],this.ruleLookup={},this.sheet=null}function StyleRule(t){this.selector=t,this.attributes=[]}var buildDate="20130516 11:42";!function(t,e){function i(t){var e,i,r=A[t]={},t=t.split(/\s+/);for(e=0,i=t.length;i>e;e++)r[t[e]]=!0;return r}function r(t,i,r){if(r===e&&1===t.nodeType)if(r="data-"+i.replace(R,"-$1").toLowerCase(),r=t.getAttribute(r),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:$.isNumeric(r)?parseFloat(r):L.test(r)?$.parseJSON(r):r}catch(a){}$.data(t,i,r)}else r=e;return r}function a(t){for(var e in t)if(("data"!==e||!$.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function s(t,e,i){var r=e+"defer",a=e+"queue",s=e+"mark",n=$._data(t,r);!(!n||"queue"!==i&&$._data(t,a)||"mark"!==i&&$._data(t,s)||!setTimeout(function(){!$._data(t,a)&&!$._data(t,s)&&($.removeData(t,r,!0),n.fire())},0))}function n(){return!1}function o(){return!0}function l(t,e,i){if(e=e||0,$.isFunction(e))return $.grep(t,function(t,r){return!!e.call(t,r,t)===i});if(e.nodeType)return $.grep(t,function(t){return t===e===i});if("string"==typeof e){var r=$.grep(t,function(t){return 1===t.nodeType});if(at.test(e))return $.filter(e,r,!i);e=$.filter(e,r)}return $.grep(t,function(t){return 0<=$.inArray(t,e)===i})}function h(t){var e=lt.split("|"),t=t.createDocumentFragment();if(t.createElement)for(;e.length;)t.createElement(e.pop());return t}function p(t,e){if(1===e.nodeType&&$.hasData(t)){var i,r,a;r=$._data(t);var s=$._data(e,r),n=r.events;if(n)for(i in delete s.handle,s.events={},n)for(r=0,a=n[i].length;a>r;r++)$.event.add(e,i+(n[i][r].namespace?".":"")+n[i][r].namespace,n[i][r],n[i][r].data);s.data&&(s.data=$.extend({},s.data))}}function c(t,e){var i;1===e.nodeType&&(e.clearAttributes&&e.clearAttributes(),e.mergeAttributes&&e.mergeAttributes(t),i=e.nodeName.toLowerCase(),"object"===i?e.outerHTML=t.outerHTML:"input"!==i||"checkbox"!==t.type&&"radio"!==t.type?"option"===i?e.selected=t.defaultSelected:("input"===i||"textarea"===i)&&(e.defaultValue=t.defaultValue):(t.checked&&(e.defaultChecked=e.checked=t.checked),e.value!==t.value&&(e.value=t.value)),e.removeAttribute($.expando))}function d(t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName("*"):"undefined"!=typeof t.querySelectorAll?t.querySelectorAll("*"):[]}function u(t){("checkbox"===t.type||"radio"===t.type)&&(t.defaultChecked=t.checked)}function f(t){var e=(t.nodeName||"").toLowerCase();"input"===e?u(t):"script"!==e&&"undefined"!=typeof t.getElementsByTagName&&$.grep(t.getElementsByTagName("input"),u)}function m(t,e){e.src?$.ajax({url:e.src,async:!1,dataType:"script"}):$.globalEval((e.text||e.textContent||e.innerHTML||"").replace(wt,"/*$0*/")),e.parentNode&&e.parentNode.removeChild(e)}function y(t,e,i){var r="width"===e?t.offsetWidth:t.offsetHeight,a="width"===e?Lt:Rt,s=0,n=a.length;if(r>0){if("border"!==i)for(;n>s;s++)i||(r-=parseFloat($.css(t,"padding"+a[s]))||0),r="margin"===i?r+(parseFloat($.css(t,i+a[s]))||0):r-(parseFloat($.css(t,"border"+a[s]+"Width"))||0);return r+"px"}if(r=Ct(t,e,e),(0>r||null==r)&&(r=t.style[e]||0),r=parseFloat(r)||0,i)for(;n>s;s++)r+=parseFloat($.css(t,"padding"+a[s]))||0,"padding"!==i&&(r+=parseFloat($.css(t,"border"+a[s]+"Width"))||0),"margin"===i&&(r+=parseFloat($.css(t,i+a[s]))||0);return r+"px"}function g(t){return function(e,i){var r;if("string"!=typeof e&&(i=e,e="*"),$.isFunction(i))for(var a,s,n=e.toLowerCase().split(Ut),o=0,l=n.length;l>o;o++)a=n[o],(s=/^\+/.test(a))&&(a=a.substr(1)||"*"),r=t[a]=t[a]||[],a=r,a[s?"unshift":"push"](i)}}function v(t,i,r,a,s,n){s=s||i.dataTypes[0],n=n||{},n[s]=!0;for(var o,s=t[s],l=0,h=s?s.length:0,p=t===Kt;h>l&&(p||!o);l++)o=s[l](i,r,a),"string"==typeof o&&(!p||n[o]?o=e:(i.dataTypes.unshift(o),o=v(t,i,r,a,o,n)));return!p&&o||n["*"]||(o=v(t,i,r,a,"*",n)),o}function b(t,i){var r,a,s=$.ajaxSettings.flatOptions||{};for(r in i)i[r]!==e&&((s[r]?t:a||(a={}))[r]=i[r]);a&&$.extend(!0,t,a)}function w(t,e,i,r){if($.isArray(e))$.each(e,function(e,a){i||Nt.test(t)?r(t,a):w(t+"["+("object"==typeof a||$.isArray(a)?e:"")+"]",a,i,r)});else if(i||null==e||"object"!=typeof e)r(t,e);else for(var a in e)w(t+"["+a+"]",e[a],i,r)}function x(){try{return new t.XMLHttpRequest}catch(e){}}function S(){return setTimeout(C,0),pe=$.now()}function C(){pe=e}function _(t,e){var i={};return $.each(fe.concat.apply([],fe.slice(0,e)),function(){i[this]=t}),i}function T(t){if(!ce[t]){var e=k.body,i=$("<"+t+">").appendTo(e),r=i.css("display");i.remove(),("none"===r||""===r)&&(oe||(oe=k.createElement("iframe"),oe.frameBorder=oe.width=oe.height=0),e.appendChild(oe),le&&oe.createElement||(le=(oe.contentWindow||oe.contentDocument).document,le.write(("CSS1Compat"===k.compatMode?"<!doctype html>":"")+"<html><body>"),le.close()),i=le.createElement(t),le.body.appendChild(i),r=$.css(i,"display"),e.removeChild(oe)),ce[t]=r}return ce[t]}function I(t){return $.isWindow(t)?t:9===t.nodeType?t.defaultView||t.parentWindow:!1}var k=t.document,D=t.navigator,E=t.location,$=function(){function i(){if(!n.isReady){try{k.documentElement.doScroll("left")}catch(t){return void setTimeout(i,1)}n.ready()}}var r,a,s,n=function(t,e){return new n.fn.init(t,e,r)},o=t.jQuery,l=t.$,h=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,p=/\S/,c=/^\s+/,d=/\s+$/,u=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,f=/^[\],:{}\s]*$/,m=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,y=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,g=/(?:^|:|,)(?:\s*\[)+/g,v=/(webkit)[ \/]([\w.]+)/,b=/(opera)(?:.*version)?[ \/]([\w.]+)/,w=/(msie) ([\w.]+)/,x=/(mozilla)(?:.*? rv:([\w.]+))?/,S=/-([a-z]|[0-9])/gi,C=/^-ms-/,_=function(t,e){return(e+"").toUpperCase()},T=D.userAgent,I=Object.prototype.toString,E=Object.prototype.hasOwnProperty,$=Array.prototype.push,A=Array.prototype.slice,M=String.prototype.trim,L=Array.prototype.indexOf,R={};return n.fn=n.prototype={constructor:n,init:function(t,i,r){var a;if(!t)return this;if(t.nodeType)return this.context=this[0]=t,this.length=1,this;if("body"===t&&!i&&k.body)return this.context=k,this[0]=k.body,this.selector=t,this.length=1,this;if("string"==typeof t){if((a="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&3<=t.length?[null,t,null]:h.exec(t))&&(a[1]||!i)){if(a[1])return r=(i=i instanceof n?i[0]:i)?i.ownerDocument||i:k,(t=u.exec(t))?n.isPlainObject(i)?(t=[k.createElement(t[1])],n.fn.attr.call(t,i,!0)):t=[r.createElement(t[1])]:(t=n.buildFragment([a[1]],[r]),t=(t.cacheable?n.clone(t.fragment):t.fragment).childNodes),n.merge(this,t);if((i=k.getElementById(a[2]))&&i.parentNode){if(i.id!==a[2])return r.find(t);this.length=1,this[0]=i}return this.context=k,this.selector=t,this}return!i||i.jquery?(i||r).find(t):this.constructor(i).find(t)}return n.isFunction(t)?r.ready(t):(t.selector!==e&&(this.selector=t.selector,this.context=t.context),n.makeArray(t,this))},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return A.call(this,0)},get:function(t){return null==t?this.toArray():0>t?this[this.length+t]:this[t]},pushStack:function(t,e,i){var r=this.constructor();return n.isArray(t)?$.apply(r,t):n.merge(r,t),r.prevObject=this,r.context=this.context,"find"===e?r.selector=this.selector+(this.selector?" ":"")+i:e&&(r.selector=this.selector+"."+e+"("+i+")"),r},each:function(t,e){return n.each(this,t,e)},ready:function(t){return n.bindReady(),a.add(t),this},eq:function(t){return t=+t,-1===t?this.slice(t):this.slice(t,t+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(A.apply(this,arguments),"slice",A.call(arguments).join(","))},map:function(t){return this.pushStack(n.map(this,function(e,i){return t.call(e,i,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:$,sort:[].sort,splice:[].splice},n.fn.init.prototype=n.fn,n.extend=n.fn.extend=function(){var t,i,r,a,s,o=arguments[0]||{},l=1,h=arguments.length,p=!1;for("boolean"==typeof o&&(p=o,o=arguments[1]||{},l=2),"object"!=typeof o&&!n.isFunction(o)&&(o={}),h===l&&(o=this,--l);h>l;l++)if(null!=(t=arguments[l]))for(i in t)r=o[i],a=t[i],o!==a&&(p&&a&&(n.isPlainObject(a)||(s=n.isArray(a)))?(s?(s=!1,r=r&&n.isArray(r)?r:[]):r=r&&n.isPlainObject(r)?r:{},o[i]=n.extend(p,r,a)):a!==e&&(o[i]=a));return o},n.extend({noConflict:function(e){return t.$===n&&(t.$=l),e&&t.jQuery===n&&(t.jQuery=o),n},isReady:!1,readyWait:1,holdReady:function(t){t?n.readyWait++:n.ready(!0)},ready:function(t){if(!0===t&&!--n.readyWait||!0!==t&&!n.isReady){if(!k.body)return setTimeout(n.ready,1);n.isReady=!0,!0!==t&&0<--n.readyWait||(a.fireWith(k,[n]),n.fn.trigger&&n(k).trigger("ready").off("ready"))}},bindReady:function(){if(!a){if(a=n.Callbacks("once memory"),"complete"===k.readyState)return setTimeout(n.ready,1);if(k.addEventListener)k.addEventListener("DOMContentLoaded",s,!1),t.addEventListener("load",n.ready,!1);else if(k.attachEvent){k.attachEvent("onreadystatechange",s),t.attachEvent("onload",n.ready);var e=!1;try{e=null==t.frameElement}catch(r){}k.documentElement.doScroll&&e&&i()}}},isFunction:function(t){return"function"===n.type(t)},isArray:Array.isArray||function(t){return"array"===n.type(t)},isWindow:function(t){return t&&"object"==typeof t&&"setInterval"in t},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null==t?""+t:R[I.call(t)]||"object"},isPlainObject:function(t){if(!t||"object"!==n.type(t)||t.nodeType||n.isWindow(t))return!1;try{if(t.constructor&&!E.call(t,"constructor")&&!E.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}for(var r in t);return r===e||E.call(t,r)},isEmptyObject:function(t){for(var e in t)return!1;return!0},error:function(t){throw Error(t)},parseJSON:function(e){return"string"==typeof e&&e?(e=n.trim(e),t.JSON&&t.JSON.parse?t.JSON.parse(e):f.test(e.replace(m,"@").replace(y,"]").replace(g,""))?new Function("return "+e)():void n.error("Invalid JSON: "+e)):null},parseXML:function(i){var r,a;try{t.DOMParser?(a=new DOMParser,r=a.parseFromString(i,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(i))}catch(s){r=e}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+i),r},noop:function(){},globalEval:function(e){e&&p.test(e)&&(t.execScript||function(e){t.eval.call(t,e)})(e)},camelCase:function(t){return t.replace(C,"ms-").replace(S,_)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toUpperCase()===e.toUpperCase()},each:function(t,i,r){var a,s=0,o=t.length,l=o===e||n.isFunction(t);if(r)if(l){for(a in t)if(!1===i.apply(t[a],r))break}else for(;o>s&&!1!==i.apply(t[s++],r););else if(l){for(a in t)if(!1===i.call(t[a],a,t[a]))break}else for(;o>s&&!1!==i.call(t[s],s,t[s++]););return t},trim:M?function(t){return null==t?"":M.call(t)}:function(t){return null==t?"":t.toString().replace(c,"").replace(d,"")},makeArray:function(t,e){var i=e||[];if(null!=t){var r=n.type(t);null==t.length||"string"===r||"function"===r||"regexp"===r||n.isWindow(t)?$.call(i,t):n.merge(i,t)}return i},inArray:function(t,e,i){var r;if(e){if(L)return L.call(e,t,i);for(r=e.length,i=i?0>i?Math.max(0,r+i):i:0;r>i;i++)if(i in e&&e[i]===t)return i}return-1},merge:function(t,i){var r=t.length,a=0;if("number"==typeof i.length)for(var s=i.length;s>a;a++)t[r++]=i[a];else for(;i[a]!==e;)t[r++]=i[a++];return t.length=r,t},grep:function(t,e,i){for(var r,a=[],i=!!i,s=0,n=t.length;n>s;s++)r=!!e(t[s],s),i!==r&&a.push(t[s]);return a},map:function(t,i,r){var a,s,o=[],l=0,h=t.length;if(t instanceof n||h!==e&&"number"==typeof h&&(h>0&&t[0]&&t[h-1]||0===h||n.isArray(t)))for(;h>l;l++)a=i(t[l],l,r),null!=a&&(o[o.length]=a);else for(s in t)a=i(t[s],s,r),null!=a&&(o[o.length]=a);return o.concat.apply([],o)},guid:1,proxy:function(t,i){if("string"==typeof i)var r=t[i],i=t,t=r;if(!n.isFunction(t))return e;var a=A.call(arguments,2),r=function(){return t.apply(i,a.concat(A.call(arguments)))};return r.guid=t.guid=t.guid||r.guid||n.guid++,r},access:function(t,i,r,a,s,o){var l=t.length;if("object"==typeof i){for(var h in i)n.access(t,h,i[h],a,s,r);return t}if(r!==e){for(a=!o&&a&&n.isFunction(r),h=0;l>h;h++)s(t[h],i,a?r.call(t[h],h,s(t[h],i)):r,o);return t}return l?s(t[0],i):e},now:function(){return(new Date).getTime()},uaMatch:function(t){return t=t.toLowerCase(),t=v.exec(t)||b.exec(t)||w.exec(t)||0>t.indexOf("compatible")&&x.exec(t)||[],{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function t(e,i){return new t.fn.init(e,i)}n.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(i,r){return r&&r instanceof n&&!(r instanceof t)&&(r=t(r)),n.fn.init.call(this,i,r,e)},t.fn.init.prototype=t.fn;var e=t(k);return t},browser:{}}),n.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(t,e){R["[object "+e+"]"]=e.toLowerCase()}),T=n.uaMatch(T),T.browser&&(n.browser[T.browser]=!0,n.browser.version=T.version),n.browser.webkit&&(n.browser.safari=!0),p.test(" ")&&(c=/^[\s\xA0]+/,d=/[\s\xA0]+$/),r=n(k),k.addEventListener?s=function(){k.removeEventListener("DOMContentLoaded",s,!1),n.ready()}:k.attachEvent&&(s=function(){"complete"===k.readyState&&(k.detachEvent("onreadystatechange",s),n.ready())}),n}(),A={};$.Callbacks=function(t){var r,a,s,n,o,t=t?A[t]||i(t):{},l=[],h=[],p=function(e){var i,r,a,s;for(i=0,r=e.length;r>i;i++)a=e[i],s=$.type(a),"array"===s?p(a):"function"===s&&(!t.unique||!d.has(a))&&l.push(a)},c=function(e,i){for(i=i||[],r=!t.memory||[e,i],a=!0,o=s||0,s=0,n=l.length;l&&n>o;o++)if(!1===l[o].apply(e,i)&&t.stopOnFalse){r=!0;break}a=!1,l&&(t.once?!0===r?d.disable():l=[]:h&&h.length&&(r=h.shift(),d.fireWith(r[0],r[1])))},d={add:function(){if(l){var t=l.length;p(arguments),a?n=l.length:r&&!0!==r&&(s=t,c(r[0],r[1]))}return this},remove:function(){if(l)for(var e=arguments,i=0,r=e.length;r>i;i++)for(var s=0;s<l.length&&(e[i]!==l[s]||(a&&n>=s&&(n--,o>=s&&o--),l.splice(s--,1),!t.unique));s++);return this},has:function(t){if(l)for(var e=0,i=l.length;i>e;e++)if(t===l[e])return!0;return!1},empty:function(){return l=[],this},disable:function(){return l=h=r=e,this},disabled:function(){return!l},lock:function(){return h=e,(!r||!0===r)&&d.disable(),this},locked:function(){return!h},fireWith:function(e,i){return h&&(a?t.once||h.push([e,i]):(!t.once||!r)&&c(e,i)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!r}};return d};var M=[].slice;$.extend({Deferred:function(t){var e,i=$.Callbacks("once memory"),r=$.Callbacks("once memory"),a=$.Callbacks("memory"),s="pending",n={resolve:i,reject:r,notify:a},o={done:i.add,fail:r.add,progress:a.add,state:function(){return s},isResolved:i.fired,isRejected:r.fired,then:function(t,e,i){return l.done(t).fail(e).progress(i),this},always:function(){return l.done.apply(l,arguments).fail.apply(l,arguments),this},pipe:function(t,e,i){return $.Deferred(function(r){$.each({done:[t,"resolve"],fail:[e,"reject"],progress:[i,"notify"]},function(t,e){var i,a=e[0],s=e[1];$.isFunction(a)?l[t](function(){(i=a.apply(this,arguments))&&$.isFunction(i.promise)?i.promise().then(r.resolve,r.reject,r.notify):r[s+"With"](this===l?r:this,[i])}):l[t](r[s])})}).promise()},promise:function(t){if(null==t)t=o;else for(var e in o)t[e]=o[e];return t}},l=o.promise({});for(e in n)l[e]=n[e].fire,l[e+"With"]=n[e].fireWith;return l.done(function(){s="resolved"},r.disable,a.lock).fail(function(){s="rejected"},i.disable,a.lock),t&&t.call(l,l),l},when:function(t){function e(t){return function(e){r[t]=1<arguments.length?M.call(arguments,0):e,--o||l.resolveWith(l,r)}}function i(t){return function(e){n[t]=1<arguments.length?M.call(arguments,0):e,l.notifyWith(h,n)}}var r=M.call(arguments,0),a=0,s=r.length,n=Array(s),o=s,l=1>=s&&t&&$.isFunction(t.promise)?t:$.Deferred(),h=l.promise();if(s>1){for(;s>a;a++)r[a]&&r[a].promise&&$.isFunction(r[a].promise)?r[a].promise().then(e(a),l.reject,i(a)):--o;o||l.resolveWith(l,r)}else l!==t&&l.resolveWith(l,s?[t]:[]);return h}}),$.support=function(){var e,i,r,a,s,n,o,l,h=k.createElement("div");if(h.setAttribute("className","t"),h.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",i=h.getElementsByTagName("*"),r=h.getElementsByTagName("a")[0],!i||!i.length||!r)return{};a=k.createElement("select"),s=a.appendChild(k.createElement("option")),i=h.getElementsByTagName("input")[0],e={leadingWhitespace:3===h.firstChild.nodeType,tbody:!h.getElementsByTagName("tbody").length,htmlSerialize:!!h.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.55/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:"on"===i.value,optSelected:s.selected,getSetAttribute:"t"!==h.className,enctype:!!k.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==k.createElement("nav").cloneNode(!0).outerHTML,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,e.noCloneChecked=i.cloneNode(!0).checked,a.disabled=!0,e.optDisabled=!s.disabled;try{delete h.test}catch(p){e.deleteExpando=!1}if(!h.addEventListener&&h.attachEvent&&h.fireEvent&&(h.attachEvent("onclick",function(){e.noCloneEvent=!1}),h.cloneNode(!0).fireEvent("onclick")),i=k.createElement("input"),i.value="t",i.setAttribute("type","radio"),e.radioValue="t"===i.value,i.setAttribute("checked","checked"),h.appendChild(i),r=k.createDocumentFragment(),r.appendChild(h.lastChild),e.checkClone=r.cloneNode(!0).cloneNode(!0).lastChild.checked,e.appendChecked=i.checked,r.removeChild(i),r.appendChild(h),h.innerHTML="",t.getComputedStyle&&(i=k.createElement("div"),i.style.width="0",i.style.marginRight="0",h.style.width="2px",h.appendChild(i),e.reliableMarginRight=0===(parseInt((t.getComputedStyle(i,null)||{marginRight:0}).marginRight,10)||0)),h.attachEvent)for(o in{submit:1,change:1,focusin:1})i="on"+o,l=i in h,l||(h.setAttribute(i,"return;"),l="function"==typeof h[i]),e[o+"Bubbles"]=l;return r.removeChild(h),r=a=s=i=h=i=null,$(function(){var t,i,r,a,s=k.getElementsByTagName("body")[0];s&&(t=k.createElement("div"),t.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",s.insertBefore(t,s.firstChild),h=k.createElement("div"),t.appendChild(h),h.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",n=h.getElementsByTagName("td"),l=0===n[0].offsetHeight,n[0].style.display="",n[1].style.display="none",e.reliableHiddenOffsets=l&&0===n[0].offsetHeight,h.innerHTML="",h.style.width=h.style.paddingLeft="1px",$.boxModel=e.boxModel=2===h.offsetWidth,"undefined"!=typeof h.style.zoom&&(h.style.display="inline",h.style.zoom=1,e.inlineBlockNeedsLayout=2===h.offsetWidth,h.style.display="",h.innerHTML="<div style='width:4px;'></div>",e.shrinkWrapBlocks=2!==h.offsetWidth),h.style.cssText="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;visibility:hidden;border:0;",h.innerHTML="<div style='position:absolute;top:0;left:0;width:1px;height:1px;margin:0;border:5px solid #000;padding:0;'><div></div></div><table style='position:absolute;top:0;left:0;width:1px;height:1px;margin:0;border:5px solid #000;padding:0;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",i=h.firstChild,r=i.firstChild,a={doesNotAddBorder:5!==r.offsetTop,doesAddBorderForTableAndCells:5===i.nextSibling.firstChild.firstChild.offsetTop},r.style.position="fixed",r.style.top="20px",a.fixedPosition=20===r.offsetTop||15===r.offsetTop,r.style.position=r.style.top="",i.style.overflow="hidden",i.style.position="relative",a.subtractsBorderForOverflowNotVisible=-5===r.offsetTop,a.doesNotIncludeMarginInBodyOffset=1!==s.offsetTop,s.removeChild(t),h=null,$.extend(e,a))}),e}();var L=/^(?:\{.*\}|\[.*\])$/,R=/([A-Z])/g;$.extend({cache:{},uuid:0,expando:"jQuery"+($.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(t){return t=t.nodeType?$.cache[t[$.expando]]:t[$.expando],!!t&&!a(t)},data:function(t,i,r,a){if($.acceptData(t)){var s;s=$.expando;var n="string"==typeof i,o=t.nodeType,l=o?$.cache:t,h=o?t[s]:t[s]&&s,p="events"===i;if(h&&l[h]&&(p||a||l[h].data)||!n||r!==e)return h||(o?t[s]=h=++$.uuid:h=s),l[h]||(l[h]={},o)||(l[h].toJSON=$.noop),("object"==typeof i||"function"==typeof i)&&(a?l[h]=$.extend(l[h],i):l[h].data=$.extend(l[h].data,i)),s=t=l[h],a||(t.data||(t.data={}),t=t.data),r!==e&&(t[$.camelCase(i)]=r),p&&!t[i]?s.events:(n?(r=t[i],null==r&&(r=t[$.camelCase(i)])):r=t,r)}},removeData:function(t,e,i){if($.acceptData(t)){var r,s,n,o=$.expando,l=t.nodeType,h=l?$.cache:t,p=l?t[o]:o;if(h[p]){if(e&&(r=i?h[p]:h[p].data)){$.isArray(e)||(e in r?e=[e]:(e=$.camelCase(e),e=e in r?[e]:e.split(" ")));for(s=0,n=e.length;n>s;s++)delete r[e[s]];if(!(i?a:$.isEmptyObject)(r))return}if(!i&&(delete h[p].data,!a(h[p])))return;$.support.deleteExpando||!h.setInterval?delete h[p]:h[p]=null,l&&($.support.deleteExpando?delete t[o]:t.removeAttribute?t.removeAttribute(o):t[o]=null)}}},_data:function(t,e,i){return $.data(t,e,i,!0)},acceptData:function(t){if(t.nodeName){var e=$.noData[t.nodeName.toLowerCase()];if(e)return!(!0===e||t.getAttribute("classid")!==e)}return!0}}),$.fn.extend({data:function(t,i){var a,s,n,o=null;if("undefined"==typeof t){if(this.length&&(o=$.data(this[0]),1===this[0].nodeType&&!$._data(this[0],"parsedAttrs"))){s=this[0].attributes;for(var l=0,h=s.length;h>l;l++)n=s[l].name,0===n.indexOf("data-")&&(n=$.camelCase(n.substring(5)),r(this[0],n,o[n]));$._data(this[0],"parsedAttrs",!0)}return o}return"object"==typeof t?this.each(function(){$.data(this,t)}):(a=t.split("."),a[1]=a[1]?"."+a[1]:"",i===e?(o=this.triggerHandler("getData"+a[1]+"!",[a[0]]),o===e&&this.length&&(o=$.data(this[0],t),o=r(this[0],t,o)),o===e&&a[1]?this.data(a[0]):o):this.each(function(){var e=$(this),r=[a[0],i];e.triggerHandler("setData"+a[1]+"!",r),$.data(this,t,i),e.triggerHandler("changeData"+a[1]+"!",r)}))},removeData:function(t){return this.each(function(){$.removeData(this,t)})}}),$.extend({_mark:function(t,e){t&&(e=(e||"fx")+"mark",$._data(t,e,($._data(t,e)||0)+1))},_unmark:function(t,e,i){if(!0!==t&&(i=e,e=t,t=!1),e){var i=i||"fx",r=i+"mark";(t=t?0:($._data(e,r)||1)-1)?$._data(e,r,t):($.removeData(e,r,!0),s(e,i,"mark"))}},queue:function(t,e,i){var r;return t?(e=(e||"fx")+"queue",r=$._data(t,e),i&&(!r||$.isArray(i)?r=$._data(t,e,$.makeArray(i)):r.push(i)),r||[]):void 0},dequeue:function(t,e){var e=e||"fx",i=$.queue(t,e),r=i.shift(),a={};"inprogress"===r&&(r=i.shift()),r&&("fx"===e&&i.unshift("inprogress"),$._data(t,e+".run",a),r.call(t,function(){$.dequeue(t,e)},a)),i.length||($.removeData(t,e+"queue "+e+".run",!0),s(t,e,"queue"))}}),$.fn.extend({queue:function(t,i){return"string"!=typeof t&&(i=t,t="fx"),i===e?$.queue(this[0],t):this.each(function(){var e=$.queue(this,t,i);"fx"===t&&"inprogress"!==e[0]&&$.dequeue(this,t)})},dequeue:function(t){return this.each(function(){$.dequeue(this,t)})},delay:function(t,e){return t=$.fx?$.fx.speeds[t]||t:t,this.queue(e||"fx",function(e,i){var r=setTimeout(e,t);i.stop=function(){clearTimeout(r)}})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t){function i(){--o||a.resolveWith(s,[s])}"string"!=typeof t&&(t=e);for(var r,t=t||"fx",a=$.Deferred(),s=this,n=s.length,o=1,l=t+"defer",h=t+"queue",t=t+"mark";n--;)(r=$.data(s[n],l,e,!0)||($.data(s[n],h,e,!0)||$.data(s[n],t,e,!0))&&$.data(s[n],l,$.Callbacks("once memory"),!0))&&(o++,r.add(i));return i(),a.promise()}});var P,F,O,N=/[\n\t\r]/g,B=/\s+/,X=/\r/g,G=/^(?:button|input)$/i,W=/^(?:button|input|object|select|textarea)$/i,H=/^a(?:rea)?$/i,j=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,V=$.support.getSetAttribute;$.fn.extend({attr:function(t,e){return $.access(this,t,e,!0,$.attr)},removeAttr:function(t){return this.each(function(){$.removeAttr(this,t)})},prop:function(t,e){return $.access(this,t,e,!0,$.prop)},removeProp:function(t){return t=$.propFix[t]||t,this.each(function(){try{this[t]=e,delete this[t]}catch(i){}})},addClass:function(t){var e,i,r,a,s,n,o;if($.isFunction(t))return this.each(function(e){$(this).addClass(t.call(this,e,this.className))});if(t&&"string"==typeof t)for(e=t.split(B),i=0,r=this.length;r>i;i++)if(a=this[i],1===a.nodeType)if(a.className||1!==e.length){for(s=" "+a.className+" ",n=0,o=e.length;o>n;n++)~s.indexOf(" "+e[n]+" ")||(s+=e[n]+" ");a.className=$.trim(s)}else a.className=t;return this},removeClass:function(t){var i,r,a,s,n,o,l;if($.isFunction(t))return this.each(function(e){$(this).removeClass(t.call(this,e,this.className))});if(t&&"string"==typeof t||t===e)for(i=(t||"").split(B),r=0,a=this.length;a>r;r++)if(s=this[r],1===s.nodeType&&s.className)if(t){for(n=(" "+s.className+" ").replace(N," "),o=0,l=i.length;l>o;o++)n=n.replace(" "+i[o]+" "," ");s.className=$.trim(n)}else s.className="";return this},toggleClass:function(t,e){var i=typeof t,r="boolean"==typeof e;return $.isFunction(t)?this.each(function(i){$(this).toggleClass(t.call(this,i,this.className,e),e)}):this.each(function(){if("string"===i)for(var a,s=0,n=$(this),o=e,l=t.split(B);a=l[s++];)o=r?o:!n.hasClass(a),n[o?"addClass":"removeClass"](a);else("undefined"===i||"boolean"===i)&&(this.className&&$._data(this,"__className__",this.className),this.className=this.className||!1===t?"":$._data(this,"__className__")||"")})},hasClass:function(t){for(var t=" "+t+" ",e=0,i=this.length;i>e;e++)if(1===this[e].nodeType&&-1<(" "+this[e].className+" ").replace(N," ").indexOf(t))return!0;return!1},val:function(t){var i,r,a,s=this[0];return arguments.length?(a=$.isFunction(t),this.each(function(r){var s=$(this);1!==this.nodeType||(r=a?t.call(this,r,s.val()):t,null==r?r="":"number"==typeof r?r+="":$.isArray(r)&&(r=$.map(r,function(t){return null==t?"":t+""})),i=$.valHooks[this.nodeName.toLowerCase()]||$.valHooks[this.type],i&&"set"in i&&i.set(this,r,"value")!==e)||(this.value=r)})):s?(i=$.valHooks[s.nodeName.toLowerCase()]||$.valHooks[s.type])&&"get"in i&&(r=i.get(s,"value"))!==e?r:(r=s.value,
"string"==typeof r?r.replace(X,""):null==r?"":r):void 0}}),$.extend({valHooks:{option:{get:function(t){var e=t.attributes.value;return!e||e.specified?t.value:t.text}},select:{get:function(t){var e,i,r=t.selectedIndex,a=[],s=t.options,n="select-one"===t.type;if(0>r)return null;for(t=n?r:0,i=n?r+1:s.length;i>t;t++)if(e=s[t],!(!e.selected||($.support.optDisabled?e.disabled:null!==e.getAttribute("disabled"))||e.parentNode.disabled&&$.nodeName(e.parentNode,"optgroup"))){if(e=$(e).val(),n)return e;a.push(e)}return n&&!a.length&&s.length?$(s[r]).val():a},set:function(t,e){var i=$.makeArray(e);return $(t).find("option").each(function(){this.selected=0<=$.inArray($(this).val(),i)}),i.length||(t.selectedIndex=-1),i}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(t,i,r,a){var s,n,o=t.nodeType;if(t&&3!==o&&8!==o&&2!==o){if(a&&i in $.attrFn)return $(t)[i](r);if("undefined"==typeof t.getAttribute)return $.prop(t,i,r);if((a=1!==o||!$.isXMLDoc(t))&&(i=i.toLowerCase(),n=$.attrHooks[i]||(j.test(i)?F:P)),r===e)return n&&"get"in n&&a&&null!==(s=n.get(t,i))?s:(s=t.getAttribute(i),null===s?e:s);if(null!==r)return n&&"set"in n&&a&&(s=n.set(t,r,i))!==e?s:(t.setAttribute(i,""+r),r);$.removeAttr(t,i)}},removeAttr:function(t,e){var i,r,a,s,n=0;if(e&&1===t.nodeType)for(r=e.toLowerCase().split(B),s=r.length;s>n;n++)(a=r[n])&&(i=$.propFix[a]||a,$.attr(t,a,""),t.removeAttribute(V?a:i),j.test(a)&&i in t&&(t[i]=!1))},attrHooks:{type:{set:function(t,e){if(G.test(t.nodeName)&&t.parentNode)$.error("type property can't be changed");else if(!$.support.radioValue&&"radio"===e&&$.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}},value:{get:function(t,e){return P&&$.nodeName(t,"button")?P.get(t,e):e in t?t.value:null},set:function(t,e,i){return P&&$.nodeName(t,"button")?P.set(t,e,i):void(t.value=e)}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(t,i,r){var a,s,n=t.nodeType;return t&&3!==n&&8!==n&&2!==n?(1===n&&$.isXMLDoc(t)||(i=$.propFix[i]||i,s=$.propHooks[i]),r!==e?s&&"set"in s&&(a=s.set(t,r,i))!==e?a:t[i]=r:s&&"get"in s&&null!==(a=s.get(t,i))?a:t[i]):void 0},propHooks:{tabIndex:{get:function(t){var i=t.getAttributeNode("tabindex");return i&&i.specified?parseInt(i.value,10):W.test(t.nodeName)||H.test(t.nodeName)&&t.href?0:e}}}}),$.attrHooks.tabindex=$.propHooks.tabIndex,F={get:function(t,i){var r,a=$.prop(t,i);return!0===a||"boolean"!=typeof a&&(r=t.getAttributeNode(i))&&!1!==r.nodeValue?i.toLowerCase():e},set:function(t,e,i){return!1===e?$.removeAttr(t,i):(e=$.propFix[i]||i,e in t&&(t[e]=!0),t.setAttribute(i,i.toLowerCase())),i}},V||(O={name:!0,id:!0},P=$.valHooks.button={get:function(t,i){var r;return(r=t.getAttributeNode(i))&&(O[i]?""!==r.nodeValue:r.specified)?r.nodeValue:e},set:function(t,e,i){var r=t.getAttributeNode(i);return r||(r=k.createAttribute(i),t.setAttributeNode(r)),r.nodeValue=e+""}},$.attrHooks.tabindex.set=P.set,$.each(["width","height"],function(t,e){$.attrHooks[e]=$.extend($.attrHooks[e],{set:function(t,i){return""===i?(t.setAttribute(e,"auto"),i):void 0}})}),$.attrHooks.contenteditable={get:P.get,set:function(t,e,i){""===e&&(e="false"),P.set(t,e,i)}}),$.support.hrefNormalized||$.each(["href","src","width","height"],function(t,i){$.attrHooks[i]=$.extend($.attrHooks[i],{get:function(t){return t=t.getAttribute(i,2),null===t?e:t}})}),$.support.style||($.attrHooks.style={get:function(t){return t.style.cssText.toLowerCase()||e},set:function(t,e){return t.style.cssText=""+e}}),$.support.optSelected||($.propHooks.selected=$.extend($.propHooks.selected,{get:function(){return null}})),$.support.enctype||($.propFix.enctype="encoding"),$.support.checkOn||$.each(["radio","checkbox"],function(){$.valHooks[this]={get:function(t){return null===t.getAttribute("value")?"on":t.value}}}),$.each(["radio","checkbox"],function(){$.valHooks[this]=$.extend($.valHooks[this],{set:function(t,e){return $.isArray(e)?t.checked=0<=$.inArray($(t).val(),e):void 0}})});var Y=/^(?:textarea|input|select)$/i,z=/^([^\.]*)?(?:\.(.+))?$/,U=/\bhover(\.\S+)?\b/,q=/^key/,Q=/^(?:mouse|contextmenu)|click/,Z=/^(?:focusinfocus|focusoutblur)$/,K=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,J=function(t){return(t=K.exec(t))&&(t[1]=(t[1]||"").toLowerCase(),t[3]=t[3]&&RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")),t},tt=function(t){return $.event.special.hover?t:t.replace(U,"mouseenter$1 mouseleave$1")};$.event={add:function(t,i,r,a,s){var n,o,l,h,p,c,d,u,f;if(3!==t.nodeType&&8!==t.nodeType&&i&&r&&(n=$._data(t))){for(r.handler&&(d=r,r=d.handler),r.guid||(r.guid=$.guid++),l=n.events,l||(n.events=l={}),o=n.handle,o||(n.handle=o=function(t){return"undefined"==typeof $||t&&$.event.triggered===t.type?e:$.event.dispatch.apply(o.elem,arguments)},o.elem=t),i=$.trim(tt(i)).split(" "),n=0;n<i.length;n++)h=z.exec(i[n])||[],p=h[1],c=(h[2]||"").split(".").sort(),f=$.event.special[p]||{},p=(s?f.delegateType:f.bindType)||p,f=$.event.special[p]||{},h=$.extend({type:p,origType:h[1],data:a,handler:r,guid:r.guid,selector:s,quick:J(s),namespace:c.join(".")},d),u=l[p],u||(u=l[p]=[],u.delegateCount=0,f.setup&&!1!==f.setup.call(t,a,c,o))||(t.addEventListener?t.addEventListener(p,o,!1):t.attachEvent&&t.attachEvent("on"+p,o)),f.add&&(f.add.call(t,h),!h.handler.guid)&&(h.handler.guid=r.guid),s?u.splice(u.delegateCount++,0,h):u.push(h),$.event.global[p]=!0;t=null}},global:{},remove:function(t,e,i,r,a){var s,n,o,l,h,p,c,d,u,f,m=$.hasData(t)&&$._data(t);if(m&&(c=m.events)){for(e=$.trim(tt(e||"")).split(" "),s=0;s<e.length;s++)if(n=z.exec(e[s])||[],o=l=n[1],n=n[2],o){for(d=$.event.special[o]||{},o=(r?d.delegateType:d.bindType)||o,u=c[o]||[],h=u.length,n=n?RegExp("(^|\\.)"+n.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null,p=0;p<u.length;p++)f=u[p],!a&&l!==f.origType||i&&i.guid!==f.guid||n&&!n.test(f.namespace)||r&&r!==f.selector&&("**"!==r||!f.selector)||(u.splice(p--,1),f.selector&&u.delegateCount--,d.remove&&d.remove.call(t,f));0===u.length&&h!==u.length&&((!d.teardown||!1===d.teardown.call(t,n))&&$.removeEvent(t,o,m.handle),delete c[o])}else for(o in c)$.event.remove(t,o+e[s],i,r,!0);$.isEmptyObject(c)&&((e=m.handle)&&(e.elem=null),$.removeData(t,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(i,r,a,s){if(!a||3!==a.nodeType&&8!==a.nodeType){var n,o,l,h,p,c=i.type||i,d=[];if(!Z.test(c+$.event.triggered)&&(0<=c.indexOf("!")&&(c=c.slice(0,-1),n=!0),0<=c.indexOf(".")&&(d=c.split("."),c=d.shift(),d.sort()),a&&!$.event.customEvent[c]||$.event.global[c]))if(i="object"==typeof i?i[$.expando]?i:new $.Event(c,i):new $.Event(c),i.type=c,i.isTrigger=!0,i.exclusive=n,i.namespace=d.join("."),i.namespace_re=i.namespace?RegExp("(^|\\.)"+d.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,n=0>c.indexOf(":")?"on"+c:"",a){if(i.result=e,i.target||(i.target=a),r=null!=r?$.makeArray(r):[],r.unshift(i),l=$.event.special[c]||{},!l.trigger||!1!==l.trigger.apply(a,r)){if(p=[[a,l.bindType||c]],!s&&!l.noBubble&&!$.isWindow(a)){for(h=l.delegateType||c,d=Z.test(h+c)?a:a.parentNode,o=null;d;d=d.parentNode)p.push([d,h]),o=d;o&&o===a.ownerDocument&&p.push([o.defaultView||o.parentWindow||t,h])}for(o=0;o<p.length&&!i.isPropagationStopped();o++)d=p[o][0],i.type=p[o][1],(h=($._data(d,"events")||{})[i.type]&&$._data(d,"handle"))&&h.apply(d,r),(h=n&&d[n])&&$.acceptData(d)&&!1===h.apply(d,r)&&i.preventDefault();return i.type=c,s||i.isDefaultPrevented()||l._default&&!1!==l._default.apply(a.ownerDocument,r)||"click"===c&&$.nodeName(a,"a")||!$.acceptData(a)||n&&a[c]&&("focus"!==c&&"blur"!==c||0!==i.target.offsetWidth)&&!$.isWindow(a)&&((o=a[n])&&(a[n]=null),$.event.triggered=c,a[c](),$.event.triggered=e,o&&(a[n]=o)),i.result}}else for(o in a=$.cache)a[o].events&&a[o].events[c]&&$.event.trigger(i,r,a[o].handle.elem,!0)}},dispatch:function(i){var r,a,s,n,o,l,h,i=$.event.fix(i||t.event),p=($._data(this,"events")||{})[i.type]||[],c=p.delegateCount,d=[].slice.call(arguments,0),u=!i.exclusive&&!i.namespace,f=[];if(d[0]=i,i.delegateTarget=this,c&&!i.target.disabled&&(!i.button||"click"!==i.type))for(s=$(this),s.context=this.ownerDocument||this,a=i.target;a!=this;a=a.parentNode||this){for(o={},l=[],s[0]=a,r=0;c>r;r++){if(n=p[r],h=n.selector,o[h]===e){var m,y=o,g=h;if(n.quick){m=n.quick;var v=a.attributes||{};m=!(m[1]&&a.nodeName.toLowerCase()!==m[1]||m[2]&&(v.id||{}).value!==m[2]||m[3]&&!m[3].test((v["class"]||{}).value))}else m=s.is(h);y[g]=m}o[h]&&l.push(n)}l.length&&f.push({elem:a,matches:l})}for(p.length>c&&f.push({elem:this,matches:p.slice(c)}),r=0;r<f.length&&!i.isPropagationStopped();r++)for(c=f[r],i.currentTarget=c.elem,p=0;p<c.matches.length&&!i.isImmediatePropagationStopped();p++)n=c.matches[p],(u||!i.namespace&&!n.namespace||i.namespace_re&&i.namespace_re.test(n.namespace))&&(i.data=n.data,i.handleObj=n,n=(($.event.special[n.origType]||{}).handle||n.handler).apply(c.elem,d),n!==e&&(i.result=n,!1===n&&(i.preventDefault(),i.stopPropagation())));return i.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,i){var r,a,s=i.button,n=i.fromElement;return null==t.pageX&&null!=i.clientX&&(r=t.target.ownerDocument||k,a=r.documentElement,r=r.body,t.pageX=i.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0),t.pageY=i.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)),!t.relatedTarget&&n&&(t.relatedTarget=n===t.target?i.toElement:n),t.which||s===e||(t.which=1&s?1:2&s?3:4&s?2:0),t}},fix:function(t){if(t[$.expando])return t;var i,r,a=t,s=$.event.fixHooks[t.type]||{},n=s.props?this.props.concat(s.props):this.props,t=$.Event(a);for(i=n.length;i;)r=n[--i],t[r]=a[r];return t.target||(t.target=a.srcElement||k),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey===e&&(t.metaKey=t.ctrlKey),s.filter?s.filter(t,a):t},special:{ready:{setup:$.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(t,e,i){$.isWindow(this)&&(this.onbeforeunload=i)},teardown:function(t,e){this.onbeforeunload===e&&(this.onbeforeunload=null)}}},simulate:function(t,e,i,r){t=$.extend(new $.Event,i,{type:t,isSimulated:!0,originalEvent:{}}),r?$.event.trigger(t,null,e):$.event.dispatch.call(e,t),t.isDefaultPrevented()&&i.preventDefault()}},$.event.handle=$.event.dispatch,$.removeEvent=k.removeEventListener?function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i,!1)}:function(t,e,i){t.detachEvent&&t.detachEvent("on"+e,i)},$.Event=function(t,e){return this instanceof $.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||!1===t.returnValue||t.getPreventDefault&&t.getPreventDefault()?o:n):this.type=t,e&&$.extend(this,e),this.timeStamp=t&&t.timeStamp||$.now(),void(this[$.expando]=!0)):new $.Event(t,e)},$.Event.prototype={preventDefault:function(){this.isDefaultPrevented=o;var t=this.originalEvent;t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=o;var t=this.originalEvent;t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=o,this.stopPropagation()},isDefaultPrevented:n,isPropagationStopped:n,isImmediatePropagationStopped:n},$.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,e){$.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,r=t.relatedTarget,a=t.handleObj;return(!r||r!==this&&!$.contains(this,r))&&(t.type=a.origType,i=a.handler.apply(this,arguments),t.type=e),i}}}),$.support.submitBubbles||($.event.special.submit={setup:function(){return $.nodeName(this,"form")?!1:void $.event.add(this,"click._submit keypress._submit",function(t){t=t.target,(t=$.nodeName(t,"input")||$.nodeName(t,"button")?t.form:e)&&!t._submit_attached&&($.event.add(t,"submit._submit",function(t){this.parentNode&&!t.isTrigger&&$.event.simulate("submit",this.parentNode,t,!0)}),t._submit_attached=!0)})},teardown:function(){return $.nodeName(this,"form")?!1:void $.event.remove(this,"._submit")}}),$.support.changeBubbles||($.event.special.change={setup:function(){return Y.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&($.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._just_changed=!0)}),$.event.add(this,"click._change",function(t){this._just_changed&&!t.isTrigger&&(this._just_changed=!1,$.event.simulate("change",this,t,!0))})),!1):void $.event.add(this,"beforeactivate._change",function(t){t=t.target,Y.test(t.nodeName)&&!t._change_attached&&($.event.add(t,"change._change",function(t){this.parentNode&&!t.isSimulated&&!t.isTrigger&&$.event.simulate("change",this.parentNode,t,!0)}),t._change_attached=!0)})},handle:function(t){var e=t.target;return this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type?t.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return $.event.remove(this,"._change"),Y.test(this.nodeName)}}),$.support.focusinBubbles||$.each({focus:"focusin",blur:"focusout"},function(t,e){var i=0,r=function(t){$.event.simulate(e,t.target,$.event.fix(t),!0)};$.event.special[e]={setup:function(){0===i++&&k.addEventListener(t,r,!0)},teardown:function(){0===--i&&k.removeEventListener(t,r,!0)}}}),$.fn.extend({on:function(t,i,r,a,s){var o,l;if("object"==typeof t){"string"!=typeof i&&(r=i,i=e);for(l in t)this.on(l,i,r,t[l],s);return this}if(null==r&&null==a?(a=i,r=i=e):null==a&&("string"==typeof i?(a=r,r=e):(a=r,r=i,i=e)),!1===a)a=n;else if(!a)return this;return 1===s&&(o=a,a=function(t){return $().off(t),o.apply(this,arguments)},a.guid=o.guid||(o.guid=$.guid++)),this.each(function(){$.event.add(this,t,a,r,i)})},one:function(t,e,i,r){return this.on.call(this,t,e,i,r,1)},off:function(t,i,r){if(t&&t.preventDefault&&t.handleObj){var a=t.handleObj;return $(t.delegateTarget).off(a.namespace?a.type+"."+a.namespace:a.type,a.selector,a.handler),this}if("object"==typeof t){for(a in t)this.off(a,i,t[a]);return this}return(!1===i||"function"==typeof i)&&(r=i,i=e),!1===r&&(r=n),this.each(function(){$.event.remove(this,t,r,i)})},bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},live:function(t,e,i){return $(this.context).on(t,this.selector,e,i),this},die:function(t,e){return $(this.context).off(t,this.selector||"**",e),this},delegate:function(t,e,i,r){return this.on(e,t,i,r)},undelegate:function(t,e,i){return 1==arguments.length?this.off(t,"**"):this.off(e,t,i)},trigger:function(t,e){return this.each(function(){$.event.trigger(t,e,this)})},triggerHandler:function(t,e){return this[0]?$.event.trigger(t,e,this[0],!0):void 0},toggle:function(t){var e=arguments,i=t.guid||$.guid++,r=0,a=function(i){var a=($._data(this,"lastToggle"+t.guid)||0)%r;return $._data(this,"lastToggle"+t.guid,a+1),i.preventDefault(),e[a].apply(this,arguments)||!1};for(a.guid=i;r<e.length;)e[r++].guid=i;return this.click(a)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),$.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){$.fn[e]=function(t,i){return null==i&&(i=t,t=null),0<arguments.length?this.on(e,null,t,i):this.trigger(e)},$.attrFn&&($.attrFn[e]=!0),q.test(e)&&($.event.fixHooks[e]=$.event.keyHooks),Q.test(e)&&($.event.fixHooks[e]=$.event.mouseHooks)}),function(){function t(t,e,i,r,s,n){for(var s=0,o=r.length;o>s;s++){var l=r[s];if(l){for(var h=!1,l=l[t];l;){if(l[a]===i){h=r[l.sizset];break}if(1!==l.nodeType||n||(l[a]=i,l.sizset=s),l.nodeName.toLowerCase()===e){h=l;break}l=l[t]}r[s]=h}}}function i(t,e,i,r,s,n){for(var s=0,o=r.length;o>s;s++){var l=r[s];if(l){for(var h=!1,l=l[t];l;){if(l[a]===i){h=r[l.sizset];break}if(1===l.nodeType)if(n||(l[a]=i,l.sizset=s),"string"!=typeof e){if(l===e){h=!0;break}}else if(0<d.filter(e,[l]).length){h=l;break}l=l[t]}r[s]=h}}}var r=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,a="sizcache"+(Math.random()+"").replace(".",""),s=0,n=Object.prototype.toString,o=!1,l=!0,h=/\\/g,p=/\r\n/g,c=/\W/;[0,0].sort(function(){return l=!1,0});var d=function(t,e,i,a){var i=i||[],s=e=e||k;if(1!==e.nodeType&&9!==e.nodeType)return[];if(!t||"string"!=typeof t)return i;var o,l,h,p,c,u=!0,f=d.isXML(e),g=[],b=t;do if(r.exec(""),(o=r.exec(b))&&(b=o[3],g.push(o[1]),o[2])){p=o[3];break}while(o);if(1<g.length&&y.exec(t))if(2===g.length&&m.relative[g[0]])l=S(g[0]+g[1],e,a);else for(l=m.relative[g[0]]?[e]:d(g.shift(),e);g.length;)t=g.shift(),m.relative[t]&&(t+=g.shift()),l=S(t,l,a);else if(!a&&1<g.length&&9===e.nodeType&&!f&&m.match.ID.test(g[0])&&!m.match.ID.test(g[g.length-1])&&(o=d.find(g.shift(),e,f),e=o.expr?d.filter(o.expr,o.set)[0]:o.set[0]),e)for(o=a?{expr:g.pop(),set:v(a)}:d.find(g.pop(),1!==g.length||"~"!==g[0]&&"+"!==g[0]||!e.parentNode?e:e.parentNode,f),l=o.expr?d.filter(o.expr,o.set):o.set,0<g.length?h=v(l):u=!1;g.length;)o=c=g.pop(),m.relative[c]?o=g.pop():c="",null==o&&(o=e),m.relative[c](h,o,f);else h=[];if(h||(h=l),h||d.error(c||t),"[object Array]"===n.call(h))if(u)if(e&&1===e.nodeType)for(t=0;null!=h[t];t++)h[t]&&(!0===h[t]||1===h[t].nodeType&&d.contains(e,h[t]))&&i.push(l[t]);else for(t=0;null!=h[t];t++)h[t]&&1===h[t].nodeType&&i.push(l[t]);else i.push.apply(i,h);else v(h,i);return p&&(d(p,s,i,a),d.uniqueSort(i)),i};d.uniqueSort=function(t){if(w&&(o=l,t.sort(w),o))for(var e=1;e<t.length;e++)t[e]===t[e-1]&&t.splice(e--,1);return t},d.matches=function(t,e){return d(t,null,null,e)},d.matchesSelector=function(t,e){return 0<d(e,null,null,[t]).length},d.find=function(t,e,i){var r,a,s,n,o,l;if(!t)return[];for(a=0,s=m.order.length;s>a;a++)if(o=m.order[a],(n=m.leftMatch[o].exec(t))&&(l=n[1],n.splice(1,1),"\\"!==l.substr(l.length-1)&&(n[1]=(n[1]||"").replace(h,""),r=m.find[o](n,e,i),null!=r))){t=t.replace(m.match[o],"");break}return r||(r="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName("*"):[]),{set:r,expr:t}},d.filter=function(t,i,r,a){for(var s,n,o,l,h,p,c,u,f=t,y=[],g=i,v=i&&i[0]&&d.isXML(i[0]);t&&i.length;){for(o in m.filter)if(null!=(s=m.leftMatch[o].exec(t))&&s[2]&&(p=m.filter[o],h=s[1],n=!1,s.splice(1,1),"\\"!==h.substr(h.length-1))){if(g===y&&(y=[]),m.preFilter[o])if(s=m.preFilter[o](s,g,r,y,a,v)){if(!0===s)continue}else n=l=!0;if(s)for(c=0;null!=(h=g[c]);c++)h&&(l=p(h,s,c,g),u=a^l,r&&null!=l?u?n=!0:g[c]=!1:u&&(y.push(h),n=!0));if(l!==e){if(r||(g=y),t=t.replace(m.match[o],""),!n)return[];break}}if(t===f){if(null!=n)break;d.error(t)}f=t}return g},d.error=function(t){throw Error("Syntax error, unrecognized expression: "+t)};var u,f=d.getText=function(t){var e,i;e=t.nodeType;var r="";if(e){if(1===e||9===e){if("string"==typeof t.textContent)return t.textContent;if("string"==typeof t.innerText)return t.innerText.replace(p,"");for(t=t.firstChild;t;t=t.nextSibling)r+=f(t)}else if(3===e||4===e)return t.nodeValue}else for(e=0;i=t[e];e++)8!==i.nodeType&&(r+=f(i));return r},m=d.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(t){return t.getAttribute("href")},type:function(t){return t.getAttribute("type")}},relative:{"+":function(t,e){var i="string"==typeof e,r=i&&!c.test(e),i=i&&!r;r&&(e=e.toLowerCase());for(var a,r=0,s=t.length;s>r;r++)if(a=t[r]){for(;(a=a.previousSibling)&&1!==a.nodeType;);t[r]=i||a&&a.nodeName.toLowerCase()===e?a||!1:a===e}i&&d.filter(e,t,!0)},">":function(t,e){var i,r="string"==typeof e,a=0,s=t.length;if(r&&!c.test(e))for(e=e.toLowerCase();s>a;a++)(i=t[a])&&(i=i.parentNode,t[a]=i.nodeName.toLowerCase()===e?i:!1);else{for(;s>a;a++)(i=t[a])&&(t[a]=r?i.parentNode:i.parentNode===e);r&&d.filter(e,t,!0)}},"":function(e,r,a){var n,o=s++,l=i;"string"==typeof r&&!c.test(r)&&(n=r=r.toLowerCase(),l=t),l("parentNode",r,o,e,n,a)},"~":function(e,r,a){var n,o=s++,l=i;"string"==typeof r&&!c.test(r)&&(n=r=r.toLowerCase(),l=t),l("previousSibling",r,o,e,n,a)}},find:{ID:function(t,e,i){return"undefined"==typeof e.getElementById||i?void 0:(t=e.getElementById(t[1]))&&t.parentNode?[t]:[]},NAME:function(t,e){if("undefined"!=typeof e.getElementsByName){for(var i=[],r=e.getElementsByName(t[1]),a=0,s=r.length;s>a;a++)r[a].getAttribute("name")===t[1]&&i.push(r[a]);return 0===i.length?null:i}},TAG:function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t[1]):void 0}},preFilter:{CLASS:function(t,e,i,r,a,s){if(t=" "+t[1].replace(h,"")+" ",s)return t;for(var n,s=0;null!=(n=e[s]);s++)n&&(a^(n.className&&0<=(" "+n.className+" ").replace(/[\t\n\r]/g," ").indexOf(t))?i||r.push(n):i&&(e[s]=!1));return!1},ID:function(t){return t[1].replace(h,"")},TAG:function(t){return t[1].replace(h,"").toLowerCase()},CHILD:function(t){if("nth"===t[1]){t[2]||d.error(t[0]),t[2]=t[2].replace(/^\+|\s*/g,"");var e=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec("even"===t[2]&&"2n"||"odd"===t[2]&&"2n+1"||!/\D/.test(t[2])&&"0n+"+t[2]||t[2]);t[2]=e[1]+(e[2]||1)-0,t[3]=e[3]-0}else t[2]&&d.error(t[0]);return t[0]=s++,t},ATTR:function(t,e,i,r,a,s){return e=t[1]=t[1].replace(h,""),!s&&m.attrMap[e]&&(t[1]=m.attrMap[e]),t[4]=(t[4]||t[5]||"").replace(h,""),"~="===t[2]&&(t[4]=" "+t[4]+" "),t},PSEUDO:function(t,e,i,a,s){if("not"===t[1]){if(!(1<(r.exec(t[3])||"").length||/^\w/.test(t[3])))return t=d.filter(t[3],e,i,1^s),i||a.push.apply(a,t),!1;t[3]=d(t[3],null,null,e)}else if(m.match.POS.test(t[0])||m.match.CHILD.test(t[0]))return!0;return t},POS:function(t){return t.unshift(!0),t}},filters:{enabled:function(t){return!1===t.disabled&&"hidden"!==t.type},disabled:function(t){return!0===t.disabled},checked:function(t){return!0===t.checked},selected:function(t){return!0===t.selected},parent:function(t){return!!t.firstChild},empty:function(t){return!t.firstChild},has:function(t,e,i){return!!d(i[3],t).length},header:function(t){return/h\d/i.test(t.nodeName)},text:function(t){var e=t.getAttribute("type"),i=t.type;return"input"===t.nodeName.toLowerCase()&&"text"===i&&(e===i||null===e)},radio:function(t){return"input"===t.nodeName.toLowerCase()&&"radio"===t.type},checkbox:function(t){return"input"===t.nodeName.toLowerCase()&&"checkbox"===t.type},file:function(t){return"input"===t.nodeName.toLowerCase()&&"file"===t.type},password:function(t){return"input"===t.nodeName.toLowerCase()&&"password"===t.type},submit:function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&"submit"===t.type},image:function(t){return"input"===t.nodeName.toLowerCase()&&"image"===t.type},reset:function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&"reset"===t.type},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},input:function(t){return/input|select|textarea|button/i.test(t.nodeName)},focus:function(t){return t===t.ownerDocument.activeElement}},setFilters:{first:function(t,e){return 0===e},last:function(t,e,i,r){return e===r.length-1},even:function(t,e){return 0===e%2},odd:function(t,e){return 1===e%2},lt:function(t,e,i){return e<i[3]-0},gt:function(t,e,i){return e>i[3]-0},nth:function(t,e,i){return i[3]-0===e},eq:function(t,e,i){return i[3]-0===e}},filter:{PSEUDO:function(t,e,i,r){var a=e[1],s=m.filters[a];if(s)return s(t,i,e,r);if("contains"===a)return 0<=(t.textContent||t.innerText||f([t])||"").indexOf(e[3]);if("not"===a){for(e=e[3],i=0,r=e.length;r>i;i++)if(e[i]===t)return!1;return!0}d.error(a)},CHILD:function(t,e){var i,r,s,n,o,l;switch(i=e[1],l=t,i){case"only":case"first":for(;l=l.previousSibling;)if(1===l.nodeType)return!1;if("first"===i)return!0;l=t;case"last":for(;l=l.nextSibling;)if(1===l.nodeType)return!1;return!0;case"nth":if(i=e[2],r=e[3],1===i&&0===r)return!0;if(s=e[0],(n=t.parentNode)&&(n[a]!==s||!t.nodeIndex)){for(o=0,l=n.firstChild;l;l=l.nextSibling)1===l.nodeType&&(l.nodeIndex=++o);n[a]=s}return l=t.nodeIndex-r,0===i?0===l:0===l%i&&l/i>=0}},ID:function(t,e){return 1===t.nodeType&&t.getAttribute("id")===e},TAG:function(t,e){return"*"===e&&1===t.nodeType||!!t.nodeName&&t.nodeName.toLowerCase()===e},CLASS:function(t,e){return-1<(" "+(t.className||t.getAttribute("class"))+" ").indexOf(e)},ATTR:function(t,e){var i=e[1],i=d.attr?d.attr(t,i):m.attrHandle[i]?m.attrHandle[i](t):null!=t[i]?t[i]:t.getAttribute(i),r=i+"",a=e[2],s=e[4];return null==i?"!="===a:!a&&d.attr?null!=i:"="===a?r===s:"*="===a?0<=r.indexOf(s):"~="===a?0<=(" "+r+" ").indexOf(s):s?"!="===a?r!==s:"^="===a?0===r.indexOf(s):"$="===a?r.substr(r.length-s.length)===s:"|="===a?r===s||r.substr(0,s.length+1)===s+"-":!1:r&&!1!==i},POS:function(t,e,i,r){var a=m.setFilters[e[2]];return a?a(t,i,e,r):void 0}}},y=m.match.POS,g=function(t,e){return"\\"+(e-0+1)};for(u in m.match)m.match[u]=RegExp(m.match[u].source+/(?![^\[]*\])(?![^\(]*\))/.source),m.leftMatch[u]=RegExp(/(^(?:.|\r|\n)*?)/.source+m.match[u].source.replace(/\\(\d+)/g,g));var v=function(t,e){return t=Array.prototype.slice.call(t,0),e?(e.push.apply(e,t),e):t};try{Array.prototype.slice.call(k.documentElement.childNodes,0)}catch(b){v=function(t,e){var i=0,r=e||[];if("[object Array]"===n.call(t))Array.prototype.push.apply(r,t);else if("number"==typeof t.length)for(var a=t.length;a>i;i++)r.push(t[i]);else for(;t[i];i++)r.push(t[i]);return r}}var w,x;k.documentElement.compareDocumentPosition?w=function(t,e){return t===e?(o=!0,0):t.compareDocumentPosition&&e.compareDocumentPosition?4&t.compareDocumentPosition(e)?-1:1:t.compareDocumentPosition?-1:1}:(w=function(t,e){if(t===e)return o=!0,0;if(t.sourceIndex&&e.sourceIndex)return t.sourceIndex-e.sourceIndex;var i,r,a=[],s=[];i=t.parentNode,r=e.parentNode;var n=i;if(i===r)return x(t,e);if(!i)return-1;if(!r)return 1;for(;n;)a.unshift(n),n=n.parentNode;for(n=r;n;)s.unshift(n),n=n.parentNode;for(i=a.length,r=s.length,n=0;i>n&&r>n;n++)if(a[n]!==s[n])return x(a[n],s[n]);return n===i?x(t,s[n],-1):x(a[n],e,1)},x=function(t,e,i){if(t===e)return i;for(t=t.nextSibling;t;){if(t===e)return-1;t=t.nextSibling}return 1}),function(){var t=k.createElement("div"),i="script"+(new Date).getTime(),r=k.documentElement;t.innerHTML="<a name='"+i+"'/>",r.insertBefore(t,r.firstChild),k.getElementById(i)&&(m.find.ID=function(t,i,r){return"undefined"==typeof i.getElementById||r?void 0:(i=i.getElementById(t[1]))?i.id===t[1]||"undefined"!=typeof i.getAttributeNode&&i.getAttributeNode("id").nodeValue===t[1]?[i]:e:[]},m.filter.ID=function(t,e){var i="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return 1===t.nodeType&&i&&i.nodeValue===e}),r.removeChild(t),r=t=null}(),function(){var t=k.createElement("div");t.appendChild(k.createComment("")),0<t.getElementsByTagName("*").length&&(m.find.TAG=function(t,e){var i=e.getElementsByTagName(t[1]);if("*"===t[1]){for(var r=[],a=0;i[a];a++)1===i[a].nodeType&&r.push(i[a]);i=r}return i}),t.innerHTML="<a href='#'></a>",t.firstChild&&"undefined"!=typeof t.firstChild.getAttribute&&"#"!==t.firstChild.getAttribute("href")&&(m.attrHandle.href=function(t){return t.getAttribute("href",2)}),t=null}(),k.querySelectorAll&&function(){var t=d,e=k.createElement("div");if(e.innerHTML="<p class='TEST'></p>",!e.querySelectorAll||0!==e.querySelectorAll(".TEST").length){d=function(e,i,r,a){if(i=i||k,!a&&!d.isXML(i)){var s=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(e);if(s&&(1===i.nodeType||9===i.nodeType)){if(s[1])return v(i.getElementsByTagName(e),r);if(s[2]&&m.find.CLASS&&i.getElementsByClassName)return v(i.getElementsByClassName(s[2]),r)}if(9===i.nodeType){if("body"===e&&i.body)return v([i.body],r);if(s&&s[3]){var n=i.getElementById(s[3]);if(!n||!n.parentNode)return v([],r);if(n.id===s[3])return v([n],r)}try{return v(i.querySelectorAll(e),r)}catch(o){}}else if(1===i.nodeType&&"object"!==i.nodeName.toLowerCase()){var s=i,l=(n=i.getAttribute("id"))||"__sizzle__",h=i.parentNode,p=/^\s*[+~]/.test(e);n?l=l.replace(/'/g,"\\$&"):i.setAttribute("id",l),p&&h&&(i=i.parentNode);try{if(!p||h)return v(i.querySelectorAll("[id='"+l+"'] "+e),r)}catch(c){}finally{n||s.removeAttribute("id")}}}return t(e,i,r,a)};for(var i in t)d[i]=t[i];e=null}}(),function(){var t=k.documentElement,e=t.matchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.msMatchesSelector;if(e){var i=!e.call(k.createElement("div"),"div"),r=!1;try{e.call(k.documentElement,"[test!='']:sizzle")}catch(a){r=!0}d.matchesSelector=function(t,a){if(a=a.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!d.isXML(t))try{if(r||!m.match.PSEUDO.test(a)&&!/!=/.test(a)){var s=e.call(t,a);if(s||!i||t.document&&11!==t.document.nodeType)return s}}catch(n){}return 0<d(a,null,null,[t]).length}}}(),function(){var t=k.createElement("div");t.innerHTML="<div class='test e'></div><div class='test'></div>",t.getElementsByClassName&&0!==t.getElementsByClassName("e").length&&(t.lastChild.className="e",1!==t.getElementsByClassName("e").length)&&(m.order.splice(1,0,"CLASS"),m.find.CLASS=function(t,e,i){return"undefined"==typeof e.getElementsByClassName||i?void 0:e.getElementsByClassName(t[1])},t=null)}(),d.contains=k.documentElement.contains?function(t,e){return t!==e&&(t.contains?t.contains(e):!0)}:k.documentElement.compareDocumentPosition?function(t,e){return!!(16&t.compareDocumentPosition(e))}:function(){return!1},d.isXML=function(t){return(t=(t?t.ownerDocument||t:0).documentElement)?"HTML"!==t.nodeName:!1};var S=function(t,e,i){for(var r,a=[],s="",e=e.nodeType?[e]:e;r=m.match.PSEUDO.exec(t);)s+=r[0],t=t.replace(m.match.PSEUDO,"");t=m.relative[t]?t+"*":t,r=0;for(var n=e.length;n>r;r++)d(t,e[r],a,i);return d.filter(s,a)};d.attr=$.attr,d.selectors.attrMap={},$.find=d,$.expr=d.selectors,$.expr[":"]=$.expr.filters,$.unique=d.uniqueSort,$.text=d.getText,$.isXMLDoc=d.isXML,$.contains=d.contains}();var et=/Until$/,it=/^(?:parents|prevUntil|prevAll)/,rt=/,/,at=/^.[^:#\[\.,]*$/,st=Array.prototype.slice,nt=$.expr.match.POS,ot={children:!0,contents:!0,next:!0,prev:!0};$.fn.extend({find:function(t){var e,i,r=this;if("string"!=typeof t)return $(t).filter(function(){for(e=0,i=r.length;i>e;e++)if($.contains(r[e],this))return!0});var a,s,n,o=this.pushStack("","find",t);for(e=0,i=this.length;i>e;e++)if(a=o.length,$.find(t,this[e],o),e>0)for(s=a;s<o.length;s++)for(n=0;a>n;n++)if(o[n]===o[s]){o.splice(s--,1);break}return o},has:function(t){var e=$(t);return this.filter(function(){for(var t=0,i=e.length;i>t;t++)if($.contains(this,e[t]))return!0})},not:function(t){return this.pushStack(l(this,t,!1),"not",t)},filter:function(t){return this.pushStack(l(this,t,!0),"filter",t)},is:function(t){return!!t&&("string"==typeof t?nt.test(t)?0<=$(t,this.context).index(this[0]):0<$.filter(t,this).length:0<this.filter(t).length)},closest:function(t,e){var i,r,a=[],s=this[0];if($.isArray(t)){for(r=1;s&&s.ownerDocument&&s!==e;){for(i=0;i<t.length;i++)$(s).is(t[i])&&a.push({selector:t[i],elem:s,level:r});s=s.parentNode,r++}return a}var n=nt.test(t)||"string"!=typeof t?$(t,e||this.context):0;
for(i=0,r=this.length;r>i;i++)for(s=this[i];s;){if(n?-1<n.index(s):$.find.matchesSelector(s,t)){a.push(s);break}if(s=s.parentNode,!s||!s.ownerDocument||s===e||11===s.nodeType)break}return a=1<a.length?$.unique(a):a,this.pushStack(a,"closest",t)},index:function(t){return t?"string"==typeof t?$.inArray(this[0],$(t)):$.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(t,e){var i="string"==typeof t?$(t,e):$.makeArray(t&&t.nodeType?[t]:t),r=$.merge(this.get(),i);return this.pushStack(i[0]&&i[0].parentNode&&11!==i[0].parentNode.nodeType&&r[0]&&r[0].parentNode&&11!==r[0].parentNode.nodeType?$.unique(r):r)},andSelf:function(){return this.add(this.prevObject)}}),$.each({parent:function(t){return(t=t.parentNode)&&11!==t.nodeType?t:null},parents:function(t){return $.dir(t,"parentNode")},parentsUntil:function(t,e,i){return $.dir(t,"parentNode",i)},next:function(t){return $.nth(t,2,"nextSibling")},prev:function(t){return $.nth(t,2,"previousSibling")},nextAll:function(t){return $.dir(t,"nextSibling")},prevAll:function(t){return $.dir(t,"previousSibling")},nextUntil:function(t,e,i){return $.dir(t,"nextSibling",i)},prevUntil:function(t,e,i){return $.dir(t,"previousSibling",i)},siblings:function(t){return $.sibling(t.parentNode.firstChild,t)},children:function(t){return $.sibling(t.firstChild)},contents:function(t){return $.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:$.makeArray(t.childNodes)}},function(t,e){$.fn[t]=function(i,r){var a=$.map(this,e,i);return et.test(t)||(r=i),r&&"string"==typeof r&&(a=$.filter(r,a)),a=1<this.length&&!ot[t]?$.unique(a):a,(1<this.length||rt.test(r))&&it.test(t)&&(a=a.reverse()),this.pushStack(a,t,st.call(arguments).join(","))}}),$.extend({filter:function(t,e,i){return i&&(t=":not("+t+")"),1===e.length?$.find.matchesSelector(e[0],t)?[e[0]]:[]:$.find.matches(t,e)},dir:function(t,i,r){for(var a=[],t=t[i];t&&9!==t.nodeType&&(r===e||1!==t.nodeType||!$(t).is(r));)1===t.nodeType&&a.push(t),t=t[i];return a},nth:function(t,e,i){for(var e=e||1,r=0;t&&(1!==t.nodeType||++r!==e);t=t[i]);return t},sibling:function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i}});var lt="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ht=/ jQuery\d+="(?:\d+|null)"/g,pt=/^\s+/,ct=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,dt=/<([\w:]+)/,ut=/<tbody/i,ft=/<|&#?\w+;/,mt=/<(?:script|style)/i,yt=/<(?:script|object|embed|option|style)/i,gt=RegExp("<(?:"+lt+")","i"),vt=/checked\s*(?:[^=]|=\s*.checked.)/i,bt=/\/(java|ecma)script/i,wt=/^\s*<!(?:\[CDATA\[|\-\-)/,xt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},St=h(k);xt.optgroup=xt.option,xt.tbody=xt.tfoot=xt.colgroup=xt.caption=xt.thead,xt.th=xt.td,$.support.htmlSerialize||(xt._default=[1,"div<div>","</div>"]),$.fn.extend({text:function(t){return $.isFunction(t)?this.each(function(e){var i=$(this);i.text(t.call(this,e,i.text()))}):"object"!=typeof t&&t!==e?this.empty().append((this[0]&&this[0].ownerDocument||k).createTextNode(t)):$.text(this)},wrapAll:function(t){if($.isFunction(t))return this.each(function(e){$(this).wrapAll(t.call(this,e))});if(this[0]){var e=$(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(t){return $.isFunction(t)?this.each(function(e){$(this).wrapInner(t.call(this,e))}):this.each(function(){var e=$(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=$.isFunction(t);return this.each(function(i){$(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(){return this.parent().each(function(){$.nodeName(this,"body")||$(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.appendChild(t)})},prepend:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.insertBefore(t,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this)});if(arguments.length){var t=$.clean(arguments);return t.push.apply(t,this.toArray()),this.pushStack(t,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this.nextSibling)});if(arguments.length){var t=this.pushStack(this,"after",arguments);return t.push.apply(t,$.clean(arguments)),t}},remove:function(t,e){for(var i,r=0;null!=(i=this[r]);r++)(!t||$.filter(t,[i]).length)&&(!e&&1===i.nodeType&&($.cleanData(i.getElementsByTagName("*")),$.cleanData([i])),i.parentNode&&i.parentNode.removeChild(i));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)for(1===t.nodeType&&$.cleanData(t.getElementsByTagName("*"));t.firstChild;)t.removeChild(t.firstChild);return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return $.clone(this,t,e)})},html:function(t){if(t===e)return this[0]&&1===this[0].nodeType?this[0].innerHTML.replace(ht,""):null;if("string"!=typeof t||mt.test(t)||!$.support.leadingWhitespace&&pt.test(t)||xt[(dt.exec(t)||["",""])[1].toLowerCase()])$.isFunction(t)?this.each(function(e){var i=$(this);i.html(t.call(this,e,i.html()))}):this.empty().append(t);else{t=t.replace(ct,"<$1></$2>");try{for(var i=0,r=this.length;r>i;i++)1===this[i].nodeType&&($.cleanData(this[i].getElementsByTagName("*")),this[i].innerHTML=t)}catch(a){this.empty().append(t)}}return this},replaceWith:function(t){return this[0]&&this[0].parentNode?$.isFunction(t)?this.each(function(e){var i=$(this),r=i.html();i.replaceWith(t.call(this,e,r))}):("string"!=typeof t&&(t=$(t).detach()),this.each(function(){var e=this.nextSibling,i=this.parentNode;$(this).remove(),e?$(e).before(t):$(i).append(t)})):this.length?this.pushStack($($.isFunction(t)?t():t),"replaceWith",t):this},detach:function(t){return this.remove(t,!0)},domManip:function(t,i,r){var a,s,n,o=t[0],l=[];if(!$.support.checkClone&&3===arguments.length&&"string"==typeof o&&vt.test(o))return this.each(function(){$(this).domManip(t,i,r,!0)});if($.isFunction(o))return this.each(function(a){var s=$(this);t[0]=o.call(this,a,i?s.html():e),s.domManip(t,i,r)});if(this[0]){if(a=o&&o.parentNode,a=$.support.parentNode&&a&&11===a.nodeType&&a.childNodes.length===this.length?{fragment:a}:$.buildFragment(t,this,l),n=a.fragment,s=1===n.childNodes.length?n=n.firstChild:n.firstChild){i=i&&$.nodeName(s,"tr"),s=0;for(var h=this.length,p=h-1;h>s;s++)r.call(i&&$.nodeName(this[s],"table")?this[s].getElementsByTagName("tbody")[0]||this[s].appendChild(this[s].ownerDocument.createElement("tbody")):this[s],a.cacheable||h>1&&p>s?$.clone(n,!0,!0):n)}l.length&&$.each(l,m)}return this}}),$.buildFragment=function(t,e,i){var r,a,s,n,o=t[0];return e&&e[0]&&(n=e[0].ownerDocument||e[0]),n.createDocumentFragment||(n=k),!(1===t.length&&"string"==typeof o&&512>o.length&&n===k&&"<"===o.charAt(0))||yt.test(o)||!$.support.checkClone&&vt.test(o)||!$.support.html5Clone&&gt.test(o)||(a=!0,(s=$.fragments[o])&&1!==s&&(r=s)),r||(r=n.createDocumentFragment(),$.clean(t,n,r,i)),a&&($.fragments[o]=s?r:1),{fragment:r,cacheable:a}},$.fragments={},$.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){$.fn[t]=function(i){var r=[],i=$(i),a=1===this.length&&this[0].parentNode;if(a&&11===a.nodeType&&1===a.childNodes.length&&1===i.length)return i[e](this[0]),this;for(var a=0,s=i.length;s>a;a++){var n=(a>0?this.clone(!0):this).get();$(i[a])[e](n),r=r.concat(n)}return this.pushStack(r,t,i.selector)}}),$.extend({clone:function(t,e,i){var r,a,s;$.support.html5Clone||!gt.test("<"+t.nodeName)?r=t.cloneNode(!0):(r=k.createElement("div"),St.appendChild(r),r.innerHTML=t.outerHTML,r=r.firstChild);var n=r;if(!($.support.noCloneEvent&&$.support.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||$.isXMLDoc(t)))for(c(t,n),r=d(t),a=d(n),s=0;r[s];++s)a[s]&&c(r[s],a[s]);if(e&&(p(t,n),i))for(r=d(t),a=d(n),s=0;r[s];++s)p(r[s],a[s]);return n},clean:function(t,e,i,r){e=e||k,"undefined"==typeof e.createElement&&(e=e.ownerDocument||e[0]&&e[0].ownerDocument||k);for(var a,s,n=[],o=0;null!=(s=t[o]);o++)if("number"==typeof s&&(s+=""),s){if("string"==typeof s)if(ft.test(s)){s=s.replace(ct,"<$1></$2>"),a=(dt.exec(s)||["",""])[1].toLowerCase();var l=xt[a]||xt._default,p=l[0],c=e.createElement("div");for(e===k?St.appendChild(c):h(e).appendChild(c),c.innerHTML=l[1]+s+l[2];p--;)c=c.lastChild;if(!$.support.tbody)for(p=ut.test(s),l="table"!==a||p?"<table>"!==l[1]||p?[]:c.childNodes:c.firstChild&&c.firstChild.childNodes,a=l.length-1;a>=0;--a)$.nodeName(l[a],"tbody")&&!l[a].childNodes.length&&l[a].parentNode.removeChild(l[a]);!$.support.leadingWhitespace&&pt.test(s)&&c.insertBefore(e.createTextNode(pt.exec(s)[0]),c.firstChild),s=c.childNodes}else s=e.createTextNode(s);var d;if(!$.support.appendChecked)if(s[0]&&"number"==typeof(d=s.length))for(a=0;d>a;a++)f(s[a]);else f(s);s.nodeType?n.push(s):n=$.merge(n,s)}if(i)for(t=function(t){return!t.type||bt.test(t.type)},o=0;n[o];o++)!r||!$.nodeName(n[o],"script")||n[o].type&&"text/javascript"!==n[o].type.toLowerCase()?(1===n[o].nodeType&&(e=$.grep(n[o].getElementsByTagName("script"),t),n.splice.apply(n,[o+1,0].concat(e))),i.appendChild(n[o])):r.push(n[o].parentNode?n[o].parentNode.removeChild(n[o]):n[o]);return n},cleanData:function(t){for(var e,i,r,a=$.cache,s=$.event.special,n=$.support.deleteExpando,o=0;null!=(r=t[o]);o++)if((!r.nodeName||!$.noData[r.nodeName.toLowerCase()])&&(i=r[$.expando])){if((e=a[i])&&e.events){for(var l in e.events)s[l]?$.event.remove(r,l):$.removeEvent(r,l,e.handle);e.handle&&(e.handle.elem=null)}n?delete r[$.expando]:r.removeAttribute&&r.removeAttribute($.expando),delete a[i]}}});var Ct,_t,Tt,It=/alpha\([^)]*\)/i,kt=/opacity=([^)]*)/,Dt=/([A-Z]|^ms)/g,Et=/^-?\d+(?:px)?$/i,$t=/^-?\d/,At=/^([\-+])=([\-+.\de]+)/,Mt={position:"absolute",visibility:"hidden",display:"block"},Lt=["Left","Right"],Rt=["Top","Bottom"];$.fn.css=function(t,i){return 2===arguments.length&&i===e?this:$.access(this,t,i,!0,function(t,i,r){return r!==e?$.style(t,i,r):$.css(t,i)})},$.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=Ct(t,"opacity","opacity");return""===i?"1":i}return t.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":$.support.cssFloat?"cssFloat":"styleFloat"},style:function(t,i,r,a){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var s,n=$.camelCase(i),o=t.style,l=$.cssHooks[n],i=$.cssProps[n]||n;if(r===e)return l&&"get"in l&&(s=l.get(t,!1,a))!==e?s:o[i];if(a=typeof r,"string"===a&&(s=At.exec(r))&&(r=+(s[1]+1)*+s[2]+parseFloat($.css(t,i)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"===a&&!$.cssNumber[n]&&(r+="px"),l&&"set"in l&&(r=l.set(t,r))===e)))try{o[i]=r}catch(h){}}},css:function(t,i,r){var a,s,i=$.camelCase(i);return s=$.cssHooks[i],i=$.cssProps[i]||i,"cssFloat"===i&&(i="float"),s&&"get"in s&&(a=s.get(t,!0,r))!==e?a:Ct?Ct(t,i):void 0},swap:function(t,e,i){var r,a={};for(r in e)a[r]=t.style[r],t.style[r]=e[r];i.call(t);for(r in e)t.style[r]=a[r]}}),$.curCSS=$.css,$.each(["height","width"],function(t,e){$.cssHooks[e]={get:function(t,i,r){var a;return i?0!==t.offsetWidth?y(t,e,r):($.swap(t,Mt,function(){a=y(t,e,r)}),a):void 0},set:function(t,e){return Et.test(e)?(e=parseFloat(e),e>=0?e+"px":void 0):e}}}),$.support.opacity||($.cssHooks.opacity={get:function(t,e){return kt.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?parseFloat(RegExp.$1)/100+"":e?"1":""},set:function(t,e){var i=t.style,r=t.currentStyle,a=$.isNumeric(e)?"alpha(opacity="+100*e+")":"",s=r&&r.filter||i.filter||"";i.zoom=1,e>=1&&""===$.trim(s.replace(It,""))&&(i.removeAttribute("filter"),r&&!r.filter)||(i.filter=It.test(s)?s.replace(It,a):s+" "+a)}}),$(function(){$.support.reliableMarginRight||($.cssHooks.marginRight={get:function(t,e){var i;return $.swap(t,{display:"inline-block"},function(){i=e?Ct(t,"margin-right","marginRight"):t.style.marginRight}),i}})}),k.defaultView&&k.defaultView.getComputedStyle&&(_t=function(t,e){var i,r,a,e=e.replace(Dt,"-$1").toLowerCase();return(r=t.ownerDocument.defaultView)&&(a=r.getComputedStyle(t,null))&&(i=a.getPropertyValue(e),""===i&&!$.contains(t.ownerDocument.documentElement,t)&&(i=$.style(t,e))),i}),k.documentElement.currentStyle&&(Tt=function(t,e){var i,r,a=t.currentStyle&&t.currentStyle[e],s=t.style;return null===a&&s&&(i=s[e])&&(a=i),!Et.test(a)&&$t.test(a)&&(i=s.left,(r=t.runtimeStyle&&t.runtimeStyle.left)&&(t.runtimeStyle.left=t.currentStyle.left),s.left="fontSize"===e?"1em":a||0,a=s.pixelLeft+"px",s.left=i,r&&(t.runtimeStyle.left=r)),""===a?"auto":a}),Ct=_t||Tt,$.expr&&$.expr.filters&&($.expr.filters.hidden=function(t){var e=t.offsetHeight;return 0===t.offsetWidth&&0===e||!$.support.reliableHiddenOffsets&&"none"===(t.style&&t.style.display||$.css(t,"display"))},$.expr.filters.visible=function(t){return!$.expr.filters.hidden(t)});var Pt,Ft,Ot=/%20/g,Nt=/\[\]$/,Bt=/\r?\n/g,Xt=/#.*$/,Gt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Wt=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Ht=/^(?:GET|HEAD)$/,jt=/^\/\//,Vt=/\?/,Yt=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,zt=/^(?:select|textarea)/i,Ut=/\s+/,qt=/([?&])_=[^&]*/,Qt=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,Zt=$.fn.load,Kt={},Jt={},te=["*/"]+["*"];try{Pt=E.href}catch(ee){Pt=k.createElement("a"),Pt.href="",Pt=Pt.href}Ft=Qt.exec(Pt.toLowerCase())||[],$.fn.extend({load:function(t,i,r){if("string"!=typeof t&&Zt)return Zt.apply(this,arguments);if(!this.length)return this;var a=t.indexOf(" ");if(a>=0)var s=t.slice(a,t.length),t=t.slice(0,a);a="GET",i&&($.isFunction(i)?(r=i,i=e):"object"==typeof i&&(i=$.param(i,$.ajaxSettings.traditional),a="POST"));var n=this;return $.ajax({url:t,type:a,dataType:"html",data:i,complete:function(t,e,i){i=t.responseText,t.isResolved()&&(t.done(function(t){i=t}),n.html(s?$("<div>").append(i.replace(Yt,"")).find(s):i)),r&&n.each(r,[i,e,t])}}),this},serialize:function(){return $.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?$.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||zt.test(this.nodeName)||Wt.test(this.type))}).map(function(t,e){var i=$(this).val();return null==i?null:$.isArray(i)?$.map(i,function(t){return{name:e.name,value:t.replace(Bt,"\r\n")}}):{name:e.name,value:i.replace(Bt,"\r\n")}}).get()}}),$.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(t,e){$.fn[e]=function(t){return this.on(e,t)}}),$.each(["get","post"],function(t,i){$[i]=function(t,r,a,s){return $.isFunction(r)&&(s=s||a,a=r,r=e),$.ajax({type:i,url:t,data:r,success:a,dataType:s})}}),$.extend({getScript:function(t,i){return $.get(t,e,i,"script")},getJSON:function(t,e,i){return $.get(t,e,i,"json")},ajaxSetup:function(t,e){return e?b(t,$.ajaxSettings):(e=t,t=$.ajaxSettings),b(t,e),t},ajaxSettings:{url:Pt,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(Ft[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":te},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":t.String,"text html":!0,"text json":$.parseJSON,"text xml":$.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:g(Kt),ajaxTransport:g(Jt),ajax:function(t,i){function r(t,i,r,n){if(2!==x){x=2,l&&clearTimeout(l),o=e,s=n||"",S.readyState=t>0?4:0;var h,c,v,n=i;if(r){var b,w,C,_,T=d,I=S,k=T.contents,D=T.dataTypes,E=T.responseFields;for(w in E)w in r&&(I[E[w]]=r[w]);for(;"*"===D[0];)D.shift(),b===e&&(b=T.mimeType||I.getResponseHeader("content-type"));if(b)for(w in k)if(k[w]&&k[w].test(b)){D.unshift(w);break}if(D[0]in r)C=D[0];else{for(w in r){if(!D[0]||T.converters[w+" "+D[0]]){C=w;break}_||(_=w)}C=C||_}C?(C!==D[0]&&D.unshift(C),r=r[C]):r=void 0}else r=e;if(t>=200&&300>t||304===t)if(d.ifModified&&((b=S.getResponseHeader("Last-Modified"))&&($.lastModified[a]=b),(b=S.getResponseHeader("Etag"))&&($.etag[a]=b)),304===t)n="notmodified",h=!0;else try{b=d,b.dataFilter&&(r=b.dataFilter(r,b.dataType));var A=b.dataTypes;w={};var M,L,R,P,F,O,N,B,X=A.length,G=A[0];for(M=1;X>M;M++){if(1===M)for(L in b.converters)"string"==typeof L&&(w[L.toLowerCase()]=b.converters[L]);if(P=G,G=A[M],"*"===G)G=P;else if("*"!==P&&P!==G){if(F=P+" "+G,O=w[F]||w["* "+G],!O)for(N in B=e,w)if(R=N.split(" "),(R[0]===P||"*"===R[0])&&(B=w[R[1]+" "+G])){N=w[N],!0===N?O=B:!0===B&&(O=N);break}!O&&!B&&$.error("No conversion from "+F.replace(" "," to ")),!0!==O&&(r=O?O(r):B(N(r)))}}c=r,n="success",h=!0}catch(W){n="parsererror",v=W}else v=n,(!n||t)&&(n="error",0>t&&(t=0));S.status=t,S.statusText=""+(i||n),h?m.resolveWith(u,[c,n,S]):m.rejectWith(u,[S,n,v]),S.statusCode(g),g=e,p&&f.trigger("ajax"+(h?"Success":"Error"),[S,d,h?c:v]),y.fireWith(u,[S,n]),p&&(f.trigger("ajaxComplete",[S,d]),--$.active||$.event.trigger("ajaxStop"))}}"object"==typeof t&&(i=t,t=e);var a,s,n,o,l,h,p,c,i=i||{},d=$.ajaxSetup({},i),u=d.context||d,f=u!==d&&(u.nodeType||u instanceof $)?$(u):$.event,m=$.Deferred(),y=$.Callbacks("once memory"),g=d.statusCode||{},b={},w={},x=0,S={readyState:0,setRequestHeader:function(t,e){if(!x){var i=t.toLowerCase(),t=w[i]=w[i]||t;b[t]=e}return this},getAllResponseHeaders:function(){return 2===x?s:null},getResponseHeader:function(t){var i;if(2===x){if(!n)for(n={};i=Gt.exec(s);)n[i[1].toLowerCase()]=i[2];i=n[t.toLowerCase()]}return i===e?null:i},overrideMimeType:function(t){return x||(d.mimeType=t),this},abort:function(t){return t=t||"abort",o&&o.abort(t),r(0,t),this}};if(m.promise(S),S.success=S.done,S.error=S.fail,S.complete=y.add,S.statusCode=function(t){if(t){var e;if(2>x)for(e in t)g[e]=[g[e],t[e]];else e=t[S.status],S.then(e,e)}return this},d.url=((t||d.url)+"").replace(Xt,"").replace(jt,Ft[1]+"//"),d.dataTypes=$.trim(d.dataType||"*").toLowerCase().split(Ut),null==d.crossDomain&&(h=Qt.exec(d.url.toLowerCase()),d.crossDomain=!(!h||h[1]==Ft[1]&&h[2]==Ft[2]&&(h[3]||("http:"===h[1]?80:443))==(Ft[3]||("http:"===Ft[1]?80:443)))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=$.param(d.data,d.traditional)),v(Kt,d,i,S),2===x)return!1;if(p=d.global,d.type=d.type.toUpperCase(),d.hasContent=!Ht.test(d.type),p&&0===$.active++&&$.event.trigger("ajaxStart"),!d.hasContent&&(d.data&&(d.url+=(Vt.test(d.url)?"&":"?")+d.data,delete d.data),a=d.url,!1===d.cache)){h=$.now();var C=d.url.replace(qt,"$1_="+h);d.url=C+(C===d.url?(Vt.test(d.url)?"&":"?")+"_="+h:"")}(d.data&&d.hasContent&&!1!==d.contentType||i.contentType)&&S.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(a=a||d.url,$.lastModified[a]&&S.setRequestHeader("If-Modified-Since",$.lastModified[a]),$.etag[a]&&S.setRequestHeader("If-None-Match",$.etag[a])),S.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+te+"; q=0.01":""):d.accepts["*"]);for(c in d.headers)S.setRequestHeader(c,d.headers[c]);if(d.beforeSend&&(!1===d.beforeSend.call(u,S,d)||2===x))return S.abort(),!1;for(c in{success:1,error:1,complete:1})S[c](d[c]);if(o=v(Jt,d,i,S)){S.readyState=1,p&&f.trigger("ajaxSend",[S,d]),d.async&&0<d.timeout&&(l=setTimeout(function(){S.abort("timeout")},d.timeout));try{x=1,o.send(b,r)}catch(_){if(!(2>x))throw _;r(-1,_)}}else r(-1,"No Transport");return S},param:function(t,i){var r=[],a=function(t,e){e=$.isFunction(e)?e():e,r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(i===e&&(i=$.ajaxSettings.traditional),$.isArray(t)||t.jquery&&!$.isPlainObject(t))$.each(t,function(){a(this.name,this.value)});else for(var s in t)w(s,t[s],i,a);return r.join("&").replace(Ot,"+")}}),$.extend({active:0,lastModified:{},etag:{}});var ie=$.now(),re=/(\=)\?(&|$)|\?\?/i;$.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return $.expando+"_"+ie++}}),$.ajaxPrefilter("json jsonp",function(e,i,r){if(i="application/x-www-form-urlencoded"===e.contentType&&"string"==typeof e.data,"jsonp"===e.dataTypes[0]||!1!==e.jsonp&&(re.test(e.url)||i&&re.test(e.data))){var a,s=e.jsonpCallback=$.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,n=t[s],o=e.url,l=e.data,h="$1"+s+"$2";return!1!==e.jsonp&&(o=o.replace(re,h),e.url===o&&(i&&(l=l.replace(re,h)),e.data===l&&(o+=(/\?/.test(o)?"&":"?")+e.jsonp+"="+s))),e.url=o,e.data=l,t[s]=function(t){a=[t]},r.always(function(){t[s]=n,a&&$.isFunction(n)&&t[s](a[0])}),e.converters["script json"]=function(){return a||$.error(s+" was not called"),a[0]},e.dataTypes[0]="json","script"}}),$.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(t){return $.globalEval(t),t}}}),$.ajaxPrefilter("script",function(t){t.cache===e&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),$.ajaxTransport("script",function(t){if(t.crossDomain){var i,r=k.head||k.getElementsByTagName("head")[0]||k.documentElement;return{send:function(a,s){i=k.createElement("script"),i.async="async",t.scriptCharset&&(i.charset=t.scriptCharset),i.src=t.url,i.onload=i.onreadystatechange=function(t,a){(a||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,r&&i.parentNode&&r.removeChild(i),i=e,a||s(200,"success"))},r.insertBefore(i,r.firstChild)},abort:function(){i&&i.onload(0,1)}}}});var ae,se=t.ActiveXObject?function(){for(var t in ae)ae[t](0,1)}:!1,ne=0;$.ajaxSettings.xhr=t.ActiveXObject?function(){var e;if(!(e=!this.isLocal&&x()))t:{try{e=new t.ActiveXObject("Microsoft.XMLHTTP");break t}catch(i){}e=void 0}return e}:x,function(t){$.extend($.support,{ajax:!!t,cors:!!t&&"withCredentials"in t})}($.ajaxSettings.xhr()),$.support.ajax&&$.ajaxTransport(function(i){if(!i.crossDomain||$.support.cors){var r;return{send:function(a,s){var n,o,l=i.xhr();if(i.username?l.open(i.type,i.url,i.async,i.username,i.password):l.open(i.type,i.url,i.async),i.xhrFields)for(o in i.xhrFields)l[o]=i.xhrFields[o];i.mimeType&&l.overrideMimeType&&l.overrideMimeType(i.mimeType),!i.crossDomain&&!a["X-Requested-With"]&&(a["X-Requested-With"]="XMLHttpRequest");try{for(o in a)l.setRequestHeader(o,a[o])}catch(h){}l.send(i.hasContent&&i.data||null),r=function(t,a){var o,h,p,c,d;try{if(r&&(a||4===l.readyState))if(r=e,n&&(l.onreadystatechange=$.noop,se&&delete ae[n]),a)4!==l.readyState&&l.abort();else{o=l.status,p=l.getAllResponseHeaders(),c={},(d=l.responseXML)&&d.documentElement&&(c.xml=d),c.text=l.responseText;try{h=l.statusText}catch(u){h=""}o||!i.isLocal||i.crossDomain?1223===o&&(o=204):o=c.text?200:404}}catch(f){a||s(-1,f)}c&&s(o,h,c,p)},i.async&&4!==l.readyState?(n=++ne,se&&(ae||(ae={},$(t).unload(se)),ae[n]=r),l.onreadystatechange=r):r()},abort:function(){r&&r(0,1)}}}});var oe,le,he,pe,ce={},de=/^(?:toggle|show|hide)$/,ue=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,fe=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];$.fn.extend({show:function(t,e,i){if(t||0===t)return this.animate(_("show",3),t,e,i);for(var i=0,r=this.length;r>i;i++)t=this[i],t.style&&(e=t.style.display,$._data(t,"olddisplay")||"none"!==e||(e=t.style.display=""),""===e&&"none"===$.css(t,"display")&&$._data(t,"olddisplay",T(t.nodeName)));for(i=0;r>i;i++)t=this[i],t.style&&(e=t.style.display,""===e||"none"===e)&&(t.style.display=$._data(t,"olddisplay")||"");return this},hide:function(t,e,i){if(t||0===t)return this.animate(_("hide",3),t,e,i);for(var i=0,r=this.length;r>i;i++)t=this[i],t.style&&(e=$.css(t,"display"),"none"!==e&&!$._data(t,"olddisplay")&&$._data(t,"olddisplay",e));for(i=0;r>i;i++)this[i].style&&(this[i].style.display="none");return this},_toggle:$.fn.toggle,toggle:function(t,e,i){var r="boolean"==typeof t;return $.isFunction(t)&&$.isFunction(e)?this._toggle.apply(this,arguments):null==t||r?this.each(function(){var e=r?t:$(this).is(":hidden");$(this)[e?"show":"hide"]()}):this.animate(_("toggle",3),t,e,i),this},fadeTo:function(t,e,i,r){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:e},t,i,r)},animate:function(t,e,i,r){function a(){var e;!1===s.queue&&$._mark(this);var i,r,a,n,o,l=$.extend({},s),h=1===this.nodeType,p=h&&$(this).is(":hidden");l.animatedProperties={};for(a in t){if(i=$.camelCase(a),a!==i&&(t[i]=t[a],delete t[a]),r=t[i],$.isArray(r)?(l.animatedProperties[i]=r[1],e=t[i]=r[0],r=e):l.animatedProperties[i]=l.specialEasing&&l.specialEasing[i]||l.easing||"swing","hide"===r&&p||"show"===r&&!p)return l.complete.call(this);!h||"height"!==i&&"width"!==i||(l.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],"inline"===$.css(this,"display")&&"none"===$.css(this,"float")&&($.support.inlineBlockNeedsLayout&&"inline"!==T(this.nodeName)?this.style.zoom=1:this.style.display="inline-block"))}null!=l.overflow&&(this.style.overflow="hidden");for(a in t)h=new $.fx(this,l,a),r=t[a],de.test(r)?(i=$._data(this,"toggle"+a)||("toggle"===r?p?"show":"hide":0))?($._data(this,"toggle"+a,"show"===i?"hide":"show"),h[i]()):h[r]():(i=ue.exec(r),n=h.cur(),i?(r=parseFloat(i[2]),o=i[3]||($.cssNumber[a]?"":"px"),"px"!==o&&($.style(this,a,(r||1)+o),n*=(r||1)/h.cur(),$.style(this,a,n+o)),i[1]&&(r=("-="===i[1]?-1:1)*r+n),h.custom(n,r,o)):h.custom(n,r,""));return!0}var s=$.speed(e,i,r);return $.isEmptyObject(t)?this.each(s.complete,[!1]):(t=$.extend({},t),!1===s.queue?this.each(a):this.queue(s.queue,a))},stop:function(t,i,r){return"string"!=typeof t&&(r=i,i=t,t=e),i&&!1!==t&&this.queue(t||"fx",[]),this.each(function(){var e,i=!1,a=$.timers,s=$._data(this);if(r||$._unmark(!0,this),null==t){for(e in s)if(s[e]&&s[e].stop&&e.indexOf(".run")===e.length-4){var n=s[e];$.removeData(this,e,!0),n.stop(r)}}else s[e=t+".run"]&&s[e].stop&&(s=s[e],$.removeData(this,e,!0),s.stop(r));for(e=a.length;e--;)a[e].elem!==this||null!=t&&a[e].queue!==t||(r?a[e](!0):a[e].saveState(),i=!0,a.splice(e,1));(!r||!i)&&$.dequeue(this,t)})}}),$.each({slideDown:_("show",1),slideUp:_("hide",1),slideToggle:_("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){$.fn[t]=function(t,i,r){return this.animate(e,t,i,r)}}),$.extend({speed:function(t,e,i){var r=t&&"object"==typeof t?$.extend({},t):{complete:i||!i&&e||$.isFunction(t)&&t,duration:t,easing:i&&e||e&&!$.isFunction(e)&&e};return r.duration=$.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in $.fx.speeds?$.fx.speeds[r.duration]:$.fx.speeds._default,(null==r.queue||!0===r.queue)&&(r.queue="fx"),r.old=r.complete,r.complete=function(t){$.isFunction(r.old)&&r.old.call(this),r.queue?$.dequeue(this,r.queue):!1!==t&&$._unmark(this)},r},easing:{linear:function(t,e,i,r){return i+r*t},swing:function(t,e,i,r){return(-Math.cos(t*Math.PI)/2+.5)*r+i}},timers:[],fx:function(t,e,i){this.options=e,this.elem=t,this.prop=i,e.orig=e.orig||{}}}),$.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),($.fx.step[this.prop]||$.fx.step._default)(this)},cur:function(){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];var t,e=$.css(this.elem,this.prop);return isNaN(t=parseFloat(e))?e&&"auto"!==e?e:0:t},custom:function(t,i,r){function a(t){return s.step(t)}var s=this,n=$.fx;this.startTime=pe||S(),this.end=i,this.now=this.start=t,this.pos=this.state=0,this.unit=r||this.unit||($.cssNumber[this.prop]?"":"px"),a.queue=this.options.queue,a.elem=this.elem,a.saveState=function(){s.options.hide&&$._data(s.elem,"fxshow"+s.prop)===e&&$._data(s.elem,"fxshow"+s.prop,s.start)},a()&&$.timers.push(a)&&!he&&(he=setInterval(n.tick,n.interval))},show:function(){var t=$._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=t||$.style(this.elem,this.prop),this.options.show=!0,t!==e?this.custom(this.cur(),t):this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur()),$(this.elem).show()},hide:function(){this.options.orig[this.prop]=$._data(this.elem,"fxshow"+this.prop)||$.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(t){var e,i=pe||S(),r=!0,a=this.elem,s=this.options;if(t||i>=s.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),s.animatedProperties[this.prop]=!0;for(e in s.animatedProperties)!0!==s.animatedProperties[e]&&(r=!1);if(r){if(null!=s.overflow&&!$.support.shrinkWrapBlocks&&$.each(["","X","Y"],function(t,e){a.style["overflow"+e]=s.overflow[t]}),s.hide&&$(a).hide(),s.hide||s.show)for(e in s.animatedProperties)$.style(a,e,s.orig[e]),$.removeData(a,"fxshow"+e,!0),$.removeData(a,"toggle"+e,!0);(t=s.complete)&&(s.complete=!1,t.call(a))}return!1}return 1/0==s.duration?this.now=i:(t=i-this.startTime,this.state=t/s.duration,this.pos=$.easing[s.animatedProperties[this.prop]](this.state,t,0,1,s.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},$.extend($.fx,{tick:function(){for(var t,e=$.timers,i=0;i<e.length;i++)t=e[i],!t()&&e[i]===t&&e.splice(i--,1);e.length||$.fx.stop()},interval:13,stop:function(){clearInterval(he),he=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(t){$.style(t.elem,"opacity",t.now)},_default:function(t){t.elem.style&&null!=t.elem.style[t.prop]?t.elem.style[t.prop]=t.now+t.unit:t.elem[t.prop]=t.now}}}),$.each(["width","height"],function(t,e){$.fx.step[e]=function(t){$.style(t.elem,e,Math.max(0,t.now)+t.unit)}}),$.expr&&$.expr.filters&&($.expr.filters.animated=function(t){return $.grep($.timers,function(e){return t===e.elem}).length});var me=/^t(?:able|d|h)$/i,ye=/^(?:body|html)$/i;$.fn.offset="getBoundingClientRect"in k.documentElement?function(t){var e,i=this[0];if(t)return this.each(function(e){$.offset.setOffset(this,t,e)});if(!i||!i.ownerDocument)return null;if(i===i.ownerDocument.body)return $.offset.bodyOffset(i);try{e=i.getBoundingClientRect()}catch(r){}var a=i.ownerDocument,s=a.documentElement;return e&&$.contains(s,i)?(i=a.body,a=I(a),{top:e.top+(a.pageYOffset||$.support.boxModel&&s.scrollTop||i.scrollTop)-(s.clientTop||i.clientTop||0),left:e.left+(a.pageXOffset||$.support.boxModel&&s.scrollLeft||i.scrollLeft)-(s.clientLeft||i.clientLeft||0)}):e?{top:e.top,left:e.left}:{top:0,left:0}}:function(t){var e=this[0];if(t)return this.each(function(e){$.offset.setOffset(this,t,e)});if(!e||!e.ownerDocument)return null;if(e===e.ownerDocument.body)return $.offset.bodyOffset(e);var i,r=e.offsetParent,a=e.ownerDocument,s=a.documentElement,n=a.body;i=(a=a.defaultView)?a.getComputedStyle(e,null):e.currentStyle;for(var o=e.offsetTop,l=e.offsetLeft;(e=e.parentNode)&&e!==n&&e!==s&&(!$.support.fixedPosition||"fixed"!==i.position);)i=a?a.getComputedStyle(e,null):e.currentStyle,o-=e.scrollTop,l-=e.scrollLeft,e===r&&(o+=e.offsetTop,l+=e.offsetLeft,!$.support.doesNotAddBorder||$.support.doesAddBorderForTableAndCells&&me.test(e.nodeName)||(o+=parseFloat(i.borderTopWidth)||0,l+=parseFloat(i.borderLeftWidth)||0),r=e.offsetParent),$.support.subtractsBorderForOverflowNotVisible&&"visible"!==i.overflow&&(o+=parseFloat(i.borderTopWidth)||0,l+=parseFloat(i.borderLeftWidth)||0);return("relative"===i.position||"static"===i.position)&&(o+=n.offsetTop,l+=n.offsetLeft),$.support.fixedPosition&&"fixed"===i.position&&(o+=Math.max(s.scrollTop,n.scrollTop),
l+=Math.max(s.scrollLeft,n.scrollLeft)),{top:o,left:l}},$.offset={bodyOffset:function(t){var e=t.offsetTop,i=t.offsetLeft;return $.support.doesNotIncludeMarginInBodyOffset&&(e+=parseFloat($.css(t,"marginTop"))||0,i+=parseFloat($.css(t,"marginLeft"))||0),{top:e,left:i}},setOffset:function(t,e,i){var r=$.css(t,"position");"static"===r&&(t.style.position="relative");var a=$(t),s=a.offset(),n=$.css(t,"top"),o=$.css(t,"left"),l={},h={};("absolute"===r||"fixed"===r)&&-1<$.inArray("auto",[n,o])?(h=a.position(),r=h.top,o=h.left):(r=parseFloat(n)||0,o=parseFloat(o)||0),$.isFunction(e)&&(e=e.call(t,i,s)),null!=e.top&&(l.top=e.top-s.top+r),null!=e.left&&(l.left=e.left-s.left+o),"using"in e?e.using.call(t,l):a.css(l)}},$.fn.extend({position:function(){if(!this[0])return null;var t=this[0],e=this.offsetParent(),i=this.offset(),r=ye.test(e[0].nodeName)?{top:0,left:0}:e.offset();return i.top-=parseFloat($.css(t,"marginTop"))||0,i.left-=parseFloat($.css(t,"marginLeft"))||0,r.top+=parseFloat($.css(e[0],"borderTopWidth"))||0,r.left+=parseFloat($.css(e[0],"borderLeftWidth"))||0,{top:i.top-r.top,left:i.left-r.left}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||k.body;t&&!ye.test(t.nodeName)&&"static"===$.css(t,"position");)t=t.offsetParent;return t})}}),$.each(["Left","Top"],function(t,i){var r="scroll"+i;$.fn[r]=function(i){var a,s;return i===e?(a=this[0],a?(s=I(a))?"pageXOffset"in s?s[t?"pageYOffset":"pageXOffset"]:$.support.boxModel&&s.document.documentElement[r]||s.document.body[r]:a[r]:null):this.each(function(){(s=I(this))?s.scrollTo(t?$(s).scrollLeft():i,t?i:$(s).scrollTop()):this[r]=i})}}),$.each(["Height","Width"],function(t,i){var r=i.toLowerCase();$.fn["inner"+i]=function(){var t=this[0];return t?t.style?parseFloat($.css(t,r,"padding")):this[r]():null},$.fn["outer"+i]=function(t){var e=this[0];return e?e.style?parseFloat($.css(e,r,t?"margin":"border")):this[r]():null},$.fn[r]=function(t){var a=this[0];if(!a)return null==t?null:this;if($.isFunction(t))return this.each(function(e){var i=$(this);i[r](t.call(this,e,i[r]()))});if($.isWindow(a)){var s=a.document.documentElement["client"+i],n=a.document.body;return"CSS1Compat"===a.document.compatMode&&s||n&&n["client"+i]||s}return 9===a.nodeType?Math.max(a.documentElement["client"+i],a.body["scroll"+i],a.documentElement["scroll"+i],a.body["offset"+i],a.documentElement["offset"+i]):t===e?(a=$.css(a,r),s=parseFloat(a),$.isNumeric(s)?s:a):this.css(r,"string"==typeof t?t:t+"px")}}),t.jQuery=t.$=$,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return $})}(window);var trace={box:null,useTextArea:!0,suppress:!0,zeroTime:new Date,filter:null};if(trace.log=function(t,e){trace.suppress||(trace.box||(box=trace.useTextArea?document.createElement("TEXTAREA"):document.createElement("DIV"),box.id="tracebox",box.style.position="absolute",box.style.width="200px",box.style.height="100px",box.style.left="100%",box.style.top="100%",box.style.overflow="scroll",box.style.margin="-120px 0 0 -220px",document.body.appendChild(box),trace.box=box),(e||trace.logShouldClear)&&(trace.box.innerHTML="",trace.box.value=""),trace.useTextArea?trace.box.value=trace.box.value+t+"\r\n":trace.box.innerHTML=trace.box.innerHTML+t+"<br/>",trace.logShouldClear=!1,setTimeout("trace.logShouldClear = true",100))},trace.logMulti=function(){if(!trace.suppress){for(var t="",e=!0,i=0;i<trace.logMulti.arguments.length;i++)e||(t+=", "),t+=trace.logMulti.arguments[i],e=!1;trace.log(t)}},trace.getTicks=function(){return new Date-trace.zeroTime},window.console)window.console.suppress=!0,window.console.logMulti=function(){if(!window.console.suppress){for(var t=new Date-trace.zeroTime+": ",e=!0,i=0;i<window.console.logMulti.arguments.length;i++)e||(t+=", "),t+=window.console.logMulti.arguments[i],e=!1;console.filter&&-1==t.indexOf(console.filter)||(window.console.log(t),window.console.logRemote&&window.console.logRemote(t),window.EventLogger&&window.EventLogger.logNote(t))}},-1<navigator.userAgent.indexOf("AppleWebKit/")&&-1==location.search.indexOf("logging=")&&(window.console.logMulti=function(){for(var t=new Date-trace.zeroTime+": ",e=!0,i=0;i<window.console.logMulti.arguments.length;i++)e||(t+=", "),t+=window.console.logMulti.arguments[i],e=!1;(!console.filter||-1!=t.indexOf(console.filter))&&window.console.log(new Date-trace.zeroTime,window.console.logMulti.arguments),window.EventLogger&&window.EventLogger.logNote(t)}),-1<location.search.indexOf("remote=1")&&(window.console.sockets=[],window.console.socketIndex=0,window.console.logRemote=function(t){t="/Log?message="+encodeURIComponent(t)+"&rand="+Math.random(),$.ajax({url:t})});else var console={log:function(t){trace.log(t)},logMulti:trace.logMulti,suppress:!0};var ppDebug={m_arrDebug:[],WriteQueue:function(){for(var t=0;t<this.m_arrDebug.length;t++)this.debug_trace(this.m_arrDebug[t]);this.m_arrDebug=[]},Clear:function(){},debug_trace:function(){},debug_error:function(t){console.log("ERROR",t)}},g_nStartTime=new Date;window.trace=trace,$.each("touchstart touchmove touchend orientationchange tap taphold swipe swipeleft swiperight swipeup swipedown scrollstart scrollstop".split(" "),function(t,e){$.fn[e]=function(t){return t?this.bind(e,t):this.trigger(e)},$.attrFn[e]=!0});var supportTouch=-1<navigator.userAgent.indexOf("iP"),scrollEvent="touchmove scroll",touchStartEvent=supportTouch?"touchstart":"mousedown",touchStopEvent=supportTouch?"touchend":"mouseup",touchMoveEvent=supportTouch?"touchmove":"mousemove";$.event.special.scrollstart={enabled:!0,setup:function(){function t(t,i){e=i;var a=t.type;t.type=e?"scrollstart":"scrollstop",$.event.handle.call(r,t),t.type=a}var e,i,r=this;$(r).bind(scrollEvent,function(r){$.event.special.scrollstart.enabled&&(e||t(r,!0),clearTimeout(i),i=setTimeout(function(){t(r,!1)},50))})}},$.event.special.tap={setup:function(){var t=this,e=$(t);e.bind(touchStartEvent,function(i){function r(){i.pageX=i.pageX||i.originalEvent.touches[0].pageX,i.pageY=i.pageY||i.originalEvent.touches[0].pageY,(10<Math.abs(l[0]-i.pageX)||10<Math.abs(l[1]-i.pageY))&&(n=!0)}if(!i.which||1===i.which){i.pageX=i.pageX||i.originalEvent.touches[0].pageX,i.pageY=i.pageY||i.originalEvent.touches[0].pageY;var a,s,n=!1,o=!0,l=[i.pageX,i.pageY];s=setTimeout(function(){o&&!n&&(a=i.type,i.type="taphold",$.event.handle.call(t,i),i.type=a)},750),e.one(touchMoveEvent,r).one(touchStopEvent,function(i){e.unbind(touchMoveEvent,r),clearTimeout(s),o=!1,(10<Math.abs(l[0]-i.pageX)||10<Math.abs(l[1]-i.pageY))&&(n=!0),n||(a=i.type,i.type="tap",$.event.handle.call(t,i),i.type=a)})}})}},$.event.special.swipe={setup:function(){var t=$(this);t.bind(touchStartEvent,function(e){function i(t){if(s){var e=t.originalEvent.touches?t.originalEvent.touches[0]:t;r={time:(new Date).getTime(),coords:[e.pageX,e.pageY]},10<Math.abs(s.coords[0]-r.coords[0])&&t.preventDefault()}}var r,a=e.originalEvent.touches?e.originalEvent.touches[0]:e,s={time:(new Date).getTime(),coords:[a.pageX,a.pageY],origin:$(e.target)};t.bind(touchMoveEvent,i).one(touchStopEvent,function(){t.unbind(touchMoveEvent,i),s&&r&&(1e3>r.time-s.time&&30<Math.abs(s.coords[0]-r.coords[0])&&75>Math.abs(s.coords[1]-r.coords[1])?s.origin.trigger("swipe").trigger(s.coords[0]>r.coords[0]?"swipeleft":"swiperight"):1e3>r.time-s.time&&30<Math.abs(s.coords[1]-r.coords[1])&&75>Math.abs(s.coords[0]-r.coords[0])&&s.origin.trigger("swipe").trigger(s.coords[1]>r.coords[1]?"swipeup":"swipedown")),s=r=void 0})})}},function(t){function e(){var t=i();t!==r&&(r=t,a.trigger("orientationchange"))}var i,r,a=t(window);t.event.special.orientationchange={setup:function(){return t.support.orientation?!1:(r=i(),void a.bind("resize",e))},teardown:function(){return t.support.orientation?!1:void a.unbind("resize",e)},add:function(t){var e=t.handler;t.handler=function(t){return t.orientation=i(),e.apply(this,arguments)}}},i=function(){var t=document.documentElement;return t&&1.1>t.clientWidth/t.clientHeight?"portrait":"landscape"}}(jQuery),$.each({scrollstop:"scrollstart",taphold:"tap",swipeup:"swipe",swipedown:"swipe",swipeleft:"swipe",swiperight:"swipe"},function(t,e){$.event.special[t]={setup:function(){$(this).bind(e,$.noop)}}}),function(){function t(t,e){var p;if(this.element="object"==typeof t?t:document.getElementById(t),this.wrapper=this.element.parentNode,this.element.style.webkitTransitionProperty="-webkit-transform",this.element.style.webkitTransitionTimingFunction="cubic-bezier(0,0,0.25,1)",this.element.style.webkitTransitionDuration="0",this.element.style.webkitTransform=l+"0,0"+h,this.options={bounce:i,momentum:i,checkDOMChanges:!0,topOnDOMChanges:!1,hScrollbar:i,vScrollbar:i,fadeScrollbar:r||!a,shrinkScrollbar:r||!a,desktopCompatibility:!1,overflow:"auto",snap:!1,bounceLock:!1,directionLock:!0,scrollbarColor:"rgba(150,150,150,0.5)",onScrollEnd:function(){}},"object"==typeof e)for(p in e)this.options[p]=e[p];this.options.desktopCompatibility&&(this.options.overflow="hidden"),this.onScrollEnd=this.options.onScrollEnd,delete this.options.onScrollEnd,this.wrapper.style.overflow=this.options.overflow,this.refresh(),window.addEventListener("onorientationchange"in window?"orientationchange":"resize",this,!1),(a||this.options.desktopCompatibility)&&(this.element.addEventListener(s,this,!1),this.element.addEventListener(n,this,!1),this.element.addEventListener(o,this,!1)),this.options.checkDOMChanges&&this.element.addEventListener("DOMSubtreeModified",this,!1)}function e(t,e,i,r,a){var s=document;this.dir=t,this.fade=i,this.shrink=r,this.uid=++p,this.bar=s.createElement("div"),this.bar.style.cssText="position:absolute;top:0;left:0;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;-webkit-transition-duration:0;-webkit-transition-delay:0;-webkit-transition-property:-webkit-transform;z-index:10;background:"+a+";-webkit-transform:"+l+"0,0"+h+";"+("horizontal"==t?"-webkit-border-radius:3px 2px;min-width:6px;min-height:5px":"-webkit-border-radius:2px 3px;min-width:5px;min-height:6px"),this.wrapper=s.createElement("div"),this.wrapper.style.cssText="-webkit-mask:-webkit-canvas(scrollbar"+this.uid+this.dir+");position:absolute;z-index:10;pointer-events:none;overflow:hidden;opacity:0;-webkit-transition-duration:"+(i?"300ms":"0")+";-webkit-transition-delay:0;-webkit-transition-property:opacity;"+("horizontal"==this.dir?"bottom:2px;left:2px;right:7px;height:5px":"top:2px;right:2px;bottom:7px;width:5px;"),this.wrapper.appendChild(this.bar),e.appendChild(this.wrapper)}t.prototype={x:0,y:0,enabled:!0,handleEvent:function(t){switch(t.type){case s:this.touchStart(t);break;case n:this.touchMove(t);break;case o:this.touchEnd(t);break;case"webkitTransitionEnd":this.transitionEnd();break;case"orientationchange":case"resize":this.refresh();break;case"DOMSubtreeModified":this.onDOMModified(t)}},onDOMModified:function(t){var e=this;t.target.parentNode==e.element&&(setTimeout(function(){e.refresh()},0),e.options.topOnDOMChanges&&(0!=e.x||0!=e.y)&&e.scrollTo(0,0,"0"))},refresh:function(){var t=this.x,i=this.y;this.scrollWidth=this.wrapper.clientWidth,this.scrollHeight=this.wrapper.clientHeight,this.scrollerWidth=this.element.offsetWidth,this.scrollerHeight=this.element.offsetHeight,this.maxScrollX=this.scrollWidth-this.scrollerWidth,this.maxScrollY=this.scrollHeight-this.scrollerHeight,this.directionY=this.directionX=0,this.scrollX&&(0<=this.maxScrollX?t=0:this.x<this.maxScrollX&&(t=this.maxScrollX)),this.scrollY&&(0<=this.maxScrollY?i=0:this.y<this.maxScrollY&&(i=this.maxScrollY)),this.options.snap&&(this.maxPageX=-Math.floor(this.maxScrollX/this.scrollWidth),this.maxPageY=-Math.floor(this.maxScrollY/this.scrollHeight),i=this.snap(t,i),t=i.x,i=i.y),(t!=this.x||i!=this.y)&&(this.setTransitionTime("0"),this.setPosition(t,i,!0)),this.scrollX=this.scrollerWidth>this.scrollWidth,this.scrollY=!this.options.bounceLock&&!this.scrollX||this.scrollerHeight>this.scrollHeight,this.options.hScrollbar&&this.scrollX?(this.scrollBarX=this.scrollBarX||new e("horizontal",this.wrapper,this.options.fadeScrollbar,this.options.shrinkScrollbar,this.options.scrollbarColor),this.scrollBarX.init(this.scrollWidth,this.scrollerWidth)):this.scrollBarX&&(this.scrollBarX=this.scrollBarX.remove()),this.options.vScrollbar&&this.scrollY&&this.scrollerHeight>this.scrollHeight?(this.scrollBarY=this.scrollBarY||new e("vertical",this.wrapper,this.options.fadeScrollbar,this.options.shrinkScrollbar,this.options.scrollbarColor),this.scrollBarY.init(this.scrollHeight,this.scrollerHeight)):this.scrollBarY&&(this.scrollBarY=this.scrollBarY.remove())},setPosition:function(t,e,i){this.x=t,this.y=e,this.element.style.webkitTransform=l+this.x+"px,"+this.y+"px"+h,i||(this.scrollBarX&&this.scrollBarX.setPosition(this.x),this.scrollBarY&&this.scrollBarY.setPosition(this.y))},setTransitionTime:function(t){t=t||"0",this.element.style.webkitTransitionDuration=t,this.scrollBarX&&(this.scrollBarX.bar.style.webkitTransitionDuration=t,this.scrollBarX.wrapper.style.webkitTransitionDuration=i&&this.options.fadeScrollbar?"300ms":"0"),this.scrollBarY&&(this.scrollBarY.bar.style.webkitTransitionDuration=t,this.scrollBarY.wrapper.style.webkitTransitionDuration=i&&this.options.fadeScrollbar?"300ms":"0")},touchStart:function(t){var e;this.enabled&&(t.preventDefault(),t.stopPropagation(),this.scrolling=!0,this.moved=!1,this.distY=this.distX=0,this.setTransitionTime("0"),(this.options.momentum||this.options.snap)&&(e=new WebKitCSSMatrix(window.getComputedStyle(this.element).webkitTransform),(e.e!=this.x||e.f!=this.y)&&(document.removeEventListener("webkitTransitionEnd",this,!1),this.setPosition(e.e,e.f),this.moved=!0)),this.touchStartX=a?t.changedTouches[0].pageX:t.pageX,this.scrollStartX=this.x,this.touchStartY=a?t.changedTouches[0].pageY:t.pageY,this.scrollStartY=this.y,this.scrollStartTime=t.timeStamp,this.directionY=this.directionX=0)},touchMove:function(t){if(this.scrolling){var e=a?t.changedTouches[0].pageX:t.pageX,i=a?t.changedTouches[0].pageY:t.pageY,r=this.scrollX?e-this.touchStartX:0,s=this.scrollY?i-this.touchStartY:0,n=this.x+r,o=this.y+s;t.stopPropagation(),this.touchStartX=e,this.touchStartY=i,(n>=0||n<this.maxScrollX)&&(n=this.options.bounce?Math.round(this.x+r/3):n>=0||0<=this.maxScrollX?0:this.maxScrollX),(o>=0||o<this.maxScrollY)&&(o=this.options.bounce?Math.round(this.y+s/3):o>=0||0<=this.maxScrollY?0:this.maxScrollY),5<this.distX+this.distY?(this.options.directionLock&&(this.distX-3>this.distY?(o=this.y,s=0):this.distY-3>this.distX&&(n=this.x,r=0)),this.setPosition(n,o),this.moved=!0,this.directionX=r>0?-1:1,this.directionY=s>0?-1:1):(this.distX+=Math.abs(r),this.distY+=Math.abs(s))}},touchEnd:function(t){if(this.scrolling){var e,i,r=t.timeStamp-this.scrollStartTime,s=a?t.changedTouches[0]:t;e=0,i=this.x;var n=this.y;if(this.scrolling=!1,t.preventDefault(),this.moved)!this.options.snap&&r>250?this.resetPosition():(this.options.momentum&&(t=!0===this.scrollX?this.momentum(this.x-this.scrollStartX,r,this.options.bounce?-this.x+this.scrollWidth/5:-this.x,this.options.bounce?this.x+this.scrollerWidth-this.scrollWidth+this.scrollWidth/5:this.x+this.scrollerWidth-this.scrollWidth):{dist:0,time:0},s=!0===this.scrollY?this.momentum(this.y-this.scrollStartY,r,this.options.bounce?-this.y+this.scrollHeight/5:-this.y,this.options.bounce?(0>this.maxScrollY?this.y+this.scrollerHeight-this.scrollHeight:0)+this.scrollHeight/5:this.y+this.scrollerHeight-this.scrollHeight):{dist:0,time:0},e=Math.max(Math.max(t.time,s.time),1),i=this.x+t.dist,n=this.y+s.dist),this.options.snap&&(t=this.snap(i,n),i=t.x,n=t.y,e=Math.max(t.time,e)),this.scrollTo(i,n,e+"ms"));else if(this.resetPosition(),a){for(e=s.target;1!=e.nodeType;)e=e.parentNode;t.preventDefault(),i=document.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!0,t.view,1,s.screenX,s.screenY,s.clientX,s.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null),i._fake=!0,e.dispatchEvent(i)}}},transitionEnd:function(){document.removeEventListener("webkitTransitionEnd",this,!1),this.resetPosition()},resetPosition:function(){var t=this,e=t.x,i=t.y;0<=t.x?e=0:t.x<t.maxScrollX&&(e=t.maxScrollX),0<=t.y||0<t.maxScrollY?i=0:t.y<t.maxScrollY&&(i=t.maxScrollY),e!=t.x||i!=t.y?t.scrollTo(e,i):(t.moved&&(t.onScrollEnd(),setTimeout(function(){t.moved=!1},0)),t.scrollBarX&&t.scrollBarX.hide(),t.scrollBarY&&t.scrollBarY.hide())},snap:function(t,e){var i,t=0<this.directionX?Math.floor(t/this.scrollWidth):0>this.directionX?Math.ceil(t/this.scrollWidth):Math.round(t/this.scrollWidth);return this.pageX=-t,t*=this.scrollWidth,t>0?t=this.pageX=0:t<this.maxScrollX&&(this.pageX=this.maxPageX,t=this.maxScrollX),e=0<this.directionY?Math.floor(e/this.scrollHeight):0>this.directionY?Math.ceil(e/this.scrollHeight):Math.round(e/this.scrollHeight),this.pageY=-e,e*=this.scrollHeight,e>0?e=this.pageY=0:e<this.maxScrollY&&(this.pageY=this.maxPageY,e=this.maxScrollY),i=Math.round(Math.max(500*(Math.abs(this.x-t)/this.scrollWidth),500*(Math.abs(this.y-e)/this.scrollHeight))),{x:t,y:e,time:i}},scrollTo:function(t,e,i){this.x==t&&this.y==e?this.resetPosition():(this.moved=!0,this.setTransitionTime(i||"350ms"),this.setPosition(t,e),"0"===i||"0s"==i||"0ms"==i?this.resetPosition():document.addEventListener("webkitTransitionEnd",this,!1))},scrollToPage:function(t,e,i){this.options.snap||(this.pageX=-Math.round(this.x/this.scrollWidth),this.pageY=-Math.round(this.y/this.scrollHeight)),"next"==t?t=++this.pageX:"prev"==t&&(t=--this.pageX),"next"==e?e=++this.pageY:"prev"==e&&(e=--this.pageY),t=-t*this.scrollWidth,e=-e*this.scrollHeight,e=this.snap(t,e),t=e.x,e=e.y,this.scrollTo(t,e,i||"500ms")},scrollToElement:function(t,e){if(t="object"==typeof t?t:this.element.querySelector(t)){var i=this.scrollX?-t.offsetLeft:0,r=this.scrollY?-t.offsetTop:0;i>=0?i=0:i<this.maxScrollX&&(i=this.maxScrollX),r>=0?r=0:r<this.maxScrollY&&(r=this.maxScrollY),this.scrollTo(i,r,e)}},momentum:function(t,e,i,r){var e=1e3*(Math.abs(t)/e),a=e*e/2.5/1e3,s=0;return t>0&&a>i?(e=e*i/a/2.5,a=i):0>t&&a>r&&(e=e*r/a/2.5,a=r),s=e/1.2,{dist:Math.round(a*(0>t?-1:1)),time:Math.round(s)}},destroy:function(t){return window.removeEventListener("onorientationchange"in window?"orientationchange":"resize",this,!1),this.element.removeEventListener(s,this,!1),this.element.removeEventListener(n,this,!1),this.element.removeEventListener(o,this,!1),document.removeEventListener("webkitTransitionEnd",this,!1),this.options.checkDOMChanges&&this.element.removeEventListener("DOMSubtreeModified",this,!1),this.scrollBarX&&(this.scrollBarX=this.scrollBarX.remove()),this.scrollBarY&&(this.scrollBarY=this.scrollBarY.remove()),t&&this.wrapper.parentNode.removeChild(this.wrapper),null}},e.prototype={init:function(t,e){var i=document,r=Math.PI;"horizontal"==this.dir?this.maxSize!=this.wrapper.offsetWidth&&(this.maxSize=this.wrapper.offsetWidth,i=i.getCSSCanvasContext("2d","scrollbar"+this.uid+this.dir,this.maxSize,5),i.fillStyle="rgb(0,0,0)",i.beginPath(),i.arc(2.5,2.5,2.5,r/2,-r/2,!1),i.lineTo(this.maxSize-2.5,0),i.arc(this.maxSize-2.5,2.5,2.5,-r/2,r/2,!1),i.closePath(),i.fill()):this.maxSize!=this.wrapper.offsetHeight&&(this.maxSize=this.wrapper.offsetHeight,i=i.getCSSCanvasContext("2d","scrollbar"+this.uid+this.dir,5,this.maxSize),i.fillStyle="rgb(0,0,0)",i.beginPath(),i.arc(2.5,2.5,2.5,r,0,!1),i.lineTo(5,this.maxSize-2.5),i.arc(2.5,this.maxSize-2.5,2.5,0,r,!1),i.closePath(),i.fill()),this.size=Math.max(Math.round(this.maxSize*this.maxSize/e),6),this.maxScroll=this.maxSize-this.size,this.toWrapperProp=this.maxScroll/(t-e),this.bar.style["horizontal"==this.dir?"width":"height"]=this.size+"px"},setPosition:function(t){"1"!=this.wrapper.style.opacity&&this.show(),t=Math.round(this.toWrapperProp*t),0>t?(t=this.shrink?t+3*t:0,7>this.size+t&&(t=-this.size+6)):t>this.maxScroll&&(t=this.shrink?t+3*(t-this.maxScroll):this.maxScroll,7>this.size+this.maxScroll-t&&(t=this.size+this.maxScroll-6)),t="horizontal"==this.dir?l+t+"px,0"+h:l+"0,"+t+"px"+h,this.bar.style.webkitTransform=t},show:function(){i&&(this.wrapper.style.webkitTransitionDelay="0"),this.wrapper.style.opacity="1"},hide:function(){i&&(this.wrapper.style.webkitTransitionDelay="350ms"),this.wrapper.style.opacity="0"},remove:function(){return this.wrapper.parentNode.removeChild(this.wrapper),null}};var i="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,r=/iphone|ipad/gi.test(navigator.appVersion),a="ontouchstart"in window,s=a?"touchstart":"mousedown",n=a?"touchmove":"mousemove",o=a?"touchend":"mouseup",l="translate"+(i?"3d(":"("),h=i?",0)":")",p=0;window.iScroll=t}();var util={};util.format=function(t){var e=util.format.arguments[1],i=1;if("object"==typeof e){for(key in e)t=t.replace("{"+key+"}",e[key]);return t}e&&e.splice?i=0:e=util.format.arguments;for(var r=i;r<e.length;r++)t=t.replace("{"+(r-i)+"}",e[r]);return t},util.min=function(t,e){return t>e?e:t},util.max=function(t,e){return e>t?e:t},util.count=function(t){var e=0;for(key in t)e++;return e},util.hasMutualKey=function(t,e){var i=!1;return $.each(t,function(t){$.each(e,function(e){i=i||t==e})}),i},util.asyncEach=function(t,e,i,r){r||(r=0);var a=[],s=0;$.each(t,function(t,e){var i={index:t,item:e,next:null};0<a.length&&(a[a.length-1].next=i),a.push(i),s++});var n=function(t){e(t.index,t.item),s--,t.next&&setTimeout(function(){n(t.next)},r)},o=function(){0==s&&i?i():setTimeout(function(){o()},10)};0<a.length&&n(a[0]),o()},util.popArrayElement=function(t,e){if(!t.indexOf)return null;var i=t.indexOf(e);return i>-1?t.splice(i,1)[0]:null},jQuery.cookie=function(t,e,i){if(1<arguments.length&&"[object Object]"!=""+e){if(i=jQuery.extend({},i),(null===e||void 0===e)&&(i.expires=-1),"number"==typeof i.expires){var r=i.expires,a=i.expires=new Date;a.setDate(a.getDate()+r)}return e=""+e,document.cookie=[encodeURIComponent(t),"=",i.raw?e:encodeURIComponent(e),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}return i=e||{},a=i.raw?function(t){return t}:decodeURIComponent,(r=RegExp("(?:^|; )"+encodeURIComponent(t)+"=([^;]*)").exec(document.cookie))?a(r[1]):null};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){for(var e,i,r,a,s,n,o="",l=0,t=Base64._utf8_encode(t);l<t.length;)e=t.charCodeAt(l++),i=t.charCodeAt(l++),r=t.charCodeAt(l++),a=e>>2,e=(3&e)<<4|i>>4,s=(15&i)<<2|r>>6,n=63&r,isNaN(i)?s=n=64:isNaN(r)&&(n=64),o=o+this._keyStr.charAt(a)+this._keyStr.charAt(e)+this._keyStr.charAt(s)+this._keyStr.charAt(n);return o},decode:function(t){for(var e,i,r,a,s,n="",o=0,t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");o<t.length;)e=this._keyStr.indexOf(t.charAt(o++)),i=this._keyStr.indexOf(t.charAt(o++)),a=this._keyStr.indexOf(t.charAt(o++)),s=this._keyStr.indexOf(t.charAt(o++)),e=e<<2|i>>4,i=(15&i)<<4|a>>2,r=(3&a)<<6|s,n+=String.fromCharCode(e),64!=a&&(n+=String.fromCharCode(i)),64!=s&&(n+=String.fromCharCode(r));return n=Base64._utf8_decode(n)},_utf8_encode:function(t){for(var t=t.replace(/\r\n/g,"\n"),e="",i=0;i<t.length;i++){var r=t.charCodeAt(i);128>r?e+=String.fromCharCode(r):(r>127&&2048>r?e+=String.fromCharCode(r>>6|192):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128)),e+=String.fromCharCode(63&r|128))}return e},_utf8_decode:function(t){for(var e="",i=0,r=c1=c2=0;i<t.length;)r=t.charCodeAt(i),128>r?(e+=String.fromCharCode(r),i++):r>191&&224>r?(c2=t.charCodeAt(i+1),e+=String.fromCharCode((31&r)<<6|63&c2),i+=2):(c2=t.charCodeAt(i+1),c3=t.charCodeAt(i+2),e+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),i+=3);return e}};TaskQueue.prototype.add=function(t){this.tasks.push(t)},TaskQueue.prototype.tick=function(t){(t=this.tasks.shift())&&t();var e=this;setTimeout(function(){e.tick()},e.timeout)},MatrixTransform.PI_OVER_180=Math.PI/180,MatrixTransform.prototype.reset=function(){this.m=[1,0,0,1,0,0]},MatrixTransform.prototype.copy=function(t){return t=new MatrixTransform,t.m=[this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5]],t},MatrixTransform.prototype.multiply=function(t){var e=this.m[1]*t.m[0]+this.m[3]*t.m[1],i=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],a=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=this.m[0]*t.m[0]+this.m[2]*t.m[1],this.m[1]=e,this.m[2]=i,this.m[3]=r,this.m[4]=a,this.m[5]=s},MatrixTransform.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=-this.m[1]*t,i=-this.m[2]*t,r=this.m[0]*t,a=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=this.m[3]*t,this.m[1]=e,this.m[2]=i,this.m[3]=r,this.m[4]=a,this.m[5]=s},MatrixTransform.prototype.rotateDegrees=function(t){this.rotate(t*MatrixTransform.PI_OVER_180)},MatrixTransform.prototype.rotate=function(t){var e=Math.cos(t),t=Math.sin(t),i=this.m[1]*e+this.m[3]*t,r=this.m[0]*-t+this.m[2]*e,a=this.m[1]*-t+this.m[3]*e;this.m[0]=this.m[0]*e+this.m[2]*t,this.m[1]=i,this.m[2]=r,this.m[3]=a},MatrixTransform.prototype.translate=function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},MatrixTransform.prototype.scale=function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},MatrixTransform.prototype.transformPoint=function(t,e){var i=t,r=e,t=i*this.m[0]+r*this.m[2]+this.m[4],e=i*this.m[1]+r*this.m[3]+this.m[5];return{x:t,y:e}},MatrixTransform.prototype.unTransformPoint=function(t,e){var i=this.copy();return i.invert(),i.transformPoint(t,e)},MatrixTransform.prototype.applyContext=function(t){t.setTransform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},MatrixTransform.prototype.toCSSTransform=function(){return"matrix("+this.m[0]+","+this.m[1]+","+this.m[2]+","+this.m[3]+","+this.m[4]+","+this.m[5]+")"};var Element=function(){this.ref=this.container=null,this.events=[],this.actionGroups={},this.variables={},this.states={},this.parent=null,this.children={},this.log=[]};Element.prototype.objectType="Element",Element.prototype.innerType="Element",Element.PixelSrc="data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",Element.prototype.restoreVariableResumeData=function(t){for(var e=$(this.xml).children("variables").children("[resume='true'][type='boolean']"),i=$(this.xml).children("variables").children("[resume='true'][type!='boolean']"),t=new bwChunk(t),r=0;!t.EOF();)for(var a=t.NextUBase10(1),s=1;a>=s;)a&s&&(r<e.length?this.variables[$(e[r]).attr("name")]="true":this.extractNextSpecialBool&&this.extractNextSpecialBool()),r++,s*=2;for(var n,e=0;e<=i.length;e++)if(e<i.length){switch(n=n?n.NextChunk():t.NextChunk(),r=$(i[e]),a=this.variableTypes[r.attr("name")],s=n.Data(),a){case"number":s=n.NextBase10()}this.variables[r.attr("name")]=s,r.next()}else this.extractNextSpecialVar&&(n=n?n.NextChunk():t.NextChunk(),this.extractNextSpecialVar(n.Data()));return n?n.Remainder():t.Remainder()},Element.prototype.shouldStoreVariableResume=function(){return this.getVariableResumeData()!=bwChunk.EMPTY_CHUNK},Element.prototype.getVariableResumeData=function(t){var e=this,i="",r="",a=1,s=0,n=!1,o=!1,l={},h=function(t,h){if(!l[t]&&e.variableResumes[t])switch(h!=e.variableDefaults[t]&&(o=!0),e.variableTypes[t]){case"bool":case"boolean":h&&"false"!=h&&(s+=a),a*=2,n=!0,a>32&&(a=1,r+=bwChunk.UBase10toN(s),n=!1,s=0);break;case"string":strTemp=bwChunk.EncodeString(h),i+=bwChunk.CreateChunk(strTemp);break;case"number":i+=bwChunk.CreateChunk(bwChunk.Base10toN(parseInt(h)))}};return $.each(this.variables,h),this.getExtraResumeVars&&$.each(this.getExtraResumeVars(),h),n&&(r+=bwChunk.UBase10toN(s)),i=bwChunk.CreateChunk(r)+i,o?bwChunk.CreateChunk(i):t?"":bwChunk.EMPTY_CHUNK},Element.prototype.toData=function(t){var e=this,i={},r={};return $.each(this.variables,function(t,a){a==e.variableDefaults[t]||r[t]||(i.variables||(i.variables={}),i.variables[t]=a)}),$.each(this.children,function(e,r){if(r.toData){var a=r.toData(t);jQuery.isEmptyObject(a)||(i.children||(i.children={}),i.children[e]=a)}}),this.shuffled&&(i.shuffled=!0),void 0!=this.shuffleX&&(i.shuffleX=this.shuffleX,i.shuffleY=this.shuffleY),this.visible&&(i.visible=!0),i},Element.prototype.updateFromData=function(t,e){var i=this;i.reset(e),t.variables&&$.each(t.variables,function(e,r){if(i.variables[e]!=r)switch(i.variables[e]=r,e){case"OnStage":t.visible="true"==r}}),t.children&&$.each(t.children,function(t,r){var a=i.children[t];a&&a.updateFromData(r,e)}),e||(t.shuffled&&(this.shuffled=!0,this.shuffleGroup&&(this.shuffleGroup.shuffled=!0),void 0!=t.shuffleX&&(this.shuffleX=t.shuffleX,this.shuffleY=t.shuffleY,this.x=this.shuffleX,this.y=this.shuffleY),void 0!=t.x&&(isNaN(parseInt(t.x))||(this.x=parseInt(t.x)),isNaN(parseInt(t.y))||(this.y=parseInt(t.y))),this.updateMatrixComplete(!0)),i.slide&&i.slide==player.currentSlide()&&i.ref&&(t.visible?this.quickShow?this.quickShow():(this.show(),this.visible=!0):"ShuffleGroup"!=this.innerType&&(this.quickHide?this.quickHide():this.hide())))},Element.prototype.reset=function(t,e){var i=this;$.each(this.variables,function(t,e){void 0!=i.variableDefaults[t]&&i.variableDefaults[t]!=e&&(i.variables[t]=i.variableDefaults[t])}),i.variables._disabled=i.variableDefaults._disabled,t||"Slide"==this.innerType||(this.visible=!1),$.each(this.children,function(i,r){(!e||e(r))&&r.reset&&r.reset(t)})},Element.prototype.setElementProperty=function(t,e,i){this[t]=e,i&&this.children&&$.each(this.children,function(r,a){a.setElementProperty&&a.setElementProperty(t,e,i)})},Element.prototype.constructElement=function(){this.events=[],this.actionGroups={},this.variables={},this.variableDefaults={},this.variableResumes={},this.variableTypes={},this.content={},this.states={},this.colors={},this.resources=[],this.eventSubscribers=[],this.matrix=new MatrixTransform,this.isRotated=!1,this.parent=null,this.children={},this.variableDefaults._default="true",this.variables.ObjectState="_default",this.variableDefaults.ObjectState="_default",this.originalYOffset=this.originalXOffset=this.originalHeight=this.originalWidth=this.originalZ=this.originalY=this.originalX=this.rotation=this.yoffset=this.xoffset=this.rotateypos=this.rotatexpos=this.dragY=this.dragX=this.y=this.x=0},Element.prototype.emptyElement=function(){this.constructElement(),this.xml=null},Element.prototype.childItems=function(){var t=[];return $.each(this.children,function(e,i){"Item"==i.objectType&&t.push(i)}),t},Element.prototype.findDescendantById=function(t){var e=null;return $.each(this.children,function(i,r){!e&&r.id==t&&(e=r),!e&&r.findDescendantById&&(e=r.findDescendantById(t))}),e},Element.prototype.hasDescendantByType=function(t){var e=!1;return $.each(this.children,function(i,r){!e&&r.innerType.toLowerCase()==t.toLowerCase()&&(e=!0),!e&&r.hasDescendantByType&&(e=r.hasDescendantByType(t))}),e},Element.prototype.getDescendantsByType=function(t){var e=this,i=[];return $.each(this.children,function(r,a){"Storyline"==e.innerType&&"Slide"==a.innerType||(a.innerType.toLowerCase()==t.toLowerCase()&&i.push(a),a.getDescendantsByType&&(i=i.concat(a.getDescendantsByType(t))))}),i},Element.prototype.isAncestor=function(t){for(var e=this.parent;e;){if(t==e)return!0;e=e.parent}return!1},Element.prototype.findAncestorOfType=function(t){for(var e=this;e;){if(e.innerType==t)return e;e=e.parent}return null},Element.prototype.eachAncestor=function(t){for(var e=this.parent;e;)t(e),e=e.parent},Element.prototype.getFullObjref=function(t){var e=this.id;return this.parent&&this.parent.id&&this.parent.getFullObjref&&(e=this.parent.getFullObjref()+"."+e),(t?"_player.":"")+e},Element.prototype.getFullVariableRef=function(t){return t=this.parseObjref(t),"_player."+t.target.getFullObjref()+"."+t.variable},Element.prototype.loadElementInfoFromXML=function(t){var e=this;this.events=[],$(t).children("events").children().each(function(t,i){var r=new StoryEvent(e);r.loadFromXML(i),e.events.push(r)}),this.actionGroups={},$(t).children("actiongroups").children().each(function(t,i){var r=$(i).attr("id"),a=$(i).children("actions").children();e.actionGroups[r]=a;
}),$(t).children("variables").children().each(function(t,i){e.variables[$(i).attr("name")]=$(i).attr("value"),e.variableDefaults[$(i).attr("name")]=$(i).attr("value"),e.variableTypes[$(i).attr("name")]=$(i).attr("type"),e.variableResumes[$(i).attr("name")]="true"==$(i).attr("resume")}),$.each($(t).children("colors").children("color"),function(t,i){var r=$(i).attr("name"),a=new Background(e.ref);a.loadFromXML($(i),"fill"),e.colors[r]=a}),this.lmsid=$(t).attr("lmsid"),e.variables.Id=$(t).attr("id"),e.variableDefaults.Id=$(t).attr("id"),e.resume="true"==$(t).attr("resume")},Element.prototype.hasEvent=function(t,e){if(!this.events)return null;for(var i=0;i<this.events.length;i++){var r=this.events[i];if(r.trigger==t)return r}return i=null,!i&&e&&this.parent&&this.parent.hasEvent&&(i=i||this.parent.hasEvent(t,e)),i},Element.constructors={},Element.registerTagNames=function(t,e){$.each(e,function(e,i){Element.constructors[i]=t})},Element.prototype.allResourcesLoaded=function(){var t=!0;return $.each(this.resources,function(e,i){t=t&&i.loaded}),t},Element.prototype.loadChildrenFromXML=function(t,e,i,r){var a=this;$(t).children("objects").children().each(function(t,s){var n;"objgroup"==s.tagName?n=new ItemGroup(a.ref,e,i):"expandinglabel"==s.tagName?n=new ExpandingLabel(a.ref,e,i):"sequencectrl"==s.tagName?n=new SequenceCtrl(a.ref,e,i):"shufflegroup"==s.tagName?n=new ShuffleGroup(a.ref,e,i):"scrollarea"==s.tagName?n=new ScrollArea(a.ref,e,i):"stategroup"==s.tagName?n=new StateGroup(a.ref,e,i):"dragitem"==s.tagName?n=new DragItem(a.ref,e,i):"droparea"==s.tagName?n=new DropArea(a.ref,a.slide,i):"droplist"==s.tagName?n=new DropList(a.ref,e,i):"textinput"==s.tagName?n=new TextInput(a.ref,e,i):"button"==s.tagName?n=new Button(a.ref,e,i):"image"==s.tagName?n=new ImageItem(a.ref,e,i):"vectorshape"==s.tagName?n=(n=$(s).attr("id"))&&0==n.indexOf("hotspot_")&&n.indexOf("_marker")==n.length-7?new HotspotMarker(a.ref,e,i):ImageItem.extractAnimatedGif(s)?new ImageItem(a.ref,e,i):new VectorShape(a.ref,e,i):"swf"==s.tagName?(n=$(s).attr("id"),n=0==n.indexOf("hotspot")?new HotspotMarker(a.ref,e,i):new SWFItem(a.ref,e,i)):"video"==s.tagName?(n=new Video,n.directParent=a):n=new StageItem(a.ref,e,i),n&&(n.parent=a,n.offsetParent=a,n.loadFromXML(s,e,i),a.children[$(s).attr("id")]=n,r&&r(n))})},Element.prototype.handleEventDeep=function(t,e,i,r){this.handleEvent(t,e,i,!1,!0,r),this.deepEach(function(a,s){s.handleEvent(t,e,i,!1,!0,r)})},Element.prototype.handleEvent=function(t,e,i,r,a,s){var n=this,o=!0;StoryEvent.cancelEvent=!1;var l=!0;return $.each(this.events,function(a,h){h.trigger!=t||h.filter&&!h.filter(e)||i&&!i(n,e)||(l=l&&h.act(n,s),o=r)}),this.group&&!a&&(l=l&&this.group.handleEvent(t,e,i,r,a,s)),!a&&o&&this.parent&&this.parent.handleEvent&&(l=l&&this.parent.handleEvent(t,e,i,r,a,s)),l},Element.prototype.runActionGroup=function(t){var e=this.parseObjref(t),i=e.target,t=e.variable,r=i.actionGroups[t],a=!0;return r&&$.each(r,function(t,e){a&&(a=i.runAction(e))}),e.processChildren&&$.each(this.children,function(e,i){var r=i.actionGroups[t];r&&$.each(r,function(t,e){a&&(a=i.runAction(e))})}),a},Element.prototype.runAction=function(t){var e=!0,i=this,r=$(t).attr("id"),a=$(t).get(0).tagName.toLowerCase();player.logActivity&&this.log.push([a,trace.getTicks()]);var s=function(t,i){if(DragItem.cancelDrag(),("_current"==t||"_frame"==t&&null==player.currentWindow)&&(e=!1),"Scene"==i.innerType&&(i=i.getFirstSlide()),"Slide"==i.innerType)if("_current"!=t&&(i.variables.WindowId=t),"_current"!=t&&"_frame"!=t){player.pause();var r=story.parseObjref(t).target;r.showSlide(i),player.windowZoomModifier=r.zoomModifier}else"_current"==t&&null!=player.currentWindow?(player.pause(),player.currentWindow.showSlide(i)):(player.currentSlide()&&player.currentSlide(),r=player.currentSlide()==i,null!=player.currentWindow&&(player.previousWindow=player.currentWindow),player.currentWindow=null,player.windowZoomModifier=1,r&&player.currentSlide().resetSlide(),player.showSlideIndex(i.slideIndex,null,!0,function(){player.pause(),player.zoomParams=null,player.play()}));else"SlideDraw"==i.innerType&&(i.showFirst(),e=!1)};switch(a){case"adjustvar":case"show":case"hide":case"show_slidelayer":case"hide_slidelayer":case"hideallslidelayers":case"media_play":case"media_pause":case"media_toggle":case"set_volume":s=new TimelineAction(i),r=new StoryEvent(i),r.isUserInitiated=!1,s.loadFromXML(t,r),s[a](r,i,!1);break;case"exe_actiongroup":e=this.runActionGroup(r);break;case"if_action":s=i.evaluateCondition($(t).children("condition").first())?"then_actions":"else_actions",$.each($(t).children(s).children(),function(t,r){e&&(e=i.runAction(r))});break;case"set_enabled":a=$(t).children("objref").attr("value"),t=$(t).children("enabled").attr("value"),s=i.parseObjref(a).target,s.variables._disabled=("false"==t).toString(),"textinput"==s.type?s.input.get(0).disabled=s.variables._disabled:"droplist"==s.type&&(s.select.get(0).disabled=s.variables._disabled);break;case"set_review":a=$(t).children("objref").attr("value"),t=$(t).children("enabled").attr("value"),s=i.parseObjref(a).target,0==s.id.indexOf("hotspot")&&(s.variables._disabled="true",s.parent.variables._disabled="true",s.ref.parent().find(".item.swf").show()),s.setVariable("ReviewMode",!0),s.set_review&&s.set_review();break;case"setdrawreview":a=$(t).attr("drawid"),t="true"==$(t).attr("review"),s=i.parseObjref(a).target,s.setVariable("ReviewMode",t),s.m_bReviewMode=t;break;case"setobjstate":(s=i.parseObjrefFromXML(t).target)||(s=i),t=$(t).children("stateref").attr("value"),s.setStates(t,"true");break;case"setfocus":i.input&&i.input.get(0).focus();break;case"trigger_next_slide":player.currentSlide().handleEvent("onnextslide");break;case"trigger_prev_slide":player.currentSlide().handleEvent("onprevslide");break;case"trigger_submit_slide":player.currentSlide().handleEvent("onsubmitslide");break;case"trigger_submitall_slide":Interaction.partialEvaluateSlide(player.currentSlide()),player.currentSlide().handleEvent("onsubmitallslide");break;case"trigger_slide_finish":player.currentSlide().handleEvent("onfinishslide");break;case"history_prev":player.currentWindow?0<player.currentWindow.history.length&&(t=player.currentWindow.history.pop(),player.currentWindow.showSlide(story.allSlides[t],!0)):0<player.history.length&&(t=player.history.pop(),player.showSlideIndex(t,null,!1));break;case"reset_player":t=$(t).attr("startslideid"),a=i.parseObjref(t).target,$.each(story.allSlides,function(t,e){e.resetSlide(!0)}),player.currentTime=0,player.currentWindow&&(player.currentWindow.close(),player.currentWindow=null),t&&(e=!1,s("_frame",a));break;case"resume_player":if(t=$(t).attr("resume"),Audio.iOSPrepare&&Audio.iOSPrepare(),"true"==t){t=player.resumeData,player.overrideResumeData&&(resumedata=player.overrideResumeData);try{player.useCompactResume?story.updateFromCompactData(t):story.updateFromData(JSON.parse(t))}catch(n){}}else story.clearLocalStorage(),SlideDraw.populateDraws();t=story.parseObjref(story.resumeWindow).target,t.close(),$(".slide:not(.framed)").hide(),player.showSlideID(story.startingslide,!0,function(){if(story.startingWindowInfo){var t=0,e=function(){10<t++||player.currentSlide()&&player.currentSlide().transitionedIn?story.startingWindowInfo.win.showSlide(story.startingWindowInfo.slide):setTimeout(e,100)};e()}});break;case"notifylinkselected":t=$(t).attr("id"),(t=story.parseObjref(t).target)&&t.notifySelected();break;case"trigger_submit_slide":player.currentSlide().handleEvent("onsubmitslide");break;case"gotoplay":a=$(t).children("objref").attr("value"),t=$(t).attr("window"),a=i.parseObjref(a).target,s(t,a);break;case"playnextdrawslide":player.currentDraw.playnextdrawslide();break;case"close_window":r=$(t).attr("id"),"_current"==r?player.currentWindow&&player.currentWindow.close():(t=story.parseObjref(r).target,t.close());break;case"close_player":window.manuallyClosing=!0,player.lmsManager.handleClosePlayer(),setTimeout(function(){player.isCrossDomainFrame?window.close():top.window.close()},10);break;case"eval_interaction":r=$(t).attr("id"),i.parseObjref(r).target.evaluate();break;case"eval_all_unanswered":Interaction.eval_all_unanswered(t);break;case"setquizcomplete":Interaction.setquizcomplete(t);break;case"object_action":if(a=$(t).attr("command"),t=this.parseObjrefFromXML(t).target,"function"==typeof t[a])return t[a](this.xml),!0;break;case"showtimer":r=$(t).attr("id"),t=i.parseObjref(r).target,t.show();break;case"hidetimer":r=$(t).attr("id"),t=i.parseObjref(r).target,t.hide();break;case"starttimer":r=$(t).attr("id"),t=i.parseObjref(r).target,t.start();break;case"pausetimer":r=$(t).attr("id"),t=i.parseObjref(r).target,t.pause();break;case"pause_timeline":t=i.parseObjrefFromXML(t).target,"Layer"==t.innerType?player.layerPlaying=!1:player.pause();break;case"resetquiz":t=i.parseObjrefFromXML(t).target,t.reset(),t.attemptCount++,$.each(t.sliderefs,function(t,e){var r=i.parseObjref(e).target;r.compactResumeData=null,r.resumeData=null,r.resetSlide(!0,!0)}),player.currentSlide().reset();break;case"exe_javascript":r=$(t).attr("id"),window.ExecuteScript(r);break;case"emailto":t=$(t).attr("address"),location.href="mailto:"+t;break;case"printresults":break;case"enable_frame_control":s=$(t).attr("name"),t="true"==$(t).attr("enable"),player.frame.setControlEnabled(s,t);break;case"setactivetimeline":player.useActiveTimeline&&(t=i.parseObjrefFromXML(t).target,player.activeTimeline="Layer"==t.innerType?t:player);break;case"debug_trace":$(t).attr("message");break;default:i[a]?i[a](t):(s=new TimelineAction(i),r=new StoryEvent(i),s.loadFromXML(t,r),s[a]&&s[a](r,i,!1))}return e},Element.prototype.getProperty=function(t){switch(t){case"AbsoluteId":return this.getFullObjref(!0);case"XPos":return this.x;case"YPos":return this.y;case"InitXPos":return this.originalX+this.xoffset-this.originalXOffset;case"InitYPos":return this.originalY+this.yoffset-this.originalYOffset;case"width":return this.width;case"height":return this.height;case"Position":if("ScrollArea"==this.innerType&&this.ref)return this.getScrollPosition()}return"function"==typeof this[t]?this[t]():""},Element.prototype.GetProperty=function(t){return this.extractVariable(t)},Element.prototype.GetVariable=function(t){return this.extractVariable(t)},Element.prototype.extractVariable=function(t,e){switch(e=e||"var"){case"var":case"variable":case"property":var i=this.parseObjref(t),r=i.target.variables[i.variable];return void 0==r&&(r=i.target.getProperty(i.variable)),"property"==e&&story.properties[t]&&(r=story.properties[t]),r;case"number":return parseFloat(t);case"boolean":return t;case"actparam":return TimelineAction.actparams[t];default:return t}},Element.prototype.setVariable=function(t,e){var i=this.parseObjref(t);i.target.variables[i.variable]!=e&&(i.target.variables[i.variable]=e,i.target.handleVarChanged(t,"onvarchanged"))},Element.prototype.registerVariableEventSubscriber=function(t,e){for(var i in this.eventSubscribers){var r=this.eventSubscribers[i];if(r.item==t&&r.varname==e)return}this.eventSubscribers.push({item:t,varname:e,check:Math.random()})},Element.prototype.handleVarChanged=function(t,e){var e=e||"onvarchanged",i=this;$.each(this.eventSubscribers,function(r,a){(a.varname==t||a.item.getFullVariableRef(a.varname)==i.getFullVariableRef(t))&&(a.item.handleEvent(e,t,null,!1,!0),a.item.render&&a.item.render(null,!0,null,"handleVarChanged"))})},Element.prototype.setProperty=function(t,e,i){var r=this.parseObjref(t),t=r.target.variables[r.variable]!=e;r.target.variables[r.variable]=e,t&&!i&&!this.group&&setTimeout(function(){r.target.handleVarChanged(r.variable,"onpropchanged")},0)},Element.prototype.parseObjrefFromXML=function(t){return this.parseObjref($(t).find("objref").attr("value"))},Element.prototype.parseObjref=function(t){var e=this,i=t,r=!1,a=!0,s=!1;if(!t)return{target:null,variable:null,success:!1,isVariableRef:!1};var n=i.split(".");return $.each(n,function(t,o){switch(o){case"_this":break;case"_children":r=!0;break;case"_parent":if(e.parent)for(e=e.parent;"ShuffleGroup"==e.innerType;)e=e.parent;break;case"_player":e=story;break;default:var l=t==n.length-1,h=e.children[o];!h&&e.children[""]&&(h=e.children[""].children[o]),h?e=h:l&&(i=o,s=!0,"undefined"==typeof e.variables[o]&&(a=!1))}}),{target:e,variable:i,processChildren:r,success:a,isVariableRef:s}},Element.prototype.setStates=function(t,e){var i=this;1<t.split("_").length&&$.each(t.split("_"),function(t,r){0!=r.length&&(r="_"+r.toLowerCase(),i.variables[r]=e,i.handleVarChanged("onvarchanged",r))}),i.render&&i.render(t,!0,null,"setStates"),i.executeStateActions&&i.executeStateActions(t),i.variables.ObjectState=t},Element.prototype.store_resume_data=function(t){var e=$(t).attr("objref"),t=$(t).attr("varref"),e=this.parseObjref(e).target,e=JSON.stringify(e.toData());this.setVariable(t,e)},Element.prototype.restore_resume_state=function(t){var e=$(t).attr("objref"),i=$(t).attr("varref"),t="true"==$(t).attr("limited"),e=this.parseObjref(e).target;(i=this.extractVariable(i))&&(i=JSON.parse(i)),i&&e.updateFromData(i,t)},Element.prototype.evaluateCondition=function(t,e){var i=this,r=function(){if(e){if(e.lmsCorrectResponses[0]&&e.lmsCorrectResponses[0].lmstext)return e.lmsCorrectResponses[0].lmstext;e.lmsCorrectResponses[0]={lmstext:""}}return""},a=function(t){if(e){var i=r();i&&(i+=" "),e.lmsCorrectResponses[0]={lmstext:i+t}}};switch($(t).get(0).tagName){case"condition":return $(t).children(),i.evaluateCondition($(t).children().first(),e);case"and":var s=!0;return $(t).children().each(function(t,n){r()&&a("and"),s=e?i.evaluateCondition(n,e)&&s:s&&i.evaluateCondition(n)}),s;case"or":return s=!1,$(t).children().each(function(t,n){r()&&a("or"),s=e?i.evaluateCondition(n,e)||s:s||i.evaluateCondition(n)}),s;case"nand":return s=!0,$(t).children().each(function(t,n){r()&&a("and"),s=e?i.evaluateCondition(n,e)&&s:s&&i.evaluateCondition(n)}),!s;case"nor":return s=!1,$(t).children().each(function(t,n){r()&&a("nor"),s=e?i.evaluateCondition(n,e)||s:s||i.evaluateCondition(n)}),!s;case"compare":var n=$(t),o=n.attr("operator"),l=!0,h=n.attr("valuea"),h=i.extractVariable(h,n.attr("typea")),p=n.attr("valueb"),n=i.extractVariable(p,n.attr("typeb"));!isNaN(h)&&!isNaN(n)&&(h=parseFloat(h),n=parseFloat(n));var p=h==n,c="equals";switch(o){case"eq":c="equal to";break;case"iceq":p=h.toLowerCase()==n.toLowerCase(),c="equal to";break;case"noteq":p=!p,c="not equal to";break;case"icneq":p=h.toLowerCase()!=n.toLowerCase(),c="not equal to";break;case"gt":p=h>n,c="greater than";break;case"gte":p=h>=n,c="greater than or equal to";break;case"lt":p=n>h,c="less than";break;case"lte":p=n>=h,c="less than or equal to";break;default:l=!1}return a("Correct Response is "+c+" "+n),l?p:!1;case"hittestpoint":return o=this.parseObjref($(t).children("objref").attr("value")).target,l=parseInt(this.extractVariable($(t).children("xpos").attr("value"),$(t).children("xpos").attr("type"))),h=parseInt(this.extractVariable($(t).children("ypos").attr("value"),$(t).children("ypos").attr("type"))),o?o.isPointActive(l,h):!1;case"hasslidetext":var o=this.parseObjref(this.extractVariable($(t).children("slideref").attr("value"),$(t).children("slideref").attr("type"))).target,d=this.extractVariable($(t).children("searchref").attr("value"),$(t).children("searchref").attr("type")),d=d.toLowerCase(),u=!1;return o.xml.find("[alttext]").each(function(t,e){u=u||-1<$(e).attr("alttext").toLowerCase().indexOf(d)}),u;case"varexists":return o=this.parseObjref($(t).attr("value")),d=o.target.variables[o.variable],void 0!=d;case"isdescendant":return l=this.extractVariable($(t).attr("targeta"),$(t).attr("typea")),o=this.extractVariable($(t).attr("targetb"),$(t).attr("typeb")),l=this.parseObjref(l).target,o=this.parseObjref(o).target,l.isAncestor(o);default:return!1}},Element.prototype.get_mouse_position=function(t){if("true"!=this.variables._disabled&&"true"!=this.parent.variables._disabled){swipe.sniff(player.lastEvent||window.event),swipe.moved=!1;var e=this.slide.ref.offset(),e=this.slide.matrix.unTransformPoint((swipe.rawX-e.left)/player.frameScale,(swipe.rawY-e.top)/player.frameScale);this.setVariable($(t).children("xvar").attr("value"),e.x),this.setVariable($(t).children("yvar").attr("value"),e.y)}},Element.prototype.moveto=function(t){var e=this.parseObjref($(t).children("objref").attr("value")).target,i=parseInt(this.extractVariable($(t).children("xpos").attr("value"),$(t).children("xpos").attr("type"))),r=parseInt(this.extractVariable($(t).children("ypos").attr("value"),$(t).children("ypos").attr("type")));if("true"==$(t).attr("addoffsetx"))var a=parseInt(this.extractVariable($(t).children("xoffset").attr("value"),$(t).children("xoffset").attr("type"))),i=i+a;"true"==$(t).attr("addoffsety")&&(t=parseInt(this.extractVariable($(t).children("yoffset").attr("value"),$(t).children("yoffset").attr("type"))),r+=t),e.actionControlled=!0,e.ref.css("left",i),e.ref.css("top",r),e.x=i,e.y=r,e.updateMatrixComplete(!0)},Element.prototype.bringtofront=function(t){var e=this;t&&(e=this.parseObjref($(t).children("value").attr("value")).target),e.depth<e.slide.topZ&&(e.depth=++e.slide.topZ,e.setZIndex(e.depth))},Element.prototype.open_webobject=function(t){this.webobject&&(this.webobject.remove(),this.webobject=null);var e=this.parent;"Slide"==this.innerType&&(e=this),this.webobject=$("<iframe class='item webobject'></iframe>"),this.webobject.attr("src",$(t).attr("url")),this.webobject.attr("width",$(t).attr("width")),this.webobject.attr("height",$(t).attr("height")),this.webobject.css("left",$(t).attr("xpos")+"px"),this.webobject.css("top",$(t).attr("ypos")+"px"),this.webobject.css("z-index",this.depth),e.ref.append(this.webobject),this.webobject.show()},Element.prototype.destroyWebobjects=function(){this.webobject&&(this.webobject.remove(),this.webobject=null)},Element.prototype.open_url=function(t){var e=$(t).attr("url"),i=$(t).attr("window"),r=$(t).attr("windowsize");$(t).attr("usedefaultcontrols");var a="true"==$(t).attr("status")?1:0,s="true"==$(t).attr("toolbar")?1:0,n="true"==$(t).attr("location")?1:0,o="true"==$(t).attr("menubar")?1:0,l="true"==$(t).attr("scrollbars")?1:0,h="true"==$(t).attr("resizable")?1:0,p=parseInt($(t).attr("width")),t=parseInt($(t).attr("height")),a="location="+n+",menubar="+o+",resizable="+h+",status="+a+",scrollbars="+l+",toolbar="+s;switch(r){case"fullscreen":a+=",width="+(screen.width-33)+",height="+(screen.height-150);break;case"custom":a+=",width="+p+",height="+t}story.popWindow=window.open(e,i,a),story.popWindow&&story.popWindow.focus&&story.popWindow.focus()},Element.prototype.slideY=function(){for(var t=0,e=this;e&&!isNaN(e.y);)t+=parseInt(e.y),!isNaN(e.yoffset)&&e!=this&&(t+=e.yoffset),"ScrollArea"==e.innerType&&e.ref&&e.ref.get(0)&&e.ref.get(0).scrollTop&&(t-=parseInt(e.ref.get(0).scrollTop)),e=e.parent;return parseInt(t)},Element.prototype.slideX=function(){for(var t=0,e=this;e&&!isNaN(e.x);)t+=parseInt(e.x),!isNaN(e.xoffset)&&e!=this&&(t+=e.xoffset),"ScrollArea"==e.innerType&&e.ref&&e.ref.get(0)&&e.ref.get(0).scrollLeft&&(t-=parseInt(e.ref.get(0).scrollLeft)),e=e.parent;return parseInt(t)},Element.prototype.testOver=function(t,e){var i=this.matrix.unTransformPoint(t,e);return 0<=i.x&&i.x<=this.width&&0<=i.y&&i.y<=this.height},Element.prototype.deepEach=function(t,e,i){isNaN(i)&&(i=0),$.each(this.children,function(r,a){(!e||e(a))&&(t(r,a,i),a.deepEach&&a.deepEach(t,e,i+1))})},Element.prototype.getAbsoluteMatrix=function(){for(var t=this.matrix.copy(),e=this.parent,i=0;e&&e.matrix&&10>i++;)t.multiply(e.matrix),e=e.parent;return t},Element.prototype.updateMatrixComplete=function(t){this.parent&&this.parent.updateMatrixComplete&&this.parent.updateMatrix&&this.parent.updateMatrixComplete(!1),this.updateMatrix(),t&&this.deepEach(function(t,e){e.matrix&&e.isStageItem&&e.updateMatrix()})};var Storyline=function(t){this.container=t,this.scenes=[],this.allSlides=[],this.slideLookup={},this.media=[],this.slideDraws=[],this.startingslide=null,this.quizzes={},this.timers={},this.pathlibs={},this.properties={},this.currentSceneIndex=0,this.constructElement()};Storyline.prototype=new Element,Storyline.prototype.objectType="Storyline",Storyline.prototype.innerType="Storyline",Storyline.prototype.saveToLocalStorage=function(){if(player.useCompactResume){var t=story.toResumeData();try{localStorageAlias[story.resumeID]=t}catch(e){}}else t=JSON.stringify(story.toData(!0)),localStorageAlias[story.resumeID]=t},Storyline.prototype.clearLocalStorage=function(){localStorageAlias.removeItem(story.resumeID)},Storyline.prototype.toResumeData=function(){var t="";if(0==player.history.length&&null==player.currentWindowSlide)return"";var e="",i=0;$.each(this.allSlides,function(t,r){r.variables.Visited&&r.trackviews&&(e+=bwChunk.UBase10toN(r.slideIndexForResume,2),i++)}),1==i&&(e="");var t=t+bwChunk.CreateChunk(e),r="",a=Window.getWindowResumeData(0,story.allSlides[player.slideIndex],player.history),r=r+bwChunk.CreateChunk(a),s=0;$.each(this.children,function(t,e){if("Window"==e.innerType&&(s++,e.visible)){var i=Window.getWindowResumeData(s,player.currentWindowSlide,e.history);r+=bwChunk.CreateChunk(i)}});var t=t+bwChunk.CreateChunk(r),a=story.getVariableResumeData(),t=t+a,n="";return $.each(this.children,function(t,e){if("Scene"==e.innerType){var i=bwChunk.EMPTY_CHUNK;e.compactResumeData&&(i=e.compactResumeData),n+=i}}),t+=n,a=bwChunk.UBase10toN(t.length),t=bwChunk.CreateChunk(a)+t},Storyline.prototype.updateFromCompactData=function(t){var t=new bwChunk(t),e=t.Remainder(),i=bwChunk.UBaseNto10(t.Data());if(e.length!=i)return!1;t=t.NextChunk(),i=t.NextChunk(),e=new bwChunk(i.Data()),i=i.NextChunk(),story.restoreVariableResumeData(i.Data()),i.Remainder();for(var i=i.NextChunk(),r=0;!i.isNothing;)i.IsEmpty()||story.getDescendantsByType("Scene")[r].restoreFromResumeData(i.Data()),i=i.NextChunk(),r++;for(;!e.IsEmpty();){var a,i=new bwChunk(e.Data()),s=bwChunk.UBaseNto10(i.Data());if(0==s)i=Window.parseResumeChunk(e),i.slide&&(this.startingslide=i.slide.getFullObjref()),player.history=i.history;else{a=null;var n=1;$.each(this.children,function(t,e){"Window"==e.innerType&&(n==s&&(a=e),n++)}),a&&(i=Window.parseResumeChunk(e),i.slide)&&(i.win=a,this.startingWindowInfo=i)}e=e.NextChunk()}for(;!t.EOF();){var o=t.NextUBase10(2),l=null;$.each(story.allSlides,function(t,e){e.slideIndexForResume==o&&(l=e)}),l.trackviews&&player.lmsManager&&(player.lmsManager.viewedSlides[l.id]=!0),player.slideList.markVisited(l)}return!0},Storyline.prototype.toData=function(t){var e=this,i={slideID:player.currentSlide().id,history:player.history};return $.each(this.variables,function(t,r){r!=e.variableDefaults[t]&&(i.variables||(i.variables={}),i.variables[t]=r)}),$.each(this.children,function(e,r){if("Slide"!=r.innerType&&r.toData){var a=r.toData(t);jQuery.isEmptyObject(a)||(i.children||(i.children={}),i.children[e]=a)}}),i},Storyline.prototype.updateBaseFromData=Element.prototype.updateFromData,Storyline.prototype.updateFromData=function(t){try{this.updateBaseFromData(t),t.slideID&&(this.startingslide=t.slideID),t.history&&(player.history=t.history)}catch(e){}},Storyline.prototype.loadFromXML=function(t){var e=this;e.xml=$(t).children(),this.scenes=[],this.allSlides=[],this.slideLookup={},this.media=[],this.currentSceneIndex=0,this.children={},this.resumeID=$(t).children().children("resume").attr("id"),this.resumeWindow=$(t).children().children("resume").attr("window"),this.resumeSlideID=$(t).children().children("resume").attr("slideid"),this.resumeLMS="true"==$(t).children().children("resume").attr("lmsresume"),this.resumeFlash="true"==$(t).children().children("resume").attr("flashresume"),this.resumePrompt="true"==$(t).children().children("resume").attr("prompt"),this.frameWidth=parseInt($(t).children().children("display").attr("width")),this.frameHeight=parseInt($(t).children().children("display").attr("height")),-1<location.search.indexOf("&menu=1")&&(this.frameWidth+=200),$(t).find("display").children("windows").children("window").each(function(t,i){var r=new Window;r.loadFromXML(i,e),r.createRef(),e.children[r.id]=r}),e.slidemap=[],$(t).children().children("slidemap").children("slideref").each(function(t,i){var r={};r.id=$(i).attr("id"),e.slidemap.push(r)}),$(t).children().children("pathlibs").children("pathlib").each(function(t,i){var r=new PathLib;r.loadFromXML(i,e),e.pathlibs[r.id]=r}),e.entrypoint=$(t).find("bwContent").attr("entrypoint"),e.startingslide=$(t).find("bwContent").attr("entrypoint");var i=$(t).find("scene");e.pendingSceneCount=i.length,i.each(function(i,r){0!=i&&1==i&&(story.startingSlideIndex=story.allSlides.length);var a=new Scene;a.id=$(r).attr("id"),a.lmsid=$(r).attr("lmsid"),a.startingslide=$(r).attr("startingslide"),a.sceneIndex=i,a.parent=e,a.loadElementInfoFromXML(r),trace.logMulti("scene",e.scenes.length+1,a.id),e.pendingSceneCount=0,$(r).children("slides").children("slide").each(function(t,i){var r=new Slide(e.container);r.loadFromXML($(i)),r.parent=a,r.sceneIndex=a.sceneIndex,r.sceneSlideIndex=t,a.slides.push(r),a.children[$(i).attr("id")]=r,e.allSlides.push(r),e.slideLookup[$(i).attr("id")]=r,e.children[r.id]=r,r.slideIndex=e.allSlides.length-1,r.slideIndexForResume=r.slideIndex+1,player.width=r.width,player.height=r.height,player.aspectRatio=r.aspectRatio}),$(t).children().children("timers").children("timer").each(function(t,i){var r=new Timer;r.loadFromXML(i,e),e.children[r.id]=r,e.timers[r.id]=r}),a.slideDraws=[],$(r).children("slidedraws").children("slidedraw").each(function(t,i){var r=new SlideDraw;r.loadFromXML(i),r.parent=a,r.drawIndex=t,a.children[r.id]=r,e.slideDraws.push(r)}),a.title="Scene "+i,e.children[a.id]=a}),this.loadElementInfoFromXML($(t).children()),$(t).children().children("quizzes").children().each(function(t,i){var r=new Quiz;r.loadFromXML(i,e),e.quizzes[r.id]=r,e.children[r.id]=r}),e.scoring=new Scoring,e.scoring.loadFromXML($(t).children().children("scoring")),SlideDraw.NextSlideIndex=this.allSlides.length+1,$(t).children().children("slidebank").each(function(t,i){var r=new SlideBank;r.loadFromXML(i,e),e.children[r.id]=r}),$(t).children().children("slidemap").children("slideref").each(function(t,i){var r=$(i).attr("id"),a=e.parseObjref(r).target;$(i).children("assets").children("asset").each(function(t,i){var r=$(i).attr("url");$(i).attr("mobileurl");var s=$(i).attr("htmlurl"),r=player.basepath+(s?s:r),s="image";switch(r.split(".").pop()){case"swf":r=r.replace(".swf",".png"),s="swfImage";break;case"png":case"jpg":case"jpeg":case"gif":case"bmp":break;case"flv":case"mov":case"mp4":case"avi":s="video";break;case"mp3":s="audio";break;default:return}switch(s){case"image":s=new Resource(e,r,function(){}),"Slide"==a.innerType&&(a.pushResource(s),s.src=r)}})}),player.loadingSlide=null},Storyline.prototype.addSlide=function(){},Storyline.prototype.getSlideByID=function(t){for(var e=0;e<story.allSlides.length;e++)if(story.allSlides[e].id==t)return story.allSlides[e];return null};var Window=function(){this.xml="",this.constructElement(),this.selected=!1,this.zoomModifier=1,this.history=[],this.visible=!1};Window.prototype=new Element,Window.prototype.objectType="Window",Window.prototype.innerType="Window",Window.getWindowResumeData=function(t,e,i){var t=""+bwChunk.CreateChunk(bwChunk.UBase10toN(t)),t=t+Slide.getResumeReference(e),r="";return $.each(i,function(t,e){r+=Slide.getResumeReference(story.allSlides[e])}),r+=Slide.getResumeReference(e),t+=bwChunk.CreateChunk(r)},Window.parseResumeChunk=function(t){var e={},i=new bwChunk(t.Data());t.Skip(i.ChunkData().length),i=Slide.getFromResumeChunk(t),e.slide=i;for(var r=[],t=new bwChunk(t.NextString());!t.EOF();)i=Slide.getFromResumeChunk(t),r.push(i.slideIndex);return r.pop(),e.history=r,e},Window.closeAll=function(){$.each(story.children,function(t,e){"Window"==e.innerType&&e.close()})},Window.prototype.loadFromXML=function(t,e){this.parent=e,this.children={},this.id=$(t).attr("id"),this.linkid=$(t).attr("linkid"),this.width=parseInt($(t).attr("width"))-2,this.height=parseInt($(t).attr("height"))-2,this.alignto=$(t).attr("alignto"),this.align=$(t).attr("align"),this.valign=$(t).attr("valign"),"LightboxWnd"==this.id||"LightboxControlsWnd"==this.id?(this.width-=6,this.height-=6):this.isPrompt=!0},Window.prototype.createRef=function(){var t=$("<div class='window'><h1>Title</h1><hr><div class='windowContent'></div></div>");switch(t.css("width",this.width),t.css("height",this.height),t.css("margin","auto"),t.addClass(this.id),this.contentRef=t.children("div").first(),this.titleRef=t.children("h1").first(),this.isPrompt&&t.addClass("prompt"),this.align){case"center":t.css("left","50%"),t.css("margin-left",-this.width/2)}switch(this.valign){case"center":t.css("top","50%"),t.css("margin-top",-this.height/2)}$("#slidecontainer").append(t),this.ref=t,this.ref.hide()},Window.prototype.prepareLightbox=function(){if($(".interstitial").removeClass("black"),$(".interstitial").removeClass("white"),$(".interstitial").unbind(),$(document.body).append($(".window.prompt")),!this.lightboxPrepared){$(document.body).append(this.ref),this.contentRef.css("width",this.width),this.contentRef.css("height",this.height),this.closeIcon=$("<div class='closeicon'><span>x</span></div>"),this.closeIcon.css("left",.85*player.width-10+"px"),this.ref.append(this.closeIcon);var t=this;this.closeIcon.click(function(){t==player.currentWindow&&t.close()}),this.lightboxPrepared=!0,this.zoomModifier=.85,"LightboxControlsWnd"==this.id&&(this.controls=$("#controls").clone(!1),this.controls.css("left","0px"),this.ref.append(this.controls),this.progressBar=new ProgressBar(null,this.controls.find("#progressbar"),!0),this.progressBar.onDragUpdate=player.progressBar.onDragUpdate,this.progressBar.zoomModifier=this.zoomModifier,this.controls.find(".submit-slide").parent().bind("click",function(){0<$(".modalfence:visible").length||story.handleEvent("onobjectevent","submit_pressed",null,!1,!1,!0)}),this.controls.find(".next-slide").parent().bind("click",function(){story.handleEvent("onobjectevent","next_pressed",null,!1,!1,!0)}),this.controls.find(".previous-slide").parent().bind("click",function(){story.handleEvent("onobjectevent","prev_pressed",null,!1,!1,!0)}),this.controls.find(".play").bind("click",function(){player.activeTimeline.play()}),this.controls.find(".pause").bind("click",function(){player.activeTimeline.pause()}),this.volumeSlider=new VolumeSlider(this.controls.find("#control-volume")),this.volumeSlider.onDragUpdate=function(t){$("audio,video").each(function(e,i){i.volume=Math.min(t*player.clipVolume,1)}),Audio.setMasterVolume&&Audio.setMasterVolume(t)})}},Window.prototype.closeLightbox=function(){player.stackedWindow||($(".blocker").hide(),$(".interstitial").hide(),$(".interstitial").removeClass("black"),player.showingInterstitial=!1,$("#slidecontainer").append($(".window.prompt"))),player.currentWindowSlide.variables.Visited=!0,player.currentWindowSlide.viewedCurrent=!0,player.currentWindowSlide.saveIfNecessary(),player.currentWindowSlide.hide(),player.currentWindowSlide.resetSlide(),player.currentWindowSlide.unloadContent(),player.currentWindow=null,player.currentWindowSlide=null,player.currentSlide().handleEvent("ontransitionin",null,null,!1,!0),player.currentTime=player.currentSlide().currentTime},Window.prototype.renderBackground=function(){var t={canvas:this.background.get(0),m_nXOffset:0,m_nYOffset:0,m_nWidth:this.width+100,m_nHeight:this.height};ppArt.DrawVector(t,"ZB1$v$vPCZy$f2L$_XA100jfZQA1$3N10OaXIA1ag70FCDY$v00LCYv0000PC_$3w2wPC_$9wn3PC_$9wn3PC_$9wn3PC_$9wn3e20PC_$9wn3PC_$PyDYg40PC_$PyDYPC_$VyYvLCYv_y00FCDY_y00e20FCDY_y009wn3_y00g409wn3_y003w2w_y00$v00VyYv$v00PyDYe20$v00PyDY$v009wn3g40$v009wn300003w2w3w2w$v009wn3$v003t3w00px000000E0505010100w00N10$$$$E0aEg70FC$v$v$vLCt1$v$vPC$v3wx_PC$v9w$vPC$v9w$vPC$v9w$vPC$v9w$ve20PC$v9w$vPC$vPy$vg40PC$vPy$vPC$vVyt1LCt1Zy$vFC$vZy$ve20FC$vZy$v9w$vZy$vg409w$vZy$v3wx_Zy$v$v$vVyt1$v$vPy$ve20$v$vPy$v$v$v9w$vg40$v$v9w$v$v$v3wx_3wx_$v$v9w$v$v$v3E",null,player.fontlib,null)},Window.prototype.appendSlide=function(t){
t.loadContentFromXML(),this.slide&&this.slide.ref.remove(),this.slide=t,this.contentRef.empty(),this.contentRef.append(t.ref),this.titleRef.html(t.title)},Window.prototype.close=function(){this.slide&&this.slide.ref&&(player.pause(),this.slide.ref.remove()),this.slide=null,this.ref.hide(),(this==player.currentWindow||this==player.previousWindow)&&(this.closeLightbox(),player.currentWindow=player.stackedWindow,player.currentWindowSlide=player.stackedWindowSlide,player.stackedWindow=null,player.stackedWindowSlide=null,this.visible=!1,player.windowZoomModifier=1,player.zoomParams=null,player.pause(),player.play())},Window.prototype.showSlide=function(t,e){if(player.currentWindow&&player.currentWindow!=this&&(player.stackedWindow=player.currentWindow,player.stackedWindowSlide=player.currentWindowSlide,player.windowStack.push(player.currentWindow)),"LightboxWnd"==this.id||"LightboxControlsWnd"==this.id)this.isLightbox=!0,this.prepareLightbox();else if("MessageWnd"==this.id){var i=$("<div class='blocker'></div>");$(".contentpane").append(i)}player.currentWindowSlide&&(player.currentWindowSlide.saveIfNecessary(),player.currentWindowSlide.resetSlide()),this.ref.show(),t.currentTime=0,t.createRef(),this.appendSlide(t),t.ref.show(),t.variables.WindowId=this.id,t.variables.Visited=!0,t.viewedCurrent=!0,t.update(0,!0),!e&&player.currentWindow&&player.currentWindowSlide&&player.currentWindow.history.push(player.currentWindowSlide.slideIndex),player.currentWindow=this,player.currentWindowSlide=t,this.visible=!0,this.isLightbox&&($(".interstitial").show(),player.showingInterstitial=!0),player.currentSlide().handleEvent("ontransitionin",null,null,!1,!0),player.currentSlide().handleEvent("ontransitionincomplete",null,null,!1,!0),player.currentSlide().handleEvent("onslidestart",null,null,!1,!0),player.currentSlide().deepEach(function(t,e){e.handleEvent&&e.handleEvent("onslidestart",null,null,!1,!0)}),player.pause(),player.currentTime=0,player.play()};var ResumePrompt=function(){this.xml="",this.constructElement(),this.selected=!1};ResumePrompt.prototype=new Window,ResumePrompt.prototype.objectType="ResumePrompt",ResumePrompt.prototype.innerType="ResumePrompt",ResumePrompt.prototype.createRef=function(){var t=this,e=$("<div class='window dialog'><h1>Resume</h1><p>Would you like to resume where you left off?</p><div class='choose'><span class='button yes'>Yes</span><span class='button no'>No</span></div></div>");this.contentRef=e.children("p").first(),this.titleRef=e.children("h1").first(),this.suppressRef=$("<div></div>"),$(document.body).append(e),this.ref=e;var i=e.find(".yes"),r=e.find(".no");e.find(".button").bind("mousedown touchstart",function(){$(this).addClass("pressed")}),e.find(".button").bind("mouseup touchend mouseout",function(){$(this).removeClass("pressed")}),i.bind("click",function(){t.slide.children.btn0.handleEvent("onrelease",null,null,!1,!1,!0),$(".interstitial").removeClass("resume"),$(".interstitial").hide(),player.showingInterstitial=!1}),r.bind("click",function(){t.slide.children.btn1.handleEvent("onrelease",null,null,!1,!1,!0),$(".interstitial").removeClass("resume"),$(".interstitial").hide(),player.showingInterstitial=!1}),this.ref.hide()},ResumePrompt.prototype.appendSlide=function(t){this.slide&&this.slide.ref.remove(),this.slide=t,this.suppressRef.append(t.ref),this.titleRef.html($(t.title).text()),setTimeout(function(){t.ref.find(".item_ResumePromptSlide_Text").text(),$(".interstitial").removeClass("black"),$(".interstitial").addClass("resume"),$(".interstitial").show(),player.showingInterstitial=!0},1)};var Scene=function(){this.slides=[],this.constructElement()};Scene.prototype=new Element,Scene.prototype.objectType="Scene",Scene.prototype.innerType="Scene",Scene.prototype.restoreFromResumeData=function(t){var e=this.getDescendantsByType("Slide"),i=[];$.each(e,function(t,e){e.resume&&i.push(e)});for(var e=new bwChunk(t),r=0,a=0;!e.isNothing;){if(r>=i.length){var s=story.slideDraws[a];s&&s.restoreFromResumeData(e.Data()),a++}else i[r].compactResumeData=e.ChunkData();e=e.NextChunk(),r++}this.compactResumeData=bwChunk.CreateChunk(t)},Scene.prototype.getResumeData=function(){var t="",e="";$.each(this.children,function(t,i){i.compactResumeData?e+=i.compactResumeData:i.resume&&(e+=bwChunk.EMPTY_CHUNK)});var i="";return $.each(this.children,function(t,e){"SlideDraw"==e.innerType&&(e.compactResumeData||(e.compactResumeData=e.getResumeData()),i+=e.compactResumeData||"0")}),e+=i,t+=bwChunk.CreateChunk(e)},Scene.prototype.getFirstSlide=function(){for(var t=0;t<story.allSlides.length;t++)if(story.allSlides[t].parent.id==this.id)return story.allSlides[t];return this};var Timer=function(t,e,i){this.container=t||$(document.body),this.slide=e,this.layer=i,this.ref=null,this.content={fontsize:18,font:"Arial"},this.constructElement(),this.events=[],this.active=!0,this.visible=!1,this.startPosition=0,this.startTime=null,this.currentPosition=0,this.visible=this.running=!1};Timer.prototype=new Element,Timer.prototype.innerType="Timer",Timer.prototype.objectType="Timer",Timer.prototype.toBaseData=Element.prototype.toData,Timer.prototype.toData=function(t){return t=this.toBaseData(t),0!=this.currentPosition&&(t.currentPosition=this.currentPosition),this.running&&(t.running=!0),this.visible&&(t.visible=!0),t},Timer.prototype.updateBaseFromData=Element.prototype.updateFromData,Timer.prototype.updateFromData=function(t){this.updateBaseFromData(t),t.currentPosition&&(this.currentPosition=t.currentPosition),t.visible&&this.show(),t.running&&this.start(),t.variables&&t.variables.DropTargetId&&(this.dropArea=this.parent.children[t.variables.DropTargetId])},Timer.prototype.loadFromXML=function(t){this.loadElementInfoFromXML(t),this.id=$(t).attr("id"),this.duration=parseInt($(t).attr("duration"))},Timer.prototype.show=function(){this.visible=!0,this.createRef(),this.render(),this.ref.show()},Timer.prototype.hide=function(){this.visible=!1,this.ref.hide()},Timer.prototype.start=function(){var t=this;this.startPosition=this.currentPosition,this.startTime=new Date,this.render(),this.interval||(this.interval=setInterval(function(){t.tick()},100))},Timer.prototype.pause=function(){this.interval&&(clearInterval(this.interval),this.interval=null)},Timer.prototype.tick=function(){this.currentPosition=this.startPosition+(new Date-this.startTime),this.currentPosition>this.duration&&(this.currentPosition=this.duration,this.handleEvent("timercomplete"),this.pause()),this.render()},Timer.prototype.createRef=function(){this.ref||(this.ref=$("<canvas class='timer' width='20' height='20'></canvas>"),player.isIOSFrame?$(document.body).append(this.ref):$(".framewrap").append(this.ref),this.context=this.ref.get(0).getContext("2d"))},Timer.prototype.render=function(){if(this.context){this.context.strokeStyle="#cfcfcf",player.isIOSFrame||(this.context.strokeStyle=player.frame.colorGroups.timer.stroke.toColorString()),this.context.beginPath(),this.context.arc(10,10,9,0,2*Math.PI,!1),this.context.stroke();var t=this.context.createLinearGradient(0,0,0,20);t.addColorStop(0,"#039EF4"),t.addColorStop(1,"#0147E6");var e=this.context.createLinearGradient(0,0,0,20);e.addColorStop(0,"#FDE145"),e.addColorStop(1,"#E4B202"),player.isIOSFrame||(t=player.frame.colorGroups.timer.duration.toCanvasGradient(this.context,20),e=player.frame.colorGroups.timer.elapsed.toCanvasGradient(this.context,20)),this.context.beginPath(),this.context.fillStyle=t,this.context.arc(10,10,9,0,2*Math.PI,!1),this.context.fill();var t=-Math.PI/2,i=t-2*this.currentPosition/this.duration*Math.PI;this.context.beginPath(),this.context.fillStyle=e,this.context.moveTo(10,10),this.context.arc(10,10,9,t,i,!0),this.context.closePath(),this.context.fill()}};var Slide=function(t){this.container=t||$(document.body),this.ref=null,this.title="Untitled Slide",this.transition=null,this.layers={},this.timelineEvents=[],this.clips=[],this.resources=[],this.interactions={},this.responses={},this.navLinks=[],this.layerStack=[],this.loadedChunkXML=this.backgroundReady=this.ready=!1,this.currentIndex=this.zeroTime=this.currentTime=this.slideIndex=0,this.duration=5e3,this.active=!0,this.paused=this.playing=!1,this.width=720,this.height=540,this.scale=1,this.topZ=5,this.constructElement(),this.fullyLoaded=!1};Slide.prototype=new Element,Slide.prototype.objectType="Slide",Slide.prototype.innerType="Slide",Slide.getResumeReference=function(t){var e;return null==t?e=9:(e=""+(t.slideBank?"1":"0"),t.slideBank?(e+=bwChunk.CreateChunk(bwChunk.UBase10toN(t.drawSlideIndex)),e+=bwChunk.CreateChunk(bwChunk.UBase10toN(t.sceneIndex)),e+=bwChunk.CreateChunk(bwChunk.UBase10toN(t.drawIndex))):(e+=bwChunk.CreateChunk(bwChunk.UBase10toN(t.sceneSlideIndex)),e+=bwChunk.CreateChunk(bwChunk.UBase10toN(t.sceneIndex)))),e},Slide.getFromResumeChunk=function(t){if("1"==t.NextString(1))var e=t.NextChunkedUBase10(),i=t.NextChunkedUBase10(),t=t.NextChunkedUBase10(),i=story.getDescendantsByType("Scene")[i],e=i.getDescendantsByType("SlideDraw")[t].orderedChildren[e];else e=t.NextChunkedUBase10(),i=t.NextChunkedUBase10(),i=story.getDescendantsByType("Scene")[i],e=i.slides[e];return e},Slide.prototype.restoreFromResumeData=function(t,e){!this.fullyLoaded&&!e&&(this.loadContentFromXML(),e=!0),this.hasRestoredInteractions=!0;var i=[];this.deepEach(function(t,e){e.resume&&"ShuffleGroup"!=e.innerType&&i.push(e)},function(t){return"Layer"==t.innerType?!1:!0});var r=new bwChunk(t),r=new bwChunk(r.Data()),a=new bwChunk(r.Data());if($.each(this.interactions,function(t,e){e.restoreFromResumeChunk(a),a=a.NextChunk()}),!e){r=r.NextChunk(),this.currentTime=bwChunk.BaseNto10(r.Data(),r.Length()),this.fixCurrentIndex();for(var r=r.NextChunk(),s=new bwChunk(r.Data()),n=0;!s.isNothing;){var o=i[n];o&&o.restoreFromResumeData(s.ChunkData()),s=s.NextChunk(),n++}var l=[];for($.each(this.children,function(t,e){"Layer"==e.innerType&&l.push(e)}),n=r.NextChunk(),o=new bwChunk(n.Data()),s=0;!o.isNothing;)r=l[s],r.restoreFromResumeData(o.Data()),o=o.NextChunk(),s++,r.reset(),r.hide();for(n=n.NextChunk(),o=new bwChunk(n.Data());!o.isNothing;)s=o.NextUBase10(),r=l[s],s=r.currentTime,r.slide==player.currentSlide()?r.show():(r.visible=!0,r.setOnStage(!0)),r.currentTime=s,o=o.NextChunk();this.restoreVariableResumeData(n.NextChunk().NextChunk().Data())}},Slide.prototype.getResumeData=function(){var t="";if(this.resume&&this.variables.Visited){var e="",i="",r="",a="";this.deepEach(function(t,i){i.resume&&"ShuffleGroup"!=i.innerType&&(e+=bwChunk.CreateChunk(i.GetResumeData()))},function(t){return"Layer"==t.innerType?!1:!0}),a="",$.each(this.interactions,function(t,e){a+=bwChunk.CreateChunk(e.GetResumeData())});var t=bwChunk.CreateChunk(a),s=bwChunk.Base10toN(this.currentTime),t=t+bwChunk.CreateChunk(s),t=t+bwChunk.CreateChunk(e),n=[];$.each(this.children,function(t,e){"Layer"==e.innerType&&(e.visible&&n.push(e),e.resume&&(i+=bwChunk.CreateChunk(e.getResumeData())))}),t+=bwChunk.CreateChunk(i),$.each(n,function(t,e){var i=e.getItemIndex();r+=bwChunk.CreateChunk(bwChunk.Base10toN(i))}),t+=bwChunk.CreateChunk(r),t+=bwChunk.CreateChunk(""),s=this.getVariableResumeData(),0<util.count(this.variables)&&(t+=s),t=bwChunk.CreateChunk(t)}return t},Slide.prototype.rebuildInteractionData=function(){if(this.compactResumeData){var t=new bwChunk(this.compactResumeData),t=new bwChunk(t.Data()),e="",i="";$.each(this.interactions,function(t,e){i+=bwChunk.CreateChunk(e.GetResumeData())}),e+=bwChunk.CreateChunk(i),e+=t.Remainder(),this.compactResumeData=bwChunk.CreateChunk(e)}},Slide.prototype.toBaseData=Element.prototype.toData,Slide.prototype.toData=function(t){if(t&&this.resumeData)return this.variables.Visited&&(this.resumeData.variables||(this.resumeData.variables={}),this.resumeData.variables.Visited=!0),this.resumeData;var e=this.toBaseData(t);return $.each(this.interactions,function(t,i){var r=i.toData();jQuery.isEmptyObject(r)||(e.interactions||(e.interactions={}),e.interactions[t]=r)}),e},Slide.prototype.updateBaseFromData=Element.prototype.updateFromData,Slide.prototype.updateFromData=function(t){this.updateBaseFromData(t),this.variables.Visited&&player.slideList.markVisited(this),this.resumeData||(this.resumeData=t)},Slide.prototype.loadFromXML=function(t){var e=this;this.width=parseInt($(t).attr("width")),this.height=parseInt($(t).attr("height")),this.aspectRatio=this.width/this.height,this.id=$(t).attr("id"),this.title=$(t).attr("title"),this.html5url=$(t).attr("html5url"),this.dataurl=$(t).attr("dataurl"),this.trackviews="true"==$(t).attr("trackviews"),this.resume="true"==$(t).attr("resume"),this.enableseek="true"==$(t).attr("enableseek"),this.enablereplay="true"==$(t).attr("enablereplay"),this.xml=t,this.loadedChunkXML=null==this.html5url,this.loadElementInfoFromXML(t),this.loadedChunkXML&&(this.loadAudioFromXML(),this.loadBackgroundFromXML(),this.loadElementInfoFromXML(t)),e.interactionCount=0,$(t).children("interactions").children("interaction").each(function(t,i){var r=new Interaction;r.loadFromXML(i,e),e.interactions[r.id]=r,e.children[r.id]=r,e.interactionCount++}),this.transition=new Transition(this),this.transition.loadFromXML(t),this.detectSimpleNavigation(),player.preload&&this.loadContentFromXML(),e.variables.WindowId="_frame",e.variableDefaults.WindowId="_frame"},Slide.prototype.loadAudioFromXML=function(){var t=this;$(this.xml).children("audiolib").children("audio").each(function(e,i){var r=new Audio;r.loadFromXML(i,t,t.slide,t.layer),r.createRef(),t.children[r.id]=r})},Slide.prototype.loadBackgroundFromXML=function(){var t=this;$(t.xml).children("background").each(function(e,i){t.background=new Background(t.ref),t.background.loadFromXML(i),t.background.src?(t.content={src:t.background.src},t.resource=new Resource(t,t.background.src,function(){t.backgroundReady=!0}),t.pushResource(t.resource)):t.backgroundReady=!0,t.ref&&t.background.apply(t.ref)})},Slide.prototype.blockAndLoad=function(t){var e=this;this.loadCallbackStack?this.loadCallbackStack.push(t):this.loadCallbackStack=[t];var i=function(){for(player.shouldShowLoadingSpinner=!1;e.loadCallbackStack.length;)e.loadCallbackStack.pop()();player.actionQueuePaused=!1};if(player.actionQueuePaused=!0,e.ready&&e.backgroundReady&&e.loadedChunkXML)i();else{var r=0;clearTimeout(e.readyWaitTimeout),e.readyWaitTimeout=null;var a=function(){e.ready&&e.backgroundReady&&e.loadedChunkXML||50<r++?i():e.readyWaitTimeout=setTimeout(a,100)};player.slideLoadQueue&&0!=e.slideIndex&&player.slideLoadQueue.promote(e.slideIndex),player.shouldShowLoadingSpinner=!0,player.loadingSpinnerTimeout=setTimeout(function(){player.shouldShowLoadingSpinner&&(player.loadingSpinner.show(),player.frame.setControlEnabled("previous",!1),player.frame.setControlEnabled("next",!1),player.frame.setControlEnabled("submit",!1))},1e3),a()}},Slide.prototype.loadContentFromXML=function(){var t=this;if(this.loadedChunkXML){if(!this.fullyLoaded){this.fullyLoaded=!0;var e=t.xml;this.loadChildrenFromXML(e,t,null,function(){}),t.timelineEvents=[],$(e).children("timeline").each(function(e,i){t.duration=$(i).attr("duration"),$(i).find("event").each(function(e,i){var r=new TimelineEvent(t);r.loadFromXML(i),t.timelineEvents.push(r)})}),$(e).children("slidelayers").children("slidelayer").each(function(e,i){var r=new Layer(t.ref,t);r.loadFromXML(i),t.layers[r.id]=r,t.children[$(i).attr("id")]=r}),this.resetSlide()}}else this.loadingChunkXML||(this.loadingChunkXML=!0,this.loadChunkXML(!0))},Slide.prototype.integrateChunkXML=function(t,e){var i=this;$(t).children("slide").children().each(function(t,e){$(i.xml).append($(e))}),this.loadedChunkXML=!0,e&&(this.loadAudioFromXML(),this.loadElementInfoFromXML(i.xml),this.loadContentFromXML(),this.loadBackgroundFromXML(),this.detectSimpleNavigation())},Slide.prototype.loadChunkXML=function(t){var e=this;if(window.SlideXMLData=function(i,r){if("string"==typeof r){r=r.replace(/[\u000a\u000b\u000c\u000d\u0085\u2028\u2029]/g,""),r=r.replace(/&#x[0-8bcef];/gi,""),-1<location.search.indexOf("dumpxml=1")&&console.log(r);var a;window.ActiveXObject?(a=new ActiveXObject("Microsoft.XMLDOM"),a.loadXML(r)):a=(new DOMParser).parseFromString(r,"text/xml"),r=a}e.id!=i?story.getSlideByID(i).integrateChunkXML(r,t):e.integrateChunkXML(r,t)},player.loadFromScript){var i=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=player.basepath+e.html5url,i.appendChild(r)}else $.ajax({url:player.basepath+e.dataurl.replace(".swf",".xml")+"?rand="+Math.random(),dataType:"xml",success:function(i){e.integrateChunkXML(i,t)},error:function(){return!1}})},Slide.prototype.detectSimpleNavigation=function(){var t=this;this.hasSimpleNavigation=!0,$(this.xml).find('actiongroup[id="ActGrpOnNextButtonClick"]').each(function(e,i){var r=$(i).children("actions").children(),a=$(i).children("actions").children("gotoplay");(1!=r.length||1!=a.length)&&(t.hasSimpleNavigation=!1)})},Slide.prototype.canUnloadContent=function(){return $(this.xml).find("hittestpoint"),0==$(this.xml).find("hittestpoint").length},Slide.prototype.unloadContent=function(){if(this.fullyLoaded&&this.canUnloadContent()&&!player.preload){this.fullyLoaded=!1;var t=this,e=0,i=0,r=[];this.deepEach(function(t,e){r.push(e)},function(t){return"audio"!=t.innerType&&"Interaction"!=t.innerType}),$.each(r,function(t,i){i.emptyElement(),e++}),children={},$.each(this.children,function(t,e){"audio"!=e.innerType&&"Interaction"!=e.innerType&&(children[t]=e)}),$.each(children,function(e){delete t.children[e],i++}),$(this.ref).find(".webobject").each(function(t,e){e.src="",$(e).remove()})}},Slide.prototype.pushResource=function(t){for(var e=0;e<this.resources.length;e++)if(this.resources[e].src==t.src)return;this.resources.push(t)},Slide.runningIndex=0,Slide.prototype.createRef=function(t){this.ref||(this.container=t||$("#slidecontainer"),$(document.createDocumentFragment()),this.ref="follow"==player.swipeMode?$('<div class="slide transitionable swipable"></div>'):$('<div class="slide transitionable"></div>'),this.ref.css("display","none"),this.ref.attr("runningindex",Slide.runningIndex++),this.background&&this.background.apply(this.ref),this.ref.get(0).id="slide_"+this.id,(this.width>player.frame.availableWidth||this.height>player.frame.availableHeight)&&(this.scale=Math.min(player.frame.availableWidth/this.width,player.frame.availableHeight/this.height),this.y=this.x=0,this.applySize(this.ref)),$.each(this.children,function(t,e){e.createRef&&e.createRef()}),this.container.append(this.ref),this.ref.css("width",this.width+"px"),this.ref.css("height",this.height+"px"),player.reorient(!0))},Slide.prototype.reduce=function(){$.each(this.children,function(t,e){e.reduce&&e.reduce()}),this.canvas&&(this.canvas.width=1,this.canvas.height=1)},Slide.prototype.destroyRef=function(){$.each(this.children,function(t,e){e.destroyRef&&e.destroyRef()}),this.ref&&(this.ref.remove(),this.ref=null)},Slide.prototype.findClip=function(t){var e=$.grep(this.clips,function(e){return e.id==t});return 0<e.length?e[0]:null},Slide.prototype.topMostLayer=function(){return 0<this.layerStack.length?this.layerStack[this.layerStack.length-1]:this},Slide.prototype.saveIfNecessary=function(){$.each(this.interactions,function(t,e){e.variables.Status&&"incomplete"!=e.variables.Status&&"unanswered"!=e.variables.Status||(e.evaluate(!0,!0,!0),e.variables.Status||(e.variables.Status="unanswered"))}),this.resume&&(this.currentTime=player.currentTime,player.useCompactResume?this.compactResumeData=this.getResumeData():this.resumeData=this.toData()),this.parent.compactResumeData=this.parent.getResumeData()},Slide.prototype.resetSlide=function(t,e){this.transitionedIn=!1,this.resume&&!t?player.useCompactResume&&this.compactResumeData?this.restoreFromResumeData(this.compactResumeData):this.resumeData&&this.updateFromData(this.resumeData):(this.deepEach(function(t,e){e.quickHide&&e.quickHide(),e.reset()},function(t){return t.parent&&"Layer"==t.parent.innerType&&t.parent.resume?!1:"Interaction"==t.innerType?1==e:!0}),this.compactResumeData="",this.currentIndex=this.currentTime=0,player.currentSlide()==this&&(player.currentTime=0),this.reset(),this.update(this.currentTime,!0,!0))},Slide.prototype.resetBase=Element.prototype.reset,Slide.prototype.reset=function(t){this.resetBase(t,function(t){return"Interaction"==t.innerType?!1:!0})},Slide.prototype.resetInteractions=function(){this.resume||$.each(this.interactions,function(t,e){e.reset()})},Slide.prototype.show=function(t,e,i){if(this.createRef(this.container),player.modalLayer=null,$.each(this.layers,function(t,e){e.visible||e.hide()}),"follow"==player.swipeMode)swipe.setSlideIndex(player.slideIndex),setTimeout(function(){t&&(player.play(),i&&i())},0),this.currentTime=0,this.update(this.currentTime,!0);else{player.container.children(".slide").removeClass("out"),player.container.children(".slide.in").addClass("out"),player.container.children(".slide").removeClass("in"),this.ref.addClass("in"),player.container.children(".slide:not(.in,.out)").css("display","none"),this.ref.css("display","block");var r=this.transition;e&&"pan"==player.animations&&(r=new Transition(this),r.pan=!0,r.wipe=!1,r.reverse=!1,r.duration=350,r.direction=e,r.transition=Transition.TransType.fly);var e=this.ref,a=player.container.children(".slide.out");r.wipe&&(e=player.container.children(".slide.out"),a=this.ref,player.container.children(".slide.out").addClass("over"),Transition.applyCss({"-webkit-transform":"translate3d(0px,0px,0px) scale(1) rotate(0deg)",opacity:1,"-webkit-transition-duration":"0s"},this.ref)),r.apply(function(){player.container.children(".slide.out").css("display","none"),player.container.children(".slide.over").removeClass("over"),t&&(player.play(!0),i&&i())},e,a),"SlideDraw"==this.parent.innerType&&(player.currentDraw=this.parent,this.parent.sniffDrawIndex(this)),this.currentIndex=0,this.transitionedIn=!1,player.zoomParams=null,this.transcript&&this.transcript.show()}},Slide.prototype.hide=function(){this.ref&&this.destroyRef()},Slide.prototype.fixCurrentIndex=function(){for(this.currentIndex=0;this.currentIndex<this.timelineEvents.length&&this.timelineEvents[this.currentIndex].time<=this.currentTime;)this.currentIndex++},Slide.prototype.update=function(t,e,i){for(this.currentTime=t;1<this.currentIndex&&this.currentIndex<=this.timelineEvents.length&&parseInt(this.timelineEvents[this.currentIndex-1].time)>=parseInt(this.currentTime);)this.currentIndex--,this.timelineEvents[this.currentIndex].revert(t);for(;this.currentIndex<this.timelineEvents.length&&this.timelineEvents[this.currentIndex].time<=this.currentTime&&(!player.paused||i);)t=this.timelineEvents[this.currentIndex],t.act(e,this.currentTime>t.time+1e3),this.currentIndex++;this.handleTransitionIn(),this.updateLayers(),this.currentTime>=this.duration&&(this.handleEvent("ontimelinecomplete"),player.layerPlaying||this.handleEvent("onallopentimelinescomplete"))},Slide.prototype.tickLayers=function(){$.each(this.layers,function(t,e){e.visible&&!e.paused&&(e.currentTime+=player.TICK_DURATION)})},Slide.prototype.updateLayers=function(){$.each(this.layers,function(t,e){e.visible&&e.update()})},Slide.prototype.handleTransitionIn=function(){this.transitionedIn||(this.transitionedIn=!0,this.handleEvent("ontransitionin",null,null,!1,!0),this.handleEvent("ontransitionincomplete",null,null,!1,!0),this.handleEvent("onslidestart",null,null,!1,!0),this.deepEach(function(t,e){e.handleEvent&&e.handleEvent("onslidestart",null,null,!1,!0)},function(t){return"Layer"!=t.innerType}))},Slide.prototype.addchoiceresponse=function(t){var e=this.children[$(t).attr("interactionid")],t=$(t).attr("value"),i=this.extractVariable(t)||"true",r=e.parseObjref(t).target;"Choice"!=r.innerType&&$.each(e.choices,function(t,e){e.lmstext.toLowerCase()==i.toLowerCase()&&(r=e)}),e.m_bAnswered=!0,"Choice"==r.innerType?(e.responses[t]=r,e.lmsResponses.push(new ResponseData(!1,r.id,"",r.lmstext,"")),r.selected=!0):(e.variables.Value=i,t=e.parseObjref(i).target,"Choice"==t.innerType?(t.selected=!0,e.lmsResponses.push(new ResponseData(!1,t.id,"",t.lmstext,""))):e.lmsResponses.push(new ResponseData(!1,i,"",i,"")))},Slide.prototype.addpairresponse=function(t){var e=this.children[$(t).attr("interactionid")],i=this.extractVariable($(t).attr("valuea"),$(t).attr("typea")),r=this.extractVariable($(t).attr("valueb"),$(t).attr("typeb"));if(i&&r)switch(t=e.parseObjref(i).target,r=e.parseObjref(r).target,t.addPair(r),r.addPair(t),e.interactionType){case"matching":case"sequence":case"likert":e.lmsResponses.push(new ResponseData(!0,r.id,t.id,r.lmstext,t.lmstext))}else e.parseObjref($(t).attr("valueb"));e.m_bAnswered=!0},Slide.prototype.show_slidelayer=function(t){var e=this.parseObjrefFromXML(t).target,i=new Transition(e);i.loadFromXML(t),e.show(i),e.update(0)},Slide.prototype.set_frame_layout=function(t){player.currentSlide()==this||player.currentFramedSlide==this||player.currentWindowSlide==this?player.frame.set_frame_layout(t):this.deferredFrameLayoutXML=t},Slide.prototype.set_window_control_layout=function(t){player.frame.set_window_control_layout(t)},Slide.prototype.isPointActive=function(){return!1},Slide.prototype.isPointObscured=function(){return!1},Slide.prototype.simplify=function(t){var e=this.childItems(),i=$('<canvas class="simplebackground"></canvas>');i.attr("width",player.width),i.attr("height",player.height);var r=i.get(0).getContext("2d");this.ref.prepend($(i));var a=0,s=0,n=!1,o=!0;$.each(e,function(t,e){player.renderVectorShapes&&player.renderVectorsAsSVG&&e.content.path&&(e.canSimplify=!1),player.renderVectorShapes&&(e.hasImagelib||e.hasTextlib)&&(e.canSimplify=!1),e.canSimplify&&o&&!e.group?s++:(o=!1,e.canSimplify=!1)});var l=function(e,i,r,o){n=!0;var l=function(){a++,a==s&&(p(),$(c).unbind("load"),c.src=Element.PixelSrc,t&&t())},c=new Image;$(c).bind("load",function(){l()}),$(c).bind("error",function(){l()}),player.renderVectorShapes&&!player.renderVectorsAsSVG&&o&&o.content.path&&!o.hasImagelib&&!o.hasTextlib?a++:c.src=e,h.push({img:c,x:i,y:r,item:o})},h=[],p=function(){$.each(h,function(t,e){if(player.renderVectorShapes&&!player.renderVectorsAsSVG&&e.item&&e.item.content.path&&!e.item.hasImagelib&&!e.item.hasTextlib){var a={canvas:i.get(0),m_nXOffset:e.x,m_nYOffset:e.y,m_nWidth:e.item.width,m_nHeight:e.item.height};ppArt.DrawVector(a,e.item.content.path),e.item.ref.addClass("vector")}else r.drawImage(e.img,e.x,e.y)})};this.background&&this.background.src&&(s++,l(this.background.src,0,0),this.ref.css("background","transparent")),$.each(e,function(t,e){e.canSimplify&&(l(e.content.src,e.x,e.y,e),e.ref.addClass("simplified"),e.simplified=!0,e.ref.attr("src",Element.PixelSrc),e.ref.css("background","transparent"),e.hasEvents||e.ref.remove(),n=!0)}),t&&!n&&t()},Slide.prototype.isSubmitted=function(){var t=!0;return $.each(this.interactions,function(e,i){t=t&&i.variables.Status&&"incomplete"!=i.variables.Status&&void 0!=i.variables.Points}),t},Slide.prototype.isAnswered=function(){var t=!0;return $.each(this.interactions,function(e,i){t=t&&i.m_bAnswered}),t},Element.prototype.forceRepaint=function(t){t&&!player.isIOS||!this.ref||"block"!=this.ref.css("display")||(t=this.ref.get(0),this.ref.hide(),player.uselessOffsetHeight=t.offsetHeight,this.ref.show())};var StageItem=function(t){this.container=t,this.ref=null,this.constructElement(),this.dirty=!0,this.actionMoved=this.actionControlled=!1,this.content={}};StageItem.prototype=new Element,StageItem.prototype.objectType="Item",StageItem.prototype.innerType="Item";var Item=StageItem;StageItem.prototype.isStageItem=!0,StageItem.prototype.getItemIndex=function(){var t=this,e=0,i=-1;return this.itemIndex?this.itemIndex:((this.layer||this.slide).deepEach(function(r,a){a.isStageItem&&"ShuffleGroup"!=a.innerType&&(a==t&&(i=e),e++)},function(t){return"Layer"==t.innerType?!1:!0}),this.itemIndex=i)},StageItem.prototype.getItemByResumeIndex=function(t){var e=0,i=null;return(this.layer||this.slide).deepEach(function(r,a){a.isStageItem&&"ShuffleGroup"!=a.innerType&&(e==t&&(i=a),e++)},function(t){return"Layer"==t.innerType?!1:!0}),i},StageItem.FlagA={FLAGA_STATE:1,FLAGA_VARIABLE:2,FLAGA_ONSTAGE:4,FLAGA_DRAGDROP:8,FLAGA_POSITION:16,FLAGA_USEFLAGB:32},StageItem.FlagB={FLAGB_DEPTH:1,FLAGB_SHUFFLED:2,FLAGB_ACTIONMOVED:4,FLAGB_ACTIONCONTROLLED:8,FLAGB_DISABLED:16,FLAGB_REVIEW:32},StageItem.prototype.restoreFromResumeData=function(t){var e=StageItem.FlagA,i=StageItem.FlagB,t=new bwChunk(t),r=t.NextUBase10(1),a=0;if(r&e.FLAGA_USEFLAGB&&(a=t.NextUBase10(1)),r&e.FLAGA_STATE){var s=t.NextUBase10(2),n="";$.each(this.states,function(t,e){e.index==s&&(n=t)}),this.variables.ObjectState=n}r&e.FLAGA_ONSTAGE?this.quickShow?this.quickShow():(this.show(),this.visible=!0):"ShuffleGroup"!=this.innerType&&(this.quickHide?this.quickHide():this.hide()),r&e.FLAGA_DRAGDROP&&(t.NextUBase10(2),t.NextUBase10(1));var o=!1;if(r&e.FLAGA_POSITION){var l=t.NextBase10(2),h=t.NextBase10(2),p=t.NextUBase10(2);switch(this.x=l+this.xoffset,this.y=h+this.yoffset,o=!0,p){case 4094:break;case 4095:this.originalParent=this.parent,this.parent=this.slide;break;default:this.originalParent=this.parent,this.parent=this.getItemByResumeIndex(p)}this.updateMatrixComplete(!0)}a&i.FLAGB_DEPTH&&this.setZIndex(t.NextUBase10(2)),a&i.FLAGB_SHUFFLED&&(this.shuffled=!0,this.shuffleGroup&&(this.shuffleGroup.shuffled=!0),l=t.NextUBase10(2),h=t.NextUBase10(2),o||(this.x=l,this.y=h),this.shuffleX=l,this.shuffleY=h,this.updateMatrixComplete(!0)),r&e.FLAGA_VARIABLE&&this.restoreVariableResumeData(t.NextString())},StageItem.prototype.GetResumeData=function(t){var e=StageItem.FlagA,i=StageItem.FlagB,r="",a="";if(this.resume||t){var s=this.shouldStoreVariableResume(),t=this.originalZ&&this.depth!=this.originalZ,n="true"==this.variables._disabled,o=this.actionControlled||this.actionMoved||t||this.shuffled||n,l=0,h=0;if(this.variables.ObjectState!=bwUtils.DEFAULT_STATE){var p=this.states[this.variables.ObjectState],c=p?p.index:0;!p&&this.actionstates&&this.actionstateindices&&(p=this.actionstates[this.variables.ObjectState],c=this.actionstateindices[this.variables.ObjectState]||0),c>=0&&(l+=e.FLAGA_STATE,a+=bwChunk.UBase10toN(p.index,2))}s&&(l+=e.FLAGA_VARIABLE),this.visible&&(l+=e.FLAGA_ONSTAGE),this.dropArea&&(p=this.dropArea.getItemIndex(),c=this.dropArea.getDragItemIndex(this),c>-1&&(l+=e.FLAGA_DRAGDROP,a+=bwChunk.UBase10toN(p,2),a+=bwChunk.UBase10toN(c,1))),p=this.x,c=this.y,isNaN(this.xoffset)||(p=this.x-this.xoffset,c=this.y-this.yoffset),(!this.shuffled||p==this.shuffleX&&c==this.shuffleX)&&(this.shuffled||isNaN(this.originalX)||p==this.originalX&&c==this.originalY)||(isNaN(this.xoffset)||(p=this.x-this.xoffset,c=this.y-this.yoffset),l+=e.FLAGA_POSITION,a+=bwChunk.Base10toN(p,2),a+=bwChunk.Base10toN(c,2),p=4094,this.originalParent&&this.parent!=this.originalParent&&(p="wordbank"==this.style?4094:"Slide"==this.parent.innerType?4095:this.parent.getItemIndex()),a+=bwChunk.UBase10toN(p,2)),o&&(l+=e.FLAGA_USEFLAGB,t&&(h+=i.FLAGB_DEPTH,a+=bwChunk.Base10toN(this.depth,2)),this.shuffled&&(h+=i.FLAGB_SHUFFLED,a+=bwChunk.Base10toN(this.shuffleX,2),a+=bwChunk.Base10toN(this.shuffleY,2)),this.actionMoved&&(h+=i.FLAGB_ACTIONMOVED),this.actionControlled&&(h+=i.FLAGB_ACTIONCONTROLLED),n&&(h+=i.FLAGB_DISABLED))}return r+=bwChunk.UBase10toN(l),o&&(r+=bwChunk.UBase10toN(h)),s&&(e=new bwChunk(this.getVariableResumeData()).Data(),a+=e),r+a},StageItem.prototype.getExtraResumeVars=function(){return{}},StageItem.prototype.loadFromXML=function(t,e,i){this.slide=e,this.layer=i,this.children={},this.links={},this.jcanvas=null,this.innerType=this.type=t.tagName,this.id="undefined"==typeof $(t).attr("id")?$(t).attr("name"):$(t).attr("id"),this.xml=t,this.loadElementInfoFromXML(t),$(t).find("html5data"),this.scrolling="true"==$(t).attr("scrolling"),this.shufflelock="true"==$(t).attr("shufflelock"),this.hasEvents=0!=$(t).find("events").length,this.content.src=Element.PixelSrc,this.loadContentFromXML(t),this.loadSizeFromXML(t),this.bitMask=new BitMask(!0,this.width,this.height),this.bitMask.itemID=this.id,
0<$(this.xml).children("dragdrop").length&&("true"==$(this.xml).children("dragdrop").first().attr("dragenabled")&&this.convertToDragItem(this.xml),"true"==$(this.xml).children("dragdrop").first().attr("dropenabled")&&this.convertToDropArea(this.xml),"true"==$(this.xml).children("dragdrop").first().attr("dragoverenabled"))&&(this.announceDragOver=!0,this.setupDragOver(this.xml))},StageItem.prototype.setupDragOver=function(){this.announceDragOver=!0,this.parseDragGroupsFromXML=DragItem.prototype.parseDragGroupsFromXML,this.parseDragGroupsFromXML(this.xml)},StageItem.prototype.loadContentFromXML=function(t){var e=$(t).find("html5data");switch(this.scrolling="true"==$(t).attr("scrolling"),this.hasEvents=0!=$(t).find("events").length,this.type){case"audio":this.canSimplify=!1,this.content.src=player.basepath+""+$(t).attr("url"),this.content.duration=parseInt($(t).attr("duration")),slide&&slide.clips&&slide.clips.push&&slide.clips.push(this),layer&&layer.clips&&layer.clips.push&&(layer.clips.push(this),this.layered=!0);break;case"vectorshape":case"scrollarea":case"state":case"dragitem":case"droplist":case"droparea":case"button":case"expandinglabel":case"link":this.content.src=Element.PixelSrc,0<$(t).children("textlib").length?(this.textlib=$(t).children("textlib"),story.textlibs||(story.textlibs={}),(e=this.textlib.children("textdata").attr("linkid"))&&0==this.textlib.find("path").length&&0==this.textlib.find("pr").length&&story.textlibs[e]&&(this.textlib=story.textlibs[e]),!e||1!=this.textlib.find("path").length&&1!=this.textlib.find("pr").length||story.textlibs[e]||(story.textlibs[e]=this.textlib)):0<$(t).children("data").length&&(this.textlib=$(t).children("data")),0<$(t).children("imagelib").length&&this.loadImageDataFromXML(t);var e=$(t).children("data").children("vectordata").children("path"),i=$(t).children("data").children("vectordata").children("pr");(1==e.length||1==i.length)&&(t=$(t).children("data").children("vectordata"),null!=$(t).attr("top")&&(this.originalRectShape=this.rectShape=new ppRect(parseInt($(t).attr("left")),parseInt($(t).attr("top")),parseInt($(t).attr("right")),parseInt($(t).attr("bottom")))),this.content.path=1==i.length?PathLib.getPathFromXML(i):e.text(),t.attr("alttext")),this.type="image";break;case"item":this.content.src=Element.PixelSrc,this.textlib=$(t),this.forceDivPattern=!0,this.type="image";break;case"textfield":this.content.src=Element.PixelSrc,0<e.length&&(this.content.src=player.basepath+"mobile/"+e.attr("url"),this.content.mask=e.attr("mask"),this.content.maskref=e.attr("maskref")),this.textlib=$(t).children("data");break;case"image":this.content.src=$(t).find("imagedata").attr("url"),this.content.src=this.content.src?player.basepath+"mobile/"+this.content.src.replace("story_content/","").replace(".swf",".png"):"",0<e.length&&(this.content.src=player.basepath+"mobile/"+e.attr("url"),this.content.mask=e.attr("mask"),this.content.maskref=e.attr("maskref"));break;case"textinput":this.canSimplify=!1,this.content.src=Element.PixelSrc;break;case"video":this.canSimplify=!1,this.content.src=$(t).find("videodata").attr("url"),this.content.autoplay="true"==$(t).attr("autoplay"),this.content.showcontrols="true"==$(t).attr("showcontrols"),this.content.autorewind="true"==$(t).attr("autorewind"),this.content.loop="true"==$(t).attr("loop"),this.content.src?(this.content.src=player.basepath+""+this.content.src,this.content.src=this.content.src.replace(".mp4",".mov"),player.usePlaceholderVideo&&(this.content.src="/aomock/DocumentHandler.ashx?mimetype=video/mp4&url=/test/video_3.mp4")):this.content.src=""}this.textlib&&this.content.src==Element.PixelSrc&&(t=this.textlib.children("textdata").children("vartext").first().text(),t||(t=this.textlib.children("textdata").attr("lmstext"))&&(t="<span>"+t+"</span>"),t)&&(this.textTemplate=t=t.replace(/size='(.*?)(pt|)'/gi,"style='font-size:$1pt'"))},StageItem.prototype.loadImageDataFromXML=function(t){var e=this;e.imagelib=new ppImageLib,$(t).children("imagelib").children("imagedata").each(function(t,i){var r=e.imagelib.AddImage($(i).attr("id"),$(i).attr("type"),null,$(i).attr("width"),$(i).attr("height"),$(i).attr("mobiledx"),$(i).attr("mobiledy")),a=$(i).attr("altimage"),s=$(i).attr("url"),a=player.basepath+(a?a:s),s=$(i).attr("mask");e.content.mask=s,e.content.maskref=$(i).attr("maskref"),-1<a.indexOf(".swf")&&(a=Element.PixelSrc),e.content.src=a,s=e.createResource(e.slide,a,function(){e.blocked&&e.ref&&e.render(e.lastRenderedState,!0,null,"resource callback")}),s.imgLibID=$(i).attr("id"),s.src=a,s.poolImage||(s.poolImage=$("<img class='loader'/>")),r.imgNode=s.poolImage.get(0),r.Width=$(i).attr("width"),r.Height=$(i).attr("height")})},StageItem.prototype.loadSizeFromXML=function(t){var e=$(t).children("data").children("html5data");"audio"!=this.type&&(0<e.length?(this.hasImagelib=0<$(t).find("imagelib").length,this.hasTextlib=0<$(t).find("textlib").length,this.xpos=parseInt($(t).attr("xpos")),this.ypos=parseInt($(t).attr("ypos")),this.xoffset=parseInt($(t).attr("xoffset"))||0,this.yoffset=parseInt($(t).attr("yoffset"))||0,this.x=this.xpos+this.xoffset,this.y=this.ypos+this.yoffset,this.width=parseInt(e.attr("width")),this.height=parseInt(e.attr("height"))):("video"==this.type?(this.xpos=parseInt($(t).attr("xpos")),this.ypos=parseInt($(t).attr("ypos")),this.x=parseInt($(t).attr("xpos")),this.y=parseInt($(t).attr("ypos"))):(this.xpos=parseInt($(t).attr("xpos")),this.ypos=parseInt($(t).attr("ypos")),this.yoffset=this.xoffset=0,this.x=this.xpos+this.xoffset,this.y=this.ypos+this.yoffset),this.width=parseInt($(t).attr("width")),this.height=parseInt($(t).attr("height")))),this.rotatexpos=Math.round($(t).attr("rotatexpos"))||0,this.rotateypos=Math.round($(t).attr("rotateypos"))||0,this.rotation=parseInt($(t).attr("rotation"))||0,this.xscale=parseInt($(t).attr("xscale"))||0,this.yscale=parseInt($(t).attr("yscale"))||0,this.depth=parseInt($(t).attr("depth"))||1,0==this.depth&&(this.depth=1),this.originalZ=this.depth,this.depth>this.slide.topZ&&(this.slide.topZ=this.depth)},StageItem.prototype.createResource=function(t,e,i){return e=new Resource(this,e,function(){i&&i()}),t.resources||(t=t.slide),t.pushResource(e),this.resources.push(e),e},StageItem.prototype.createRef=function(){this.parent.ref||this.parent.createRef(),this.container=this.parent.ref,this.ref?this.render(null,!1,null,"StageItem createRef"):(this.ref=$('<div class="item"></div>'),this.ref.addClass(this.type),this.ref.addClass(this.innerType.toLowerCase()),this.ref.addClass("item_"+this.id),player.showItemInfo&&this.ref.append($('<div class="itemid">'+this.id+"</div>")),this.applySize(this.ref),"dragitem"==this.innerType&&this.setZIndex(this.depth),this.container.append(this.ref),this.ref.get(0).item=this,"video"!=this.type&&"audio"!=this.type&&this.bindEvents(),$.each(this.children,function(t,e){e.createRef&&e.createRef()}),this.initDrag&&(this.initDrag(),this.convertRefToDragItem()),("DropArea"==this.innerType||this.isDropArea)&&this.ref.addClass("droparea"),this.announceDragOver&&this.ref.addClass("dragover"),this.visible=!1,this.nearestScrollAreaAncestor=this.findAncestorOfType("ScrollArea"))},StageItem.prototype.setInteractive=function(){this.ref.addClass("interactive"),this.parent.setInteractive&&this.parent.setInteractive()},StageItem.prototype.setZIndex=function(t,e){(e||"Layer"!=this.innerType&&"ExpandingLabel"!=this.innerType)&&($.each(this.children,function(e,i){i.depth>t&&(t=i.depth)}),this.ref&&this.ref.css("z-index",t),this.depth=t,this.parent&&this.parent.setZIndex&&this.parent.setZIndex(t))},Element.prototype.updateMatrix=function(){this.matrix.reset(),"ScrollArea"==this.innerType&&this.ref&&0!=this.ref.get(0).scrollTop&&this.matrix.translate(0,-this.ref.get(0).scrollTop),"sequencectrl"==this.innerType&&this.ref&&0!=this.ref.get(0).scrollTop&&this.matrix.translate(0,-this.ref.get(0).scrollTop),this.parent&&!this.parent.dragX&&!this.parent.dragY&&this.matrix.translate(this.dragX||0,this.dragY||0),this.parent&&this.parent.matrix&&this.matrix.multiply(this.parent.matrix.copy()),this.centerpoint={x:this.rotatexpos-this.xoffset,y:this.rotateypos-this.yoffset},this.matrix.translate(this.x+this.centerpoint.x,this.y+this.centerpoint.y),this.matrix.rotateDegrees(this.rotation),this.matrix.translate(-this.centerpoint.x,-this.centerpoint.y),this.isRotated=this.parent&&this.parent.isRotated||0!=this.rotation},Element.prototype.applySize=function(t){this.updateMatrix(),player.showMatrixDebug&&(player.testCanvas||(player.testCanvas=$("<canvas id='test' width='1000' height='1000' style='position:absolute;z-index:200;left:0px;top:0px;'></canvas>"),$("#slideframe").append(player.testCanvas),player.testContext=player.testCanvas.get(0).getContext("2d"),player.testContext.fillStyle="rgba(255,255,0,0.5)",player.testContext.fillStyle="rgba(0,0,0,0.5)",player.testContext.strokeStyle="rgba(0,255,0,0.5)"),player.testContext.save(),this.matrix.applyContext(player.testContext),player.testContext.strokeStyle="rgba(0,255,0,0.5)",player.testContext.strokeRect(0,0,this.width,this.height),this.getAABB(),player.testContext.restore()),t.css("left",this.x+"px"),t.css("top",this.y+"px"),t.css("width",this.width+"px"),t.css("height",this.height+"px"),"Layer"!=this.innerType&&"ExpandingLabel"!=this.innerType&&0<this.depth&&(t.css("z-index",this.depth),this.parent&&"ShuffleGroup"==this.parent.innerType&&this.parent.ref)&&(this.parent.depth=this.depth,this.parent.ref.css("z-index",this.depth)),0!=this.rotation&&(t.css("-webkit-transform-origin",this.rotatexpos-this.xoffset+"px "+(this.rotateypos-this.yoffset)+"px"),t.css("-webkit-transform","rotate("+this.rotation+"deg)"),t.css("-moz-transform-origin",this.rotatexpos-this.xoffset+"px "+(this.rotateypos-this.yoffset)+"px"),t.css("-moz-transform","rotate("+this.rotation+"deg)"),t.css("-o-transform-origin",this.rotatexpos-this.xoffset+"px "+(this.rotateypos-this.yoffset)+"px"),t.css("-o-transform","rotate("+this.rotation+"deg)"),t.css("-ms-transform-origin",this.rotatexpos-this.xoffset+"px "+(this.rotateypos-this.yoffset)+"px"),t.css("-ms-transform","rotate("+this.rotation+"deg)"),this.canSimplify=!1)},StageItem.prototype.bindEvents=function(){var t=this,e=function(e){if("true"==t.variables._disabled||swipe.moved)return!1;var i=(e.pageX-t.ref.offset().left+t.xoffset)/player.currentZoom(),r=(e.pageY-t.ref.offset().top+t.yoffset)/player.currentZoom();return t.ref.offset(),t.ref.offset(),swipe.parseEventCoords(e),e=swipe.getSlideCoords(t.slide),i<t.width&&r<t.height&&t.isPointActive(e.x,e.y)&&!t.isPointObscured(e.x,e.y)?!0:!1},i=!1;t.bindStoryEvent("click touchstart","ondoubleclick",function(t){if(e(t)){if(i)return!0;i=!0,setTimeout(function(){i=!1},400)}return!1}),t.bindStoryEvent("mousedown","onrightrelease",function(t){return 3==t.which}),t.shouldBindEvent("onpress")||t.shouldBindEvent("onrelease")},StageItem.prototype.unBindEvents=function(){},StageItem.prototype.reduce=function(){$.each(this.children,function(t,e){e.reduce&&e.reduce()}),this.canvas&&(this.canvas.width=1,this.canvas.height=1)},StageItem.prototype.destroyRef=function(){$.each(this.children,function(t,e){e.destroyRef&&e.destroyRef()}),this.ref&&(this.ref.unbind(),this.ref.get(0).item=null,this.ref.get(0).id=null,removeDOMElement(this.ref),this.ref=null,this.destroyComponent("ref"),this.destroyComponent("contentRef"),this.destroyComponent("jcanvas"),this.destroyComponent("canvas"),this.destroyComponent("border"),this.dirty=!0)},StageItem.prototype.destroyComponent=function(t){this[t]&&($(this[t]).remove(),this[t]=null)};var removeDOMElement=function(t){t.get&&(t=t.get(0)),t.parentNode&&t.parentNode.removeChild(t)};StageItem.prototype.render=function(){if(this.ref)switch(this.innerType){case"swf":this.ref.css("background-color","orange"),this.ref.show();case"textfield":case"image":this.content.src!=Element.PixelSrc&&(this.ref.css("background","transparent url("+escape(this.content.src)+") no-repeat"),this.ref.show())}},StageItem.prototype.show=function(t,e,i){this.createRef(this.parent.ref),$.each(this.resources,function(t,e){e.load(player.deferredLoadingIndex++)});var r=this;if(!this.visible||this.dirty){if(this.dirty=!1,t&&t.isUserInitiated&&(this.actionControlled=!0),"audio"!=this.type){if(r.textlib&&r.textTemplate&&r.content.src==Element.PixelSrc&&r.textTemplate&&r.renderTextTemplate(),e){if(!i||0==e.duration){if(!this.ref)return;this.visible=!0,r.ref.show(),r.handleEvent("ontransitionin",null,null,!1,!0),r.runningTransition=e,r.pendingHide=!1,r.pendingShow=!0,e.setTarget(this),e.apply(function(){r.ref&&r.pendingShow&&(r.pendingHide=!1,r.pendingShow=!1,r.ref.show()),r.handleEvent("ontransitionincomplete",null,null,!1,!0)},null,null,"ease-out")}}else r.runningTransition=null,r.pendingHide=!1,r.pendingShow=!1,this.visible=!0,r.ref.show(),r.handleEvent("ontransitionin",null,null,!1,!0),r.handleEvent("ontransitionincomplete",null,null,!1,!0);r.group&&r.group.show(null,null,null,!0)}0<r.events.length&&(!r.ref.data("events")||!r.ref.data("events").mouseup&&!r.ref.data("events").mousedown&&!r.ref.data("events").touchstart&&!r.ref.data("events").touchend)&&this.bindEvents(),this.setOnStage(!0),this.shuffleGroup&&this.shuffleGroup.shuffle()}},StageItem.prototype.setOnStage=function(t,e){this.setProperty("OnStage",(t&&this.visible).toString(),e),$.each(this.children,function(i,r){r.setOnStage&&r.setOnStage(t,e)})},StageItem.prototype.quickShow=function(){this.visible=!0,"audio"!=this.type&&this.slide&&this.slide==player.currentSlide()&&this.ref&&(this.pendingShow=this.pendingHide=!1,this.ref.show()),this.setOnStage(!0,!0)},StageItem.prototype.quickHide=function(){this.visible=!1,"audio"!=this.type&&"ItemGroup"!=this.type&&this.slide&&this.slide==player.currentSlide()&&this.ref&&(this.pendingShow=this.pendingHide=!1,this.ref.hide()),this.setOnStage(!1,!0)},StageItem.prototype.hide=function(t,e){if(this.visible&&this.ref){var i=this;this.visible=!1,t&&t.isUserInitiated&&(this.actionControlled=!0),"audio"!=this.type&&(i.handleEvent("ontransitionout",null,null,!1,!0),e?(i.runningTransition=e,i.pendingHide=!0,i.pendingShow=!1,e.setTarget(this),e.apply(function(){i.ref&&i.pendingHide&&(i.pendingHide=!1,i.pendingShow=!1,i.ref.hide()),i.handleEvent("ontransitionoutcomplete",null,null,!1,!0)},null,null,"ease-in")):(i.runningTransition=null,this.ref&&(i.pendingHide=!1,i.pendingShow=!1,this.ref.hide()),i.handleEvent("ontransitionoutcomplete",null,null,!1,!0))),this.setOnStage(!1)}},StageItem.prototype.mediaReady=function(){return this&&this.ref&&this.ref.get(0)&&4==this.ref.get(0).readyState?!0:!1},StageItem.prototype.shouldBindEvent=function(t){if(player.showItemInfo)return!0;var e=this,i=!1;return $.each(e.events,function(r,a){if(a.trigger==t)i=!0;else{var s=e.parent;s&&s.shouldBindEvent&&!i&&(i=s.shouldBindEvent(t))}}),i},StageItem.prototype.bindStoryEvent=function(t,e,i){if(this.shouldBindEvent(e)){var r=this;this.ref.bind(t,function(t){"onrelease"==e&&player.updateItemInfo(r);var a=r.findDownstreamMedia();a&&a.prep();var s=function(a,s){return $.each(a,function(a,n){n.trigger!=e||i&&"function"==typeof i&&!i(t)||(n.act(r,!0),s=!1)}),s},a=s(r.events,!0);return r.group&&r.group.events&&r.group.events.length&&(a=s(r.group.events,a)),a})}},Element.prototype.prepDownstreamMedia=function(){var t=this.findDownstreamMedia();t&&t.prep()},Element.prototype.findDownstreamMedia=function(t){if(t=t||0,!(t>6)){var e=this,i=[],r=function(r){r&&$.each(r,function(r,a){a.findDownstreamMedia(e,i,++t)})};return r(e.events),0==i.length&&e.timelineEvents&&r(e.timelineEvents),0==i.length&&r(player.currentSlide().timelineEvents),0<i.length?i[0]:null}},StageItem.prototype.bindVarListener=function(t){for(var e=this.parseObjref(t).target,e=0;e<this.events.length;e++){var i=this.events[e];if("onvarchanged"==i.trigger&&i.varname==t&&i.boundByItemID==this.id)return i}return i=new StoryEvent(this),i.trigger="onvarchanged",i.varname=t,i.boundByItemID=this.id,i.filter=function(e){return e==t},e=new TimelineAction(this),e.type="render_item",e.item=this,i.actions.push(e),this.events.push(i),e=this.parseObjref(t).target,e.registerVariableEventSubscriber(this,t),i},StageItem.prototype.renderTextTemplate=function(){var t=this,e=t.textTemplate,e=e.replace(/pt'/gi,"px'"),i=e.match(/\&(.*?);/g);i&&$.each(i,function(i,r){var a=r.replace(/\&|\$|;/g,""),s=t.extractVariable(a);(null===s||"undefined"==typeof s)&&(s=""),!isNaN(parseFloat(s))&&isFinite(s)&&(s=Math.round(100*parseFloat(s))/100),e=e.replace(r,s),t.bindVarListener(a)}),t.contentRef||(t.contentRef=t.ref),t.contentRef.empty(),t.contentRef.append($(e)),t.contentRef.find("p").first().css("width",t.width),t.contentRef.find("p").first().css("height",t.height)},StageItem.prototype.getBitMask=function(){return this.lastRenderedState&&this.stateMasks&&this.stateMasks[this.lastRenderedState]?this.stateMasks[this.lastRenderedState]:this.bitMask},StageItem.prototype.fixRef=function(){if(!this.isState&&this.ref.get(0).id){var t=$("#"+this.ref.get(0).id);t.get(0)&&this.ref.get(0)!=t.get(0)&&(this.ref=t)}},StageItem.prototype.getAABB=function(){var t=this,e={left:5e3,top:5e3,right:-5e3,bottom:-5e3};return $.each([[0,0],[this.width,0],[this.width,this.height],[0,this.height]],function(i,r){var a=t.matrix.transformPoint(r[0]-t.xoffset,r[1]-t.yoffset),s=a.x,a=a.y;s<e.left&&(e.left=s),s>e.right&&(e.right=s),a<e.top&&(e.top=a),a>e.bottom&&(e.bottom=a)}),player.showDebugOverlap&&player.testContext&&setTimeout(function(){player.testContext.strokeStyle="rgba(0,0,255,0.5)",player.testContext.strokeRect(e.left,e.top,e.right-e.left,e.bottom-e.top)},0),e},StageItem.prototype.getAABB_simple=function(t,e){if(void 0===t&&(t=this.rotation),0==t){var i={};return e?(i.left=0,i.top=0,i.right=this.width,i.bottom=this.height):(i.left=this.x+this.dragX,i.top=this.y+this.dragY,i.right=this.x+this.dragX+this.width,i.bottom=this.y+this.dragY+this.height),i}var i={left:5e3,top:5e3,right:-5e3,bottom:-5e3},r=[[-this.width/2,-this.height/2],[this.width/2,-this.height/2],[this.width/2,this.height/2],[-this.width/2,this.height/2]],a=Math.cos(t*Math.PI/180),s=Math.sin(t*Math.PI/180);return $.each(r,function(t,e){x=Math.ceil(-e[0]*a+e[1]*s),y=Math.ceil(e[0]*s-e[1]*a),x<i.left&&(i.left=x),x>i.right&&(i.right=x),y<i.top&&(i.top=y),y>i.bottom&&(i.bottom=y)}),e?(i.left+=this.rotatexpos,i.top+=this.rotateypos,i.right+=this.rotatexpos,i.bottom+=this.rotateypos):(i.left+=this.x+this.dragX+this.rotatexpos,i.top+=this.y+this.dragY+this.rotateypos,i.right+=this.x+this.dragX+this.rotatexpos,i.bottom+=this.y+this.dragY+this.rotateypos),player.showDebugOverlap&&player.testContext&&setTimeout(function(){player.testContext.strokeStyle="rgba(0,0,255,0.5)",player.testContext.strokeRect(i.left,i.top,i.right-i.left,i.bottom-i.top)},0),i},StageItem.prototype.testRotatedOverlap=function(t){var e,i,r,a,s=this.getAABB(),n=t.getAABB();if(e=BitMask.max(s.left,n.left),i=BitMask.min(s.right,n.right),r=BitMask.max(s.top,n.top),a=BitMask.min(s.bottom,n.bottom),s.right<n.left||s.left>n.right||s.bottom<n.top||s.top>n.bottom)return!1;for(player.showDebugOverlap&&(player.testCanvas||(player.testCanvas=$("<canvas id='test' width='1000' height='1000' style='position:absolute;z-index:200;left:0px;top:0px;'></canvas>"),$("#slideframe").append(player.testCanvas),player.testContext=player.testCanvas.get(0).getContext("2d"),player.testContext.fillStyle="rgba(255,255,0,0.5)"),player.testCanvas.show(),clearTimeout(player.testCanvasClear),player.testCanvasClear=setTimeout(function(){player.testCanvas.hide()},1e3),player.showDebugOverlapPersistent||(player.testContext.clearRect(0,0,1e3,1e3),player.testContext.fillStyle="rgba(0,255,255,0.2)",player.testContext.fillRect(s.left,s.top,s.right-s.left,s.bottom-s.top),player.testContext.fillStyle="rgba(0,0,255,0.2)",player.testContext.fillRect(n.left,n.top,n.right-n.left,n.bottom-n.top),player.testContext.strokeStyle="rgba(255,0,255,0.8)",player.testContext.strokeRect(e,r,i-e,a-r))),s=i-e,a=s*(a-r),n=0;a>n;n+=64){i=e+n%s;var o=r+Math.floor(n/s);if(player.showDebugOverlap&&(this.isPointActive(i,o)?t.isPointActive(i,o)?t.isPointObscured(i,o,this,function(t){return t.dropArea})?(player.testContext.fillStyle="rgba(255,0,0,0.9)",player.testContext.fillRect(i-1,o-1,2,2)):(player.testContext.fillStyle="rgba(0,255,0,0.9)",player.testContext.fillRect(i-2,o-2,4,4)):(player.testContext.fillStyle="rgba(255,255,0,0.9)",player.testContext.fillRect(i-1,o-1,2,2)):(player.testContext.fillStyle=t.isPointActive(i,o)?"rgba(0,0,0,0.5)":"rgba(100,100,100,0.2)",player.testContext.fillRect(i-1,o-1,2,2))),this.isPointActive(i,o)&&t.isPointActive(i,o)&&!t.isPointObscured(i,o,this,function(t){return t.dropArea}))return!0}return!1};var Layer=function(t,e){this.container=t||$(document.body),this.ref=null,this.constructElement(),this.timelineEvents=[],this.clips=[],this.currentIndex=this.currentTime=0,this.duration=10,this.active=!0,this.slide=e,this.layer=null,this.parent=e,this.paused=this.viewed=!1};Layer.prototype=new StageItem,Layer.prototype.objectType="Layer",Layer.prototype.innerType="Layer",Layer.prototype.getItemIndex=function(){var t=this,e=0,i=-1;return this.itemIndex?this.itemIndex:($.each(this.slide.children,function(r,a){"Layer"==a.innerType&&(a==t&&(i=e),e++)}),this.itemIndex=i)},Layer.prototype.restoreFromResumeData=function(t){var e=[];this.deepEach(function(t,i){i.resume&&"ShuffleGroup"!=i.innerType&&e.push(i)}),t=new bwChunk(t).NextChunk(),this.currentTime=bwChunk.BaseNto10(t.Data(),t.Length());for(var t=t.NextChunk(),t=new bwChunk(t.Data()),i=0;!t.isNothing;){var r=e[i];r&&r.restoreFromResumeData(t.ChunkData()),t=t.NextChunk(),i++}},Layer.prototype.getResumeData=function(){var t="";if(this.resume&&this.viewed){var e="";this.deepEach(function(t,i){i.resume&&"ShuffleGroup"!=i.innerType&&(e+=bwChunk.CreateChunk(i.GetResumeData()))});var t=t+bwChunk.EMPTY_CHUNK,i=bwChunk.Base10toN(this.currentTime),t=t+bwChunk.CreateChunk(i),t=t+bwChunk.CreateChunk(e),t=t+bwChunk.EMPTY_CHUNK,t=t+bwChunk.EMPTY_CHUNK,t=t+bwChunk.CreateChunk("")}return t},Layer.prototype.toBaseData=Element.prototype.toData,Layer.prototype.toData=function(){var t=this.toBaseData();return t.currentTime=this.currentTime,t},Layer.prototype.updateBaseFromData=Element.prototype.updateFromData,Layer.prototype.updateFromData=function(t){this.updateBaseFromData(t),this.currentTime=t.currentTime},Layer.prototype.loadFromXML=function(t){var e=this;this.id=$(t).attr("id"),this.modal="true"==$(t).attr("modal"),this.resume="true"==$(t).attr("resume"),this.pauseparent="true"==$(t).attr("pauseparent"),this.depth=parseInt($(t).attr("depth")),this.loadChildrenFromXML(t,e.slide,e,function(t){t.canSimplify=!1}),$(t).children("audiolib").children("audio").each(function(t,i){var r=new Audio;r.loadFromXML(i,e.slide,e),r.createRef(),e.children[r.id]=r}),$(t).find("timeline").each(function(t,i){e.duration=$(i).attr("duration"),$(i).find("event").each(function(t,i){var r=new TimelineEvent(e);r.loadFromXML(i),e.timelineEvents.push(r)})}),$(t).children("background").each(function(t,i){e.background=new Background(e.ref),e.background.loadFromXML(i),e.background.src||(e.backgroundReady=!0),e.ref&&e.background.apply(e.ref)}),this.loadElementInfoFromXML(t),this.depth=++this.slide.topZ,this.type="layer"},Layer.prototype.resetBase=Element.prototype.reset,Layer.prototype.reset=function(t){this.resume?player.useCompactResume&&this.compactResumeData?this.restoreFromResumeData(this.compactResumeData):this.resumeData&&this.updateFromData(this.resumeData):(this.resetBase(),t||(this.visible=!1,this.ref&&this.ref.hide()),$.each(this.children,function(t,e){e.hide&&e.hide()}))},Layer.prototype.createBaseRef=StageItem.prototype.createRef,Layer.prototype.destroyBaseRef=StageItem.prototype.destroyRef,Layer.prototype.createRef=function(){this.ref||(this.createBaseRef(),this.ref.removeClass("item"),this.ref.addClass("layer"),this.background&&this.background.apply(this.ref),this.ref.css("display","none"))},Layer.prototype.show=function(t){this.createRef(this.parent.ref);var e=this;$(".currentlayer").removeClass("currentlayer"),this.ref.addClass("currentlayer"),this.viewed=!0;var i=this.ref;if(t&&0!=t.duration){var r=this.visible;i.css("display","block"),t.setTarget(this),e.transitioning=!0,t.apply(function(){e.transitioning=!1,r||(e.handleEvent("ontransitionincomplete",null,null,!1,!0),e.handleSlideStart())},null,null,"ease-out"),r||(e.handleEvent("ontransitionin",null,null,!1,!0),e.setOnStage(!0))}else e.runningTransition=null,i.css("display","block"),this.visible||(e.handleEvent("ontransitionin",null,null,!1,!0),e.handleEvent("ontransitionincomplete",null,null,!1,!0),e.handleSlideStart(),e.setOnStage(!0));this.pauseparent&&this.slide==player.currentSlide()&&player.pause(!0),player.modalLayer=null,this.modal&&(this.modalfence||(this.modalfence=$("<div class='modalfence'></div>"),this.parent.ref.append(this.modalfence),this.modalfence.bind("click",function(){})),player.modalLayer=e,this.modalfence.show()),t=e.slide.topMostLayer(),t!=e&&t.handleEvent("endtopmostlayer"),util.popArrayElement(this.slide.layerStack,this),this.slide.layerStack.push(this),this.handleEvent("ontopmostlayer"),this.depth=this.slide.topZ+1,this.slide.topZ=this.depth,this.visible&&this.resume?this.ref.css("display","block"):(this.visible||(this.currentIndex=this.currentTime=0),this.resume&&this.compactResumeData&&(this.restoreFromResumeData(this.compactResumeData),player.activeTimeline==this)&&(player.activeTimeline.currentTime=this.currentTime),this.visible=!0,this.paused=!1)},Layer.prototype.hide=function(t){if(this.visible){this.visible=!1,player.modalLayer=null;var e=this,i=function(){e.ref.css("display","none"),e.handleEvent("ontransitionoutcomplete",null,null,!1,!0),$.each(e.clips,function(t,e){e.pauseClip()}),e.modalfence&&e.modalfence.hide(),e.destroyWebobjects(),e.resume?e.compactResumeData=e.getResumeData():e.reset(),e.slide.topMostLayer()==e&&e.handleEvent("endtopmostlayer"),util.popArrayElement(e.slide.layerStack,e),0<e.slide.layerStack.length?e.slide.layerStack[e.slide.layerStack.length-1].handleEvent("ontopmostlayer"):(e.slide.handleEvent("ontopmostlayer"),player.activeTimeline=player),e.setOnStage(!1),e.pauseparent&&player.play(!0,!0,!1)};e.handleEvent("ontransitionout",null,null,!1,!0),t&&0!=t.duration?(t.setTarget(this),t.apply(function(){i()},null,null,"ease-out")):(e.runningTransition=null,i())}},Layer.prototype.destroyWebobjects=function(){$.each(this.children,function(t,e){e.destroyWebobjects&&e.destroyWebobjects()})},Layer.prototype.play=function(){this.paused=!1,$(".controlbar-button").find(".wait").hide(),$(".controlbar-button").find(".play").hide(),$(".controlbar-button").find(".pause").show()},Layer.prototype.pause=function(){this.paused=!0,$.each(this.clips,function(t,e){player.currentClipSyncToTimeline&&(e.pauseClip(),player.scheduledMediaSrc==e.content.src)&&(clearTimeout(player.mediaTimeout),player.scheduledMediaSrc=null)}),$(".controlbar-button").find(".wait").hide(),$(".controlbar-button").find(".pause").hide(),$(".controlbar-button").find(".play").show()},Layer.prototype.update=function(){if(!(this.currentTime>parseInt(this.duration)+100)){ProgressBar.getCurrentProgressBar().dragging&&player.currentClip&&(player.currentClip.currentTime=(player.activeTimeline.currentTime-player.currentClipStartTime)/1e3),player.activeTimeline==this&&(ProgressBar.getCurrentProgressBar().index=player.activeTimeline.currentTime,ProgressBar.getCurrentProgressBar().count=player.activeTimeline.duration,ProgressBar.getCurrentProgressBar().update(),this.paused?($(".controlbar-button").find(".wait").hide(),$(".controlbar-button").find(".pause").hide(),$(".controlbar-button").find(".play").show()):($(".controlbar-button").find(".wait").hide(),$(".controlbar-button").find(".play").hide(),$(".controlbar-button").find(".pause").show()));var t=null;for($.each(this.clips,function(e,i){i.getIsPlaying&&i.getIsPlaying()&&(t=i)}),t&&(this.currentTime=parseInt(1e3*t.getCurrentTime()+player.currentClipStartTime)),player.layerPlaying=!0;0<this.currentIndex&&this.timelineEvents[this.currentIndex-1].time>this.currentTime;)this.currentIndex--,this.timelineEvents[this.currentIndex].revert(this.currentTime);for(;this.currentIndex<this.timelineEvents.length&&this.timelineEvents[this.currentIndex].time<=this.currentTime&&player.layerPlaying;)this.timelineEvents[this.currentIndex].act(),this.currentIndex++;this.currentTime>=this.duration&&(this.handleEvent("ontimelinecomplete",null,null,!1,!0),player.currentTime>=player.currentSlide().duration&&this.handleEvent("onallopentimelinescomplete"),player.layerPlaying=!1)}},Layer.prototype.handleSlideStart=function(){this.handledSlideStart||(this.handledSlideStart=!0,this.handleEvent("onslidestart",null,null,!1,!0),this.deepEach(function(t,e){e.handleEvent&&e.handleEvent("onslidestart",null,null,!1,!0)}))};var VectorShape=function(t){this.container=t||$(document.body),this.ref=null,this.constructElement(),this.currentIndex=0,this.content={},this.colors={},this.type="textfield",this.active=!0,this.id=Math.random(),this.name="item",this.visible=this.layered=!1,this.canSimplify=!0,this.hasEvents=!1,this.xml="",this.deferredResourceIndex=0,this.lastRenderedState="none",this.canvas=null,this.m_nYOffset=this.m_nXOffset=0,this.height=this.width=1e3,this.vectorHot=!1};VectorShape.prototype=new StageItem,VectorShape.prototype.objectType="Item",VectorShape.prototype.innerType="vectorshape",VectorShape.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,VectorShape.prototype.loadFromXML=function(t,e,i){var r=this;this.loadBaseFromXML(t,e,i),this.yoffset=this.xoffset=0,this.originalWidth=parseInt($(t).attr("width")),this.originalHeight=parseInt($(t).attr("height")),this.originalX=this.x,this.originalY=this.y,0<$(t).children("data").children("textdata").children("vartext").length&&(this.textlib=$(t).children("data")),this.canSimplify=!1,$(t).children("states").children().each(function(t,e){var i=$(e).attr("name"),a=$(e).children("data").children("vectordata"),s={left:a.attr("left"),top:a.attr("top"),right:a.attr("right"),bottom:a.attr("bottom"),path:PathLib.getPathFromXML(a.children("pr")),index:t};s.path&&""!=s.path||(s.path=a.children("path").text()),r.states[i]=s}),this.loadLinksFromXML(t)},VectorShape.prototype.loadLinksFromXML=function(t){var e=this;$(t).children("textlib").children("textdata").each(function(t,i){var r=$(i).attr("id");$(i).children("linkdata").children("link").each(function(t,i){var a=new LinkArea(e.ref,e.slide,e.layer,r);a.parent=e,a.loadFromXML(i,e.slide,e.layer),e.links[a.id]=a,e.hasLinks=!0})})},VectorShape.prototype.createBaseRef=StageItem.prototype.createRef,VectorShape.prototype.destroyBaseRef=StageItem.prototype.destroyRef,VectorShape.prototype.createRef=function(){if(!this.ref){this.createBaseRef(),this.contentRef||(this.contentRef=$('<div class="item unhideable vartext"></div>')),this.ref.append(this.contentRef),this.ref.css("width",this.originalWidth),this.ref.css("height",this.originalHeight);var t=$(this.xml).find("textdata").first().attr("valign");t&&this.contentRef.addClass("v"+t),t=$('<canvas class="content" width="'+this.originalWidth+'" height="'+this.originalHeight+'"></canvas>'),t.css("position","absolute"),this.ref.append(t),this.jcanvas=t,this.canvas=t.get(0),this.context=this.canvas.getContext("2d"),this.renderAsBackground&&(this.altRef=$('<div class="item unhideable alternate"></div>'),this.altRef.css("width",this.originalWidth),this.altRef.css("height",this.originalHeight),this.ref.append(this.altRef)),this.lastRenderedState=null,this.render(this.variables.ObjectState,!0,null,"VectorShape createRef")}},VectorShape.prototype.destroyRef=function(){this.destroyBaseRef(),this.canvas&&($(this.canvas).remove(),this.canvas=null),this.contentRef&&(this.contentRef.remove(),this.contentRef=null),this.bitMask=this.lastRenderedState=null,this.stateMasks={}},VectorShape.prototype.renderCallback=function(){},VectorShape.prototype.render=function(t,e,i,r,a,s){if(this.ref){var n=this;if(e||t!=this.lastRenderedState)if(this.lastRenderedState=t,
n.allResourcesLoaded())if(n.blocked=!1,n.canvas||(n.canvas=$(this.ref).find("canvas").get(0)),player.useSafeCanvas)this.canvas.getContext("2d"),this.ref.css("background-color","#"+parseInt(900*Math.random()+1100)%1e3);else{if(n.m_nXOffset=n.xoffset,n.m_nYOffset=n.yoffset,n.width=n.width,n.height=n.height,e=new ppTextLib(n.xml),i=n.content.path,n.states[t]?(i=n.states[t].path,n.rectShape=new ppRect(n.states[t].left,n.states[t].top,n.states[t].right,n.states[t].bottom)):this.originalRectShape&&(this.rectShape=this.originalRectShape),n.rectShape&&0==n.rectShape.right&&0==n.rectShape.bottom&&(n.rectShape.right=n.width,n.rectShape.bottom=n.height),i)try{var o=new Date;ppArt.itemID=n.id,ppArt.item=n,ppArt.DrawVector(n,i,e,player.fontlib,n.imagelib,s);for(var l in n.links)n.links[l].linkdx=ppArt.m_listTextOffsets[n.links[l].textid].x,n.links[l].linkdy=ppArt.m_listTextOffsets[n.links[l].textid].y;if(n.textOffset&&(n.m_nXOffset+=n.textOffset.x,n.m_nYOffset+=n.textOffset.y),n.m_nXOffset!=n.xoffset||n.m_nYOffset!=n.yoffset){var h=n.m_nXOffset-n.xoffset,p=n.m_nYOffset-n.yoffset;n.originalXOffset||(n.originalXOffset=n.xoffset,n.originalYOffset=n.yoffset),n.xoffset=n.m_nXOffset,n.yoffset=n.m_nYOffset,this.x+=h,this.y+=p,n.applySize(n.ref)}parseInt(new Date-o),t&&!n.stateMasks&&(n.stateMasks={}),s=function(){if(player.usePixelTesting)return new BitMask(!0,n.width,n.height);var t=new BitMask(!1,n.width,n.height,n.imageWidth||n.width,n.imageHeight||n.height);return!n.content.mask&&n.content.maskref&&(n.content.mask=player.bitmasks[n.content.maskref]),n.content.mask?(t.loadFromRLE(n.content.mask),t.pixels&&!t.isOpaque&&(n.width!=$(n.canvas).attr("width")||n.height!=$(n.canvas).attr("height"))&&t.resize($(n.canvas).attr("width"),$(n.canvas).attr("height"),-n.xoffset,-n.yoffset)):-1<n.content.src.indexOf(".jpg")?t.isOpaque=!0:player.isLocalFileSystem&&n.imagelib?t.isOpaque=!0:(t=new BitMask(!1,$(n.canvas).attr("width"),$(n.canvas).attr("height")),n.context||(n.context=n.canvas.getContext("2d")),t.loadFromContext(n.context)),t},t&&!n.stateMasks[t]?n.stateMasks[t]=s():(!n.bitMask||n.bitMask.isOpaque)&&(n.bitMask=s())}catch(c){n.ref&&n.ref.addClass("failedcanvas")}n.renderForeground&&n.renderForeground(),n.updateDragPosition&&n.dragging&&n.updateDragPosition()}else n.blocked=!0}},VectorShape.prototype.renderForeground=function(){if(this.textlib){this.ref.addClass("textlib");var t=this.textlib.children("textdata").children("vartext").first().text();!t&&this.textlib.children("textdata").attr("lmstext")&&(t=this.textlib.children("textdata").attr("lmstext"),t="<span>"+t+"</span>"),t&&(t=t.replace(/size='(.*?)(pt|)'/gi,"style='font-size:$1pt'"),this.textTemplate=t=t.replace(/pt'/gi,"px'"),this.renderTextTemplate())}else this.hasImagelib&&(this.image||(this.image=new Image,this.image.src=this.content.src),this.ref.css("background","url("+escape(this.image.src)+")"),this.ref.removeClass("failedcanvas"))};var Audio=function(t,e,i){this.container=t||$(document.body),this.slide=e,this.layer=i,this.ref=null,this.constructElement(),this.currentIndex=0,this.content={},this.colors={},this.type="audio",this.active=!0,this.id=Math.random(),this.name="item",this.visible=this.layered=!1,this.canSimplify=!0,this.hasEvents=!1,this.xml=""};Audio.prototype=new StageItem,Audio.prototype.objectType="Item",Audio.prototype.innerType="audio",Audio.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,Audio.prototype.loadFromXML=function(t,e,i){this.parent=i?i:e,this.slide=e,this.layer=i,this.children={},this.id=$(t).attr("id"),this.xml=t,this.loadElementInfoFromXML(t),this.content.src=player.basepath+$(t).attr("url"),this.content.duration=parseInt($(t).attr("duration")),e&&e.clips&&e.clips.push&&e.clips.push(this),i&&i.clips&&i.clips.push&&(i.clips.push(this),this.layered=!0),this.resource||(this.resource=this.createResource(this.slide,this.content.src))},Audio.prototype.createRef=function(){if(!this.ref){var t=this;this.container=$(document.body),this.ref=$('<audio preload="auto"><source src="'+t.content.src+'"/></audio>'),this.ref.attr("src",t.content.src),this.container.append(this.ref),this.ref.get(0).item=this,this.ref.bind("canplay",function(){player.blocked&&(player.currentSlide().currentIndex+=1,t.canPlayThrough=!0,player.unblock())}),this.ref.bind("timeupdate",function(){4==t.ref.get(0).readyState&&player.blocked&&(player.currentSlide().currentIndex+=1,t.canPlayThrough=!0,player.unblock())}),this.ref.bind("error",function(){t.canPlayThrough=!0,player.unblock()}),this.ref.bind("ended",function(){t.handleEvent("onmediacomplete")}),this.ref.bind("play",function(){if(!isNaN(t.correctedPosition)&&t.shouldSetPosition)try{t.setCurrentTime(t.correctedPosition),t.shouldSetPosition=!1}catch(e){}})}},Audio.prototype.destroyRef=function(){},Audio.prototype.renderCallback=function(){},Audio.prototype.render=function(){},Audio.prototype.prep=function(){if(player.isIOS){var t=this;if(this.id!=player.nextPreparedClipID){var e=!1;$("audio,video").each(function(i,r){!r.paused&&!r.ended&&(r.item.slide!=t.slide?r.pause():e=!0)}),e||(this.ref.get(0).load(),this.prepared=!0,player.nextPreparedClipID=this.id)}}},Audio.prototype.getTimelineAncestor=function(){for(var t=this.parent,e=4;t&&0<e--;){if("Layer"==t.innerType||"Slide"==t.innerType)return t;t=this.parent}return this.slide},Audio.prototype.playClip=function(){if(this.ref&&this.ref.get&&this.ref.get(0)&&this.ref.get(0).play){var t=this.ref.get(0);t&&t.play&&t.play()}},Audio.prototype.pauseClip=function(){if(this.ref&&this.ref.get&&this.ref.get(0)&&this.ref.get(0).pause){var t=this.ref.get(0);t&&t.pause&&t.pause()}},Audio.prototype.getCurrentTime=function(){return this.ref&&this.ref.get&&this.ref.get(0)?this.ref.get(0).currentTime:0},Audio.prototype.setCurrentTime=function(t){this.ref&&this.ref.get&&this.ref.get(0)&&(this.ref.get(0).currentTime=t)},Audio.prototype.getScheduled=function(){return this.ref&&this.ref.get&&this.ref.get(0)?this.ref.get(0).scheduled:!1},Audio.prototype.setScheduled=function(t){this.ref&&this.ref.get&&this.ref.get(0)&&(this.ref.get(0).scheduled=t)},Audio.prototype.getClip=function(){return this.ref&&this.ref.get&&this.ref.get(0)?this.ref.get(0):null},Audio.prototype.getIsPlaying=function(){return this.ref&&this.ref.get&&this.ref.get(0)?!this.ref.get(0).paused&&!this.ref.get(0).ended:!1};var Video=function(t,e,i){this.container=t||$(document.body),this.slide=e,this.layer=i,this.storedRef=this.ref=null,this.constructElement(),this.currentIndex=0,this.content={},this.colors={},this.type="video",this.active=!0,this.id=Math.random(),this.name="item",this.visible=this.layered=!1,this.canSimplify=!0,this.hasEvents=!1,this.xml=""};Video.refStore={},Video.prototype=new StageItem,Video.prototype.objectType="Item",Video.prototype.innerType="video",Video.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,Video.prototype.loadFromXML=function(t,e,i){this.slide=e,this.layer=i,this.children={},this.innerType=this.type="video",this.id=$(t).attr("id"),this.xml=t,this.loadElementInfoFromXML(t),this.loadSizeFromXML(t),this.canSimplify=!1,this.content.src=player.basepath+$(t).find("videodata").attr("url"),this.content.autoplay="true"==$(t).attr("autoplay"),this.content.showcontrols="true"==$(t).attr("showcontrols"),this.content.autorewind="true"==$(t).attr("autorewind"),this.content.loop="true"==$(t).attr("loop"),this.content.captureanimation="true"==$(t).attr("captureanimation"),this.content.poster=player.basepath+$(t).find("videodata").attr("poster"),this.content.hasPoster=""!=$(t).find("videodata").attr("poster"),player.usePlaceholderVideo&&(this.content.src="/aomock/DocumentHandler.ashx?mimetype=video/mp4&url=/test/video_3.mp4"),this.content.src=this.content.src.replace(".flv",".mp4"),this.showPlaceholder=-1<this.content.src.indexOf(".swf"),this.directParent&&"Layer"==this.directParent.innerType&&(i=this.directParent),e&&e.clips&&e.clips.push&&e.clips.push(this),i&&i.clips&&i.clips.push&&(i.clips.push(this),this.layered=!0),this.resource||(this.resource=this.createResource(this.slide,this.content.src)),this.canSimplify=!1},Video.prototype.createBaseRef=StageItem.prototype.createRef,Video.prototype.destroyBaseRef=StageItem.prototype.destroyRef,Video.prototype.createRef=function(){if(this.parent.ref?this.container=this.parent.ref:this.parent.createRef(),this.ref)this.ref.parent().attr("id"),this.container.attr("id");else if(Video.refStore[this.id])this.ref=Video.refStore[this.id],this.container.append(this.ref);else{var t=this;this.ref=$('<video class="item" '+(this.content.showcontrols?"controls":"")+'><source src="'+t.content.src+'"/></video>'),this.ref.attr("src",t.content.src),this.ref.addClass(this.type),this.ref.attr("poster",this.content.poster),(player.noVideo||this.showPlaceholder)&&(this.content.hasPoster||(this.ref=$('<div class="item video unsupported"><h1>Not Supported</h1>Flash content is not supported in the HTML5 player.</div>'),this.ref.addClass(this.type)),this.playClip=function(){player.blockedOn=null,player.unblock(),t.handleEvent("onmediacomplete")},this.ref.get(0).play=this.playClip,this.ref.get(0).load=function(){},this.ref.get(0).pause=function(){}),this.content.captureanimation&&(player.suppressCaptureAnimations||player.isIOS)&&(t=this,t.isSuppressedCaptureAnimation=!0,this.ref=$('<div class="item video captureanimation"></div>'),this.playClip=function(){player.blockedOn=null,player.unblock(),t.handleEvent("onmediacomplete")},this.ref.get(0).play=this.playClip,this.pauseClip=function(){},this.ref.get(0).load=function(){},this.ref.get(0).pause=function(){},this.ref.get(0).src="[captureanimation: no source]"),this.applySize(this.ref),this.container.append(this.ref),this.ref.get(0).item=this,this.ref.bind("canplay",function(){t.canPlayThrough=!0,player.blocked&&player.blockedOn==t&&player.unblock()}),this.ref.bind("timeupdate",function(){4==t.ref.get(0).readyState&&(t.canPlayThrough=!0,player.blocked&&player.blockedOn==t&&player.unblock())}),this.ref.bind("error",function(){t.canPlayThrough=!0,player.blocked&&player.blockedOn==t&&player.unblock()}),this.ref.bind("ended",function(){t.handleEvent("onmediacomplete")}),this.ref.bind("play",function(){if(!isNaN(t.correctedPosition)&&t.shouldSetPosition)try{t.setCurrentTime(t.correctedPosition),t.shouldSetPosition=!1}catch(e){}})}},Video.prototype.destroyRef=function(){this.pauseClip(),player.isIOS?(this.ref&&this.ref.get&&this.ref.get(0)&&(Video.refStore[this.id]=this.ref,this.ref.hide(),this.ref.remove()),this.ref=null):(this.ref&&this.ref.get&&this.ref.get(0)&&(this.ref.get(0).src=""),this.destroyBaseRef())},Video.prototype.renderCallback=function(){},Video.prototype.render=function(){},Video.prototype.showBase=StageItem.prototype.show,Video.prototype.show=function(t,e,i){if(this.showBase(t,e,i),this.slide==player.currentSlide()&&!player.noVideo)if(this.showPlaceholder)this.handleEvent("onmediacomplete");else{var r=this;if((r.content.autoplay||"StoryEvent"==t.type)&&(player.playing||player.layerPlaying)){var a=r.getTimelineAncestor().currentTime-t.time;if(r.ref&&r.ref.get&&r.ref.get(0)){var s=r.ref.get(0);this.isSuppressedCaptureAnimation?r.playClip():(clearTimeout(player.mediaTimeout),player.scheduledMediaSrc=s.src,player.mediaTimeout=setTimeout(function(){player.mediaTimeout=null,player.scheduledMediaSrc=null,r.playClip(),player.currentClip=s,player.currentClipStartTime=t.time,player.currentClipSyncToTimeline="TimelineEvent"==t.type;try{r.setCurrentTime(a/1e3)}catch(e){}},0))}}}},Video.prototype.prep=function(){player.isIOS&&this.id!=player.nextPreparedClipID&&this.ref&&this.ref.get&&this.ref.get(0)&&(this.ref.get(0).load(),this.prepared=!0,player.nextPreparedClipID=this.id)},Video.prototype.getTimelineAncestor=Audio.prototype.getTimelineAncestor,Video.extractZeroTimeAutoPlayEvent=function(t){if(!player.isIOS||0!=t.time)return null;for(var e=0;e<t.actions.length;e++){var i=t.actions[e],r=i.parentElement.parseObjref(i.originalItemID).target;if("show"==i.type&&"video"==r.innerType)return i=new TimelineEvent(i.parentElement),i.actions.push(t.actions.splice(e,1)[0]),i.time=1,i}return null},Video.prototype.playClip=function(){this.ref&&this.ref.get&&this.ref.get(0)&&this.ref.get(0).play&&this.ref.get(0).play()},Video.prototype.pauseClip=function(){this.ref&&this.ref.get&&this.ref.get(0)&&this.ref.get(0).pause&&this.ref.get(0).pause()},Video.prototype.getCurrentTime=function(){return this.ref&&this.ref.get&&this.ref.get(0)?this.ref.get(0).currentTime:0},Video.prototype.setCurrentTime=function(t){this.ref&&this.ref.get&&this.ref.get(0)&&(this.ref.get(0).currentTime=t)},Video.prototype.mediaReady=function(){return this&&this.ref&&this.ref.get(0)&&4==this.ref.get(0).readyState?!0:!1},Video.prototype.getScheduled=function(){return this.ref&&this.ref.get&&this.ref.get(0)?this.ref.get(0).scheduled:!1},Video.prototype.setScheduled=function(t){this.ref&&this.ref.get&&this.ref.get(0)&&(this.ref.get(0).scheduled=t)},Video.prototype.getClip=function(){return this.ref&&this.ref.get&&this.ref.get(0)?this.ref.get(0):null},Video.prototype.getIsPlaying=function(){return this.ref&&this.ref.get&&this.ref.get(0)?!this.ref.get(0).paused&&!this.ref.get(0).ended:!1};var LinkArea=function(t,e,i,r){this.textid=r,this.linkdy=this.linkdx=0,this.container=t||$(document.body),this.slide=e,this.layer=i,this.ref=null,this.constructElement()};LinkArea.prototype=new VectorShape,LinkArea.prototype.innerType="LinkArea",LinkArea.prototype.objectType="Item",LinkArea.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,LinkArea.prototype.renderBase=VectorShape.prototype.render,LinkArea.prototype.loadFromXML=function(t,e,i){this.loadBaseFromXML(t,e,i),e=$(t).children("textdata").children("vectortext").children("pr"),1==e.length&&(t=$(t).children("textdata").children("vectortext"),null!=$(t).attr("top")&&(this.originalRectShape=this.rectShape=new ppRect(parseInt($(t).attr("left")),parseInt($(t).attr("top")),parseInt($(t).attr("right")),parseInt($(t).attr("bottom")))),1==e.length&&(this.content.path=PathLib.getPathFromXML(e))),this.type="LinkArea"},LinkArea.prototype.createRef=function(){},LinkArea.prototype.render=function(t){switch(t){case"onrollover":new ppTextLib(this.xml),this.parent.render(this.parent.lastRenderedState,!0,null,"LinkArea render",!1,this.id);break;case"onrollout":this.parent.render(null,!0)}},LinkArea.prototype.handleIfOver=function(t,e,i){return e=this.parent.getCanvasPoint(e.x,e.y),e.x>this.xpos+this.linkdx&&e.x<this.xpos+this.linkdx+this.width&&e.y>this.ypos+this.linkdy&&e.y<this.ypos+this.linkdy+this.height?(i&&this.isMouseOver||(this.isMouseOver=!0,this.parent.handleEvent(t,this.id,null,!1,!1,!0),this.render(t)),!0):!1},LinkArea.prototype.handleIfOut=function(t,e){var i=this.parent.getCanvasPoint(e.x,e.y);return i.x>this.xpos+this.linkdx&&i.x<this.xpos+this.linkdx+this.width&&i.y>this.ypos+this.linkdy&&i.y<this.ypos+this.linkdy+this.height?!1:(this.isMouseOver&&(this.isMouseOver=!1,this.parent.handleEvent(t,this.id,null,!1,!1,!0),this.render(t)),!0)};var TextInput=function(t,e,i){this.container=t||$(document.body),this.slide=e,this.layer=i,this.ref=null,this.content={fontsize:18,font:"Arial"},this.constructElement(),this.events=[],this.active=!0,this.visible=!1};TextInput.prototype=new StageItem,TextInput.prototype.innerType="TextInput",TextInput.prototype.objectType="Item",TextInput.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,TextInput.prototype.showBase=StageItem.prototype.show,TextInput.prototype.hideBase=StageItem.prototype.hide,TextInput.prototype.extractNextSpecialVar=function(t){t=bwChunk.DecodeString(t),this.variables.Text=t,this.ref&&this.input&&(this.input[0].value=t)},TextInput.prototype.getExtraResumeVars=function(){var t="";return this.variableResumes.VAR_TEXT=!0,this.variableDefaults.VAR_TEXT=t,this.variableTypes.VAR_TEXT="string",this.ref&&this.input&&(t=this.input[0].value),{VAR_TEXT:t}},TextInput.prototype.loadFromXML=function(t,e,i){this.content.numeric="true"==$(t).attr("numeric"),this.content.multiline="true"==$(t).attr("multiline"),this.content.maxchars=parseInt($(t).attr("maxchars")),this.content.fontsize=$(t).attr("fontsize"),this.content.textcolor=$(t).attr("textcolor").replace("0x","#"),this.content.bold="true"==$(t).attr("bold"),this.content.font=$(t).attr("font"),this.bindto=$(t).attr("bindto"),this.content.instructionText="";var r=$(t).children("data").children("textdata").text();""!=r?this.content.instructionText=$(r).text():this.content.numeric||(this.content.instructionText="type your text here");var r=$(t).children("background").children("vectordata").children("path"),a=$(t).children("background").children("vectordata").children("pr");if(1==r.length||1==a.length){var s=$(t).children("background").children("vectordata");null!=$(s).attr("top")&&(this.originalRectShape=this.rectShape=new ppRect(parseInt($(s).attr("left")),parseInt($(s).attr("top")),parseInt($(s).attr("right")),parseInt($(s).attr("bottom")))),this.content.path=1==a.length?PathLib.getPathFromXML(a):r.text()}this.loadBaseFromXML(t,e,i),this.type="textinput",this.variables.Text=""},TextInput.prototype.validate=function(){var t=this.input.get(0).value;return this.content.numeric&&!t.match(/^-?([0-9]*\.|)[0-9]*$/)?!1:(!isNaN(this.content.maxchars)&&0<this.content.maxchars&&t.length>this.content.maxchars&&(this.input.get(0).value=t.substr(0,this.content.maxchars)),!0)},TextInput.prototype.createRef=function(){if(!this.ref){var t=this;this.container=this.parent.ref,this.ref=$('<div class="item textinput interactive"></div>'),this.applySize(this.ref),this.container.append(this.ref);var e=this.content.multiline?$("<textarea>"):$("<input type='text'>");e.css("font-size",this.content.fontsize+"px"),e.css("font-family",this.content.font+",Arial,Sans-Serif"),e.css("color",this.content.textcolor),e.attr("size",this.content.maxchars),e.attr("placeholder",this.content.instructionText),""!=this.variables.Text&&(e.get(0).value=this.variables.Text);var i=$("<canvas></canvas>");i.css("position","absolute"),this.ref.append(i),this.canvas=i.get(0),this.ref.append(e),this.input=e,this.input.get(0).item=this,"true"==this.variables._disabled&&(this.input.get(0).disabled=!0),this.ref.addClass("interactive"),this.contentRef=this.ref,this.ref.get(0).item=this,t.input.bind("change",function(){t.variables.Text=this.value}),t.input.bind("keydown",function(e){var i=t.input.get(0),r=i.value;setTimeout(function(){if(player.iOSKeyboardFault)switch(e.keyCode){case 8:0<i.value.length&&(i.value=i.value.substr(0,i.value.length-1))}t.validate(i.value)||(i.value=r),t.variables.Text=i.value,t.bindto&&""!=t.bindto&&t.setVariable(t.bindto,i.value)},0)}),player.isIOS&&window!=top&&t.input.bind("keypress",function(e){var i=this,r=i.value;setTimeout(function(){var a=r+String.fromCharCode(e.charCode);i.value==r&&a.length>r.length&&a!=r&&t.validate(a)&&(player.iOSKeyboardFault=!0,1<a.length&&a.substr(1,1).toLowerCase()!=a.substr(1,1)&&(a=a.substr(0,1)+a.substr(1,1).toLowerCase()+a.substr(2)),i.value=a,i.focus())},0)}),t.input.bind("focus",function(){}),t.input.bind("blur",function(){t.handleEvent("onlosefocus",null,null,!1,!1,!0)}),t.bindto&&""!=t.bindto&&(t.bindVarListener(t.bindto).act(t,!1),t.variables.Text=this.input.get(0).value),t.renderBackground("",!0,null,"textinput createref")}},TextInput.prototype.renderBackground=VectorShape.prototype.render,TextInput.prototype.render=function(){if(this.bindto&&""!=this.bindto){var t=this.extractVariable(this.bindto);t!=this.input.get(0).value&&(this.input.get(0).value=t),this.variables.Text=t}},TextInput.prototype.applySize=function(t){t.css("left",this.x+"px"),t.css("top",this.y+"px"),t.css("width",this.width+"px"),t.css("height",this.height+"px"),"Layer"!=this.innerType&&"ExpandingLabel"!=this.innerType&&0<this.depth&&t.css("z-index",this.depth),$(this.canvas).css("left",this.xoffset+"px"),$(this.canvas).css("top",this.yoffset+"px"),0!=this.rotation&&(t.css("-webkit-transform-origin",this.rotatexpos-this.xoffset+"px "+(this.rotateypos-this.yoffset)+"px"),t.css("-webkit-transform","rotate("+this.rotation+"deg)"),t.css("-moz-transform-origin",this.rotatexpos-this.xoffset+"px "+(this.rotateypos-this.yoffset)+"px"),t.css("-moz-transform","rotate("+this.rotation+"deg)"),t.css("-o-transform-origin",this.rotatexpos-this.xoffset+"px "+(this.rotateypos-this.yoffset)+"px"),t.css("-o-transform","rotate("+this.rotation+"deg)"),t.css("-ms-transform-origin",this.rotatexpos-this.xoffset+"px "+(this.rotateypos-this.yoffset)+"px"),t.css("-ms-transform","rotate("+this.rotation+"deg)"),this.canSimplify=!1)};var DragItem=function(t){this.container=t||$(document.body),this.ref=null,this.constructElement(),this.currentIndex=0,this.content={},this.colors={},this.type="textfield",this.active=!0,this.id=Math.random(),this.name="item",this.visible=this.layered=!1,this.canSimplify=!0,this.hasEvents=!1,this.xml="",this.deferredResourceIndex=0,this.fillet=10,this.lastRenderedState="none",this.snapy=this.snapx=0,this.multidrop=this.dragreturn=!0,this.dropoffsety=this.dropoffsetx=0,this.canvas=null,this.m_nYOffset=this.m_nXOffset=0,this.height=this.width=1e3,this.downY=this.downX=this.dragY=this.dragX=0,this.dropArea=null,this.dragDropIDs={global:!0},this.dragOverIDs={global:!0},this.currentlyOver={},this.isDragItem=!0};DragItem.prototype=new Item,DragItem.prototype.objectType="Item",DragItem.prototype.innerType="Item",DragItem.prototype.extractNextSpecialVar=function(t){(t=this.getItemByResumeIndex(t))&&(this.dropArea=t,this.dropArea.variables.DragConnectData=this.connectdata,"wordbank"==this.style&&(this.originalParent=this.parent,this.parent=this.dropArea.parent,this.x=this.dropArea.x,this.y=this.dropArea.y,this.depth=++this.slide.topZ,this.updateMatrixComplete(!0)))},DragItem.prototype.getExtraResumeVars=function(){var t=-1;return this.variableResumes.VAR_SELECTED_ITEM=!0,this.variableDefaults.VAR_SELECTED_ITEM=-1,this.variableTypes.VAR_SELECTED_ITEM="number",this.dropArea&&(t=this.dropArea.getItemIndex()),{VAR_SELECTED_ITEM:t}},DragItem.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,DragItem.prototype.toBaseData=Element.prototype.toData,DragItem.prototype.toData=function(t){return t=this.toBaseData(t),t.x=this.x,t.y=this.y,this.depth!=this.originalZ&&(t.depth=this.depth),t},DragItem.prototype.updateBaseFromData=Element.prototype.updateFromData,DragItem.prototype.updateFromData=function(t,e){this.updateBaseFromData(t,e),e||(isNaN(parseInt(t.x))||(this.x=parseInt(t.x)),isNaN(parseInt(t.y))||(this.y=parseInt(t.y)),t.depth&&(this.depth=t.depth,this.depth>this.slide.topZ)&&(this.slide.topZ=this.depth),this.updateMatrixComplete(!0)),t.variables&&t.variables.DropTargetId&&(this.dropArea=this.parent.children[t.variables.DropTargetId],!this.dropArea)&&(this.dropArea=this.slide.findDescendantById(t.variables.DropTargetId)),this.ref&&this.updatePosition()},DragItem.prototype.resetBase=Element.prototype.reset,DragItem.prototype.reset=function(t){this.resetBase(t),t||(this.x=this.originalX,this.y=this.originalY,this.shuffled&&(this.x=this.shuffleX,this.y=this.shuffleY),this.xoffset=this.originalXOffset||0,this.yoffset=this.originalYOffset||0,this.dragY=this.dragX=0,this.dropArea=null,this.updatePosition(),isNaN(this.x)&&(this.x=this.originalX,this.y=this.originalY))},StageItem.prototype.convertToDragItem=function(t){switch(this.toBaseData=DragItem.prototype.toBaseData,this.toData=DragItem.prototype.toData,this.updateBaseFromData=DragItem.prototype.updateBaseFromData,this.updateFromData=DragItem.prototype.updateFromData,this.resetBase=DragItem.prototype.resetBase,this.reset=DragItem.prototype.reset,this.initDrag=DragItem.prototype.initDrag,this.mousedown=DragItem.prototype.mousedown,this.mousemove=DragItem.prototype.mousemove,this.mouseup=DragItem.prototype.mouseup,this.fixPositionEvent=DragItem.prototype.fixPositionEvent,this.updateDragPosition=DragItem.prototype.updateDragPosition,this.testOverlap=DragItem.prototype.testOverlap,this.findDropArea=DragItem.prototype.findDropArea,this.dock=DragItem.prototype.dock,this.undock=DragItem.prototype.undock,this.updatePosition=DragItem.prototype.updatePosition,this.reParent=DragItem.prototype.reParent,this.getExtraResumeVars=DragItem.prototype.getExtraResumeVars,this.parseDragGroupsFromXML=DropArea.prototype.parseDragGroupsFromXML,this.extractNextSpecialVar=DragItem.prototype.extractNextSpecialVar,this.lastRenderedState="none",this.currentlyOver={},this.innerType){case"textfield":case"image":break;case"ItemGroup":case"StateGroup":this.render=function(){},$.each(this.children,function(){});break;default:this.render=VectorShape.prototype.render}this.droptype=$(t).children("dragdrop").attr("droptype"),this.snapx=parseInt($(t).children("dragdrop").attr("snapx")),this.snapy=parseInt($(t).children("dragdrop").attr("snapy")),this.dragreturn="true"==$(t).children("dragdrop").attr("dragreturn"),this.multidrop="true"==$(t).children("dragdrop").attr("multidrop"),this.dropoffsetx=parseInt($(t).children("dragdrop").attr("dropoffsetx")),this.dropoffsety=parseInt($(t).children("dragdrop").attr("dropoffsety")),this.originalX=this.x,this.originalY=this.y,this.downY=this.downX=this.dragY=this.dragX=0,this.parseDragGroupsFromXML(t),this.isDragItem=!0},StageItem.prototype.convertRefToDragItem=function(){this.ref.addClass("dragitem"),this.setInteractive()},DragItem.prototype.bustScrollAreas=function(){},DragItem.initialized=!1,DragItem.init=function(){DragItem.initialized=!0,DragItem.cargo=null;var t=function(t){DragItem.cargo&&(DragItem.cargo.mousemove(t),t.preventDefault())},e=function(t){DragItem.cargo&&(DragItem.cargo.mouseup(t),t.preventDefault())};player.isIOS?($(document.body).bind("touchmove",t),$(window).bind("touchend",e)):($(document.body).bind("mousemove",t),$(window).bind("mouseup",e))},DragItem.cancelDrag=function(){DragItem.cargo&&(DragItem.cargo.dragging=!1),DragItem.cargo=null,$(".item").removeClass("dragging")},DragItem.prototype.loadFromXML=function(t,e,i){this.loadBaseFromXML(t,e,i),this.parseDragGroupsFromXML(t),this.style=$(t).attr("style"),this.connectdata=$(t).attr("connectdata"),this.reviewdata=$(t).attr("reviewdata"),this.width=parseInt($(t).attr("width")),this.height=parseInt($(t).attr("height")),this.originalX=this.x,this.originalY=this.y,this.alttext=$(this.xml).find("textdata").attr("alttext"),"wordbank"!=this.style||this.colors.hover||(t=new Background(this.ref),t.rotation="90",t.fillType="linear",t.stops.push(t.parseStop('<color rgb="0xBBF8FB" alpha="100" stop="0" />')),t.stops.push(t.parseStop('<color rgb="0xA5E8EB" alpha="100" stop="100" />')),this.colors.hover=t),this.variables.DropTargetId="",this.canSimplify=!1},DragItem.prototype.parseDragGroupsFromXML=function(t){var e=$(t).children("dragdrop").children("dragoverids").children("dragoverid"),t=$(t).children("dragdrop").children("dragdropids").children("dragdropid");if(0==e.length&&0==t.length)this.dragDropIDs={global:!0},this.dragOverIDs={global:!0};else{this.dragDropIDs={},this.dragOverIDs={};var i=this;e.each(function(t,e){var r=$(e).text();i.dragOverIDs[r]=!0}),t.each(function(t,e){var r=$(e).text();i.dragDropIDs[r]=!0})}},DragItem.prototype.initDrag=function(){this.canSimplify=!1,DragItem.initialized||DragItem.init()},DragItem.prototype.createBaseRef=StageItem.prototype.createRef,DragItem.prototype.createRef=function(){if(!this.ref){this.createBaseRef(),this.ref.addClass("dragitem"),this.setInteractive();var t=$("<canvas></canvas>");t.attr("width",this.width),t.attr("height",this.height),t.css("position","absolute"),this.ref.append(t);var e=$("<canvas></canvas>");e.attr("width",this.width),e.attr("height",this.height),e.css("margin","0 0 0 "+2*this.fillet+"px"),e.css("position","absolute"),this.ref.append(e);var i=$("<div></div>");i.css("margin","0 0 0 "+2*this.fillet+"px"),i.css("position","absolute"),i.css("margin-top",parseInt(this.height/2)-10),i.empty(),i.text(this.alttext),this.ref.append(i),this.border=t.get(0),this.canvas=e.get(0),this.contentRef=i,this.initDrag()}this.render(null,!0)},DragItem.prototype.renderCallback=function(){this.width=this.originalWidth,this.height=this.originalHeight,this.render(),this.contentRef.css("margin-top",parseInt(this.height/2)-10),this.contentRef.empty(),this.contentRef.text(this.alttext)},DragItem.prototype.render=function(t,e){if(this.ref&&(e||t!=this.lastRenderedState)){this.lastRenderedState=t;var i=this.border.getContext("2d"),r=parseInt(900*Math.random()+1100)%1e3;switch(i.fillStyle="#"+r,i.fillStyle="#fff",i.lineWidth=1,i.strokeStyle="#ccc",r=i.createLinearGradient(0,0,0,this.height),r.addColorStop(0,"#fcfcfc"),r.addColorStop(1,"#eaeaea"),i.fillStyle=r,this.colors[t]&&this.colors[t].applyCanvas(i,this,!0,!1),r=this.fillet,this.style){case"matching":i.beginPath(),i.moveTo(r+.5,.5),i.lineTo(this.width-.5,.5),i.lineTo(this.width-.5,this.height-.5),i.lineTo(r+.5,this.height-.5),i.lineTo(r+.5,this.height-r-.5),i.lineTo(.5,this.height-r-.5),i.lineTo(.5,r+.5),i.lineTo(r+.5,r+.5),i.lineTo(r+.5,.5),i.fill(),i.stroke(),this.variables.ReviewMode&&(i.fillStyle="#DB0000",this.dropArea&&this.reviewdata==this.dropArea.reviewdata&&(i.fillStyle="#008520"),r=8,i.beginPath(),i.arc(8.5,8.5,r,0,2*Math.PI),i.fill(),r=6.8,i.beginPath(),i.strokeStyle="rgba(255,255,255,0.6)",i.lineWidth=.8,i.arc(8.4,8.4,r,0,2*Math.PI),i.fill(),i.stroke(),i.fillStyle="#fff",i.font="10px sans-serif",i.textBaseline="top",i.fillText(this.reviewdata,5,2),this.dropArea&&this.dropArea.matchingDragItem!=this&&(this.dropArea.matchingDragItem=this,this.dropArea.variables.ReviewMode=this.variables.ReviewMode,this.dropArea.render(this.dropArea.lastRenderedState,!0)));break;case"wordbank":this.variables.ReviewMode&&("1"==this.reviewdata?(i.lineWidth=2,i.strokeStyle="#008520"):this.dropArea&&(i.lineWidth=2,i.strokeStyle="#DB0000")),r=this.height/2,i.beginPath(),i.moveTo(r+.5,.5),i.lineTo(this.width-r-.5,.5),i.arc(this.width-r-.5,r,r-i.lineWidth/2,3*Math.PI/2,Math.PI/2),i.lineTo(r+.5,this.height-.5),i.arc(r+.5,r,r-i.lineWidth/2,Math.PI/2,3*Math.PI/2),i.fill(),0!=i.lineWidth&&i.stroke();break;default:i.fillRect(.5,.5,this.width,this.height-i.lineWidth),i.strokeRect(.5,.5,this.width,this.height-i.lineWidth)}}},DragItem.prototype.fixPositionEvent=function(t){if(!t.fixed){t.originalEvent.touches&&(0<t.originalEvent.touches.length?(t.pageX=t.originalEvent.touches[0].pageX,t.pageY=t.originalEvent.touches[0].pageY):(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY)),t.fixed=!0,t.pageX=parseInt(t.pageX/player.currentZoom()),t.pageY=parseInt(t.pageY/player.currentZoom());var e=$(".framewrap").offset(),i=t.pageY-e.top;t.pageX=parseInt((t.pageX-e.left)/player.frameScale+e.left),t.pageY=parseInt(i/player.frameScale+e.top)}},DragItem.prototype.mousedown=function(t){"true"!=this.variables._disabled&&"true"!=this.parent.variables._disabled&&("wordbank"==this.style&&this.dropArea?this.render(""):(this.fixPositionEvent(t),this.downScrollTop=0,this.nearestScrollAreaAncestor?this.downScrollTop=this.nearestScrollAreaAncestor.ref.get(0).scrollTop:"sequence"==this.style&&(this.downScrollTop=this.parent.ref.get(0).scrollTop),this.findAncestorOfType("ScrollArea")&&(this.originalParent=this.parent,this.reParent(this.slide)),this.downX=t.pageX,this.downY=t.pageY,this.lastX=this.x,this.lastY=this.y,this.depth<this.slide.topZ&&(this.originalZ||(this.originalZ=this.depth),this.depth=++this.slide.topZ,this.setZIndex(this.depth)),this.dragStarted=!1,this.dragging=!0,DragItem.cargo=this,this.ref.addClass("dragging"),this.handleEvent("ondragstart",null,null,!1,!1,!0),this.handleEvent("onpress",null,null,!1,!1,!0)))},DragItem.prototype.reParent=function(t){var e=this.findAncestorOfType("ScrollArea"),i=t.findAncestorOfType("ScrollArea"),r=this.parent.ref.offset(),a=t.ref.offset(),s=0,n=0,o=0,l=0;e&&(s=e.ref.get(0).scrollTop,n=e.ref.get(0).scrollLeft,!e.scrollPlaceHolder)&&(e.scrollPlaceHolder=$("<div class='scrollplaceholder'/>"),e.scrollPlaceHolder.css("top",e.ref.get(0).scrollHeight-1),e.scrollPlaceHolder.css("left",e.ref.get(0).scrollWidth-1),
e.ref.append(e.scrollPlaceHolder)),i&&(o=i.ref.get(0).scrollTop,l=i.ref.get(0).scrollLeft),e=s-o,n-=l,t.ref.append(this.ref),this.parent=t,this.x+=(r.left-a.left-n)/player.frameScale,this.y+=(r.top-a.top-e)/player.frameScale,this.updateDragPosition()},DragItem.prototype.mousemove=function(t){this.fixPositionEvent(t),this.dragStarted||(this.dragStarted=!0,this.handleEvent("ondragdisconnect",null,null,!1,!0,!1)),this.dragging&&(swipe.moved=!0,this.dragX=t.pageX-this.downX,this.dragY=t.pageY-this.downY,this.updateDragPosition(),this.findDropArea())},DragItem.prototype.mouseup=function(t){this.fixPositionEvent(t),this.dragging=!1,DragItem.cargo=null,$(".item").removeClass("dragging"),this.updateDragPosition(),DragItem.dropArea?(this.dock(DragItem.dropArea),DragItem.dropArea=null,DropArea.update()):(this.undock(),this.dragreturn&&"sequence"!=this.style&&this.originalZ&&this.setZIndex(this.originalZ)),this.setElementProperty("dragX",0,!0),this.setElementProperty("dragY",0,!0),swipe.moved=!1,this.handleEvent("ondragend",null,null,!1,!1,!0),this.handleEvent("onrelease",null,null,!1,!1,!0),this.mouseupCallback&&this.mouseupCallback(t),$.each(this.children,function(t,e){void 0!=e.dragX&&(e.dragX=0,e.dragY=0)}),!this.dropArea&&this.dragreturn?this.originalParent&&this.originalParent!=this.parent&&(this.reParent(this.originalParent),this.updatePosition()):this.dropArea&&this.dropArea.parent!=this.parent&&(this.reParent(this.dropArea.parent),this.updatePosition()),this.updateMatrixComplete(!0)},DragItem.prototype.updateDragPosition=function(){this.ref.css("left",this.x+this.dragX),this.ref.css("top",this.y+this.dragY),this.updateMatrixComplete(!0)},StageItem.prototype.testOverlap=function(t){if(0<$(".modalfence:visible").length)return!1;var e=this;if("ItemGroup"==t.innerType||"StateGroup"==t.innerType){var i=!1;return $.each(t.children,function(t,r){i=i||e.testOverlap(r)}),i}return"ItemGroup"==e.innerType||"StateGroup"==e.innerType?(i=!1,$.each(e.children,function(r,a){a.testOverlap&&(a.setElementProperty("dragX",e.dragX,!0),a.setElementProperty("dragY",e.dragY,!0),i=i||a.testOverlap(t))}),i):this.testRotatedOverlap(t)},VectorShape.prototype.getCanvasPoint=function(t,e){return this.matrix.unTransformPoint(t,e)},StageItem.prototype.isPointActive=function(t,e){return this.visible?this.testOver(t,e):!1},VectorShape.prototype.isPointActive=function(t,e){var i=this.getCanvasPoint(t,e),r=this.getBitMask();return 0>=i.x||0>=i.y||i.x>=this.canvas.width||i.y>=this.canvas.height?!1:(r=r.isPointActive(i.x,i.y),BitMask.showDebug&&player.monitoringItem==this&&"_default_Hover"==this.lastRenderedState&&(BitMask.testCanvas||(BitMask.testCanvas=$("<canvas id='test' width='1000' height='1000' style='position:absolute;z-index:200;left:0px;top:0px;'></canvas>"),$(document.body).append(BitMask.testCanvas),BitMask.testContext=BitMask.testCanvas.get(0).getContext("2d"),BitMask.testContext.fillStyle="rgba(255,255,0,0.5)"),BitMask.testCanvas.show(),clearTimeout(BitMask.testCanvasClear),BitMask.testCanvasClear=setTimeout(function(){BitMask.testCanvas.hide()},1e3),BitMask.testContext.clearRect(0,0,1e3,1e3),this.getBitMask().drawDebug(BitMask.testCanvas.get(0)),BitMask.testContext.fillStyle=r?"rgba(0,255,0,1)":"rgba(255,0,0,1)",BitMask.testContext.fillRect(i.x-2,i.y-2,4,4)),r)},StageItem.prototype.isAbove=function(t){for(var e=this;e;){for(var i=t;i;){if(i.parent==e.parent)return e.depth>i.depth;i=i.parent}e=e.parent}return!1},StageItem.prototype.isPointObscured=function(t,e,i,r){var a=this,s=!1;return a.slide.deepEach(function(n,o){if(!s&&o!=a&&o!=i&&o.isAbove&&o.isAbove(a)&&o.isPointActive(t,e)&&(!i||!i.isAncestor(o)))if("ScrollArea"==o.innerType){o.isAncestor(a);var l=o.ref.get(0).scrollTop;s=o.isPointActive(t,e-l,i,r)}else o.nearestScrollAreaAncestor&&o.nearestScrollAreaAncestor!=a.nearestScrollAreaAncestor?(l=o.nearestScrollAreaAncestor.ref.get(0).scrollTop,s=o.isPointActive(t,e-l)):s=!0},function(t){var e=r&&r(t);return t!=a&&t.visible&&t!=i&&!e}),s},DragItem.prototype.findDropArea=function(){var t=this,e=null,i=1e5;return $.each(t.slide.ref.find(".droparea"),function(r,a){if(a.item&&util.hasMutualKey(a.item.dragDropIDs,t.dragDropIDs)&&t.testOverlap(a.item)){var s=t.slideX()+t.dragX,n=t.slideY()+t.dragY,s=Math.sqrt(Math.pow(s-a.item.slideX(),2)+Math.pow(n-a.item.slideY(),2));i>s&&(e=a.item,i=s)}}),t.variables.DragOverId="",$.each(t.slide.ref.find(".dragover"),function(e,i){i.item&&util.hasMutualKey(i.item.dragOverIDs,t.dragOverIDs)&&t.testOverlap(i.item)?(t.variables.DragOverId=i.item.id,t.currentlyOver[i.item.id]||t.handleEvent("ondragover",null,null,!1,!1,!0),t.currentlyOver[i.item.id]=!0):t.currentlyOver[i.item.id]=!1}),DragItem.dropArea=e,DropArea.update(),e},DragItem.prototype.swapPositionsWith=function(t){var e=this.y;this.y=t.y,t.y=e,this.ref.css("top",this.y+"px"),t.ref.css("top",t.y+"px")},DragItem.prototype.updatePosition=function(){var t=this.fillet||0;if(this.dropArea)switch(this.dropArea.droptype){case"matching":this.x=this.dropArea.x+this.dropArea.width-t;break;case"snap":this.x=this.dropArea.x+this.dropArea.snapx-this.snapx+this.xoffset-this.dropArea.xoffset,this.y=this.dropArea.y+this.dropArea.snapy-this.snapy+this.yoffset-this.dropArea.yoffset;break;case"tile":break;case"free":void 0==this.lastX&&(this.lastX=this.x,this.lastY=this.y),this.x=this.dragX+this.lastX,this.y=this.dragY+this.lastY,this.lastX=this.x,this.lastY=this.y;break;case"stackoffset":break;case"stackrandom":void 0==this.randx&&(this.randx=Math.random(),this.randy=Math.random(),1==this.dropArea.dockedItemCount)&&(this.randy=this.randx=.5);var t=parseInt(2*this.randx*this.dropArea.dropoffsetx)-this.dropArea.dropoffsetx,e=parseInt(2*this.randy*this.dropArea.dropoffsety)-this.dropArea.dropoffsety;this.x=this.dropArea.x+this.dropArea.snapx-this.snapx+t+this.xoffset-this.dropArea.xoffset,this.y=this.dropArea.y+this.dropArea.snapy-this.snapy+e+this.yoffset-this.dropArea.yoffset;break;case"wordbank":this.slideY(),this.x=this.dropArea.x+this.x-this.slideX()+this.dropArea.x-this.dropArea.slideX(),this.y=this.dropArea.y+this.y-this.slideY()+this.dropArea.y-this.dropArea.slideY();break;default:this.x=this.dropArea.x,this.y=this.dropArea.y}else this.dragreturn?this.shuffled&&"sequence"!=this.style?(this.x=parseInt(this.shuffleX)+this.xoffset,"matching"!=this.style&&(this.y=parseInt(this.shuffleY)+this.yoffset)):(this.x=parseInt(this.originalX)+this.xoffset,"matching"!=this.style&&(this.y=parseInt(this.originalY)+this.yoffset)):(this.x+=this.dragX,this.y+=this.dragY);this.ref&&(this.ref.css("left",this.x+"px"),this.ref.css("top",this.y+"px")),this.updateMatrixComplete(!0)},DragItem.prototype.undock=function(t){this.dropArea&&(this.dropArea.variables.DragConnectData="",this.dropArea.dockedItemCount--,this.dropArea.dragItem=null),this.variables.DropTargetId="",t||(this.dropArea=null,this.dragreturn&&this.originalParent&&this.originalParent!=this.parent&&this.reParent(this.originalParent),this.updatePosition(),DropArea.unstackItem(this),DropArea.update())},DragItem.prototype.dock=function(t){var e=this;"matching"==e.style?$.each(e.slide.ref.find(".dragitem"),function(i,r){var a=r.item;a&&a!=e&&a.y==t.y&&(e.reParent(a.parent),e.swapPositionsWith(a),a.undock())}):"wordbank"==e.style&&$.each(e.slide.ref.find(".dragitem"),function(t,i){var r=i.item;r&&r!=e&&r.undock()}),this.dropArea&&this.undock(!0),t.variables.DragConnectData=this.connectdata,t.dragItem=this,t.dockedItemCount++,e.variables.DropTargetId=t.id,e.dropArea=t,DropArea.unstackItem(this,e.dropArea),e.updatePosition(),e.render(e.lastRenderedState),t&&(!t.multidrop&&0<t.dockedItemCount&&$.each(e.slide.ref.find(".dragitem"),function(i,r){var a=r.item;a&&a!=e&&a.dropArea==t&&(a.x=parseInt(a.originalX)+a.xoffset,a.y=parseInt(a.originalY)+a.yoffset,a.undock())}),t.findSlot(this),t.updateSlotPositions()),swipe.moved=!1,this.handleEvent("ondragconnect",null,null,!1,!1,!0),t.handleEvent("ondragconnect",null,null,!1,!1,!0)},DragItem.prototype.set_review=function(){this.render("",!0)};var DropArea=function(t){this.container=t||$(document.body),this.ref=null,this.constructElement(),this.currentIndex=0,this.content={},this.colors={},this.type="droparea",this.active=!0,this.id=Math.random(),this.name="item",this.visible=this.layered=!1,this.canSimplify=!0,this.hasEvents=!1,this.xml="",this.deferredResourceIndex=0,this.fillet=10,this.droptype="matching",this.lastRenderedState="none",this.snapy=this.snapx=0,this.multidrop=this.dragreturn=!0,this.dropoffsety=this.dropoffsetx=0,this.slots=[],this.dragItemIDs=[],this.dockedItemCount=0,this.canvas=this.dragItem=null,this.m_nYOffset=this.m_nXOffset=0,this.m_nHeight=this.m_nWidth=1e3,this.dragDropIDs={global:!0},this.dragOverIDs={global:!0}};DropArea.prototype=new StageItem,DropArea.prototype.objectType="Item",DropArea.prototype.innerType="DropArea",DropArea.prototype.extractNextSpecialVar=function(t){(t=this.getItemByResumeIndex(t))&&(this.dragItem=t)},DropArea.prototype.getExtraResumeVars=function(){var t=-1;switch(this.variableResumes.VAR_SELECTED_ITEM=!0,this.variableDefaults.VAR_SELECTED_ITEM=-1,this.variableTypes.VAR_SELECTED_ITEM="number",this.style){case"matching":case"wordbank":return this.dragItem&&(t=this.dragItem.getItemIndex()),{VAR_SELECTED_ITEM:t};default:return{}}},DropArea.prototype.toBaseData=Element.prototype.toData,DropArea.prototype.toData=function(t){var e=this.toBaseData(t);return this.DragConnectData&&(e.DragConnectData=this.DragConnectData),this.slots&&0<this.slots.length&&(e.slots=[],$.each(this.slots,function(t,i){e.slots.push(i.id)})),e},DropArea.prototype.updateBaseFromData=Element.prototype.updateFromData,DropArea.prototype.updateFromData=function(t){var e=this;this.updateBaseFromData(t),t.DragConnectData&&(this.DragConnectData=t.DragConnectData),t.slots&&(this.slots=[],$.each(t.slots,function(t,i){var r=e.parent.children[i];r&&e.slots.push(r)}))},DropArea.prototype.resetBase=Element.prototype.reset,DropArea.prototype.reset=function(){this.resetBase(),this.slots=[],this.dragItemIDs=[],this.dockedItemCount=0},StageItem.prototype.convertToDropArea=function(t){switch(this.toBaseData=DropArea.prototype.toBaseData,this.toData=DropArea.prototype.toData,this.updateBaseFromData=DropArea.prototype.updateBaseFromData,this.updateFromData=DropArea.prototype.updateFromData,this.resetBase=DropArea.prototype.resetBase,this.reset=DropArea.prototype.reset,this.update=DragItem.prototype.update,this.findSlot=DropArea.prototype.findSlot,this.findTileSlot=DropArea.prototype.findTileSlot,this.findOffsetSlot=DropArea.prototype.findOffsetSlot,this.updateSlotPositions=DropArea.prototype.updateSlotPositions,this.unstack=DropArea.prototype.unstack,this.parseDragGroupsFromXML=DropArea.prototype.parseDragGroupsFromXML,this.getDragItemIndex=DropArea.prototype.getDragItemIndex,this.getExtraResumeVars=DropArea.prototype.getExtraResumeVars,this.extractNextSpecialVar=DropArea.prototype.extractNextSpecialVar,this.lastRenderedState="none",this.innerType){case"textfield":case"image":break;case"ItemGroup":case"StateGroup":this.render=function(){};break;default:this.render=VectorShape.prototype.render}this.originalWidth=parseInt($(t).attr("width")),this.originalHeight=parseInt($(t).attr("height")),this.originalX=this.x,this.originalY=this.y,this.droptype=$(t).children("dragdrop").attr("droptype"),this.snapx=parseInt($(t).children("dragdrop").attr("snapx")),this.snapy=parseInt($(t).children("dragdrop").attr("snapy")),this.dragreturn="true"==$(t).children("dragdrop").attr("dragreturn"),this.multidrop="true"==$(t).children("dragdrop").attr("multidrop"),this.dropoffsetx=parseInt($(t).children("dragdrop").attr("dropoffsetx")),this.dropoffsety=parseInt($(t).children("dragdrop").attr("dropoffsety")),this.slots=[],this.dragItemIDs=[],this.dockedItemCount=0,this.isDropArea=!0,this.variables.DragConnectData="",this.variableDefaults.DragConnectData="",this.parseDragGroupsFromXML(t)},DropArea.update=function(){$.each(player.currentSlide().ref.find(".droparea"),function(t,e){e.item&&(e.item==DragItem.dropArea?e.item.render("over"):e.item.render(),e.item.updateSlotPositions())}),DragItem.cargo&&DragItem.dropArea&&DragItem.dropArea.findSlot(DragItem.cargo)},DropArea.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,DropArea.prototype.parseDragGroupsFromXML=DragItem.prototype.parseDragGroupsFromXML,DropArea.prototype.loadFromXML=function(t,e,i){this.loadBaseFromXML(t,e,i),this.style=$(t).attr("style"),this.droptype=$(t).attr("style"),this.reviewdata=$(t).attr("reviewdata"),this.originalWidth=parseInt($(t).attr("width")),this.originalHeight=parseInt($(t).attr("height")),this.alttext=$(this.xml).find("textdata").attr("alttext"),this.variables.DragConnectData="",this.variableDefaults.DragConnectData="",this.canSimplify=!1},DropArea.prototype.loadDragDropFromXML=function(){},DropArea.prototype.createBaseRef=StageItem.prototype.createRef,DropArea.prototype.createRef=function(){if(this.ref)this.render(null,!0);else{this.type="droparea",this.createBaseRef(),this.ref.addClass("droparea");var t=$("<canvas></canvas>");t.attr("width",this.width),t.attr("height",this.height),t.css("position","absolute"),this.ref.append(t);var e=$("<canvas></canvas>");e.attr("width",this.width),e.attr("height",this.height),e.css("margin","0 0 0 "+this.fillet+"px"),e.css("position","absolute"),this.ref.append(e);var i=$("<div></div>");i.css("margin","0 0 0 "+this.fillet+"px"),i.css("position","absolute"),i.css("margin-top",parseInt(this.height/2)-10),i.empty(),i.text(this.alttext),i.show(),this.ref.append(i),this.border=t.get(0),this.jcanvas=e,this.canvas=e.get(0),this.contentRef=i,this.bindEvents(),this.render()}},DropArea.prototype.bindEvents=function(){var t=this;t.ref.bind("dragstart",function(t){t.preventDefault()}),t.ref.bind("mouseover",function(){DragItem.cargo&&t.render("over")}),t.ref.bind("mouseout",function(){t.render("out")})},DropArea.prototype.renderCallback=function(){},DropArea.prototype.render=function(t,e){if(this.ref&&(e||t!=this.lastRenderedState)){this.lastRenderedState=t;var i=this.border.getContext("2d"),r=parseInt(900*Math.random()+1100)%1e3;switch(i.fillStyle="#"+r,i.fillStyle="#fff",i.lineWidth=1,i.strokeStyle="#ccc",r=i.createLinearGradient(0,0,0,this.height),r.addColorStop(0,"#fcfcfc"),r.addColorStop(1,"#eaeaea"),i.fillStyle=r,this.colors[t]&&this.colors[t].applyCanvas(i,this,!0,!1),t){case"over":i.lineWidth=3;break;default:i.lineWidth=1}var r=i.lineWidth/2,a=this.fillet;switch(this.style){case"matching":i.beginPath(),i.moveTo(0+r,0+r),i.lineTo(this.width-r,0+r),i.lineTo(this.width-r,a-r),i.lineTo(this.width-a-r,a-r),i.lineTo(this.width-a-r,this.height-a+r),i.lineTo(this.width-r,this.height-a+r),i.lineTo(this.width-r,this.height-r),i.lineTo(0+r,this.height-r),i.lineTo(0+r,0+r),i.fill(),i.stroke(),this.variables.ReviewMode&&(i.fillStyle="#DB0000",this.matchingDragItem&&this.matchingDragItem.reviewdata==this.reviewdata&&(i.fillStyle="#008520"),a=8,i.beginPath(),i.arc(8,8,a,0,2*Math.PI),i.fill(),a=7,i.beginPath(),i.fillStyle="#000",i.strokeStyle="rgba(255,255,255,0.5)",i.lineWidth=.5,i.arc(8,8,a,0,2*Math.PI),i.fill(),i.stroke(),i.fillStyle="#fff",i.font="10px sans-serif",i.textBaseline="top",i.fillText(this.reviewdata,5,2));break;case"wordbank":this.variables.ReviewMode&&(i.lineWidth=2,i.strokeStyle="#DB0000"),a=this.height/2,i.beginPath(),i.moveTo(a+r,r),i.lineTo(this.width-a-r,r),i.arc(this.width-a-r,a,a-i.lineWidth/2,3*Math.PI/2,Math.PI/2),i.lineTo(a+r,this.height-r),i.arc(a+r,a,a-i.lineWidth/2,Math.PI/2,3*Math.PI/2),i.fill(),i.stroke();break;default:i.fillRect(r,r,this.width,this.height-i.lineWidth),i.strokeRect(r,r,this.width,this.height-i.lineWidth)}}},DropArea.prototype.updateSlotPositions=function(){switch(this.droptype){case"stackrandom":case"free":return;case"stackoffset":for(var t=0,e=0;e<this.slots.length;e++){var i=this.slots[e];i!=DragItem.cargo&&(i.x=this.x+e*this.dropoffsetx,i.y=this.y+e*this.dropoffsety,i.ref.css("left",i.x+"px"),i.ref.css("top",i.y+"px"),i.updateMatrixComplete(!0),0==t?t=i.depth:i.setZIndex(t+e))}return}for(var r=t=0,a=0,e=0;e<this.slots.length;e++)i=this.slots[e],t+i.width>this.width&&(t=0,r+=a),i!=DragItem.cargo&&(i.x=this.x+t,i.y=this.y+r,i.updatePosition()),a=i.height,t+=i.width},DropArea.prototype.findSlot=function(t){"tile"==this.droptype?(this.findTileSlot(t),this.updateSlotPositions()):"stackoffset"==this.droptype&&(this.findOffsetSlot(t),this.updateSlotPositions())},DropArea.prototype.findTileSlot=function(t){var e=t.x-this.x+t.dragX+t.snapx,i=t.y-this.y+t.dragY+t.snapy,r=this.slots.indexOf(t);if(r>-1&&this.slots.splice(r,1),0>e&&0>i)this.slots.splice(0,0,t);else{for(var a=0,s=0,n=0,o=0,r=o=0;r<this.slots.length;r++){var l=this.slots[r],a=a+n;if(a+l.width>this.width&&(a=0,s+=o),n=l.width,o=l.height,e+t.width<=this.width&&a+n>=e&&s+o>=i)return void this.slots.splice(r,0,t);if(s+o>=i&&a+n>=this.width)return void this.slots.splice(r,0,t)}this.slots.push(t)}},DropArea.prototype.findOffsetSlot=function(t){var e=t.x-this.x+t.dragX,i=t.y-this.y+t.dragY,r=this.slots.indexOf(t);for(r>-1&&this.slots.splice(r,1),r=0;r<this.slots.length;r++)if(e<r*this.dropoffsetx&&i<r*this.dropoffsety)return void this.slots.splice(r,0,t);this.slots.push(t)},DropArea.prototype.getDragItemIndex=function(t){for(var e=0;e<this.slots.length;e++)if(this.slots[e]==t)return e;return-1},DropArea.unstackItem=function(t,e){$.each(player.currentSlide().ref.find(".droparea"),function(i,r){r!=e&&r.item&&r.item.unstack(t)})},DropArea.prototype.unstack=function(t){t=this.slots.indexOf(t),t>-1&&this.slots.splice(t,1)},DragItem.prototype.set_review=function(){this.render("",!0)};var DropList=function(t,e,i){this.container=t||$(document.body),this.slide=e,this.layer=i,this.ref=null,this.content={fontsize:18,font:"Arial"},this.constructElement(),this.events=[],this.active=!0,this.visible=!1,this.originalIndices={}};DropList.prototype=new StageItem,DropList.prototype.innerType="DropList",DropList.prototype.objectType="Item",DropList.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,DropList.prototype.showBase=StageItem.prototype.show,DropList.prototype.hideBase=StageItem.prototype.hide,DropList.prototype.toBaseData=Element.prototype.toData,DropList.prototype.toData=function(){var t=this.toBaseData();return this.shuffleOrder&&(t.shuffleOrder=this.shuffleOrder),t},DropList.prototype.updateBaseFromData=Element.prototype.updateFromData,DropList.prototype.updateFromData=function(t){this.updateBaseFromData(t),t.shuffleOrder&&(this.shuffleOrder=t.shuffleOrder)},DropList.prototype.extractNextSpecialVar=function(t){t=$(this.xml).children("data").children("itemlist").children().get(t),t=$(t).attr("itemdata"),this.variables.SelectedItemData=t,this.ref&&this.select&&this.select.val(t)},DropList.prototype.getExtraResumeVars=function(){this.variableResumes.VAR_SELECTED_ITEM=!0,this.variableDefaults.VAR_SELECTED_ITEM=-1,this.variableTypes.VAR_SELECTED_ITEM="number";var t=-1;return this.ref&&this.select&&(t=this.originalIndices[this.select.val()],void 0===t&&(t=-1)),{VAR_SELECTED_ITEM:t}},DropList.prototype.loadFromXML=function(t,e,i){this.loadBaseFromXML(t,e,i),this.alttext=$(t).children("data").children("textdata ").attr("alttext"),this.shuffle="true"==$(t).attr("shuffle"),this.shuffleOrder=[],this.type="droplist"},DropList.prototype.update=function(){this.variables.SelectedItemData=this.select.val()},DropList.prototype.createRef=function(){if(this.ref)this.update();else{var t=this;this.container=this.parent.ref,this.ref=$('<div class="item droplist interactive"></div>'),this.applySize(this.ref),this.container.append(this.ref),this.canvas=this.ref.get(0),this.select=$("<select></select>"),this.select.css("font-size",this.content.fontsize+"px"),this.select.css("font-family",this.content.font+",Arial,Sans-Serif"),this.applySize(this.select),this.ref.append(this.select),"true"==this.variables._disabled&&(this.select.get(0).disabled=!0),this.contentRef=this.ref,this.ref.get(0).item=this;var e={};if($(this.xml).children("data").children("itemlist").children().each(function(i,r){var a=$(r).attr("itemdata"),s=$(r).children("textdata").attr("alttext"),n=$("<option value='"+a+"'>"+s+"</option>");t.originalIndices[a]=i,e[s]=n,t.shuffleOrder.length<=i&&t.shuffleOrder.push(.5<Math.random()),t.shuffle&&t.shuffleOrder[i]?t.select.prepend(n):t.select.append(n)}),this.alttext&&""!=this.alttext)if(e[this.alttext])e[this.alttext].get(0).selected=!0;else{var i=$("<option value=''>"+this.alttext+"</option>");t.select.prepend(i)}void 0!=this.variables.SelectedItemData&&this.select.val(this.variables.SelectedItemData),t.select.bind("change click",function(){t.update()}),t.select.bind("blur",function(){t.handleEvent("onlosefocus",null,null,!1,!1,!0)}),t.update()}};var Button=function(t){this.container=t||$(document.body),this.ref=null,this.constructElement(),this.currentIndex=0,this.content={},this.colors={},this.type="textfield",this.active=!0,this.id=Math.random(),this.name="item",this.visible=this.layered=!1,this.canSimplify=!0,this.hasEvents=!1,this.xml="",this.deferredResourceIndex=0,this.canvas=null,this.m_nYOffset=this.m_nXOffset=0,this.height=this.width=1e3};Button.prototype=new StageItem,Button.prototype.objectType="Item",Button.prototype.innerType="Item",Button.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,Button.prototype.loadFromXML=function(t,e,i){this.loadBaseFromXML(t,e,i),this.style=$(t).attr("style"),this.connectdata=$(t).attr("connectdata"),this.originalWidth=parseInt($(t).attr("width")),this.originalHeight=parseInt($(t).attr("height")),this.originalX=this.x,this.originalY=this.y,0<$(t).children("data").children("textdata").children("vartext").length&&(this.textlib=$(t).children("data")),e=$(t).children("data").children("textdata").children("vectortext").children("path"),i=$(t).children("data").children("textdata").children("vectortext").children("pr"),(1==e.length||1==i.length)&&(t=$(t).children("data").children("textdata").children("vectortext"),null!=$(t).attr("top")&&(this.originalRectShape=this.rectShape=new ppRect(parseInt($(t).attr("left")),parseInt($(t).attr("top")),parseInt($(t).attr("right")),parseInt($(t).attr("bottom")))),this.content.path=1==i.length?PathLib.getPathFromXML(i):e.text()),this.canSimplify=!1},Button.prototype.createBaseRef=StageItem.prototype.createRef,Button.prototype.createRef=function(){if(!(this.ref||(this.createBaseRef(),this.ref.addClass("interactive"),1<this.ref.children().length))){this.contentRef=$('<div class="item unhideable"></div>'),this.contentRef.css("width","100%"),this.ref.append(this.contentRef);var t=$("<canvas></canvas>");t.css("position","absolute"),this.ref.append(t);var e=$("<canvas></canvas>");e.css("position","relative"),this.ref.append(e),this.jcanvas=e,this.border=t.get(0),this.canvas=e.get(0),this.render("btn_bg"),this.ref.get(0).item=this,this.ref.css("width",this.width-2),this.ref.css("height",this.height-2)}},Button.prototype.destroyBaseRef=StageItem.prototype.destroyRef,Button.prototype.destroyRef=function(){this.ref.empty(),this.contentRef.remove(),this.contentRef=null,this.destroyBaseRef()},Button.prototype.bindEventsBase=StageItem.prototype.bindEvents,Button.prototype.bindEvents=function(){var t=this;this.bindEventsBase(),this.ref.bind("mouseover",function(){t.render("btn_hover")}),this.ref.bind("mouseout mouseup",function(){t.render("btn_bg")}),this.ref.bind("mousedown",function(){t.render("btn_down")})},Button.prototype.renderCallback=function(){this.width=this.originalWidth,this.height=this.originalHeight,this.render("btn_bg")},Button.prototype.render=function(t){this.ref&&(this.colors[t]&&this.colors[t].apply(this.ref,this,!0,!1),this.colors.btn_border&&this.ref.css("border-color",this.colors.btn_border.toColorString()),this.renderVectorForeground(t))},Button.prototype.renderVectorForeground=VectorShape.prototype.render,Button.prototype.renderCanvas=function(t){if(this.ref){var e=this.border.getContext("2d"),i=parseInt(900*Math.random()+1100)%1e3;e.fillStyle="#"+i,e.fillStyle="#fff",e.lineWidth=1,e.strokeStyle="#ccc",i=e.createLinearGradient(0,0,0,this.height),i.addColorStop(0,"#fcfcfc"),i.addColorStop(1,"#eaeaea"),e.fillStyle=i,this.colors[t]&&this.colors[t].applyCanvas(e,this,!0,!1),e.fillRect(.5,.5,this.width,this.height-1),e.strokeRect(.5,.5,this.width,this.height-1)}};var ImageItem=function(t){this.container=t||$(document.body),this.ref=null,this.constructElement(),this.type="image",this.active=!0,this.id=Math.random(),this.name="item",this.visible=this.layered=!1,this.canSimplify=!0,this.hasEvents=!1,this.xml="",this.deferredResourceIndex=0,this.canvas=null,this.m_nYOffset=this.m_nXOffset=0,this.height=this.width=1e3};ImageItem.prototype=new StageItem,ImageItem.prototype.objectType="Item",ImageItem.prototype.innerType="Image",ImageItem.extractAnimatedGif=function(t){var e=null;return $(t).children("imagelib").children("imagedata").each(function(t,i){var r=$(i).attr("altimage");r&&r.indexOf(".gif")==r.length-4&&(e=r)}),e},ImageItem.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,ImageItem.prototype.loadFromXML=function(t,e,i){this.loadBaseFromXML(t,e,i),this.zoomtype=$(t).attr("zoomtype"),this.btnxpos=parseInt($(t).attr("btnxpos")),this.btnypos=parseInt($(t).attr("btnypos")),0<$(t).children("zoomdata").children("imagedata").length&&(this.zoomSrc=player.basepath+$(t).children("zoomdata").children("imagedata").attr("url"),this.zoomType=$(t).children("zoomdata").children("imagedata").attr("type"),this.zoomWidth=parseInt($(t).children("zoomdata").children("imagedata").attr("width")),this.zoomHeight=parseInt($(t).children("zoomdata").children("imagedata").attr("height"))),0<$(t).children("zoomdata").children("html5data").length&&(this.zoomSrc=player.basepath+"mobile/"+$(t).children("zoomdata").children("html5data").attr("url")),this.canSimplify=!1},ImageItem.prototype.loadContentFromXML=function(t){this.content.src=Element.PixelSrc;var e=$(t).find("html5data");this.content.mask=e.attr("mask"),this.content.maskref=e.attr("maskref");var i;0<e.length&&e.attr("url")&&(i="mobile/"+e.attr("url")),i||(i=$(t).children("zoomdata").children("imagedata").attr("url")),i||(i=$(t).children("data").children("imagedata").attr("url")),i&&(this.content.src=player.basepath+i,this.content.src.indexOf(".swf")==this.content.src.length-4)&&(this.content.src=this.content.src.replace(".swf",".png"),this.content.src=this.content.src.replace("story_content","mobile")),0<$(t).children("imagelib").length&&this.loadImageDataFromXML(t)},ImageItem.prototype.destroyBaseRef=StageItem.prototype.destroyRef,ImageItem.prototype.destroyRef=function(){this.zoomButton&&(this.zoomButton.remove(),this.zoomButton=null,this.zoomImage.remove(),this.zoomImage=null),this.destroyBaseRef()},ImageItem.prototype.createBaseRef=StageItem.prototype.createRef,ImageItem.prototype.createRef=function(){var t=this;if(!this.ref&&(this.createBaseRef(),this.loadContentFromXML(this.xml,this.slide,this.layer),this.contentRef=$('<image class="item unhideable"></image>'),this.contentRef.attr("width",this.width),this.contentRef.attr("height",this.height),this.contentRef.attr("src",this.content.src),this.ref.append(this.contentRef),this.ref.get(0).item=this,this.zoomType)){var e=$("<div class='zoombutton'><div class='zoombuttoninner'></div></div>");e.css("left",this.btnxpos),e.css("top",this.btnypos),e.css("z-index",this.depth);var i=$("<image class='zoomimage'/>");i.attr("src",this.zoomSrc),i.attr("width",this.zoomWidth),i.attr("height",this.zoomHeight),$(document.body).append(i),i.hide(),this.ref.click(function(){var e=t.zoomWidth,r=t.zoomHeight,a=e/r;a>player.frame.aspectRatio&&e>player.frame.containerWidth?(e=player.frame.containerWidth,r=player.frame.containerWidth*t.zoomHeight/t.zoomWidth):a<=player.frame.aspectRatio&&r>player.frame.containerHeight&&(r=player.frame.containerHeight,e=player.frame.containerHeight/t.zoomHeight*t.zoomWidth);var a=t.ref.offset().left+t.width/2-e/2,s=t.ref.offset().top+t.height/2-r/2;a<player.frame.containerLeft&&(a=player.frame.containerLeft),s<player.frame.containerTop&&(s=player.frame.containerTop),a+e>player.frame.containerLeft+player.frame.containerWidth&&(a=a-(a+e)+(player.frame.containerLeft+player.frame.containerWidth)),s+r>player.frame.containerTop+player.frame.containerHeight&&(s=s-(s+r)+(player.frame.containerTop+player.frame.containerHeight)),i.css("width",e),i.css("height",r),i.css("left",a),i.css("top",s),i.show(),MouseEvents.addHideable(".zoomimage",".zoombutton,.image",function(){$(".zoomimage").hide(),$(".interstitial").hide(),player.showingInterstitial=!1}),$(".interstitial").removeClass("black"),$(".interstitial").unbind(),$(".interstitial").show()}),this.ref.addClass("interactive"),this.ref.addClass("clickable"),this.ref.append(e),this.zoomButton=e,this.zoomImage=i}},ImageItem.prototype.render=function(){};var ItemGroup=function(t,e,i){this.container=t||$(document.body),this.slide=e,this.layer=i,this.ref=null,this.constructElement(),this.active=!0,this.visible=!1};ItemGroup.prototype=new StageItem,ItemGroup.prototype.innerType="ItemGroup",ItemGroup.prototype.objectType="Item",ItemGroup.prototype.loadFromXML=function(t){this.id=$(t).attr("id"),this.xml=t,this.loadElementInfoFromXML(t),this.loadSizeFromXML(t),0<$(this.xml).children("dragdrop").length&&("true"==$(this.xml).children("dragdrop").first().attr("dragenabled")&&this.convertToDragItem(this.xml),"true"==$(this.xml).children("dragdrop").first().attr("dropenabled")&&this.convertToDropArea(this.xml),"true"==$(this.xml).children("dragdrop").first().attr("dragoverenabled"))&&(this.announceDragOver=!0,this.setupDragOver(this.xml)),this.loadChildrenFromXML(t,this.slide,this.layer,function(t){t.canSimplify=!1}),this.canSimplify=!1},ItemGroup.prototype.renderForeground=function(){},ItemGroup.prototype.isPointActive=function(t,e,i,r){var a=!1;return $.each(this.children,function(s,n){n!=i&&(a=a||n.isPointActive(t,e,i,r))}),a};var ShuffleGroup=function(t,e,i){this.container=t||$(document.body),this.slide=e,this.layer=i,this.ref=null,this.constructElement(),this.active=!0,this.visible=!1};ShuffleGroup.prototype=new ItemGroup,ShuffleGroup.prototype.innerType="ShuffleGroup",ShuffleGroup.prototype.objectType="Item",ShuffleGroup.prototype.loadBaseFromXML=ItemGroup.prototype.loadFromXML,ShuffleGroup.prototype.loadFromXML=function(t){var e=this;e.xml=t,this.loadBaseFromXML(t),this.shuffleAttr=$(t).attr("shuffle"),this.canSimplify=!1,$.each(this.children,function(t,i){i.shuffleGroup=e})},ShuffleGroup.prototype.baseShow=ShuffleGroup.prototype.show,ShuffleGroup.prototype.show=function(t,e,i){this.baseShow(t,e,i),"false"!=this.shuffleAttr&&this.shuffle()},ShuffleGroup.prototype.shuffle=function(){"true"!=this.shuffleAttr||this.shuffled||(0<$(this.xml).find("droplist").length?this.shuffleDropLists():this.shuffleElements(),this.shuffled=!0)},ShuffleGroup.prototype.shuffleDropLists=function(){var t=this;$.each(this.children,function(e,i){"droplist"==i.innerType&&(t.shuffleSelect(i.select.get(0)),i.update())})},ShuffleGroup.prototype.shuffleSelect=function(t){for(var e=t.options,i=[],r=e.length-1;r>=0;r--)i.push(e[r]),$(e[r]).remove();for(;i.length;)r=i.splice(this.getRandomIndex(i),1)[0],e.add(r);t.selectedIndex=0},ShuffleGroup.prototype.shuffleElements=function(){var t=[],e=[],i=!0,r=!0,a=-1e3,s=-1e3;if($.each(this.children,function(n,o){o.shufflelock||(-1e3!=a&&o.height!=a&&(i=!1),-1e3!=s&&o.x!=s&&(r=!1),s=o.x,a=o.height,e.push(o),t.push(o),o.unshuffleX=o.x,o.unshuffleY=o.y)}),r&&!i)this.shuffleStacked();else{for(;0<e.length&&0<t.length;){var n=e.pop(),o=this.getRandomIndex(t),o=t.splice(o,1)[0];o.originalX=o.unshuffleX,o.originalY=o.unshuffleY,o.x=n.unshuffleX,o.y=n.unshuffleY,o.ref&&(o.ref.css("top",o.y+"px"),o.ref.css("left",o.x+"px"))}$.each(this.children,function(t,e){e.shuffled=!0,e.shuffleX=e.x-e.xoffset,e.shuffleY=e.y-e.yoffset,e.updateMatrixComplete(!0)})}},ShuffleGroup.prototype.shuffleStacked=function(){var t=[],e=[];$.each(this.children,function(i,r){r.shufflelock||(e.push(r),t.push(r),
r.unshuffleX=r.x,r.unshuffleY=r.y)});var i=0;for(0<e.length&&(i=e[0].unshuffleY);0<t.length;){var r=this.getRandomIndex(t),r=t.splice(r,1)[0];r.originalX=r.unshuffleX,r.originalY=r.unshuffleY,r.y=i,i+=r.height,r.ref&&r.ref.css("top",r.y+"px")}$.each(this.children,function(t,e){e.shuffled=!0,e.shuffleX=e.x-e.xoffset,e.shuffleY=e.y-e.yoffset,e.updateMatrixComplete(!0)})},ShuffleGroup.prototype.shuffleRows=function(){if(!this.shuffled){this.shuffled=!0;var t={},e=[],i=[];$.each(this.children,function(r,a){t[a.x]&&(t={},e.push(i),i=[]),i.push(a),t[a.x]=a}),e.push(i);for(var r=0;10>r;r++)this.swapRow(this.getRandomMember(e),this.getRandomMember(e));$.each(this.children,function(t,e){e.shuffled=!0,e.shuffleX=e.x-e.xoffset,e.shuffleY=e.y-e.yoffset})}},ShuffleGroup.prototype.getRandomIndex=function(t){return parseInt(Math.random()*t.length)},ShuffleGroup.prototype.getRandomMember=function(t){var e=this.getRandomIndex(t);return t[e]},ShuffleGroup.prototype.swapRow=function(t,e){var i=this;t!=e&&$.each(t,function(t,r){i.swapItem(r,e[t])})},ShuffleGroup.prototype.swapItem=function(t,e,i){if(t!=e&&t&&e){var r=t.y,a=t.x;t.y=e.y,e.y=r,t.originalY=t.y,e.originalY=e.y,t.ref.css("top",t.y+"px"),e.ref.css("top",e.y+"px"),i&&(t.x=e.x,e.x=a,t.originalX=t.x,e.originalX=e.x,t.ref.css("left",t.x+"px"),e.ref.css("left",e.x+"px")),t.updateMatrixComplete(!0),e.updateMatrixComplete(!0)}};var ScrollArea=function(t,e,i){this.container=t||$(document.body),this.slide=e,this.layer=i,this.ref=null,this.constructElement(),this.active=!0,this.visible=!1};ScrollArea.prototype=new ItemGroup,ScrollArea.prototype.innerType="ScrollArea",ScrollArea.prototype.objectType="Item",ScrollArea.prototype.loadBaseFromXML=ItemGroup.prototype.loadFromXML,ScrollArea.prototype.loadFromXML=function(t){var e=this;e.xml=t,this.loadBaseFromXML(t),$(e.xml).children("background").each(function(t,i){e.background=new Background(e.ref),e.background.loadFromXML(i)}),this.canSimplify=!1,$.each(this.children,function(t,i){i.ScrollArea=e})},ScrollArea.prototype.baseShow=ScrollArea.prototype.show,ScrollArea.prototype.show=function(t,e,i){this.baseShow(t,e,i)},ScrollArea.prototype.createRef=function(){if(this.parent.ref||this.parent.createRef(),this.container=this.parent.ref,this.ref)this.render(null,!1,null,"StageItem createRef");else{var t=this;this.ref=$('<div class="item scrollarea"></div>'),this.ref.addClass(this.type),this.ref.addClass(this.innerType.toLowerCase()),this.ref.addClass("item_"+this.id),this.ref.attr("id","item_"+this.id),player.showItemInfo&&this.ref.append($('<div class="itemid">'+this.id+"</div>")),this.applySize(this.ref),this.container.append(this.ref),this.ref.get(0).item=this,t.background&&t.background.apply(t.ref),$.each(this.children,function(t,e){e.createRef&&e.createRef()}),t.visible=!1,this.ref.bind("scroll",function(){var e=t.ref.get(0);e.style.cssText+=";-webkit-transform:rotateZ(0deg)",player.uselessOffsetHeight=e.offsetHeight,e.style.cssText+=";-webkit-transform:none",t.updateMatrixComplete(!0)}),-1<navigator.userAgent.indexOf("AppleWebKit")&&-1<navigator.userAgent.indexOf("Macintosh")&&t.ref.css("border","solid 1px transparent")}};var StateGroup=function(t,e,i){this.container=t||$(document.body),this.slide=e,this.layer=i,this.ref=null,this.constructElement(),this.active=!0,this.visible=!1};StateGroup.prototype=new ItemGroup,StateGroup.prototype.innerType="StateGroup",StateGroup.prototype.loadFromXML=function(t){var e=this;this.id=$(t).attr("id"),this.xml=t,this.loadElementInfoFromXML(t),this.loadSizeFromXML(t),0<$(this.xml).children("dragdrop").length&&("true"==$(e.xml).children("dragdrop").first().attr("dragenabled")&&e.convertToDragItem(e.xml),"true"==$(e.xml).children("dragdrop").first().attr("dropenabled")&&e.convertToDropArea(e.xml),"true"==$(e.xml).children("dragdrop").first().attr("dragoverenabled"))&&(this.announceDragOver=!0,e.setupDragOver(e.xml)),this.loadChildrenFromXML(t,e.slide,e.layer,function(t){t.canSimplify=!1,t.group=e}),this.canSimplify=!1,this.actionstates={},this.actionstateindices={},$(t).children("actionstates").children().each(function(t,i){var r=$(i).attr("name"),a=$(i).children("actions").children();e.actionstates[r]=a,e.actionstateindices[r]=t})},StateGroup.prototype.render=VectorShape.prototype.render,StateGroup.prototype.executeStateActions=function(t){var e=this;(t=e.actionstates[t])&&$.each(t,function(t,i){e.runAction(i)})};var ExpandingLabel=function(t,e,i){this.container=t||$(document.body),this.slide=e,this.layer=i,this.ref=null,this.constructElement(),this.events=[],this.active=!0,this.showContent=this.showTitle=this.visible=!1,this.VAR_EXPANDED="_expanded",this.GROW_TITLE_TIME=250,this.GROW_CONTENT_TIME=500,this.ARROW_HEIGHT=18,this.FILL_BORDER="border",this.FILL_BG="bg",this.borderwidth=1,this.arrowxpos=this.arrowypos=0,this.m_strAlign="top",this.m_nContentHeight=0,this.m_nRadius=8,this.m_nTitleHeight=80,this.m_bHideTitleOnComplete=this.m_bShowContentOnComplete=this.m_bAnimatingContentOut=this.m_bAnimatingContentIn=this.m_bAnimatingTitleOut=this.m_bAnimatingTitleIn=this.m_bContentShowing=this.m_bTitleShowing=!1,this.m_nGrowStartTime=0,this.m_nTextHeight=30,this.m_nMarginRight=this.m_nMarginLeft=5,this.m_nMarginRightTitle=20,this.m_nMarginText=this.m_nMarginBottom=this.m_nMarginTop=5,this.m_nHotspotHeight=0,this.m_bShowCloseButton=!1};ExpandingLabel.prototype=new StageItem,ExpandingLabel.prototype.innerType="ExpandingLabel",ExpandingLabel.prototype.objectType="Item",ExpandingLabel.prototype.extractNextSpecialBool=function(){this.showContent=!0},ExpandingLabel.prototype.getExtraResumeVars=function(){return this.variableResumes.VAR_EXPANDED=!0,this.variableDefaults.VAR_EXPANDED=!1,this.variableTypes.VAR_EXPANDED="bool",{VAR_EXPANDED:this.showContent}},ExpandingLabel.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,ExpandingLabel.prototype.loadFromXML=function(t,e,i){var r=$(t).children("objects");r.remove(),this.loadBaseFromXML(t,e,i),$(t).append(r),this.id=$(t).attr("id"),this.xml=t,this.borderwidth=parseInt($(t).attr("borderwidth")),this.contentheight=parseInt($(t).attr("contentheight")),this.arrowxpos=parseInt($(t).attr("arrowxpos")),this.arrowypos=parseInt($(t).attr("arrowypos")),this.showclosebutton="true"==$(t).attr("showclosebutton"),this.hasContent=0<$(t).children("objects").length,this.width+=8,this.height+=8,0>this.arrowypos?(this.m_strAlign="top",0>this.arrowxpos&&(this.arrowxpos=0),this.arrowxpos>this.width&&(this.arrowxpos=this.width),this.arrowypos=this.ARROW_HEIGHT):this.arrowypos>this.height?(this.m_strAlign="bottom",0>this.arrowxpos&&(this.arrowxpos=0),this.arrowxpos>this.width&&(this.arrowxpos=this.width),this.arrowypos=this.height+this.ARROW_HEIGHT):this.arrowxpos>this.width?(this.m_strAlign="left",this.arrowxpos=this.width+this.ARROW_HEIGHT):0>this.arrowxpos&&(this.m_strAlign="right",this.arrowxpos=this.ARROW_HEIGHT),this.loadChildrenFromXML(t,this.slide,this.layer,function(t){t.canSimplify=!1}),this.canSimplify=!1},ExpandingLabel.prototype.createBaseRef=StageItem.prototype.createRef,ExpandingLabel.prototype.destroyBaseRef=StageItem.prototype.destroyRef,ExpandingLabel.prototype.renderForeground=VectorShape.prototype.renderForeground,ExpandingLabel.prototype.renderVector=VectorShape.prototype.render,ExpandingLabel.prototype.createRef=function(){if(!this.ref){var t=this;this.createBaseRef(),this.ref.addClass("expandinglabel interactive"),this.ref.children().addClass("expandinglabelcontent"),this.expandingLabelContent=this.ref.children(),this.canvasWidth=t.width+2*t.borderwidth+t.ARROW_HEIGHT,this.canvasHeight=t.height+2*t.borderwidth+t.ARROW_HEIGHT;var e=$('<canvas class="content" width="'+this.canvasWidth+'" height="'+this.canvasHeight+'"></canvas>');e.css("position","absolute"),this.ref.append(e),this.backgroundCanvas=e.get(0),e=$('<canvas class="content expandinglabeltitlecanvas" width="'+this.canvasWidth+'" height="'+this.canvasHeight+'"></canvas>'),e.css("position","absolute"),this.ref.append(e),this.jcanvas=e,this.canvas=e.get(0),this.contentRef=$('<div class="item unhideable expandinglabeltitle"></div>'),this.contentRef.css("width","100%"),this.ref.prepend(this.contentRef),this.ref.css("width",t.width),this.ref.css("height",t.height),this.visible=!1,this.hide(),setTimeout(function(){var e=t.id.replace("_expandinglabel","");t.button=t.parent.children[e],t.button.ref&&t.button.ref.addClass("interactive")},0)}},ExpandingLabel.prototype.show=function(t,e,i){if(this.createRef(this.parent.ref),this.visible){var r=this;e?i&&0!=e.duration||(this.visible=!0,this.variables.Expanded="true",r.ref.show(),r.handleEvent("ontransitionin",null,null,!1,!0),e.setTarget(this),e.apply(function(){r.handleEvent("ontransitionincomplete",null,null,!1,!0)})):(this.visible=!0,this.variables.Expanded="true",r.ref.show(),r.handleEvent("ontransitionin",null,null,!1,!0),r.handleEvent("ontransitionincomplete",null,null,!1,!0))}},ExpandingLabel.prototype.hide=function(t,e){this.visible=!1,this.variables.Expanded="false";var i=this;i.handleEvent("ontransitionout",null,null,!1,!0),e?(e.setTarget(this),e.apply(function(){i.ref&&i.ref.hide(),i.handleEvent("ontransitionoutcomplete",null,null,!1,!0)})):(this.ref&&this.ref.hide(),i.handleEvent("ontransitionoutcomplete",null,null,!1,!0))},ExpandingLabel.prototype.render=function(t,e){if(this.renderVector(t,e),this.ref){var i=this.width,r=this.showContent||!this.hasContent?this.height:this.m_nTextHeight+this.m_nMarginTop+this.m_nMarginBottom;yoffset=xoffset=0;var a=this.arrowypos;this.showContent?(this.ref.css("top",this.y),this.expandingLabelContent.show()):("right"==this.m_strAlign||"left"==this.m_strAlign?(a=this.arrowypos/this.height*r,this.ref.css("top",this.y+this.arrowypos-a)):"bottom"==this.m_strAlign&&this.ref.css("top",this.y+this.height-r),this.expandingLabelContent.hide());var s=this.backgroundCanvas.getContext("2d");switch(s.lineWidth=this.borderwidth,this.colors[this.FILL_BORDER].applyCanvas(s,this,!1,!0),this.colors[this.FILL_BG].applyCanvas(s,this,!0,!1),s.clearRect(0,0,this.canvasWidth,this.canvasHeight),s.save(),s.translate(s.lineWidth/2,s.lineWidth/2),s.beginPath(),$(this.canvas).css("margin","8px 8px 0px "+(s.lineWidth+8)+"px"),this.m_strAlign){case"top":s.translate(0,this.ARROW_HEIGHT),$(this.backgroundCanvas).css("margin-top",-this.ARROW_HEIGHT+"px"),this.DrawBottomCaption(s,0,-this.ARROW_HEIGHT,i,r,this.m_nRadius,this.arrowxpos,this.ARROW_HEIGHT);break;case"bottom":$(this.canvas).css("margin-top","-8px"),$(this.backgroundCanvas).css("margin-top","-8px"),this.DrawTopCaption(s,0,0,i,r,this.m_nRadius,this.arrowxpos,this.ARROW_HEIGHT);break;case"left":$(this.canvas).css("margin-left",s.lineWidth-8+"px"),$(this.backgroundCanvas).css("margin-left","-8px"),this.DrawLeftCaption(s,0,0,i,r,this.m_nRadius,a,this.ARROW_HEIGHT);break;case"right":s.translate(this.ARROW_HEIGHT,0),$(this.backgroundCanvas).css("margin-left",-this.ARROW_HEIGHT+"px"),this.DrawRightCaption(s,-this.ARROW_HEIGHT,0,i,r,this.m_nRadius,a,this.ARROW_HEIGHT)}s.fill(),s.stroke(),s.restore(),this.renderForeground()}},ExpandingLabel.prototype.hideOthers=function(){var t=this;$(".expandinglabel").each(function(e,i){i.item&&i.item!=t&&i.item.hide()})},ExpandingLabel.prototype.togglecontent=function(){this.showContent=!this.showContent,this.variables.Expanded=this.showContent.toString(),this.showContent?($(".above").removeClass("above"),$(".showing").removeClass("showing"),this.hideOthers(),this.render(null,!0,this.width,this.height),this.visible=!0,this.show(),this.ref.addClass("above showing"),this.button.ref.addClass("above showing"),this.handleEvent("onobjectevent","contentin",null,!1,!1,!0)):(this.hide(),$(".above").removeClass("above"),this.handleEvent("onobjectevent","contentout",null,!1,!1,!0))},ExpandingLabel.prototype.showcomplete=function(){this.showContent=!0,this.variables.Expanded=this.showContent.toString(),$(".above").removeClass("above"),$(".showing").removeClass("showing"),this.hideOthers(),this.render(null,!0,this.width,this.height),this.visible=!0,this.show(),this.ref.addClass("above showing"),this.button.ref.addClass("above showing"),this.handleEvent("onobjectevent","contentin")},ExpandingLabel.prototype.hidecomplete=function(){this.variables.Expanded="false",this.hide(),$(".above").removeClass("above"),this.showTitle=this.showContent=!1},ExpandingLabel.prototype.showtitle=function(){if(!this.showContent){var t=this.m_nTextHeight+this.m_nMarginTop+this.m_nMarginBottom,e=this.height-t;this.showTitle=this.visible=!0,this.showContent=!1,this.variables.Expanded="false",this.show(),$(".above").removeClass("above"),this.ref.addClass("above"),this.button.ref.addClass("above"),this.render(null,!0,this.width,t,0,e)}},ExpandingLabel.prototype.hidetitle=function(){this.showContent||(this.showContent=this.showTitle=this.visible=!1,this.variables.Expanded="false",this.hide(),$(".above").removeClass("above"))},ExpandingLabel.prototype.DrawTopCaption=function(t,e,i,r,a,s,n,o){0>s&&(s=0);var l=s+o/2>=n,h=n>=r-(s+o/2),p=n-o/2,c=r-(n+o/2),d=0;l&&(p=n,c=r-(n+o)),h&&(p=n-o,c=r-n),0>p&&(p=0),0>c&&(c=0),p>r&&(p=r),c>r&&(c=r);var n=o/2,u=0,u=s;p+o>r&&(d=o,o=d-(p+d-r)/2,p-=(p+d-r)/2),c+o>r&&(d=o,o=d-(c+d-r)/2,c-=(c+d-r)/2),d=r-c,s>c&&(d=r-s),t.moveTo(e+d,i),t.lineTo(e+r-u,i),t.arcTo(e+r,i,e+r,i+u,u),u=s,s>c&&(u=c),t.lineTo(e+r,i+a-u),t.arcTo(e+r,i+a,e+r-u,i+a,u),u=s,t.lineTo(e+r-c,i+a),s>p&&(u=p),l?t.lineTo(e+p,i+a+o):h?t.lineTo(e+r-c,i+a+o):t.lineTo(e+p+n,i+a+o),t.lineTo(e+p,i+a),t.lineTo(e+u,i+a),t.arcTo(e,i+a,e,i+a-u,u),u=s,t.lineTo(e,i+u),t.arcTo(e,i,e+u,i,u),t.lineTo(e+d,i)},ExpandingLabel.prototype.DrawBottomCaption=function(t,e,i,r,a,s,n,o){0>s&&(s=0);var l=s+o/2>=n,h=n>=r-(s+o/2),p=n-o/2,c=r-(n+o/2),d=0;l&&(p=n,c=r-(n+o)),h&&(p=n-o,c=r-n),0>p&&(p=0),0>c&&(c=0),p>r&&(p=r),c>r&&(c=r);var n=o/2,u=0,u=s;s>c&&(u=c),p+o>r&&(d=o,i+=(p+d-r)/2,o=d-(p+d-r)/2,p-=(p+d-r)/2),c+o>r&&(d=o,i+=(c+d-r)/2,o=d-(c+d-r)/2,c-=(c+d-r)/2),d=r-c,t.moveTo(e+d,i+o),t.lineTo(e+r-u,i+o),t.arcTo(e+r,i+o,e+r,i+o+u,u),u=s,t.lineTo(e+r,i+a+o-u),t.arcTo(e+r,i+o+a,e+r-u,i+a+o,u),u=s,t.lineTo(e+u,i+o+a),t.arcTo(e,i+a+o,e,i+a+o-u,u),u=s,s>p&&(u=p),t.lineTo(e,i+o+u),t.arcTo(e,i+o,e+u,i+o,u),t.lineTo(e+p,i+o),l?t.lineTo(e+p,i):h?t.lineTo(e+r-c,i):t.lineTo(e+p+n,i),t.lineTo(e+d,i+o)},ExpandingLabel.prototype.DrawLeftCaption=function(t,e,i,r,a,s,n,o){0>s&&(s=0);var l=o/2>=n,h=n>=a-o/2,p=n-o/2,c=a-(n+o/2),d=0;if(l&&(p=n,c=a-(n+o)),h&&(p=n-o,c=a-n),0>p&&(p=0),0>c&&(c=0),p>a&&(p=a),c>a&&(c=a),d=s,n=r/2,t.moveTo(e+n,i),d=s,s>p&&(d=p),t.lineTo(e+r-d,i),t.arcTo(e+r,i,e+r,i+d,d),c+o>a&&(d=o,o=d-(c+d-a)/2,c-=(c+d-a)/2),p+o>a)var u=p,d=o,p=u-(u+d-a)/2,o=d-(u+d-a)/2;t.lineTo(e+r,i+p),l?t.lineTo(e+r+o,i+p):h?t.lineTo(e+r+o,i+a-c):t.lineTo(e+r+o,i+p+o/2),t.lineTo(e+r,i+p+o),d=s,s>c&&(d=c),t.lineTo(e+r,i+a-d),t.arcTo(e+r,i+a,e+r-d,i+a,d),d=s,t.lineTo(e+d,i+a),t.arcTo(e,i+a,e,i+a-d,d),d=s,t.lineTo(e,i+d),t.arcTo(e,i,e+d,i,d),t.lineTo(e+n,i)},ExpandingLabel.prototype.DrawRightCaption=function(t,e,i,r,a,s,n,o){0>s&&(s=0);var l=o/2>=n,h=n>=a-o/2,p=n-o/2,c=a-(n+o/2),d=0;l&&(p=n,c=a-(n+o)),h&&(p=n-o,c=a-n),0>p&&(p=0),0>c&&(c=0),p>a&&(p=a),c>a&&(c=a),d=s,n=r/2,t.moveTo(e+o+n,i),t.lineTo(e+o+r-d,i),t.arcTo(e+o+r,i,e+o+r,i+d,d),t.lineTo(e+o+r,i+a-d),t.arcTo(e+o+r,i+a,e+o+r-d,i+a,d),d=s,s>c&&(d=c),t.lineTo(e+o+d,i+a),t.arcTo(e+o,i+a,e+o,i+a-d,d),c+o>a&&(d=o,e+=(c+d-a)/2,o=d-(c+d-a)/2,c-=(c+d-a)/2),p+o>a&&(r=p,d=o,e+=(r+d-a)/2,p=r-(r+d-a)/2,o=d-(r+d-a)/2),t.lineTo(e+o,i+a-c),l?t.lineTo(e,i+p):h?t.lineTo(e,i+a-c):t.lineTo(e,i+p+o/2),t.lineTo(e+o,i+p),d=s,s>p&&(d=p),t.lineTo(e+o,i+d),t.arcTo(e+o,i,e+o+d,i,d),t.lineTo(e+o+n,i)};var SequenceCtrl=function(t,e,i){this.container=t||$(document.body),this.ref=null,this.constructElement(),this.slide=e,this.layer=i,this.constructElement(),this.events=[],this.active=!0,this.visible=!1,this.currentIndex=0,this.content={},this.colors={},this.active=!0,this.id=Math.random(),this.name="item",this.visible=this.layered=!1,this.canSimplify=!0,this.hasEvents=!1,this.xml="",this.deferredResourceIndex=0,this.padY=20,this.padX=25,this.originalIndex=this.dropIndex=-1,this.indexedChildren=[]};SequenceCtrl.prototype=new StageItem,SequenceCtrl.prototype.objectType="Item",SequenceCtrl.prototype.innerType="SequenceCtrl",SequenceCtrl.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,SequenceCtrl.prototype.shuffleRows=ShuffleGroup.prototype.shuffleRows,SequenceCtrl.prototype.shuffleElements=ShuffleGroup.prototype.shuffleElements,SequenceCtrl.prototype.getRandomMember=ShuffleGroup.prototype.getRandomMember,SequenceCtrl.prototype.getRandomIndex=ShuffleGroup.prototype.getRandomIndex,SequenceCtrl.prototype.swapRow=ShuffleGroup.prototype.swapRow,SequenceCtrl.prototype.swapItem=ShuffleGroup.prototype.swapItem,SequenceCtrl.prototype.extractNextSpecialVar=function(t){for(var t=bwChunk.CreateChunk(t),t=new bwChunk(t),e=0,i=0;!t.EOF();){var r=this.indexedChildren[t.NextUBase10(1)];r.y=e,this.variables["_pos"+i]=r.itemdata,e+=r.height+this.padY,i++}},SequenceCtrl.prototype.getExtraResumeVars=function(){this.variableResumes.VAR_ITEM_ORDER=!0,this.variableDefaults.VAR_ITEM_ORDER="",this.variableTypes.VAR_ITEM_ORDER="string";var t="";if(this.ref){var e=this.getOrderedItemList();$.each(e,function(e,i){t+=bwChunk.UBase10toN(i.sequenceIndex)})}return{VAR_ITEM_ORDER:t}},SequenceCtrl.prototype.loadFromXML=function(t,e,i){var r=this;this.loadBaseFromXML(t,e,i),this.loadSizeFromXML(t),this.shortid=$(t).attr("id").replace("list_",""),this.parent.children[this.shortid]=this,this.canSimplify=!1;var a=10;$(t).children("data").children("itemlist").children().each(function(t,i){var s=new SequenceItem(r.ref,e);s.offsetY=a,s.offsetX=r.padX,s.sequenceIndex=t,s.loadFromXML(i,e),s.width=r.width-r.padX-r.padX,s.parent=r,s.offsetParent=r,r.children[s.id]=s,r.indexedChildren[t]=s,a+=s.height+r.padY,r.indicatorWidth=s.width,r.indicatorOffsetX=s.x})},SequenceCtrl.prototype.createBaseRef=StageItem.prototype.createRef,SequenceCtrl.prototype.createRef=function(){var t=this;if(!t.ref){this.container=this.parent.ref,this.ref=$('<div class="item sequencectrl interactive"></div>'),this.container.append(this.ref),this.applySize(this.ref),this.indicator=$('<div class="sequenceindicator"></div>'),this.indicator.css("width",this.width),this.container.append(this.indicator),this.contentRef=this.ref,this.ref.get(0).item=this,this.indicator.css("left",this.x+this.indicatorOffsetX),this.indicator.css("width",this.indicatorWidth);var e=0;$.each(t.children,function(i,r){r.createRef(),t.appendLineNumber(e++,r)}),this.shuffleRows(),this.ref.bind("scroll",function(){var e=t.ref.get(0);e.scrollHeight<=e.scrollTop+t.height&&(t.hasScrolledToEnd=!0),e=t.ref.get(0),e.style.cssText+=";-webkit-transform:rotateZ(0deg)",player.uselessOffsetHeight=e.offsetHeight,e.style.cssText+=";-webkit-transform:none",t.updateMatrixComplete(!0)}),this.slide.ref.bind("scroll",function(){this.scrollLeft=this.scrollTop=0}),this.updateScore()}},SequenceCtrl.prototype.appendLineNumber=function(t,e){var i=e.offsetY,r=$('<div class="sequencelinenumber"></div>');r.text(t+1+"."),r.css("top",-1e3),$(document.body).append(r);var a=r.height();a>0&&a<e.height&&(i+=(e.height-a)/2),r.css("top",i),this.variables.ReviewMode&&r.addClass("correct"),this.ref.append(r)},SequenceCtrl.prototype.getOrderedItemList=function(){var t=[];return $.each(this.children,function(e,i){for(var r=!1,a=0;a<t.length;a++)if(!r&&i.y<t[a].y){t.splice(a,0,i),r=!0;break}r||t.push(i)}),t},SequenceCtrl.prototype.updateScore=function(){var t=this,e=t.getOrderedItemList();$.each(e,function(e,i){t.variables["_pos"+e]=i.itemdata,i.currentIndex=e})},SequenceCtrl.prototype.set_review=function(){var t=this.ref.children(".sequencelinenumber"),e=this.getOrderedItemList();$.each(e,function(e,i){i.sequenceIndex==e?$(t[e]).addClass("correct"):$(t[e]).addClass("incorrect")})},SequenceCtrl.prototype.showBase=StageItem.prototype.show,SequenceCtrl.prototype.show=function(t,e,i,r){this.parent.ref&&(this.render(),this.showBase(t,e,i,r),r||$.each(this.children,function(r,a){a.show&&(a.ref.show(),a.render(),a.show(t,e,i))}))},SequenceCtrl.prototype.Viewed=function(){return"true"},SequenceCtrl.prototype.Viewed=function(){return this.ref&&(this.ref.get(0).scrollHeight<=this.height||this.hasScrolledToEnd)?"true":"false"};var SequenceItem=function(t){this.container=t||$(document.body),this.ref=null,this.constructElement(),this.currentIndex=0,this.content={},this.colors={},this.type="item",this.active=!0,this.id=Math.random(),this.name="item",this.visible=this.layered=!1,this.canSimplify=!0,this.hasEvents=!1,this.xml="",this.offsetY=this.offsetX=this.deferredResourceIndex=0,this.canvas=null,this.m_nYOffset=this.m_nXOffset=0,this.m_nHeight=this.m_nWidth=1e3};SequenceItem.prototype=new StageItem,SequenceItem.prototype.objectType="Item",SequenceItem.prototype.innerType="SequenceItem",SequenceItem.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,SequenceItem.prototype.loadFromXML=function(t,e,i){this.loadBaseFromXML(t,e,i),this.id=$(t).attr("itemdata").split("_")[1],this.itemdata=$(t).attr("itemdata"),this.width=parseInt($(t).children("textdata").first().attr("width")),this.height=parseInt($(t).children("textdata").first().attr("height")),this.x=this.offsetX,this.y=this.offsetY,this.originalWidth=this.width,this.originalHeight=this.height,this.canSimplify=!1,e=new Background(this.ref),e.rotation="90",e.fillType="linear",e.stops.push(e.parseStop('<color rgb="0xBBF8FB" alpha="100" stop="0" />')),e.stops.push(e.parseStop('<color rgb="0xA5E8EB" alpha="100" stop="100" />')),this.colors.hover=e,e=$(t).children("textdata"),t=$(t).children("textdata").children("vectortext"),i=t.children("pr"),1==i.length&&(this.textSprite={canvas:null,m_nXOffset:0,m_nYOffset:0,width:1e3,height:1e3,charIndex:0,maxCharIndex:0,vectorHot:!1,isShapeMask:!1},null!=$(t).attr("top")&&(this.textSprite.x=$(e).attr("xpos"),this.textSprite.y=$(e).attr("ypos"),this.textSprite.width=$(e).attr("width"),this.textSprite.height=$(e).attr("height"),this.textSprite.rectShape=new ppRect(parseInt($(t).attr("left")),parseInt($(t).attr("top")),parseInt($(t).attr("right")),parseInt($(t).attr("bottom"))),this.textSprite.rectShape.right=Math.max(this.textSprite.rectShape.right,this.width),this.textSprite.rectShape.bottom=Math.max(this.textSprite.rectShape.bottom,this.height),this.textSprite.originalRectShape=this.rectShape),this.textSprite.path=PathLib.getPathFromXML(i))},SequenceItem.prototype.createBaseRef=StageItem.prototype.createRef,SequenceItem.prototype.createRef=function(){if(this.ref)this.render();else{this.container=this.parent.ref,this.ref=$('<div class="item sequenceitem interactive"></div>'),this.container.append(this.ref),this.ref.css("left",this.x+"px"),this.ref.css("top",this.y+"px"),this.ref.css("width",this.width+"px"),this.ref.css("height",this.height+"px"),this.contentRef=$('<div class="item unhideable"></div>'),this.contentRef.css("margin","4px 20px");var t=$('<canvas class="content"></canvas>');t.css("position","relative"),this.ref.append(t),this.canvas=t.get(0),$(this.ref).css("width",this.width),$(this.ref).css("height",this.height),$(this.canvas).attr("width",this.width),$(this.canvas).attr("height",this.height),this.textSprite?(t=$("<canvas></canvas>"),t.css("position","absolute"),t.css("left",this.textSprite.x+"px"),t.css("top",this.textSprite.y+"px"),t.attr("width",this.width+"px"),t.attr("height",this.height+"px"),t.attr("id",this.id+"_text"),this.ref.append(t),this.textSprite.canvas=t.get(0),this.textRef=t):this.ref.append(this.contentRef),this.textTemplate="<span>"+this.textlib.children("textdata").attr("lmstext")+"</span>",this.renderTextTemplate(),this.ref.get(0).item=this,this.convertToDragItem(this.xml),this.style="sequence",this.dragreturn=!0,this.initDrag(),this.render=SequenceItem.prototype.renderOverride,this.updateDragPosition=SequenceItem.prototype.updateDragPositionOverride,this.findDropArea=SequenceItem.prototype.findDropAreaOverride,this.mouseupCallback=SequenceItem.prototype.Drop,this.show()}},SequenceItem.prototype.updateDragPositionOverride=function(){this.ghost||(this.ghost=this.ref.clone(),this.ghost.css("opacity",.7),this.ghost.css("z-index",1e3),this.parent.container.append(this.ghost),this.ghostCanvas=this.ghost.find("canvas").get(0));var t=this.parent.ref.get(0).scrollTop,e=this.x+this.dragX+this.parent.x,t=this.getScrolledY()+this.parent.y-t;this.ghost.show(),this.ghost.css("left",e),this.ghost.css("top",t),this.render("",this.ghostCanvas),this.render("hover",this.canvas)},SequenceItem.prototype.renderCallback=function(){},SequenceItem.prototype.renderOverride=function(t,e){var e=e||this.canvas,i=e.getContext("2d"),r=parseInt(900*Math.random()+1100)%1e3;i.fillStyle="#"+r,i.fillStyle="#fff",i.lineWidth=1,i.strokeStyle="#C7C7C7",r=i.createLinearGradient(0,0,0,this.height),r.addColorStop(0,"#fcfcfc"),r.addColorStop(1,"#eaeaea"),i.fillStyle=r,this.colors[t]&&this.colors[t].applyCanvas(i,this,!0,!1),r=this.height/2,i.beginPath(),i.moveTo(r+.5,.5),i.lineTo(this.width-r-.5,.5),i.arc(this.width-r-.5,r,r,3*Math.PI/2,Math.PI/2),i.lineTo(r+.5,this.height-.5),i.arc(r+.5,r,r,Math.PI/2,3*Math.PI/2),i.fill(),i.save(),i.clip(),i.strokeStyle="#fff",i.lineWidth=3.4,i.stroke(),i.restore(),this.colors[t]&&(i.strokeStyle=this.colors[t].stops[0].color),i.stroke(),this.textSprite&&(i=new ppTextLib(this.xml),ppArt.itemID=this.id,ppArt.item=this,ppArt.m_bMaskMode=!1,ppArt.DrawVector(this.textSprite,this.textSprite.path,i,player.fontlib,this.imagelib,null,null))},SequenceItem.prototype.getScrolledY=function(){var t=this.downScrollTop||0;return this.y+this.dragY+this.parent.ref.get(0).scrollTop-t},SequenceItem.prototype.findDropAreaOverride=function(){for(var t=this.parent.getOrderedItemList(),e=-1,i=this.getScrolledY(),r=this.parent.y,a=t.length-1;a>=0;a--){var s=t[a];i<s.y+s.height/2&&(e=a,r=this.parent.y+s.y-this.parent.padY/2),s==this&&(this.parent.originalIndex=a)}-1==e&&(s=t[t.length-1],r=this.parent.y+s.y+s.height+this.parent.padY/2),r-=this.parent.ref.get(0).scrollTop,this.parent.indicator.show(),this.parent.indicator.css("top",r),this.parent.dropIndex=e,player.lastSequenceDropIndex=e},SequenceItem.prototype.Drop=function(){if(-1==this.parent.originalIndex)this.parent.indicator.hide(),this.ghost.hide();else{this.parent.dropIndex!=player.lastSequenceDropIndex&&(this.parent.dropIndex=player.lastSequenceDropIndex),this.parent.indicator.hide(),this.ghost.hide();var t=this.parent.getOrderedItemList();if(-1==this.parent.dropIndex&&(this.parent.dropIndex=t.length),this.parent.dropIndex!=this.parent.originalIndex)for(var e=this.parent.dropIndex>this.parent.originalIndex?1:-1,i=this.parent.dropIndex>this.parent.originalIndex?0:-1,r=this.parent.originalIndex;r!=this.parent.dropIndex+i;r+=e)this.parent.swapItem(this,t[r]);this.variables._checked="true",this.parent.updateScore(),this.parent.dropIndex=-1,this.parent.originalIndex=-1}this.render()};var HotspotMarker=function(t){this.container=t||$(document.body),this.ref=null,this.constructElement(),this.xml="",this.angle=0,this.speed=.05};HotspotMarker.prototype=new StageItem,HotspotMarker.prototype.objectType="Item",HotspotMarker.prototype.innerType="HotspotMarker",HotspotMarker.prototype.toBaseData=Element.prototype.toData,HotspotMarker.prototype.toData=function(t){return t=this.toBaseData(t),this.x!=this.originalX&&(t.x=this.x),this.y!=this.originalY&&(t.y=this.y),t},HotspotMarker.prototype.updateBaseFromData=Element.prototype.updateFromData,HotspotMarker.prototype.updateFromData=function(t){this.updateBaseFromData(t),t.x&&(this.x=t.x),t.y&&(this.y=t.y)},HotspotMarker.prototype.loadBaseFromXML=StageItem.prototype.loadFromXML,HotspotMarker.prototype.loadFromXML=function(t,e,i){this.loadBaseFromXML(t,e,i),this.originalX=this.x,this.originalY=this.y,this.height=this.width=38,this.spinnerRadius=5,this.ring1Radius=7,this.ring2Radius=16},HotspotMarker.prototype.createBaseRef=StageItem.prototype.createRef,HotspotMarker.prototype.createRef=function(){if(this.ref)this.render();else{var t=this;this.createBaseRef(),this.ref.addClass("hotspotmarker"),this.ref.css("margin-left",-this.width/2),this.ref.css("margin-top",-this.height/2);var e=$("<canvas></canvas>");e.attr("width",this.width),e.attr("height",this.height),this.ref.append(e),this.jcanvas=e,this.canvas=e.get(0);var e=parseInt(this.parent.variables[this.id.replace("_marker","_xpos")]),i=parseInt(this.parent.variables[this.id.replace("_marker","_ypos")]);!isNaN(e)&&e>-1?(this.ref.css("left",e),this.ref.css("top",i),setTimeout(function(){t.ref.show()},100)):(this.ref.css("left",-100),this.ref.css("top",-100)),this.spinning||(this.step(),this.spinning=!0),this.ref.show()}},HotspotMarker.prototype.render=function(){function t(t){return t=t%6/4,t>1&&(t=0),t>.5&&(t=1-t),0>t&&(t=0),t}if(this.ref){var e=this.canvas.getContext("2d"),i=this.width/2-2;e.clearRect(0,0,this.width,this.height),e.save(),e.translate(i+2,i+2),e.rotate(this.angle),e.beginPath(),e.arc(0,0,this.spinnerRadius,0,2*Math.PI),e.fillStyle="#000",e.fill(),e.beginPath(),e.moveTo(0,0),e.arc(0,0,this.spinnerRadius,0,Math.PI/2),e.lineTo(0,0),e.arc(0,0,this.spinnerRadius,Math.PI,3*Math.PI/2),e.fillStyle="#fff",e.fill();var i=t(this.angle+.5),r=t(this.angle);i>0&&(e.strokeStyle="rgba(0,255,255,0)",e.strokeStyle="rgba(100,255,255,"+i+")",e.lineWidth=4,e.beginPath(),e.arc(0,0,this.ring1Radius,0,2*Math.PI),e.stroke(),e.beginPath(),e.strokeStyle="rgba(100,255,255,"+r+")",e.arc(0,0,this.ring2Radius,0,2*Math.PI),e.stroke()),e.restore()}},HotspotMarker.prototype.step=function(){var t=this;if(this.ref){this.angle+=this.speed,this.render();var t=this,e=t.ref.get(0);t.ref.show(),setTimeout(function(){t.ref&&t.ref.show()},100)}HotspotMarker.requestAnimFrame()(function(){t.step()},e)},HotspotMarker.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}};var SWFItem=function(t,e,i){this.container=t||$(document.body),this.slide=e,this.layer=i,this.ref=null,this.constructElement(),this.currentIndex=0,this.content={},this.colors={},this.type="swf",this.active=!0,this.id=Math.random(),this.name="item",this.visible=this.layered=!1,this.canSimplify=!0,this.hasEvents=!1,this.xml=""};SWFItem.prototype=new StageItem,SWFItem.prototype.objectType="Item",SWFItem.prototype.innerType="SWFItem",SWFItem.prototype.createBaseRef=StageItem.prototype.createRef,SWFItem.prototype.destroyBaseRef=StageItem.prototype.destroyRef,SWFItem.prototype.createRef=function(){this.ref?this.container.append(this.ref):(this.container=this.parent.ref)&&(this.ref=$('<div class="item swf unsupported"><h1>Not Supported</h1>SWF objects cannot be rendered by the HTML5 player.</div>'),this.ref.addClass(this.type),this.applySize(this.ref),this.container.append(this.ref),this.ref.get(0).item=this)},SWFItem.prototype.renderCallback=function(){},SWFItem.prototype.render=function(){};var Resource=function(t,e,i){this.item=t,this.src=e,this.loading=this.loaded=this.prepared=!1,this.callback=i,this.poolImage=null};Resource.ImagePool=[],Resource.LoadedImagesLog={},Resource.TotalPixels=0,Resource.LoadedImageCount=0,Resource.prototype.load=function(t,e){if(!t&&0!=t)throw"undefined index "+t;var i=this;if(this.loaded||this.deferLoading)i.execCallback(e);else if(!this.loading)switch(this.item.type){case"audio":case"video":i.execCallback(e);break;default:var r=Resource.LoadedImagesLog[i.src];if(r){i.item.imageWidth=r.get(0).width,i.item.imageHeight=r.get(0).height,i.poolImage=r,i.item.imagelib&&$.each(i.item.imagelib.m_listImages,function(t,e){i.imgLibID==e.Id&&(e.width=i.item.imageWidth,e.height=i.item.imageHeight,e.imgNode=r.get(0))}),i.loaded=!0,i.execCallback(e),i.unbind();break}i.poolImage||(i.poolImage=$("<img class='loader'/>")),i.poolImage.load(function(){i.item.imageWidth=i.poolImage.get(0).width||i.poolImage.get(0).naturalWidth,i.item.imageHeight=i.poolImage.get(0).height||i.poolImage.get(0).naturalHeight,
Resource.LoadedImagesLog[i.src]=i.poolImage,Resource.TotalPixels+=i.item.imageWidth*i.item.imageHeight,Resource.LoadedImageCount++,i.loaded||(i.loaded=!0,i.execCallback(e)),i.unbind()}),i.poolImage.error(function(){return i.item.ref&&i.item.ref.addClass("missing"),i.loaded=!0,i.execCallback(e),i.unbind(),!1}),i.timeout=setTimeout(function(){i.loaded||(i.item.ref&&i.item.ref.addClass("missing"),i.loaded=!0,i.execCallback(e)),i.unbind()},1e4),i.poolImage.attr("src",i.src),this.loading=!0}},Resource.prototype.unload=function(){},Resource.prototype.unbind=function(){this.poolImage.unbind("load"),this.poolImage.unbind("error"),clearTimeout(this.timeout)},Resource.prototype.prep=function(){this.item.prep&&(this.item.prep(),this.prepared=!0)},Resource.prototype.execCallback=function(t){t&&t(this),this.callback&&this.callback(this)};var TimelineEvent=function(t){this.actions=[],this.time=0,this.type="TimelineEvent",this.parentElement=t};TimelineEvent.prototype.loadFromXML=function(t){var e=this;e.time=parseInt($(t).attr("time")),$(t).children("actions").children().each(function(t,i){var r=new TimelineAction(e.parentElement);r.loadFromXML(i,e),e.actions.push(r)})},TimelineEvent.prototype.act=function(t,e){this.isUserInitiated=!1;var i=this,r=!0;$.each(this.actions,function(a,s){(!t||"media_play"!=s.type&&"media_seek"!=s.type&&"media_toggle"!=s.type)&&r&&(r=s.act(i,null,t,e,!1))})},TimelineEvent.prototype.getMediaDuration=function(){var t=0;return $.each(this.actions,function(e,i){if("media_play"==i.type||"media_seek"==i.type||"media_toggle"==i.type){var r=i.getItem();r.content.duration&&(t=r.content.duration)}}),t},TimelineEvent.prototype.revert=function(){$.each(this.actions,function(t,e){e.revert()})};var TimelineAction=function(t){this.type="show",this.transition=null,this.itemID="",this.item=null,this.xml="",this.variables={},this.parentElement=t};TimelineAction.prototype.loadFromXML=function(t,e){if(this.type=t.tagName,this.originalItemID=this.itemID=$(t).children("objref").attr("value"),"setfocus"==this.type&&(this.itemID=$(t).find("value").attr("value")),this.itemID&&-1<this.itemID.indexOf(".")){var i=this.itemID.split(".");this.itemID=i[i.length-1]}this.transition=new Transition,this.transition.loadFromXML(t),this.xml=t,(i=this.getItem())&&("StoryEvent"==e.type?i.canSimplify=!1:0!=e.time?i.canSimplify=!1:this.transition&&0!=this.transition.duration&&(i.canSimplify=!1))},TimelineAction.prototype.getItemPack=function(){return this.parentElement.parseObjref(this.originalItemID)},TimelineAction.prototype.getItem=function(){return this.parentElement.parseObjref(this.originalItemID).target},TimelineAction.prototype.act=function(t,e,i,r){var a=!0;return e&&this.getItem()&&this.getItem(),e=e||this.getItem()||this.parentElement||story,"function"==typeof this[this.type]?this[this.type](t,e,i,r):e?a=e.runAction(this.xml):"TimelineEvent"==t.type&&(a=player.currentSlide().runAction(this.xml)),a},TimelineAction.prototype.revert=function(){var t=this.getItem();switch(this.type){case"show":t&&"audio"!=t.type&&t.hide()}},TimelineAction.prototype.show=function(t,e,i,r){var e=this.getItemPack(),a=e.target;!e.isVariableRef&&a&&(e=a,a=this.transition,r&&(a=null),"Slide"!=e.innerType&&e.show(t,a,i))},TimelineAction.prototype.hide=function(t,e,i,r){i=this.getItemPack(),e=i.target,i.isVariableRef||(e?(i=this.transition,r&&(i=null),e.hide(t,i)):trace.logMulti("should hide",this.itemID,e))},TimelineAction.prototype.hideallslidelayers=function(){$(".layer").hide(),$.each(player.currentSlide().layers,function(t,e){e.hide()})},TimelineAction.prototype.hide_slidelayer=function(t,e){var i=e.parseObjrefFromXML(this.xml),r=i.target;i.isVariableRef||(r.hide(this.transition),r.transitioning&&r.ref.hide())},TimelineAction.prototype.show_slidelayer=function(t,e){var i=e.parseObjrefFromXML(this.xml),r=i.target;if(!i.isVariableRef){var a="true"==$(this.xml).attr("hideothers"),i=!r.visible;a&&$.each(player.currentSlide().layers,function(t,e){e!=r&&e.hide()}),a=new Transition(r),a.loadFromXML(this.xml),r.show(a),i&&r.update(0),r.depth<r.slide.topZ&&(r.depth=++r.slide.topZ),r.setZIndex(r.depth,!0)}},TimelineAction.prototype.media_seek=function(t,e){var i=this.getItem();if(i&&(e=i),e&&e.setCurrentTime){var r=i=parseInt($(this.xml).attr("position"));"TimelineEvent"==t.type&&((r=e.getTimelineAncestor())||(r=player.currentSlide()),r=i+r.currentTime-t.time),e.shouldSetPosition=!1,i=0;try{i=Math.abs(1e3*clip.currentTime-r)}catch(a){}if(i>100){e.correctedPosition=r,e.shouldSetPosition=!0;try{e.setCurrentTime(r/1e3),e.shouldSetPosition=!1}catch(s){}}}},TimelineAction.prototype.set_volume=function(t,e){var i=this.getItem();i&&(e=i),i=parseInt($(this.xml).attr("volume")),player.clipVolume=i/100,i=util.min(i,100),i=util.max(i,0);try{e.ref.get(0).volume=i/100*player.volumeSlider.volume/100}catch(r){}},TimelineAction.prototype.media_toggle=function(t,e){var i=this.getItem();i&&(e=i),e&&(i=e.ref.get(0),!e.media_toggled&&i.paused?(e.media_toggled=!0,this.media_play(t,e)):(e.media_toggled=!1,this.media_pause(t,e)))},TimelineAction.prototype.media_play=function(t,e){var i=this.getItem();i&&(e=i),e&&(t&&"StoryEvent"==t.type&&t.isUserInitiated&&e.prep(),e.playClip)&&(this.getItem().mediaReady()||(player.blockedOn=this.getItem(),player.block()),e.isSuppressedCaptureAnimation?e.playClip():(clearTimeout(player.mediaTimeout),player.scheduledMediaSrc=e.content.src,e.setScheduled(!0),player.mediaTimeout=setTimeout(function(){player.mediaTimeout=null,player.scheduledMediaSrc=null,e.setScheduled(!1),e.playClip(),player.currentClip=e.getClip(),player.currentClipStartTime=t.time,player.currentClipSyncToTimeline="TimelineEvent"==t.type},0)))},TimelineAction.prototype.media_pause=function(t,e){if(e){var i=this.getItem();i.pauseClip(),i.media_toggled=!1}},TimelineAction.prototype.move=function(t,e,i){if(!i&&e){if(!this.path){this.path=new BezierPath,this.path.loadFromXML(this.xml,e),this.animationName="animation_"+e.id;var i="@-webkit-keyframes "+this.animationName,r=this.path.toKeyFrames(10);document.styleSheets[0].insertRule(i+r,0)}var a=this.path,s=this.animationName;t&&"StoryEvent"==t.type&&t.isUserInitiated&&(e.actionMoved=!0),e.ref.unbind("webkitAnimationEnd"),e.ref.bind("webkitAnimationEnd",function(){var t=a.points[a.points.length-1];e.ref.css("-webkit-transform","translateX("+t.x+"px) translateY("+t.y+"px)"),e.ref.css("-webkit-animation-name",""),e.ref.css("-webkit-animation-duration","0s"),e.ref.unbind("webkitAnimationEnd"),e.handleEvent("onmovecomplete")}),e.ref.css("-webkit-animation-name",""),e.ref.css("-webkit-animation-duration","0s"),setTimeout(function(){e.ref.css("-webkit-animation-name",s),e.ref.css("-webkit-animation-duration",a.duration+"ms"),e.ref.css("-webkit-animation-iteration-count","1")},0)}},TimelineAction.prototype.zoompan=function(t,e,i,r){r||(this.zoomPanObj||(this.zoomPanObj=new ZoomPan,this.zoomPanObj.loadFromXML(this.xml)),i||this.zoomPanObj.apply(player.currentSlide().ref))},TimelineAction.prototype.object_action=function(t,e){var i=$(this.xml).attr("command");if(this.getItem(),e=this.getItem().parseObjrefFromXML(this.xml).target,"function"==typeof e[i])e[i](this.xml);else switch(i){case"togglecontent":e.visible?e.hide():e.show();break;case"hidecomplete":e.hide()}},TimelineAction.prototype.adjustvar=function(t,e,i,r){var a=this,r=r||$(this.xml).attr("variable"),s=$(this.xml).attr("operator"),n=$(this.xml).children("value").attr("type"),o=$(this.xml).children("value").attr("value");switch(s){case"toggle":o="true"==e.extractVariable(r)?"false":"true";break;case"add":s=e.extractVariable(o,n),n=parseFloat(e.extractVariable(r)),isNaN(n)&&(n=0),o=n+parseFloat(s);break;case"sub":s=e.extractVariable(o,n),n=parseFloat(e.extractVariable(r)),isNaN(n)&&(n=0),o=n-parseFloat(s);break;case"mult":s=e.extractVariable(o,n),n=parseFloat(e.extractVariable(r)),isNaN(n)&&(n=0),o=n*parseFloat(s);break;case"div":s=e.extractVariable(o,n),n=parseFloat(e.extractVariable(r)),isNaN(n)&&(n=0),o=n/parseFloat(s),isNaN(o)&&(o=0);break;case"set":o=$(this.xml).children("value").attr("value"),("property"==n||"variable"==n||"var"==n)&&(o=e.extractVariable(o,n)),"number"==n&&(o=parseFloat(o))}e||(e=story),e.setVariable(r,o),0==r.indexOf("_children")&&$.each(e.children,function(e,s){var n=r.replace("_children.","");a.adjustvar(t,s,i,n)}),e.group&&this.adjustvar(t,e.group,i)},TimelineAction.prototype.exe_actiongroup=function(t,e){var i=$(this.xml).attr("id");i.indexOf("State"),e.runActionGroup(i),e.group&&e.group.runActionGroup(i)},TimelineAction.prototype.render_item=function(){this.item.render(null,!0,null,"TimelineAction.prototype.render_item")};var StoryEvent=function(t){this.trigger="",this.time=0,this.actions=[],this.type="StoryEvent",this.parentElement=t};StoryEvent.prototype.loadFromXML=function(t){var e=this;switch(this.trigger=t.tagName,$(t).children("actions").children().each(function(t,i){var r=new TimelineAction(e.parentElement);r.loadFromXML(i,e),e.actions.push(r)}),e.trigger){case"onvarchanged":case"onpropchanged":e.varname=$(t).attr("varname"),e.varname||(e.varname=$(t).attr("propname"));var i=this.parentElement.parseObjref(e.varname).target;e.filter=function(t){return void 0===t?void 0:t==e.varname||i.getFullVariableRef(t)==i.getFullVariableRef(e.varname)},i.registerVariableEventSubscriber(this.parentElement,e.varname);break;case"onobjectevent":e.eventname=$(t).attr("eventname"),e.filter=function(t){return t==e.eventname};break;case"onkeypress":e.keyCode=$(t).attr("keycode"),e.shiftKey="true"==$(t).attr("shift"),e.ctrlKey="true"==$(t).attr("ctrl"),e.altKey="true"==$(t).attr("alt"),e.filter=function(t){var i=t.keyCode==e.keyCode&&t.shiftKey==e.shiftKey&&t.ctrlKey==e.ctrlKey&&t.altKey==e.altKey;return i&&13==t.keyCode&&t.target.blur(),i};break;case"onlinkrelease":e.triggerid=$(t).attr("triggerid"),e.filter=function(t){return t==e.triggerid};break;default:e.filter=function(){return!0}}},StoryEvent.prototype.act=function(t,e){this.isUserInitiated=e;var i=this,r=!0;return $.each(this.actions,function(e,a){r&&(r=a.act(i,t,!1,!1))}),r},StoryEvent.prototype.findDownstreamMedia=function(t,e,i){return e||(e=[]),$.each(this.actions,function(r,a){switch(a.type){case"media_play":case"media_toggle":var s=a.getItem();e.push(s);break;case"show":a.getItem()&&"video"==a.getItem().type&&e.push(a.getItem());break;case"show_slidelayer":(s=t.parseObjrefFromXML(a.xml).target)&&(s=s.findDownstreamMedia(++i))&&e.push(s);break;case"if_action":$(a.xml).find("media_play,media_toggle").each(function(i,r){var a=t.parseObjrefFromXML(r).target;a&&e.push(a)}),$(a.xml).find("show_slidelayer").each(function(r,a){var s=t.parseObjrefFromXML(a).target;s&&(s=s.findDownstreamMedia(++i))&&e.push(s)})}}),0<e.length?e[0]:null},TimelineEvent.prototype.findDownstreamMedia=StoryEvent.prototype.findDownstreamMedia;var Background=function(t){this.container=t||$(document.body),this.backgroundType="fill",this.fillType="linear",this.stops=[]};Background.prototype.loadFromXML=function(t,e){var i=this;switch(i.backgroundType=e||$(t).attr("type"),this.backgroundType){case"fill":i.rotation=$(t).children("fill").attr("rotation"),i.fillType=$(t).children("fill").attr("type"),i.stops=[];var r=$(t).attr("url");if(r){i.src=player.basepath+"mobile/"+r;break}$(t).children("fill").children("colors").children("color").each(function(t,e){var r=i.parseStop(e);i.stops.push(r)});break;case"swf":i.src=player.basepath+""+$(t).children("imagedata").attr("url").replace("story_content","mobile").replace(".swf",".jpg");break;case"vector":r=$(t).children("vectordata"),i.state={left:r.attr("left"),top:r.attr("top"),right:r.attr("right"),bottom:r.attr("bottom"),path:PathLib.getPathFromXML(r.children("pr"))},i.rectShape=new ppRect(i.state.left,i.state.top,i.state.right,i.state.bottom)}},Background.prototype.parseStop=function(t){return{rawcolor:$(t).attr("rgb").replace("0x","#"),color:Background.parseRGBA($(t).attr("rgb"),$(t).attr("alpha")),stop:parseInt($(t).attr("stop"))/255,alpha:parseInt($(t).attr("alpha"))/100}},Background.parseRGBA=function(t,e){var i=Frame.parseRGB(t.replace("0x","#"));return i.push(parseInt(e)/100),"rgba("+i.join(",")+")"},Background.prototype.colorStops=function(){var t="";return $.each(this.stops,function(e,i){""!=t&&(t+=","),t+=i.color+" "+100*i.stop+"%"}),t},Background.prototype.toColorString=function(){return this.stops[0].color},Background.prototype.toCssString=function(){switch(this.backgroundType){case"fill":return this.src?"transparent url("+this.src+") no-repeat":1==this.stops.length?this.stops[0].color:"-webkit-linear-gradient(top, "+this.colorStops()+")";case"swf":return"transparent url("+this.src+") no-repeat"}},Background.prototype.toCss=function(){if(player.noImg)return{};var t={};switch(this.backgroundType){case"fill":t.background=this.src?"transparent url("+escape(this.src)+") no-repeat":1==this.stops.length?this.stops[0].color:"-webkit-linear-gradient(top, "+this.colorStops()+")";break;case"swf":t.background="transparent url("+escape(this.src)+") no-repeat";break;case"vector":this.generateVectorSrc(),t.background="transparent url("+this.src+") no-repeat"}return t},Background.prototype.generateVectorSrc=function(){this.src||(this.canvas=document.createElement("canvas"),this.canvas.width=this.state.right,this.canvas.height=this.state.bottom,this.m_nYOffset=this.m_nXOffset=0,this.height=this.width=1e3,ppArt.DrawVector(this,this.state.path,null,player.fontlib,this.imagelib,null),this.src=this.canvas.toDataURL("image/png"),this.canvas=null)},Background.prototype.apply=function(t){this.container=t||this.container;var e=this;$.each(this.toCss(),function(t,i){$(e.container).css(t,i)})},Background.prototype.toCanvasGradient=function(t,e){var i=t.createLinearGradient(0,0,0,e);return $.each(this.stops,function(t,e){i.addColorStop(e.stop,e.color)}),i},Background.prototype.applyCanvas=function(t,e,i,r){var a=t.createLinearGradient(0,0,0,e.height);$.each(this.stops,function(t,e){a.addColorStop(e.stop,e.color)}),i&&(t.fillStyle=a),r&&(t.strokeStyle=a)};var SlideBank=function(){this.constructElement(),this.id="_slidebank_"+SlideBank.index,SlideBank.index++,this.bankSlideIndex=0};SlideBank.prototype=new Element,SlideBank.prototype.objectType="SlideBank",SlideBank.prototype.innerType="SlideBank",SlideBank.index=0,SlideBank.prototype.loadFromXML=function(t){var e=this;this.children={},$(t).children("slides").children("slide").each(function(t,i){var r=new Slide(story.container);r.loadFromXML($(i)),r.parent=e,story.allSlides.push(r),story.slideLookup[r.id]=r,e.children[r.id]=r,r.slideIndex=story.allSlides.length-1,r.bankSlideIndex=e.bankSlideIndex++})};var SlideDraw=function(){this.constructElement(),this.interactions={},this.exitActions=[],this.draw=[],this.orderedChildren=[],this.navLinks=[],this.drawIndex=0};SlideDraw.NextSlideIndex=0,SlideDraw.prototype=new Element,SlideDraw.prototype.objectType="SlideDraw",SlideDraw.prototype.innerType="SlideDraw",SlideDraw.prototype.getRandomMember=ShuffleGroup.prototype.getRandomMember,SlideDraw.prototype.getRandomIndex=ShuffleGroup.prototype.getRandomIndex,SlideDraw.populateDraws=function(){$.each(story.slideDraws,function(t,e){0==e.draw.length&&(e.createDraw(),e.populateDraw())})},SlideDraw.prototype.restoreFromResumeData=function(t){this.compactResumeData=bwChunk.CreateChunk(t);var e=new bwChunk(t);for(this.draw=[];!e.EOF();)this.draw.push(this.refs[e.NextUBase10(2)]);for(this.populateDraw(),t=0,e=e.NextChunk();!e.isNothing;)this.orderedChildren[t].compactResumeData=e.ChunkData(),t++,e=e.NextChunk()},SlideDraw.prototype.getResumeData=function(){var t="",e="";$.each(this.orderedChildren,function(i,r){t+=bwChunk.UBase10toN(r.drawListIndex,2),r.compactResumeData?e+=r.compactResumeData:r.resume&&(e+=bwChunk.EMPTY_CHUNK)});var i=bwChunk.CreateChunk(bwChunk.CreateChunk(t)+e);return this.compactResumeData=i,this.parent.compactResumeData=this.parent.getResumeData(),i},SlideDraw.prototype.toBaseData=Element.prototype.toData,SlideDraw.prototype.toData=function(t){return t=this.toBaseData(t),t.draw=this.draw,t},SlideDraw.prototype.updateBaseFromData=Element.prototype.updateFromData,SlideDraw.prototype.updateFromData=function(t){this.updateBaseFromData(t),t.draw&&(this.draw=t.draw,this.populateDraw())},SlideDraw.prototype.loadFromXML=function(t){var e=this;this.id=$(t).attr("id"),this.shuffle="true"==$(t).attr("shuffle"),this.shufflecount=parseInt($(t).attr("shufflecount")),e.variables.Id=$(t).attr("id"),e.variableDefaults.Id=$(t).attr("id"),e.variables.WindowId="_frame",e.variableDefaults.WindowId="_frame",$(t).children("exitaction").children().each(function(t,i){var r=new TimelineAction(e);r.loadFromXML(i,e),e.exitActions.push(r)}),this.refs=[],$(t).children("sliderefs").children("slideref").each(function(t,i){var r={id:$(i).attr("id"),index:t,shuffleinclude:"true"==$(i).attr("shuffleinclude"),linknext:"true"==$(i).attr("linknext"),linkprev:"true"==$(i).attr("linkprev")};e.refs.push(r)})},SlideDraw.prototype.createDraw=function(){if(this.shuffle){var t=this;this.draw=[];for(var e=[],i=[],r=[];0<this.refs.length&&this.refs[0].linkprev;){var a=this.refs.shift();t.draw.push(a)}for(;0<this.refs.length&&this.refs[this.refs.length-1].linknext;)r.unshift(this.refs.pop().id);for($.each(this.refs,function(t,r){i.push(r),r.linknext||(e.push(i),i=[])}),a=0;t.draw.length+r.length<this.shufflecount&&0<e.length&&100>a++;){var s=this.shufflecount-t.draw.length-r.length,n=t.getRandomIndex(e),o=e[n];o.length<=s&&($.each(o,function(e,i){t.draw.push(i)}),e.splice(n,1))}if(a>=100&&0<e.length){var l=1e3,l=null;$.each(e,function(t,e){(!l||l.length>e.length)&&(l=e)}),$.each(l,function(e,i){t.draw.push(i)})}for(;0<r.length;)t.draw.push(r.shift());$.each(this.draw,function(){})}else this.createDrawUnshuffled()},SlideDraw.prototype.createDrawUnshuffled=function(){for(this.draw=[];this.refs.length;)this.draw.push(this.refs.shift())},SlideDraw.prototype.populateDraw=function(){var t=this;this.children={},$.each(this.draw,function(e,i){var r=i.id,a=story.slideLookup[r],s=new Slide(story.container);s.loadFromXML($(a.xml)),s.parent=t,s.slideBank=t,story.allSlides.push(s),player.slideLoadQueue.push(story.allSlides.length-1),s.originalSlideIndex=s.slideIndex,s.drawSlideIndex=e,s.slideIndex=story.allSlides.length-1,s.slideIndexForResume=SlideDraw.NextSlideIndex++,s.sceneIndex=t.parent.sceneIndex,s.drawIndex=t.drawIndex,s.bankSlideIndex=a.bankSlideIndex,s.drawListIndex=i.index,t.children[r]=s,t.orderedChildren.push(s)}),player.slideLoadQueue.restart()},SlideDraw.prototype.showFirst=function(){var t=this.getFirstSlide();this.parent.compactResumeData=this.parent.getResumeData(),player.showSlideIndex(t.slideIndex,null,!0)},SlideDraw.prototype.getFirstSlide=function(){return this.drawIndex=0,player.currentDraw=this,0==this.draw.length&&SlideDraw.populateDraws(),this.children[this.draw[this.drawIndex].id]},SlideDraw.prototype.playnextdrawslide=function(){0==this.draw.length&&SlideDraw.populateDraws(),player.currentSlide().parent==this&&(this.drawIndex=player.currentSlide().drawSlideIndex),this.drawIndex++,this.drawIndex>=this.draw.length?(player.currentSlide().saveIfNecessary(),this.fireExitActions()):player.showSlideIndex(this.children[this.draw[this.drawIndex].id].slideIndex,null,!0)},SlideDraw.prototype.fireExitActions=function(){var t=this;$.each(this.exitActions,function(e,i){i.act(t,null,!1,!1)})},SlideDraw.prototype.sniffDrawIndex=function(t){var e=this;$.each(this.draw,function(i,r){r==t.id&&(e.drawIndex=i)})},SlideDraw.prototype.resetSlide=function(t,e){$.each(this.children,function(i,r){r.resetSlide(t,e)}),this.compactResumeData=""};var SlideList=function(t){this.container=t||$(document.body),this.ref=null,this.ref=$("#menu_container"),this.landscapeContainer=$("#landscape_menu"),this.portraitContainer=$("#portrait_menu"),this.contentRef=$("#slide_list"),this.closed=!1,player.simplenav&&(this.contentRef.removeClass("menu_list"),this.contentRef.addClass("slidelist"))};SlideList.maxDepth=0,SlideList.SetDepth=function(t,e){e>SlideList.maxDepth&&(SlideList.styleSheet||(SlideList.styleSheet=new CustomStyleSheet),SlideList.styleSheet.add("ul.slidelist li.depth"+e,"padding-left",6+12*e+"px"),SlideList.styleSheet.add("ul.slidelist li.depth"+e+".has_children","padding-left",-10+12*e+"px"),SlideList.styleSheet.build(),SlideList.maxDepth=e),t.addClass("depth"+e)},SlideList.prototype.build=function(t,e,i,r){var a=this,e=e||a.contentRef,i=i||"",r=r||1,s=player.frame.options.autonumber;a.justDivided=!0,$.each(t,function(t,n){var o=s?i+(t+1)+".":"",l=$("<li>"+o+" "+n.displaytext+"</li>");SlideList.SetDepth(l,r),l.toggleExpand=function(){return l.hasClass("has_children")&&(l.hasClass("open")?SlideList.collapseSection(l):SlideList.expandSection(l)),!1},l.click(function(){if(!(a.scroll.moved||player.currentWindow&&"MessageWnd"==player.currentWindow.id)){var t=story.parseObjref(n.slideid).target,e=story.parseObjref(n.drawid).target;return e&&(t=e.getFirstSlide()),t?(t.variables.Visited&&l.addClass("visited"),t.variables.Visited=!0,t.viewedCurrent=!0,player.showSlideID(t.getFullObjref(!0),!0),$(".window").hide(),player.slideList.hide(),$(".toptab.active").removeClass("active"),!1):!1}}),l.bind("mouseover mouseout",function(){});var h=story.parseObjref(n.slideid).target,p=story.parseObjref(n.drawid).target;h&&"Scene"==h.innerType&&!a.justDivided&&e.append($('<li class="divider"/>')),a.justDivided=!1,e.append(l),n.links?(p=$("<span/>"),p.click(l.toggleExpand),l.prepend(p),l.addClass("has_children open"),a.build(n.links,e,o,r+1)):p?a.addSlideDraw(p,n):h&&"SlideDraw"==h.innerType?a.addSlideDraw(h,n):!h&&n.expand&&(p=$("<span/>"),l.prepend(p),l.addClass("has_children neither")),h&&"Scene"==h.innerType&&(e.append($('<li class="divider"/>')),a.justDivided=!0),n.listitems||(n.listitems=[]),n.listitems.push(l),n.expand||l.toggleExpand()})},SlideList.prototype.addSlideDraw=function(t,e){t.navLinks=[e],$.each(t.children,function(t,i){"Slide"==i.innerType&&i.navLinks.push(e)})},SlideList.prototype.addSlideDrawExpanded=function(t,e,i,r){var a=this,r=r||"",s=0;$.each(t.children,function(t,n){if("Slide"==n.innerType){var o=$('<li><span></span><a href="javascript:void(null);" title="">'+(player.frame.options.autonumber?r+(s+1)+".":"")+" "+n.title+"</a></li>");o.click(function(){return a.scroll.moved?void 0:(player.showSlideID(e+"."+n.id,!0),$(".window").hide(),player.slideList.hide(),!1)}),i.append(o),s++,n.navLinks.push({listitems:[o]})}})},SlideList.prototype.toggle=function(){this.visible?this.hide():this.show()},SlideList.prototype.show=function(){this.visible||(this.visible=!0,Transition.applyCss({"-webkit-transition-property":"none","-webkit-transition-duration":"0ms",opacity:1,display:"block"},this.portraitContainer),$("#control-menu").addClass("active"),this.refresh(),this.scrollSelectedIntoView(1))},SlideList.prototype.hide=function(){this.visible&&(this.visible=!1,this.portraitContainer.hide(),$("#control-menu").removeClass("active"))},SlideList.prototype.refresh=function(){this.scroll={moved:!1}},SlideList.prototype.scrollSelectedIntoView_old=function(t){var t=isNaN(t)?500:t,e=this;$(".menu_list .selected").each(function(i,r){var a=$(r).closest(".menu_list"),s=$(r).position().top,n=$(r).height(),o=a.position().top-s,l=a.parent().height();if(0>s)switch(a.get(0).id){case"slide_list":e.scroll.scrollTo(0,o,t);break;case"slide_list_portrait":e.portraitScroll.scrollTo(0,o,t)}else if(s>l-n)switch(a.get(0).id){case"slide_list":e.scroll.scrollTo(0,o,t);break;case"slide_list_portrait":e.portraitScroll.scrollTo(0,o,t)}})},SlideList.prototype.scrollSelectedIntoView=function(t){t=isNaN(t)?500:t,$(".slidelist .selected").each(function(t,e){var i=$(e).closest(".slidelist"),r=$(e).position().top,a=$(e).height(),s=i.position().top,n=i.parent().height(),o=i.parent().get(0).scrollTop,l=r-s-a,r=r-s-n+2*a;r>o&&(i.parent().get(0).scrollTop=r),o>l&&(i.parent().get(0).scrollTop=l)})},SlideList.prototype.markVisited=function(t){$.each(t.navLinks,function(t,e){$.each(e.listitems,function(t,e){e.addClass("visited")})}),t.variables.Visited=!0},SlideList.collapseSection=function(t){if(t.hasClass("has_children"))for(t.removeClass("open"),t=t.next();1==t.length&&!t.hasClass("divider");)t.hide(),t=t.next()},SlideList.expandSection=function(t){if(t.hasClass("has_children"))for(t.addClass("open"),t=t.next();1==t.length&&!t.hasClass("divider");)t.show(),t=t.next()},SlideList.prototype.collapse=function(t,e){player.frame.options.autocollapse&&t.parent!=e.parent&&e.parent.innerType==t.parent.innerType&&$.each(Frame.navLinks,function(i,r){-1<r.slideid.indexOf(e.parent.id)&&$.each(r.listitems,function(t,e){e.hasClass("has_children")&&SlideList.collapseSection(e)}),-1<r.slideid.indexOf(t.parent.id)&&$.each(r.listitems,function(t,e){e.hasClass("has_children")&&SlideList.expandSection(e)})})},SlideList.shorten=function(t,e){if(t.length>e){for(var i=t.substr(0,e-3),r=i.length-1;r>0;r--)if(" "==i.substr(r,1))return i.substr(0,r)+"&hellip;";return"&hellip;"}return t};var FileList=function(t){this.container=t||$(document.body),this.ref=null,this.loaded=this.visible=!1,this.ref=$('<div id="filelist"><div id="filelistscroll"></div></div>'),this.contentRef=this.ref.children("#filelistscroll"),this.container.append(this.ref)};FileList.prototype.load=function(){var t=this;$.ajax({url:"/ListFiles.aspx",dataType:"xml",success:function(e){t.contentRef.empty();var i=$('<ul class="navlist"><li tabindex="0" class="divider">Open<span class="icon icon-x"></span></li></ul>');i.find(".divider").click(function(){t.hide()}),$(e).find("file").each(function(e,r){var a=$(r).attr("name"),s=$('<li tabindex="-1">'+a+'<span class="icon icon-r"></span></li>');s.click(function(){t.scroll.moved||(player.basepath=a,player.load(function(){$("#slideframe").css("opacity","1.0"),player.setSlideIndex(0),player.restart(),$(".slide").show()}),t.hide())}),i.append(s)}),t.contentRef.append(i),t.contentRef.append($('<br style="clear:both;">'))},error:function(){}})},FileList.prototype.addScene=function(t,e){var i=$('<ul class="navlist"><li tabindex="0" class="divider">'+e+"</li></ul>");$.each(t,function(t,e){var r=$('<li tabindex="-1">'+e.title+'<span class="icon-r"></span></li>');r.click(function(){player.showSlideIndex(t,"pan"==player.animations?2:null,!0),player.slideList.hide()}),i.append(r)}),this.contentRef.append(i)},FileList.prototype.show=function(){if(!this.visible){this.visible=!0,this.load();var t=this,e={"-webkit-transition-property":"-webkit-transform, opacity","-webkit-transition-duration":"400ms","-webkit-transform-origin":"center center","-webkit-transition-timing-function":"ease-out","-webkit-transform":"translate3d(0px,0px,0px) scale(1) rotate(0)"};this.ref.show(),Transition.applyCss({"-webkit-transition-property":"-webkit-transform, opacity","-webkit-transition-duration":"0ms","-webkit-transform-origin":"center center","-webkit-transition-timing-function":"ease-in","-webkit-transform":"translate3d(0px,-100%,0px) scale(1) rotate(0)"},this.ref),setTimeout(function(){t.ref.unbind("webkitTransitionEnd"),t.ref.bind("webkitTransitionEnd",function(){t.ref.unbind("webkitTransitionEnd"),t.refresh()}),Transition.applyCss(e,t.ref),t.refresh()},0)}},FileList.prototype.hide=function(){var t=this;this.visible&&(this.visible=!1,this.ref.unbind("webkitTransitionEnd"),this.ref.bind("webkitTransitionEnd",function(){t.ref.unbind("webkitTransitionEnd")}),Transition.applyCss({"-webkit-transition-property":"-webkit-transform, opacity","-webkit-transition-duration":"200ms","-webkit-transform-origin":"center center","-webkit-transition-timing-function":"ease-in","-webkit-transform":"translate3d(0px,-100%,0px) scale(1) rotate(0)"},this.ref))},FileList.prototype.refresh=function(){this.scroll||(this.scroll=new iScroll("filelistscroll",{desktopCompatibility:!0})),this.scroll.refresh()};var Transition=function(t){this.target=null,this.transition=Transition.TransType.appear,this.duration=750,this.direction=1,this.hasContext=this.reverse=this.pan=this.wipe=!1,t&&this.setTarget(t)};Transition.TransType={appear:"appear",fly:"fly",fade:"fade",grow:"grow",spin:"spin"},Transition.Direction={1:{getLeft:function(t){return-t.targetWidth},getTop:function(t,e){return e}},2:{getLeft:function(t){return t.containerWidth},getTop:function(t,e){return e}},4:{getLeft:function(t,e){return e},getTop:function(t){return-t.targetHeight}},8:{getLeft:function(t,e){return e},getTop:function(t){return t.containerHeight}}},Transition.prototype.toString=function(){return"[duration:"+this.duration+", direction:"+this.direction+", type:"+this.transition+"]"},Transition.prototype.setTarget=function(t){this.target=t,this.hasContext||this.sniffContext()},Transition.prototype.sniffContext=function(){switch(this.target.objectType){case"Item":this.targetLeft=this.target.x,this.targetTop=this.target.y,this.targetWidth=this.target.width,this.targetHeight=this.target.height,this.containerWidth=player.width,this.containerHeight=player.height;break;case"Layer":this.targetTop=this.targetLeft=0,this.targetWidth=player.width,this.targetHeight=player.height,this.containerWidth=player.width,this.containerHeight=player.height;break;case"Slide":this.targetTop=this.targetLeft=0,this.targetWidth=player.width,this.targetHeight=player.height,this.containerWidth=player.width,this.containerHeight=player.height;break;case"Bounce":this.targetTop=this.targetLeft=0,this.targetWidth=player.width/10,this.targetHeight=player.height/10,this.containerWidth=player.width/10,this.containerHeight=player.height/10}this.hasContext=!0},Transition.prototype.loadFromXML=function(t){this.transition=$(t).attr("transition"),$(t).attr("transduration")?(this.duration=$(t).attr("transduration"),this.direction=$(t).attr("transdir"),this.wipe="true"==$(t).attr("wipetrans")):(this.duration=$(t).attr("duration"),this.direction=$(t).attr("direction")),this.reverse="hide"==$(t).get(0).tagName.toLowerCase()},Transition.prototype.getOffscreenPosition=function(){var t=this,e={x:this.targetLeft,y:this.targetTop};return $.each(Transition.Direction,function(i,r){t.direction&parseInt(i)&&(e.x=r.getLeft(t,e.x),e.y=r.getTop(t,e.y))}),e},Transition.prototype.getOffscreenCss=function(t){var e=0,i=0;-1<this.transition.indexOf(Transition.TransType.fly)&&(i=this.getOffscreenPosition(),e=i.x-this.targetLeft,i=i.y-this.targetTop),t&&(e=-e,i=-i),t=0,-1<this.transition.indexOf(Transition.TransType.spin)&&(t=360),this.target&&"Item"==this.target.objectType&&(t+=this.target.rotation);var r=1;-1<this.transition.indexOf(Transition.TransType.grow)&&(r=.01);var a=1;return-1<this.transition.indexOf(Transition.TransType.fade)&&(a=.02),this.target&&this.target.hasDescendantByType&&this.target.hasDescendantByType("video")&&(t=0==t?.02:t),{"-webkit-transform":"translate3d("+e+"px,"+i+"px,0px) scale("+r+") rotate("+t+"deg)","-moz-transform":"translate3d("+e+"px,"+i+"px,0px) scale("+r+") rotate("+t+"deg)","-o-transform":"translate3d("+e+"px,"+i+"px,0px) scale("+r+") rotate("+t+"deg)","-ms-transform":"translate("+e+"px,"+i+"px) scale("+r+") rotate("+t+"deg)",opacity:a}},Transition.prototype.getZeroCss=function(){var t=0;return this.target&&"Item"==this.target.objectType&&(t=this.target.rotation),this.target&&this.target.hasDescendantByType&&this.target.hasDescendantByType("video")&&(t=0==t?.02:t),{"-webkit-transform":"translate3d(0px,0px,0px) scale(1) rotate("+t+"deg)","-moz-transform":"translate3d(0px,0px,0px) scale(1) rotate("+t+"deg)","-o-transform":"translate3d(0px,0px,0px) scale(1) rotate("+t+"deg)","-ms-transform":"translate(0px,0px) scale(1) rotate("+t+"deg)",opacity:1}},Transition.prototype.getImmediateCss=function(){return{"-webkit-transition-property":"-webkit-transform, opacity","-webkit-transition-duration":"0s","-moz-transition-property":"-moz-transform, opacity","-moz-transition-duration":"0s","-o-transition-property":"-o-transform, opacity","-o-transition-duration":"0s","-ms-transition-property":"-ms-transform, opacity","-ms-transition-duration":"0s"}},Transition.prototype.getTransitionCss=function(t){return t=t||"ease-out",
{"-webkit-transition-property":"-webkit-transform, opacity","-webkit-transition-duration":this.duration+"ms","-webkit-transition-timing-function":t,"-moz-transition-property":"-moz-transform, opacity","-moz-transition-duration":this.duration+"ms","-moz-transition-timing-function":t,"-o-transition-property":"-o-transform, opacity","-o-transition-duration":this.duration+"ms","-o-transition-timing-function":t,"-ms-transition-property":"-ms-transform, opacity","-ms-transition-duration":this.duration+"ms","-ms-transition-timing-function":t}},Transition.applyCss=function(t,e){$.each(t,function(t,i){$(e).css(t,i)})},Transition.prototype.applyCss=function(t,e){Transition.applyCss(t,e)},Transition.prototype.apply=function(t,e,i,r){var a=this,s={},n={},e=e||a.target.ref,r=r||"ease-out";this.hasContext||this.sniffContext(),this.reverse||this.wipe?(s=a.getZeroCss(),n=a.getOffscreenCss(!1)):(s=a.getOffscreenCss(!1),n=a.getZeroCss());var o=a.getOffscreenCss(!0);e.unbind("webkitTransitionEnd transitionend oTransitionEnd"),a.applyCss(a.getImmediateCss(),e),a.applyCss(s,e),a.target.runningTransition=a,setTimeout(function(){var s=!1;e.bind("webkitTransitionEnd transitionend oTransitionEnd",function(){a.target.runningTransition=null,e.unbind("webkitTransitionEnd transitionend oTransitionEnd"),t&&!s&&(s=!0,t())}),0<a.duration&&setTimeout(function(){t&&!s&&a.target.runningTransition==a&&(e.unbind("webkitTransitionEnd transitionend oTransitionEnd"),a.target.runningTransition=null,s=!0,t(),player.currentSlide().forceRepaint())},2*a.duration),a.applyCss(a.getTransitionCss(r),e),a.applyCss(n,e),a.pan&&i&&(a.applyCss(a.getTransitionCss(r),i),a.applyCss(o,i)),player.canAnimate&&0!=a.duration||!t||(e.unbind("webkitTransitionEnd transitionend oTransitionEnd"),t&&t())},0)},Transition.bounce=function(t,e){if(player.canAnimate){var i=new Transition({objectType:"Bounce"});i.duration=100,i.direction=e,i.transition=Transition.TransType.fly,$.each(t,function(t,e){i.applyCss(i.getImmediateCss(),e),i.applyCss(i.getZeroCss(),e)}),setTimeout(function(){$.each(t,function(t,e){i.applyCss(i.getTransitionCss(),e),i.applyCss(i.getOffscreenCss(),e),e.unbind("webkitTransitionEnd transitionend oTransitionEnd"),e.bind("webkitTransitionEnd transitionend oTransitionEnd",function(){i.duration=400,e.unbind("webkitTransitionEnd transitionend oTransitionEnd"),i.applyCss(i.getTransitionCss(),e),i.applyCss(i.getZeroCss(),e)})})},0)}};var Quiz=function(){this.xml="",this.sliderefs=[],this.quizrefs=[],this.constructElement(),this.variables.Score=0,this.attemptCount=this.variables.PercentScore=0,this.m_bCompleted=this.m_bEvaluated=!1};Quiz.prototype=new Element,Quiz.prototype.objectType="Quiz",Quiz.prototype.innerType="Quiz",Quiz.prototype.toBaseData=Element.prototype.toData,Quiz.prototype.toData=function(){var t=this.toBaseData();return 0<this.attemptCount&&(t.attemptCount=this.attemptCount),t},Quiz.prototype.updateBaseFromData=Element.prototype.updateFromData,Quiz.prototype.updateFromData=function(t){this.updateBaseFromData(t),t.attemptCount&&(this.attemptCount=t.attemptCount)},Quiz.prototype.SetResumeData=function(t){this.m_bEvaluated="1"==t.substr(0,1),this.m_bCompleted="1"==t.substr(1,1)},Quiz.prototype.GetResumeData=function(){var t;return t=""+(this.m_bEvaluated?"1":"0"),t+=this.m_bCompleted?"1":"0"},Quiz.prototype.loadFromXML=function(t,e){var i=this;if(this.parent=e,this.children={},this.id=$(t).attr("id"),this.lmstext=$(t).attr("lmstext"),this.issurvey=$(t).attr("issurvey"),this.passpercent=$(t).attr("passpercent"),this.submitall=$(t).attr("submitall"),this.submitunanswered=$(t).attr("submitunanswered"),this.scoretype=$(t).attr("scoretype"),this.variables.PassPercent=this.passpercent,this.variables.PassScore=0,this.loadElementInfoFromXML(t),$(t).children("sliderefs").children("slideref").each(function(t,e){var r=$(e).attr("id");i.sliderefs.push(r),i.parseObjref(r).target.quiz=i}),$(t).children("quizrefs").children("quizref").each(function(t,e){var r={id:$(e).attr("id"),weight:parseInt($(e).attr("weight")),mustpass:"true"==$(e).attr("id")};i.quizrefs.push(r)}),e.g_listQuizzes){var r=new QuizData(this.id,this.lmstext);r.nPassingScore=this.passpercent,e.g_listQuizzes[this.id]=r}},Quiz.prototype.AllQuestionsSubmitted=function(t){if(this.m_bCompleted)return"true";var e=!0;return $.each(this.sliderefs,function(i,r){var a=story.parseObjref(r).target;if(a){var s=function(i){e=e&&i.isAnswered(),t||(e=e&&i.isSubmitted())};"SlideDraw"==a.innerType?$.each(a.children,function(t,e){!e.hasRestoredInteractions&&e.compactResumeData&&e.restoreFromResumeData(e.compactResumeData,!0),s(e)}):s(a)}}),e?"true":"false"},Quiz.prototype.AllQuestionsAnswered=function(){return this.AllQuestionsSubmitted(!0)},Quiz.prototype.QuizComplete=function(){var t=this.m_bCompleted;return $.each(story.quizzes,function(e,i){t=t&&i.m_bCompleted}),t?"true":"false"},Quiz.SEARCH_UNANSWERED="SEARCH_UNANSWERED",Quiz.SEARCH_UNSUBMITTED="SEARCH_UNSUBMITTED",Quiz.SEARCH_VIEWED="SEARCH_VIEWED",Quiz.prototype.findNextSlide=function(t,e){var i=[];$.each(this.sliderefs,function(t,e){var r=story.parseObjref(e).target;r&&("SlideDraw"==r.innerType?$.each(r.children,function(t,e){i.push(e)}):i.push(r))}),e&&i.push(e);for(var r=player.currentWindowSlide||player.currentFramedSlide||player.currentSlide(),a=!1,s=0;s<2*i.length;s++){var n=i[s%i.length];if(a)switch(t){case Quiz.SEARCH_UNANSWERED:if(!n.isAnswered())return n;break;case Quiz.SEARCH_UNSUBMITTED:if(!n.isSubmitted())return n;break;case Quiz.SEARCH_VIEWED:if(n.variables.Visited)return n}else(n===r||s>=i.length-1)&&(a=!0)}return null},Quiz.prototype.setquizcomplete=function(t){t=this.parseObjrefFromXML(t).target,t.m_bCompleted=!0,player.lmsManager.handleQuizComplete(t)},Quiz.prototype.Passed=function(){return this.variables.Score>=this.variables.PassScore?"true":"false"},Quiz.dump=function(){$.each(story.quizzes,function(t,e){$.each(e.sliderefs,function(t,i){var r=story.parseObjref(i).target;if(r){var a=function(t,e){var i=0;0<e.attempts.length&&(i=e.attempts[0].answers.length),console.log(["d:interaction",e.id,e.concatChoices(e.lmsResponses),e.GetResumeData(),e.attempts.length,i,e])};"SlideDraw"==r.innerType&&$.each(r.children,function(t,i){("partial"!=e.scoretype||i.variables.Visited)&&$.each(i.interactions,a)}),("partial"!=e.scoretype||r.variables.Visited)&&$.each(r.interactions,a)}})})};var Answer=function(){this.xml="",this.constructElement()};Answer.prototype=new Element,Answer.prototype.objectType="Answer",Answer.prototype.innerType="Answer",Answer.prototype.loadFromXML=function(t,e){this.parent=e,this.children={},this.id=$(t).attr("id"),this.points=$(t).attr("points"),this.status=$(t).attr("status"),this.actions=$(t).children("actions").children(),this.evaluate=$(t).children("evaluate").children()};var Choice=function(){this.xml="",this.constructElement(),this.selected=!1,this.pairs=[]};Choice.prototype=new Element,Choice.prototype.objectType="Choice",Choice.prototype.innerType="Choice",Choice.prototype.loadFromXML=function(t,e){this.parent=e,this.children={},this.id=$(t).attr("id"),this.lmstext=$(t).attr("lmstext")},Choice.FromParameters=function(t,e,i){var r=new Choice;r.id=t,r.lmstext=e,r.parent=i},Choice.prototype.hasPair=function(t){for(var e=0;e<this.pairs.length;e++)if(this.pairs[e]==t)return!0;return!1},Choice.prototype.findPair=function(t){for(var e=0;e<this.pairs.length;e++)if(this.pairs[e]==t)return t;return null},Choice.prototype.addPair=function(t){this.hasPair(t)||this.pairs.push(t)};var ResponseData=function(t,e,i,r,a,s){this.m_bValid=!0,this.m_bPairResponse=t,this.m_strChoice=e,this.m_strStatement=i||"",e&&0!=this.m_strChoice.length?!this.m_bPairResponse||i&&0!=this.m_strStatement.length||(this.m_bValid=!1):this.m_bValid=!1,this.lmstext=r,this.statementLMSText=a,this.interaction=s};ResponseData.TYPE_STATEMENTS="statements",ResponseData.TYPE_CHOICES="choices",ResponseData.prototype.IsPair=function(){return this.m_bPairResponse},ResponseData.prototype.ChoiceID=function(){return this.m_strChoice},ResponseData.prototype.StatementID=function(){return this.m_strStatement},ResponseData.prototype.IsValid=function(){return this.m_bValid},ResponseData.prototype.GetResumeData=function(t,e){var i;return i=0+(this.m_bPairResponse?1:0),i+=this.m_bValid?2:0,i=""+bwChunk.UBase10toN(i,1),this.m_bValid&&(i+=this.GetResumeResponseIndex(ResponseData.TYPE_CHOICES,this.m_strChoice,t),this.m_bPairResponse&&(i+=this.GetResumeResponseIndex(ResponseData.TYPE_STATEMENTS,this.m_strStatement,e))),i},ResponseData.prototype.SetResumeData=function(t,e,i){var r=bwChunk.UBaseNto10(t.substr(0,1));this.m_bPairResponse=(1&r)>0,this.m_bValid=(2&r)>0,t=t.substr(1),this.m_bValid&&(t=this.SetResumeResponse(ResponseData.TYPE_CHOICES,t,e),this.m_bPairResponse&&this.SetResumeResponse(ResponseData.TYPE_STATEMENTS,t,i))},ResponseData.prototype.GetResumeResponseIndex=function(t,e,i){var r=e.split("."),a=-1,s="";if(2==r.length&&r[0]==t){var n,t=0;for(n in i){if(i[n].id==r[1]){a=t;break}t++}}return s=a>=0?"0"+bwChunk.UBase10toN(a,2):"1"+bwChunk.CreateChunk(e)},ResponseData.prototype.GetResponseByIndex=function(t,e){var i,r=0;for(i in t){if(r==e)return t[i];r++}return null},ResponseData.prototype.SetResumeResponse=function(t,e,i){var r="0"==e.substr(0,1),a=-1,e=e.substr(1);return r?(a=bwChunk.UBaseNto10(e.substr(0,2)),e=e.substr(2),i=this.GetResponseByIndex(i,a).id,t==ResponseData.TYPE_CHOICES?(this.m_strChoice=t+"."+i,this.lmstext=this.GetLMSText(i)):(this.m_strStatement=t+"."+i,this.statementLMSText=this.GetLMSText(i))):(e=new bwChunk(e),t==ResponseData.TYPE_CHOICES?(this.m_strChoice=e.Data(),this.lmstext=this.GetLMSText(this.m_strChoice)):(this.m_strStatement=e.Data(),this.statementLMSText=this.GetLMSText(this.m_strStatement)),e=e.Remainder()),e},ResponseData.prototype.GetLMSText=function(t){return this.interaction&&(t=this.interaction.children[t])?t.lmstext:""};var Interaction=function(){this.xml="",this.choices={},this.answers={},this.statements={},this.responseActions=[],this.responses={},this.correctResponses={},this.attempts=[],this.variables={},this.lmsResponses=[],this.lmsCorrectResponses=[],this.constructElement(),this.m_bUnanswered=this.m_bAnswered=this.scoreAO=!1,this.m_nUserAnswerIndex=-1};if(Interaction.prototype=new Element,Interaction.prototype.objectType="Interaction",Interaction.prototype.innerType="Interaction",Interaction.prototype.toBaseData=Element.prototype.toData,Interaction.prototype.toData=function(){var t=this.toBaseData();return $.each(this.responses,function(e,i){t.responses||(t.responses={}),t.responses[e]=i.toData()}),0<this.attempts.length&&(t.attempts=this.attempts),t},Interaction.prototype.restoreFromResumeChunk=function(t){var e=t.NextUBase10(2);if(this.m_bAnswered="1"==t.NextString(1),this.m_bUnanswered="1"==t.NextString(1),e>0){var i=t.NextString(1),r=t.NextChunkedBase10(),a=t.NextChunkedBase10();switch(t.NextChunkedBase10(),t="",i){case"0":t="correct";break;case"1":t="incomplete";break;case"2":t="incorrect";break;case"3":t="neutral"}if(this.variables.AttemptCount=e,this.variables.Points=r,this.variables.Status=t,"incomplete"!=this.variables.Status)for(;this.attempts.length<e;)this.attempts.push({time:player.elapsedTime(),isfinal:!0,sent:!1,pointsAwarded:a,result:t,answers:[]})}else{for(e=t.NextUBase10(2),this.lmsResponses=[],i=t.NextString(),t=0;e>t;t++)i=new bwChunk(i),a=new ResponseData(!1,"","","","",this),a.SetResumeData(i.Data(),this.choices,this.statements),this.lmsResponses.push(a),r=this.choices[a.ChoiceID()],a=this.statements[a.StatementID()],r&&(r.selected=!0,this.responses[r.longID]=r,this.m_bUnanswered=!1,a&&(r.addPair(a),a.addPair(r))),i=i.Remainder();this.evaluate(!0,!0,!0,!0)}Interaction.updateScore("from restoreFromResumeChunk")},Interaction.prototype.GetResumeData=function(){var t="",e=this.attempts.length,i=parseInt(this.variables.Points)||0,r=this.variables.Status,t=t+bwChunk.UBase10toN(e,2),t=t+(this.m_bAnswered?"1":"0"),t=t+(this.m_bUnanswered?"1":"0");if(e>0){switch(r){case"correct":t+="0";break;case"incomplete":t+="1";break;case"incorrect":t+="2";break;case"neutral":t+="3"}t+=bwChunk.CreateChunk(bwChunk.Base10toN(i)),e>1&&(i=(e=this.attempts[this.attempts-1])?parseInt(e.pointsAwarded)||0:0),t+=bwChunk.CreateChunk(bwChunk.Base10toN(i)),t+=bwChunk.CreateChunk(bwChunk.Base10toN(this.m_nUserAnswerIndex))}else for(t+=bwChunk.UBase10toN(this.lmsResponses.length,2),e=0;e<this.lmsResponses.length;e++)t+=bwChunk.CreateChunk(this.lmsResponses[e].GetResumeData(this.choices,this.statements));return t},Interaction.prototype.updateBaseFromData=Element.prototype.updateFromData,Interaction.prototype.updateFromData=function(t){this.updateBaseFromData(t),t.responses&&(this.responses={},$.each(t.responses,function(){})),t.attempts&&(this.attempts=t.attempts)},Interaction.prototype.resetBase=Element.prototype.reset,Interaction.prototype.reset=function(){this.resetBase(),this.choices={},this.answers={},this.statements={},this.responseActions=[],this.responses={},this.correctResponses={},this.lmsResponses=[],this.lmsCorrectResponses=[],this.attempts=[],this.variables={},this.loadFromXML(this.xml,this.parent),this.m_nUserAnswerIndex=-1},Interaction.prototype.loadFromXML=function(t,e){var i=this;this.slide=this.parent=e,this.children={},this.xml=t,this.id=$(t).attr("id"),this.lmsid=$(t).attr("lmsid"),this.lmstext=$(t).attr("lmstext"),this.interactionType=$(t).attr("type"),this.maxpoints=$(t).attr("maxpoints"),this.aoinclude=$(t).attr("aoinclude"),this.istracked=$(t).attr("istracked"),this.issurvey="true"==$(t).attr("issurvey"),$(t).children("choices").children("choice").each(function(t,e){var r=new Choice;r.loadFromXML(e,this),r.longID="choices."+r.id,i.choices[r.id]=r,i.children[r.id]=r}),$(t).children("statements").children("statement").each(function(t,e){var r=new Choice;r.loadFromXML(e,this),r.innerType="Statement",r.longID="statements."+r.id,i.statements[r.id]=r,i.children[r.id]=r}),$(t).children("answers").children("answer").each(function(t,e){var r=new Answer;r.loadFromXML(e,this),i.answers[r.id]=r,i.children[r.id]=r}),this.responseActions=$(t).children("response_definition").children("actions").children(),this.variables.AttemptCount=0,this.variableDefaults.AttemptCount=0},Interaction.prototype.evaluate=function(t,e,i,r){var a=this,s=this.slide;this.scoreAO=!e,r||(s.responses={},this.responses={},this.lmsResponses=[]),this.lmsCorrectResponses=[],this.variables.AttemptCount++,this.partialEvaluate&&(this.variables.AttemptCount=1),r||($.each(a.choices,function(t,e){e.selected=!1,e.pairs=[]}),$.each(a.statements,function(t,e){e.pairs=[]}),$.each(this.responseActions,function(t,e){s.runAction(e)}));var n=!1,o=!0,l=0;$.each(this.answers,function(t,e){$.each(e.evaluate,function(){l++})});var h,p=0;for(h in a.responses)p++;this.m_bUnanswered=!0;var c=0;$.each(this.answers,function(e,r){var h=!0,d=!1,u=0;$.each(r.evaluate,function(){u++});var f=0<parseInt(r.points);$.each(r.evaluate,function(t,e){switch(e.tagName){case"other":h=o||n?1==l?!0:!1:!0;break;case"equals":var i=$(e).attr("choiceid"),i=a.parseObjref(i).target;switch(h=h&&i.selected,d=d||i.selected,a.interactionType){case"fillin":case"numeric":h=d;break;case"multipleresponse":p!=u&&(h=!1)}f&&a.lmsCorrectResponses.push(new ResponseData(!1,i.id,"",i.lmstext,""));break;case"condition":h=h&&s.evaluateCondition(e,a);break;case"pair":var i=$(e).attr("choiceid"),c=$(e).attr("statementid"),i=a.parseObjref(i).target,c=a.parseObjref(c).target,m=i.hasPair(c);if(m){var y=i.findPair(c),g=0;$.each(r.evaluate,function(t,e){-1<$(e).attr("statementid").indexOf(y.id)&&g++}),m=m&&g==y.pairs.length}h=h&&m,d=d||m,f&&a.lmsCorrectResponses.push(new ResponseData(!0,i.id,c.id,i.lmstext,c.lmstext))}}),h&&(d=!0),d&&(a.m_bUnanswered=!1,a.m_bAnswered=!0),i?(a.partialEvaluate||(a.partialEvaluate={}),a.partialEvaluate.attemptCount=a.variables.AttemptCount,h&&(a.partialEvaluate.status=r.status,a.partialEvaluate.points=r.points,a.m_nUserAnswerIndex=c,n=!0)):h&&(a.variables.Status=r.status,a.variables.Points=r.points,a.m_nUserAnswerIndex=c,t||$.each(r.actions,function(t,e){s.runAction(e)}),n=!0),o=!1,c++}),Interaction.updateScore("from interaction evaluate: "+a.id),i?(p>0&&(this.m_bAnswered=!0),this.variables.AttemptCount--):(n||this.variables.AttemptCount--,this.partialEvaluate=null,this.noteAttempt(),player.lmsManager.handleInteractionEvaluated(this))},Interaction.prototype.noteAttempt=function(){var t={time:player.elapsedTime(),isfinal:!0,sent:!1,pointsAwarded:this.variables.Points,result:this.variables.Status,answers:[]};$.each(this.lmsResponses,function(e,i){t.answers.push(i.m_bPairResponse?{statementid:i.statementLMSText,choiceid:i.lmstext}:{choiceid:i.lmstext})}),this.attempts.push(t)},Interaction.prototype.Answered=function(){return this.m_bAnswered?"true":"false"},Interaction.updateScore=function(){$.each(story.quizzes,function(t,e){var i=0,r=0,a=0;$.each(e.sliderefs,function(t,s){var n=story.parseObjref(s).target;if(n){var o=function(t,e){a++,r+=parseInt(e.maxpoints);var s=parseInt(e.variables.Points)||0;i+=s};"SlideDraw"==n.innerType&&$.each(n.children,function(t,i){!i.hasRestoredInteractions&&i.compactResumeData&&i.restoreFromResumeData(i.compactResumeData,!0),("partial"!=e.scoretype||i.variables.Visited)&&$.each(i.interactions,o)}),("partial"!=e.scoretype||n.variables.Visited)&&$.each(n.interactions,o)}}),e.variables.Score=i,e.maxscore=r,e.variables.PercentScore=parseFloat(parseInt(1e4*i/r)/100),isNaN(e.variables.PercentScore)&&(e.variables.PercentScore=0),e.variables.PassScore=Math.ceil(parseFloat(e.variables.PassPercent*r/100)),window&&window.g_oContentResults&&(window.g_oContentResults.nScore=e.variables.PercentScore),e.handleVarChanged(e.getFullVariableRef("Score"),"onvarchanged")}),$.each(story.quizzes,function(t,e){if(0!=e.quizrefs.length){var i=0,r=0;$.each(e.quizrefs,function(t,e){var a=story.parseObjref(e.id).target;a&&!isNaN(a.variables.Score)&&(i+=a.variables.Score,r+=a.maxscore)}),e.variables.Score=i,e.maxscore=r,e.variables.PercentScore=parseFloat(parseInt(1e4*i/r)/100),isNaN(e.variables.PercentScore)&&(e.variables.PercentScore=0),e.variables.PassScore=Math.ceil(parseFloat(e.variables.PassPercent*r/100)),window&&window.g_oContentResults&&(window.g_oContentResults.nScore=e.variables.PercentScore),e.handleVarChanged(e.getFullVariableRef("Score"),"onvarchanged")}})},Interaction.partialEvaluateSlide=function(t){$.each(t.interactions,function(t,e){(!e.variables.Status||"unanswered"==e.variables.Status)&&e.evaluate(!0,!0,!0)})},Interaction.eval_all_unanswered=function(){var t=function(t){t.compactResumeData&&t.restoreFromResumeData(t.compactResumeData,!0);var e=!1;$.each(t.interactions,function(t,i){if(!i.variables.Status||"unanswered"==i.variables.Status)for(i.partialEvaluate||i.evaluate(!0,!0,!0),i.partialEvaluate&&(i.variables.Status=i.partialEvaluate.status,i.variables.Points=i.partialEvaluate.points,i.variables.AttemptCount=i.partialEvaluate.attemptCount),i.variables.Status||(i.variables.Status="unanswered"),e=!0;i.attempts.length<i.variables.AttemptCount;){var r={time:player.elapsedTime(),isfinal:!0,sent:!1,pointsAwarded:i.variables.Points,result:i.variables.Status,answers:[]};i.attempts.push(r)}i.m_bAnswered=!0}),e&&t.rebuildInteractionData()};$.each(story.quizzes,function(e,i){i.m_bEvaluated=!0,$.each(i.sliderefs,function(e,i){var r=story.parseObjref(i).target;r&&("SlideDraw"==r.innerType?$.each(r.children,function(e,i){t(i)}):t(r))})}),Interaction.updateScore("from eval_all_unanswered")},Interaction.setquizcomplete=function(t){t=story.parseObjrefFromXML(t).target,t.m_bCompleted=!0,player.lmsManager.handleQuizComplete(t)},Scoring.prototype.loadFromXML=function(t,e){var i=this;this.parent=e,this.scorerefs={},this.id=$(t).attr("id"),this.type=$(t).attr("type"),this.passpercent=$(t).attr("passpercent"),this.viewthreshold=parseInt($(t).attr("viewthreshold")),this.passstatus=$(t).attr("passstatus"),this.failstatus=$(t).attr("failstatus"),isNaN(this.viewthreshold)&&(this.viewthreshold=0),$(t).children("scorerefs").children("scoreref").each(function(t,e){var r={};r.type=$(e).attr("type"),r.ref=$(e).attr("ref"),r.weight=$(e).attr("weight"),r.maxvalue=$(e).attr("maxvalue"),r.mustpass=$(e).attr("mustpass"),i.scorerefs[r.ref]=r})},AOClient.prototype.call=function(t,e,i,r){var a="http://articulate.com/KnowledgeFlash/Services/Content/Api/"+t,s=$.parseXML(e),n=this,o=this.endpoint+"?rand="+Math.random();$.ajax({url:o,type:"POST",dataType:"xml",data:s,headers:{SOAPAction:a},processData:!1,contentType:'text/xml; charset="utf-8"',cache:!1,success:function(t,e,r){i&&i(t,e,r)},error:function(){return-1<location.search.indexOf("aodebug="),r&&!window.manuallyClosing&&confirm("Unable to connect to the server.  Please verify you can connect to the internet. Retry?")&&n.call(t,e,i,r),!1}})},AOClient.prototype.wrapWithEnvelope=function(t){return'<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body>'+t+"</soap:Body></soap:Envelope>"},AOClient.prototype.getVanillaXML=function(t){return this.wrapWithEnvelope("<"+t+' xmlns="http://articulate.com/KnowledgeFlash/Services/Content/Api"><contentUrl>'+escape(location.href)+"</contentUrl></"+t+">")},AOClient.prototype.GetApiVersion=function(){var t=this;this.call("GetApiVersion",this.getVanillaXML("GetApiVersion"),function(e){this.apiVersion=$(e).find("GetApiVersionResult").text(),t.apiVersionReturned=!0})},AOClient.prototype.GetSessionId=function(){var t=this;this.call("GetSessionId",this.getVanillaXML("GetSessionId"),function(e){player.aoSessionID=$(e).find("GetSessionIdResult").text(),t.getSessionIdReturned=!0})},AOClient.prototype.GetResumeInfo=function(){var t=this;this.call("GetResumeInfo",this.getVanillaXML("GetResumeInfo"),function(e){e=$(e).find("GetResumeInfoResult").text(),player.aoResumeData=e,t.getResumeInfoReturned=!0})},AOClient.prototype.RefreshSession=function(){this.call("RefreshSession",this.getVanillaXML("RefreshSession"),function(t){$(t).find("RefreshSessionResult").text()})},AOClient.prototype.SetViewBasedComplete=function(){},AOClient.prototype.SavePlayerData=function(){this.call("SavePlayerData",this.wrapWithEnvelope(story.toAOData()),function(){var t=story.getDescendantsByType("Interaction");$.each(t,function(t,e){$.each(e.attempts,function(t,e){e.sent=!0})})},!0),this.sendcount++},AOClient.prototype.SaveResume=function(){var t="",t=player.useCompactResume?story.toResumeData():JSON.stringify(story.toData(!0));this.call("SaveResume",this.wrapWithEnvelope('<SaveResume xmlns="http://articulate.com/KnowledgeFlash/Services/Content/Api"><contentUrl>'+escape(location.href)+'</contentUrl><playerdata sessionid="string"><resumeData>'+t+"</resumeData></playerdata></SaveResume>"),function(){})},AOClient.prototype.reCapitalize=function(t,e){return $.each(e,function(e,i){t=t.replace(RegExp("<"+i,"ig"),"<"+i),t=t.replace(RegExp("</"+i,"ig"),"</"+i),t=t.replace(RegExp(i+'="',"ig"),i+'="')}),t},AOClient.prototype.handleInteractionEvaluated=function(){(player.isIOS||-1<location.search.indexOf("aoforce=1"))&&player.aoClient.SavePlayerData(!0)},AOClient.prototype.init=function(){var t=this;this.GetApiVersion(),this.GetSessionId(),this.GetResumeInfo(),this.refreshInterval=setInterval(function(){t.RefreshSession()},6e4);var e=!1;$(window).bind("unload beforeunload",function(){e||(t.SavePlayerData(!1),e=!0)})},AOClient.prototype.isReady=function(){return 1==this.apiVersionReturned&&1==this.getSessionIdReturned&&1==this.getResumeInfoReturned?!0:!1},Interaction.prototype.toAOData=function(){var t=this,e=$("<interaction/>");return e.attr("idRef",this.getFullObjref()),e.attr("type",this.interactionType),$.each(this.attempts,function(i,r){var a=$("<attempt/>");switch(a.attr("time",r.time),a.attr("final",r.isfinal),a.attr("sent",r.sent),a.attr("pointsAwarded",r.pointsAwarded),a.attr("result",r.result),t.interactionType){case"fillin":case"numeric":$.each(r.answers,function(t,e){var i=$("<answer/>");i.get(0).innerHTML=e.choiceid,a.append(i)});break;case"matching":case"sequence":$.each(r.answers,function(t,e){var i=$("<answer/>");i.attr("statementid",e.statementid),i.attr("choiceid",e.choiceid),a.append(i)});break;default:$.each(r.answers,function(t,e){var i=$("<answer/>");i.attr("choiceid",e.choiceid),a.append(i)})}e.append(a)}),e},Quiz.prototype.toAOData=function(){var t=$("<quiz/>");t.attr("idRef",this.getFullObjref()),t.attr("score",this.variables.Score),t.attr("possibleScore",this.maxscore),t.attr("duration",player.elapsedTime()),this.status=parseInt(this.variables.Score)>=parseInt(this.variables.PassScore)?story.scoring.passstatus:story.scoring.failstatus,t.attr("status",this.status);var e=$("<interactions/>");return $.each(this.sliderefs,function(t,i){function r(t){$.each(t.interactions,function(t,i){(i.scoreAO||player.forceAO)&&e.append($(i.toAOData()))})}var a=story.parseObjref(i).target;"SlideDraw"==a.innerType?$.each(a.children,function(t,e){r(e)}):r(a)}),t.append(e),t.get(0).outerHTML},Storyline.prototype.toAOData=function(){var t=$('<SavePlayerData xmlns="http://articulate.com/KnowledgeFlash/Services/Content/Api"/>');t.append($("<contentUrl>"+location.href+"</contentUrl>"));var e=$("<playerdata/>");e.attr("sessionid",player.aoSessionID),e.attr("sendcount",player.aoClient.sendcount);var i=story.toResumeData();e.append($("<resumeData>"+i+"</resumeData>")),$.each(this.allSlides,function(t,e){if(e!=player.currentSlide()&&e.compactResumeData&&!e.hasRestoredInteractions)try{e.restoreFromResumeData(e.compactResumeData,!0)}catch(i){}e.hasRestoredInteractions=!0});var i=$("<results/>"),r=$("<summary/>"),a=$("<quizzes/>"),s=$("<viewdata/>"),n=0,o=0,l=story.scoring.failstatus,h=0,p=0,c=0;$.each(this.quizzes,function(t,e){n+=parseInt(e.variables.Score),o+=e.maxscore,a.append($(e.toAOData())),l=e.status}),c=0,$.each(this.allSlides,function(t,e){if(e.trackviews&&(c++,e.variables.Visited)){p++,e.viewedCurrent&&h++;var i=$("<slide/>");i.attr("id",e.getFullObjref()),s.append(i)}}),s.attr("total",c),s.attr("viewed",h),s.attr("viewedcomplete",p),e.append(s);var d=parseFloat(parseInt(1e4*n/o)/100);return isNaN(d)&&(d=0),"view"==story.scoring.type?(0<story.scoring.viewthreshold&&p>=story.scoring.viewthreshold&&(l=story.scoring.passstatus),r.attr("slidesviewed",p),r.attr("slidestotal",c),r.attr("duration",player.elapsedTime()),r.attr("status",l)):"survey"==story.scoring.type?(r.attr("duration",player.elapsedTime()),r.attr("status",l)):(r.attr("score",d),r.attr("possibleScore",100),r.attr("duration",player.elapsedTime()),r.attr("status",l),i.append(a)),i.append(r),e.append(i),t.append(e),player.aoClient.reCapitalize(t.get(0).outerHTML,"SavePlayerData,resumeData,contentUrl,idRef,pointsAwarded,possibleScore".split(","))},LMSClient.prototype.initResume=function(){var t="";return window&&window.lms_DoFSCommand&&(window.hasLMS=!0,window.lmsAPI=parent,!parent.GetDataChunk&&window.GetDataChunk&&(window.lmsAPI=window),window.lmsAPI.GetDataChunk||(window.g_bAPIPresent=!1,window.g_bLMSPresent=window.lmsAPI.IsLmsPresent&&window.lmsAPI.IsLmsPresent()),window.g_bAPIPresent=!0,window.lmsAPI.GetDataChunk||(window.g_bAPIPresent=!1,window.hasLMS=!1,player.hasLMS=!1,player.lmsManager.hasLMS=!1),window.g_bLMSPresent=window.lmsAPI.IsLmsPresent&&window.lmsAPI.IsLmsPresent(),window.g_bAPIPresent&&(t=window.lmsAPI.GetDataChunk("cmi.suspend_data"),window.lmsAPI.g_strResumeData=t,window.g_strResumeData=t,window.LMSCommit(),window.lms_DoFSCommand("BW_InitResume"))),t},LMSClient.prototype.handleInteractionEvaluated=function(t){if("view"!=story.scoring.type){t=t.toLMSData();try{window.lms_DoFSCommand("BW_StoreQuestionResult",t)}catch(e){}window.lms_DoFSCommand("BW_UpdateStatus")}},LMSClient.prototype.handleClosePlayer=function(){try{window.lms_DoFSCommand("BW_ClosePlayer")}catch(t){}},LMSClient.prototype.sendResumeData=function(){if(player.useCompactResume){var t=story.toResumeData();lms_DoFSCommand("BW_SetResumeData",t)}},LMSClient.prototype.reportViewBasedComplete=function(){window.g_oContentResults.nScore=100,window.g_oContentResults.strStatus=story.scoring.passstatus,window.g_oContentResults.strType="view",window.lms_DoFSCommand("BW_UpdateViewStatus",window.g_oContentResults.strStatus+"|~|view")},Interaction.prototype.toLMSData=function(){var t=[],e=this.parent,i=null;if($.each(story.quizzes,function(t,r){$.each(r.sliderefs,function(t,a){var s=story.parseObjref(a).target;s==e&&(i=r),"SlideDraw"==s.innerType&&$.each(s.children,function(t,a){a==e&&(i=r)})})}),!e||!i)return"";for(var r=i.attemptCount,a=parseInt(this.variables.AttemptCount-1),s=0,n=0;n<i.sliderefs.length;n++)-1<i.sliderefs[n].indexOf(e.id)&&(s=n+1);return t.push(i.id),t.push(e.parent.lmsid+"_"+e.lmsid+"_"+this.lmsid+"_"+r+"_"+a),t.push(this.lmsid),t.push(this.interactionType),t.push(this.concatChoices(this.lmsCorrectResponses)),t.push(this.concatChoices(this.lmsResponses)),t.push("0"),t.push(this.variables.Status),t.push(this.variables.Points),t.push(GetTime(new Date)),t.push("1"),t.push(s),t.push(this.lmstext),t.push(i.lmstext),t.push(this.istracked),t.join(window.g_strLDelim||"|~|")},Interaction.prototype.concatChoices=function(t){var e=[],i=window.g_strLInteractionDelim||"|#|";return $.each(t,function(t,i){i.m_bPairResponse&&e.push(i.statementLMSText),e.push(i.lmstext)}),e.join(i)},Quiz.prototype.reportLMSStatus=function(){if("view"!=story.scoring.type){var t=[],e="",e=parseInt(this.variables.Score)>=parseInt(this.variables.PassScore)?story.scoring.passstatus:story.scoring.failstatus,i=100*this.variables.Score/this.maxscore,r=100*this.variables.PassScore/this.maxscore;t.push(e),t.push(i),t.push(0),t.push(100),t.push(r),t.push("quiz"),t=t.join(window.g_strLDelim||"|~|"),window.g_oContentResults.nScore=i,window.g_oContentResults.strStatus=e,window.lms_DoFSCommand("BW_UpdateStatus",t)}},LMSManager.prototype.initResume=function(){return this.hasLMS?player.lmsClient.initResume():void 0},LMSManager.prototype.handleInteractionEvaluated=function(t){this.hasAO?player.aoClient.handleInteractionEvaluated(t):this.hasLMS?player.lmsClient.handleInteractionEvaluated(t):this.hasTinCan&&player.tinCanClient.handleInteractionEvaluated(t)},LMSManager.prototype.handleSlideViewed=function(t){t.trackviews&&(this.viewedSlides[t.id]=!0),t.viewedCurrent=!0;var e=Object.keys(this.viewedSlides).length;0<story.scoring.viewthreshold&&"view"==story.scoring.type&&e>=story.scoring.viewthreshold&&(this.hasAO?(player.aoClient.SetViewBasedComplete(),player.aoClient.SavePlayerData(!0)):this.hasLMS?(console.log("reporting view based completion to LMS"),$.each(story.quizzes,function(){}),player.lmsClient.reportViewBasedComplete(),player.lmsClient.sendResumeData()):this.hasTinCan&&player.tinCanClient.reportViewBasedComplete(e)),this.hasLMS?player.lmsClient.sendResumeData():this.hasAO?player.aoClient.SaveResume():this.hasTinCan&&(player.tinCanClient.handleSlideViewed(t),player.tinCanClient.sendResumeData())},LMSManager.prototype.handleQuizComplete=function(t){this.hasAO&&player.aoClient.SavePlayerData(!0),this.hasLMS&&t.reportLMSStatus(),this.hasTinCan&&player.tinCanClient.reportQuizComplete(t)},LMSManager.prototype.handleClosePlayer=function(){this.hasLMS&&player.lmsClient.handleClosePlayer(),this.hasTinCan&&player.tinCanClient.handleClosePlayer()},LMSManager.prototype.init=function(){globals.bAOSupport||window.g_bAOSupport||player.useAO?(player.aoClient=new AOClient,player.aoClient.init(),this.hasAO=!0):globals.bTinCan||window.g_bTinCan||player.useTinCan?(player.tinCanClient=new TinCanClient,player.tinCanClient.init(),this.hasTinCan=!0):window&&window.lms_DoFSCommand&&(player.lmsClient=new LMSClient,player.hasLMS=!0,window.lmsAPI=parent,!parent.GetDataChunk&&window.GetDataChunk&&(window.lmsAPI=window),window.g_bAPIPresent=!0,window.g_bLMSPresent=window.lmsAPI.IsLmsPresent&&window.lmsAPI.IsLmsPresent(),this.hasLMS=!0)},LMSManager.prototype.isReady=function(){return this.hasAO?player.aoClient.isReady():this.hasTinCan?player.tinCanClient.isReady():!0;
},window){window.g_oContentResults=new ContentResults,window.g_listQuizzes={};var unloadFired=!1;$(window).bind("unload beforeunload",function(){!unloadFired&&parent.LMSUnload&&(parent.LMSUnload(),unloadFired=!0)})}var TC_PARAM_AUTH="auth",TC_PARAM_REG="registration",TC_PARAM_ACTIVITY_ID="activity_id",TC_PARAM_ACTOR="actor",TC_PARAM_ENDPOINT="endpoint",TC_PARAM_GROUPING="grouping",TC_PARAM_CONTENT_ENDPOINT="content_endpoint",TC_PARAM_CONTENT_TOKEN="content_token",REQ_TYPE_RESUME_SAVE=1,REQ_TYPE_RESUME_RESTORE=2,REQ_TYPE_TRACKING=3;ppTinCanComm.prototype.PostOnClose=function(){for(this.m_bStopPosting=!0;0<this.m_arrTinCanMsgQueue.length;){var t=this.m_arrTinCanMsgQueue.shift();PostSyncRequest(t)}},ppTinCanComm.prototype.GetAuth=function(){return this.m_listParams[TC_PARAM_AUTH]},ppTinCanComm.prototype.GetRegistration=function(){return this.m_listParams[TC_PARAM_REG]},ppTinCanComm.prototype.GetActivityId=function(){return this.m_listParams[TC_PARAM_ACTIVITY_ID]},ppTinCanComm.prototype.GetActor=function(){return this.m_listParams[TC_PARAM_ACTOR]},ppTinCanComm.prototype.GetActorObj=function(){return this.m_jsActor},ppTinCanComm.prototype.GetEndPoint=function(){return this.m_listParams[TC_PARAM_ENDPOINT]},ppTinCanComm.prototype.GetGrouping=function(){return this.m_listParams[TC_PARAM_GROUPING]},ppTinCanComm.prototype.ParseQueryString=function(t){for(var t=t.split("&"),e="",i="",e="",r=0,a=0;a<t.length;a++)switch(e=t[a],r=e.indexOf("="),i=decodeURIComponent(e.substr(0,r)),e=decodeURIComponent(e.substr(r+1)),this.m_listParams[i]=e,i){case TC_PARAM_ACTOR:this.m_jsActor=JSON.parse(e);break;case TC_PARAM_AUTH:case TC_PARAM_GROUPING:case TC_PARAM_ACTIVITY_ID:case TC_PARAM_REG:case TC_PARAM_ENDPOINT:case TC_PARAM_CONTENT_ENDPOINT:case TC_PARAM_CONTENT_TOKEN:break;default:this.m_listCustomParams[i]=e}},ppTinCanComm.prototype.ConvertToPost=function(t,e,i,r,a,s){var n,o="";for(n in a)o+=n+"="+encodeURIComponent(a[n])+"&";0<r.length&&(o+="content="+encodeURIComponent(r)),this.SendRequest(new ppTinCanRequest(t,"POST",o,e+"?method="+i,s))},ppTinCanComm.prototype.GetHeaders=function(){var t={};t.Authorization=this.m_listParams[TC_PARAM_AUTH],t.registration=this.m_listParams[TC_PARAM_REG],t["Content-Type"]="application/json";for(var e in this.m_listCustomParams)t[e]=this.m_listCustomParams[e];return t},ppTinCanComm.prototype.SendRequest=function(t){this.m_bWaitingTinCanResponse||this.m_bStopPosting?this.m_arrTinCanMsgQueue.push(t):this.PostAsyncRequest(t)},ppTinCanComm.prototype.PostAsyncRequest=function(t){try{this.UseXDomainRequest(t.Url)?this.PostXDomainRequest(t,!1):this.PostXmlHttp(t)}catch(e){confirm("Unable to connect to server.  Please verify that you are connected to the internet. Retry?")?(this.m_bWaitingTinCanResponse=!1,this.SendRequest(t)):(this.m_bFatalError=this.m_bStopPosting=!0,this.m_pfnFatalError(0))}},ppTinCanComm.prototype.PostXDomainRequest=function(t,e){var i=new XDomainRequest;if(i.open(t.Method,t.Url),i.TCRequest=t,i.TCComm=this,i.status=0,i.onload=function(){i.status=200,e||this.TCComm.OnSendComplete(i)},i.onerror=function(){i.status=-1,e||this.TCComm.OnSendError(i)},i.send(strData),e)for(var r=(new Date).getTime();5e3>(new Date).getTime()-r&&0==i.status;){var a=new XMLHttpRequest;a.open("GET",window.location+"?"+(new Date).getTime(),!1),a.send(null)}return i.status},ppTinCanComm.prototype.PostXmlHttp=function(t){var e=this.CreateXmlHttp();null!=e&&(this.m_bWaitingTinCanResponse=!0,e.TCRequest=t,e.TCComm=this,e.onreadystatechange=function(){4==e.readyState&&(400<=e.status&&(!this.m_bIE||1223!=e.status)?this.TCComm.OnSendError(e):this.TCComm.OnSendComplete(e))},e.open(t.Method,t.Url,!0),e.send(t.Data))},ppTinCanComm.prototype.OnSendComplete=function(t){null!=t.TCRequest.Callback&&void 0!=t.TCRequest.Callback&&t.TCRequest.Callback(t.responseText),this.m_bWaitingTinCanResponse=!1,0<this.m_arrTinCanMsgQueue.length&&!this.m_bStopPosting&&this.SendRequest(this.m_arrTinCanMsgQueue.shift())},ppTinCanComm.prototype.OnSendError=function(t){t.TCRequest.MessageType==REQ_TYPE_RESUME_RESTORE?(t.TCRequest.Callback(""),this.m_bWaitingTinCanResponse=!1,0<this.m_arrTinCanMsgQueue.length&&!this.m_bStopPosting&&this.SendRequest(this.m_arrTinCanMsgQueue.shift())):confirm("Unable to connect to server.  Please verify that you are connected to the internet. Retry? ")?(this.m_bWaitingTinCanResponse=!1,this.SendRequest(t.TCRequest)):(this.m_bFatalError=this.m_bStopPosting=!0,t.status&&this.m_pfnFatalError(t.status))},ppTinCanComm.prototype.CreateXmlHttp=function(){var t=null,e=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],i=0;if(window.XMLHttpRequest)try{t=new XMLHttpRequest}catch(r){t=null}if(null==t&&window.ActiveXObject)for(;null==t&&i<e.length;){try{t=new ActiveXObject(e[i])}catch(a){t=null}i++}return t},ppTinCanComm.prototype.PostSyncRequest=function(t){try{var e=0,e=this.UseXDomainRequest(t.Url)?this.PostXDomainRequest(t,!0):this.PostSyncXmlHttp(t);200!=e&&(confirm("Could not save the result data. You may need to login again. Retry?")?this.PostSyncRequest(t):this.m_bFatalError=!0)}catch(i){confirm("Unable to connect to server.  Please verify that you are connected to the internet. Retry?")?this.PostSyncRequest(t):this.m_bFatalError=!0}},ppTinCanComm.prototype.PostSyncXmlHttp=function(t){var e=this.CreateXmlHttp(),i=200;return null!=e&&(e.open(t.Method,t.Url,!1),e.send(t.Data),400<=e.status&&!(this.m_bIE&&1223==e.status)&&(i=-1)),i},ppTinCanComm.prototype.UseXDomainRequest=function(t){var e=!1;if(this.m_bIE){this.CreateXmlHttp();var e=document.createElement("a"),i=document.createElement("a");e.href=t,i.href=window.location,e=e.hostname!=i.hostname||e.protocol!=i.protocol||e.port!=i.port}return e};var TC_DELIM_CHOICE="[,]",TC_DELIM_STATEMENT="[.]";ppTinCanApi.prototype.PostOnClose=function(){this.m_tcComm.PostOnClose()},ppTinCanApi.prototype.RequestResumeData=function(t){var e=this.m_tcComm.GetHeaders();e.activityId=this.m_tcComm.GetActivityId(),e.actor=this.m_tcComm.GetActor(),e.stateId="resume",this.m_tcComm.ConvertToPost(REQ_TYPE_RESUME_RESTORE,this.m_tcComm.GetEndPoint()+"activities/state","GET","",e,t)},ppTinCanApi.prototype.UpdateResumeData=function(t){var e=this.m_tcComm.GetHeaders();e.activityId=this.m_tcComm.GetActivityId(),e.actor=this.m_tcComm.GetActor(),e.stateId="resume",this.m_tcComm.ConvertToPost(REQ_TYPE_RESUME_SAVE,this.m_tcComm.GetEndPoint()+"activities/state","PUT",t,e,null)},ppTinCanApi.prototype.NotifyCourseComplete=function(t,e,i,r){var a={id:this.m_tcComm.GetActivityId()},s="completed";i||(s=e?"passed":"failed"),a={verb:s,object:a,context:this.GetContext(this.m_tcComm.GetActivityId())},a.result=i?{duration:this.ConvertMSToISO(r)}:{score:{scaled:t/100},success:e?"true":"false",duration:this.ConvertMSToISO(r)},this.PutStatement(a,REQ_TYPE_TRACKING)},ppTinCanApi.prototype.NotifyQuizComplete=function(t,e,i,r,a,s){var n={id:r},o="completed";s||(o=a?"passed":"failed"),r={verb:o,object:n,context:this.GetContext(r)},s||(r.result={score:{scaled:t/100,raw:e,min:0,max:i},success:a?"true":"false"}),this.PutStatement(r,REQ_TYPE_TRACKING)},ppTinCanApi.prototype.NotifyCourseStarted=function(){this.PutStatement({verb:"attempted",object:{id:this.m_tcComm.GetActivityId()},context:this.GetContext(this.m_tcComm.GetActivityId())},REQ_TYPE_TRACKING)},ppTinCanApi.prototype.NotifyViewedComplete=function(t,e){var i={id:this.m_tcComm.GetActivityId()},r={completion:!0,duration:this.ConvertMSToISO(e),extensions:{viewcount:t}};this.PutStatement({verb:"completed",object:i,result:r,context:this.GetContext(this.m_tcComm.GetActivityId())},REQ_TYPE_TRACKING)},ppTinCanApi.prototype.NotifySlideViewed=function(t){this.PutStatement({verb:"experienced",object:{id:t},context:this.GetContext(this.m_tcComm.GetActivityId())},REQ_TYPE_TRACKING)},ppTinCanApi.prototype.LogQuestion=function(t,e,i,r,a,s,n,o){"likert"==a?this.LogLikertQuestion(t,e,i,r):this.LogNormalQuestion(t,e,i,r,a,s,n,o)},ppTinCanApi.prototype.LogLikertQuestion=function(t,e,i,r){if(null!=r&&0<r.length)for(var a=null,s=0,s=0;s<r.length;s++){var a=r[s],n={id:e+"."+i+"."+this.GetSimpleId(a.Statement)},a={response:this.GetSimpleId(a.Choice)};this.PutStatement({verb:"answered",object:n,result:a,context:this.GetContext(t)},REQ_TYPE_TRACKING)}},ppTinCanApi.prototype.LogNormalQuestion=function(t,e,i,r,a,s,n,o){var l="",a=this.NormalizeType(a),h=0,p=null;if(null!=r&&0<r.length)switch(a){case"fill-in":case"numeric":for(h=0;h<r.length;h++)p=r[h],h>0&&(l+=TC_DELIM_CHOICE),l+=p.Choice;break;case"sequencing":case"true-false":case"choice":for(h=0;h<r.length;h++)p=r[h],h>0&&(l+=TC_DELIM_CHOICE),l+=this.GetSimpleId(p.Choice);break;case"matching":for(h=0;h<r.length;h++)p=r[h],h>0&&(l+=TC_DELIM_CHOICE),l+=this.GetSimpleId(p.Statement)+TC_DELIM_STATEMENT+this.GetSimpleId(p.Choice)}e={id:e+"."+i},l={response:l},s||(l.success=n,l.score={raw:o}),this.PutStatement({verb:"answered",object:e,result:l,context:this.GetContext(t)},REQ_TYPE_TRACKING)},ppTinCanApi.prototype.PutStatement=function(t){t.actor=this.m_tcComm.GetActorObj();var e=this.m_tcComm.GetHeaders();e.statementId=this.GetUUID(),this.m_tcComm.ConvertToPost(REQ_TYPE_TRACKING,this.m_tcComm.GetEndPoint()+"statements/","PUT",JSON.stringify(t),e,null)},ppTinCanApi.prototype.GetContext=function(t){return{contextActivities:{grouping:{id:this.m_tcComm.GetActivityId()},parent:{id:t}},registration:this.m_tcComm.GetRegistration()}},ppTinCanApi.prototype.GetSimpleId=function(t){var e=t.lastIndexOf(".");return e>=0&&(t=t.substr(e+1)),t},ppTinCanApi.prototype.NormalizeType=function(t){var e="";switch(t){case"truefalse":e="true-false";break;case"wordbank":case"hotspot":case"multiplechoice":case"multipleresponse":e="choice";break;case"essay":case"fillin":case"numeric":e="fill-in";break;case"matching":e="matching";break;case"sequence":e="sequencing";break;case"likert":e="likert"}return e},ppTinCanApi.prototype.GetUUID=function(){var t;return t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/x/g,function(){return Math.floor(16*Math.random()).toString(16)}),t=t.replace(/y/g,(Math.floor(4*Math.random())+8).toString(16))},ppTinCanApi.prototype.ConvertMSToISO=function(t){var e="P",t=Math.floor(t/10),i=0,r=0,a=0,a=Math.floor(t/864e4),t=t-864e4*a,r=Math.floor(t/36e4),t=t-36e4*r,i=Math.floor(t/6e3);return a>0&&(e+=a+"D"),e+"T"+(r+"H")+(i+"M")+((t-6e3*i)/100+"S")},TinCanClient.prototype.GetResumeData=function(){var t=this;this.api.RequestResumeData(function(e){player.tinCanResumeData=e,t.getResumeDataReturned=!0})},TinCanClient.prototype.SetViewBasedComplete=function(){},TinCanClient.prototype.SavePlayerData=function(){},TinCanClient.prototype.handleSlideViewed=function(t){this.api.NotifySlideViewed(t.id)},TinCanClient.prototype.handleInteractionEvaluated=function(t){var e=t.parent,i=e.quiz,r=$.map(t.lmsResponses,function(t){return t.IsPair()?new ppResponsePair(t.ChoiceID(),t.StatementID()):new ppResponsePair(t.ChoiceID(),"")}),a="correct"==t.variables.Status;switch(t.interactionType){case"likert":return void this.api.LogLikertQuestion(i.id,e.id,t.id,r);case"essay":case"fillin":case"numeric":r=[new ppResponsePair(t.lmsResponses[0].lmstext)]}this.api.LogNormalQuestion(i.id,e.id,t.id,r,t.interactionType,"true"==t.issurvey,a,t.variables.Points)},TinCanClient.prototype.reportViewBasedComplete=function(t){this.api.NotifyViewedComplete(t,new Date-this.startTime)},TinCanClient.prototype.reportQuizComplete=function(t){var e=this,i=t.variables.Score>=t.variables.PassScore;this.api.NotifyQuizComplete(t.variables.PercentScore,t.variables.Score,t.maxscore,t.id,i,"true"==t.issurvey);var r=new Date-this.startTime;$.each(story.scoring.scorerefs,function(a,s){var n=story.parseObjref(s.ref);n&&n.target&&n.target.id==t.id&&e.api.NotifyCourseComplete(t.variables.PercentScore,i,"true"==t.issurvey,r)})},TinCanClient.prototype.sendResumeData=function(){if(player.useCompactResume){var t=story.toResumeData();""!=t&&this.api.UpdateResumeData(t)}},TinCanClient.prototype.init=function(){var t=this,e=document.location.search.substr(1);t.startTime=new Date,this.api=new ppTinCanApi(e),this.GetResumeData(),this.api.NotifyCourseStarted();var i=!1;$(window).bind("unload beforeunload",function(){i||(t.api.PostOnClose(),i=!0)})},TinCanClient.prototype.isReady=function(){return this.getResumeDataReturned},bwUtils={DEFAULT_STATE:"_default"},bwChunk.EMPTY_CHUNK="0",bwChunk.BASE_NUMBER=64,bwChunk.BASE_POW=6,bwChunk.m_arr10to64="0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$".split(","),bwChunk.m_o64to10={v0:0,v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8,v9:9,va:10,vb:11,vc:12,vd:13,ve:14,vf:15,vg:16,vh:17,vi:18,vj:19,vk:20,vl:21,vm:22,vn:23,vo:24,vp:25,vq:26,vr:27,vs:28,vt:29,vu:30,vv:31,vw:32,vx:33,vy:34,vz:35,vA:36,vB:37,vC:38,vD:39,vE:40,vF:41,vG:42,vH:43,vI:44,vJ:45,vK:46,vL:47,vM:48,vN:49,vO:50,vP:51,vQ:52,vR:53,vS:54,vT:55,vU:56,vV:57,vW:58,vX:59,vY:60,vZ:61,v_:62,v$:63},bwChunk.prototype.ChunkData=function(){return this.m_strChunkData},bwChunk.prototype.Remainder=function(){return this.m_strRemainder},bwChunk.prototype.Length=function(){return this.m_nLength},bwChunk.prototype.Data=function(){return this.m_strData},bwChunk.prototype.NextChunk=function(){return new bwChunk(this.Remainder())},bwChunk.prototype.Skip=function(t){this.m_nOffset+=t},bwChunk.prototype.NextString=function(t){t||(t=this.m_nLength);var e=this.m_strData.substr(this.m_nOffset,t);return this.m_nOffset+=t,e},bwChunk.prototype.NextBase10=function(t){var e=bwChunk.BaseNto10(this.m_strData.substr(this.m_nOffset,t));return this.m_nOffset+=t,e},bwChunk.prototype.NextUBase10=function(t){var e=bwChunk.UBaseNto10(this.m_strData.substr(this.m_nOffset,t));return this.m_nOffset+=t,e},bwChunk.prototype.NextChunkedBase10=function(){var t=new bwChunk(this.m_strData.substr(this.m_nOffset)),e=t.Length(),t=bwChunk.BaseNto10(t.Data(),t.Length());return this.m_nOffset+=e,t},bwChunk.prototype.NextChunkedUBase10=function(){var t=new bwChunk(this.m_strData.substr(this.m_nOffset)),e=t.Length(),t=bwChunk.UBaseNto10(t.Data(),t.Length());return this.m_nOffset+=e,t},bwChunk.prototype.IsEmpty=function(){return""==this.Data()},bwChunk.prototype.EOF=function(){return this.m_nOffset>=this.m_strData.length},bwChunk.CreateChunk=function(t){var e=t.length,i=bwChunk.UBase10toN(e),r="";return r=e>63?"~"+i.length+i+t:i+t},bwChunk.UBase10toN=function(t,e){void 0==e&&(e=-1);for(var i=parseInt(t),r=0,a="",s=!0;i>0||s;)s=!1,r=i&bwChunk.BASE_NUMBER-1,a+=bwChunk.m_arr10to64[r],i>>=bwChunk.BASE_POW;for(;a.length<e;)a+="0";return a},bwChunk.UBaseNto10=function(t){for(var e=0,i="",r=0;r<t.length;r++)i="v"+t.charAt(r),e+=parseInt(bwChunk.m_o64to10[i])<<bwChunk.BASE_POW*r;return e},bwChunk.Base10toN=function(t,e){void 0==e&&(e=-1);for(var i=parseInt(t),r=0,a="",s=!0,n=0>i,r=1;Math.pow(bwChunk.BASE_NUMBER,r)/2<=Math.abs(t);)r++;if(r>e&&(e=r),n){for(r=0;-i>=Math.pow(bwChunk.BASE_NUMBER,r)/2;)r++;i=Math.pow(bwChunk.BASE_NUMBER,r)+i}for(;i>0||s;)s=!1,r=i&bwChunk.BASE_NUMBER-1,a+=bwChunk.m_arr10to64[r],i>>=bwChunk.BASE_POW;for(;a.length<e;)a+=n?"$":"0";return a},bwChunk.BaseNto10=function(t){for(var e=0,i="",r=0;r<t.length;r++)i="v"+t.charAt(r),e+=parseInt(bwChunk.m_o64to10[i])<<bwChunk.BASE_POW*r;return t=Math.pow(bwChunk.BASE_NUMBER,t.length)/2,e>=t&&(e-=2*t),e},bwChunk.GlobalReplace=function(t,e,i){return e=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),t.replace(RegExp(e,"g"),i)},bwChunk.GlobalUnReplace=function(t,e,i){return bwChunk.GlobalReplace(t,i,e)},bwChunk.StringEncodings=[["^","^0"],["&","^1"],["'","^2"],["+","^3"],[String.fromCharCode(10),"^4"],[String.fromCharCode(13),"^5"],["?","^6"],[",","^7"],["%","^8"],["\\","^9"],['"',"^A"],["‘","^B"],["’","^C"],["“","^D"],["”","^E"]],bwChunk.EncodeString=function(t){return $.each(bwChunk.StringEncodings,function(e,i){t=bwChunk.GlobalReplace(t,i[0],i[1])}),t},bwChunk.DecodeString=function(t){return $.each(bwChunk.StringEncodings,function(e,i){t=bwChunk.GlobalReplace(t,i[1],i[0])}),t},PathLib.prototype.loadFromXML=function(t){var e=this;this.xml=t,this.id=$(t).attr("id"),this.paths={},$(t).children("path").each(function(t,i){e.paths[$(i).attr("i")]=$(i).attr("p")})},PathLib.getPath=function(t,e){return story.pathlibs[t]&&story.pathlibs[t].paths[e]?story.pathlibs[t].paths[e]:""},PathLib.getPathFromXML=function(t){return PathLib.getPath($(t).attr("l"),$(t).attr("i"))},BezierPath.nCr=function(t,e){for(var i=1,r=1;e>=r;r++)i*=(t+1-r)/r;return i},BezierPath.prototype.setPoints=function(t){t[0].time=0,t[t.length-1].time=100,this.points=t},BezierPath.prototype.loadFromXML=function(t,e){var i=[];$(t).find("segment").children().each(function(t,r){var a=parseInt($(r).attr("x"))-e.x+e.xoffset,s=parseInt($(r).attr("y"))-e.y+e.yoffset;i.push({x:a,y:s})}),this.setPoints(i),this.duration=$(t).attr("duration"),this.easing=$(t).attr("easing"),this.easingdir=$(t).attr("easingdir")},BezierPath.prototype.getXYAtTime=function(t){var e=this.points;if(t<e[0].time)return e[0];if(t>e[e.length-1].time)return e[e.length-1];for(var i=0,r=e.length-1,a=1;a<e.length;a++){var s=e[a];if(t<s.time){r=a;break}void 0!=s.time&&(i=a)}for(var n=r-i,a=e[i].time,t=(t-a)/(e[r].time-a),o=r=0,a=0;n>=a;a++)var s=e[i+a],l=BezierPath.nCr(n,a)*Math.pow(1-t,n-a)*Math.pow(t,a),r=r+l*s.x,o=o+l*s.y;return{x:parseInt(r),y:parseInt(o)}},BezierPath.EasingSteps=[0,15,23.75,32.5,41.25,50,58.75,67.5,76.25,85,100],BezierPath.DirectSteps=[0,10,20,30,40,50,60,70,80,90,100],BezierPath.prototype.toKeyFrames=function(){var t="linear"!=this.easing,e="",i=BezierPath.DirectSteps;t&&(i=BezierPath.DirectSteps);for(var r=0;r<BezierPath.DirectSteps.length;r++){var a=i[r],s=this.getXYAtTime(BezierPath.DirectSteps[r]),n="linear";0==r&&t?n="ease-in":r==BezierPath.DirectSteps.length-2&&t&&(n="ease-out"),block=a+"% {-webkit-transform: translateX("+s.x+"px) translateY("+s.y+"px);-webkit-animation-timing-function:"+n+";}",e+=block+"\r\n"}return"{"+e+"}"};var ZoomPan=function(){this.target=null,this.duration=750};ZoomPan.prototype.loadFromXML=function(t){this.lastx=parseInt($(t).attr("lastx")),this.lasty=parseInt($(t).attr("lasty")),this.lastwidth=parseInt($(t).attr("lastwidth")),this.lastheight=parseInt($(t).attr("lastheight")),this.xpos=parseInt($(t).attr("xpos")),this.ypos=parseInt($(t).attr("ypos")),this.width=parseInt($(t).attr("width")),this.height=parseInt($(t).attr("height")),this.duration=parseInt($(t).attr("duration")),this.staticimage=$(t).attr("staticimage")},ZoomPan.prototype.getZoomModifier=function(){return player.currentWindow?player.currentWindow.zoomModifier:1},ZoomPan.prototype.getStartCss=function(){var t=player.width/this.lastwidth,t=t*this.getZoomModifier(),e=this.lastx*t,i=this.lasty*t,r="translate3d("+-e+"px,"+-i+"px,0px) scale("+t+") rotate(0deg)";return 0==e&&0==i&&1==t&&(r=""),{"-webkit-transition-property":"","-webkit-transition-duration":"0s","-webkit-transform-origin":"top left","-webkit-transition-timing-function":"ease-in","-webkit-transform":r,"-moz-transition-property":"","-moz-transition-duration":"0s","-moz-transform-origin":"top left","-moz-transition-timing-function":"ease-in","-moz-transform":r,"-ms-transition-property":"","-ms-transition-duration":"0s","-ms-transform-origin":"top left","-ms-transition-timing-function":"ease-in","-ms-transform":"translate("+-e+"px,"+-i+"px) scale("+t+") rotate(0deg)"}},ZoomPan.prototype.getFinishCss=function(){var t=player.width/this.width,t=t*this.getZoomModifier(),e=this.xpos*t,i=this.ypos*t;this.zoomParams={scale:t,scaledx:e,scaledy:i};var r="translate3d("+-e+"px,"+-i+"px,0px) scale("+t+") rotate(0deg)";return 0==e&&0==i&&1==t&&(r=""),player.currentWindow&&(this.zoomParams.scale/=player.currentWindow.zoomModifier),{"-webkit-transition-property":"-webkit-transform, opacity","-webkit-transition-duration":this.duration+"ms","-webkit-transform-origin":"top left","-webkit-transition-timing-function":"ease-in","-webkit-transform":r,"-moz-transition-property":"-moz-transform, opacity","-moz-transition-duration":this.duration+"ms","-moz-transform-origin":"top left","-moz-transition-timing-function":"ease-in","-moz-transform":r,"-ms-transition-property":"-ms-transform, opacity","-ms-transition-duration":this.duration+"ms","-ms-transform-origin":"top left","-ms-transition-timing-function":"ease-in","-ms-transform":"translate("+-e+"px,"+-i+"px) scale("+t+") rotate(0deg)"}},ZoomPan.prototype.applyCss=function(t,e){$.each(t,function(t,i){$(e).css(t,i)})},ZoomPan.prototype.apply=function(t){var e=this;e.applyCss(e.getStartCss(),t),setTimeout(function(){e.applyCss(e.getFinishCss(),t),player.zoomParams=e.zoomParams},0)};var swipe={swiping:!1,animating:!1,moved:!1,x:0,y:0,vx:0,vy:0,downX:0,downY:0,lastX:0,lastY:0,startTime:0,lastTime:0,quick:200,normal:300,modes:{follow:"follow",none:"none"}};swipe.parseEventCoords=function(t){if(t.originalEvent.touches?0<t.originalEvent.touches.length?(swipe.x=t.originalEvent.touches[0].pageX,swipe.y=t.originalEvent.touches[0].pageY):(swipe.x=t.originalEvent.changedTouches[0].pageX,swipe.y=t.originalEvent.changedTouches[0].pageY):(swipe.x=t.pageX,swipe.y=t.pageY),!t.frameScaled){swipe.rawX=swipe.x,swipe.rawY=swipe.y;var e=$(".framewrap").offset(),i=swipe.y-e.top;swipe.x=parseInt((swipe.x-e.left)/player.frameScale+e.left),swipe.y=parseInt(i/player.frameScale+e.top)}t.frameScaled=!0},swipe.sniff=function(t,e){if(t.originalEvent||(t.originalEvent=t),swipe.lastX=swipe.x,swipe.lastY=swipe.y,swipe.parseEventCoords(t),swipe.deltaX=swipe.x-swipe.downX,swipe.deltaY=swipe.y-swipe.downY,swipe.deltaX*=1/player.currentZoom(),swipe.deltay*=1/player.currentZoom(),e){var i=new Date-swipe.lastTime;swipe.vx=(swipe.x-swipe.lastX)/i/player.currentZoom(),swipe.vy=(swipe.y-swipe.lastY)/i/player.currentZoom()}swipe.lastTime=new Date,(10<Math.abs(swipe.deltaX)||10<Math.abs(swipe.deltaY))&&(swipe.moved=!0)},swipe.getSlideCoords=function(t){if(t=t||player.currentSlide(),!t.ref)return{x:0,y:0};var t=t.ref.offset(),e=$(".framewrap").offset();return t.left=(t.left-e.left)/player.frameScale+e.left,t.top=(t.top-e.top)/player.frameScale+e.top,e=(swipe.x-t.left)/player.currentZoom(),t=(swipe.y-t.top)/player.currentZoom(),player.zoomParams&&(e/=player.zoomParams.scale,t/=player.zoomParams.scale),1!=player.windowZoomModifier&&(e*=player.frameScale,t*=player.frameScale),{x:parseInt(e),y:parseInt(t)}},swipe.noteDownCoords=function(){swipe.downX=swipe.x,swipe.downY=swipe.y,swipe.moved=!1,swipe.startTime=new Date},swipe.hasMoved=function(t){if(t)return swipe.x!=swipe.downX||swipe.y!=swipe.downY;var t=Math.abs(swipe.x-swipe.downX),e=Math.abs(swipe.y-swipe.downY);return t>3||e>3},swipe.start=function(t){player.showingInterstitial||(swipe.animating&&swipe.applyCallback(),swipe.sniff(t,!1),swipe.downX=swipe.x,swipe.downY=swipe.y,swipe.swiping=!0,swipe.moved=!1,swipe.startTime=new Date)},swipe.move=function(t){"follow"!=player.swipeMode?swipe.moved=!0:swipe.swiping&&(swipe.sniff(t,!0),swipe.apply(swipe.deltaX,0))},swipe.end=function(t){if("follow"==player.swipeMode)if(swipe.animating)swipe.swiping=!1;else if(swipe.swiping){swipe.sniff(t,!1),swipe.swiping=!1;var t=1e3>new Date-swipe.startTime,e=1<Math.abs(swipe.vx);swipe.deltaX>.5*player.width?swipe.prev(swipe.normal):swipe.deltaX<.5*-player.width?swipe.next(swipe.normal):t&&100<swipe.deltaX&&2<Math.abs(swipe.deltaX/swipe.deltaY)?swipe.prev(swipe.quick):t&&-100>swipe.deltaX&&2<Math.abs(swipe.deltaX/swipe.deltaY)?swipe.next(swipe.quick):e&&10<swipe.deltaX&&2<Math.abs(swipe.deltaX/swipe.deltaY)?swipe.prev(swipe.quick):e&&-10>swipe.deltaX&&2<Math.abs(swipe.deltaX/swipe.deltaY)?swipe.next(swipe.quick):(swipe.apply(0,300),(!t||!(-100>swipe.deltaY&&.5>Math.abs(swipe.deltaX/swipe.deltaY)))&&t&&100<swipe.deltaY&&Math.abs(swipe.deltaX/swipe.deltaY)),swipe.moved=!1}else swipe.apply(0,0)},swipe.cancel=function(){swipe.swiping=!1,swipe.animating=!1,swipe.moved=!1,swipe.apply(0,0)},swipe.cancelTap=function(){setTimeout(function(){player.justTapped=!1},0)},swipe.next=function(t){t=t||swipe.normal,swipe.cancelTap(),player.slideIndex==$(".slide").length-1?swipe.apply(0,t):(player.unblock(),player.prepAudio(player.slideIndex+1),swipe.animating=!0,swipe.applyCallback=function(){swipe.animating&&(player.showNextSlide(),swipe.animating=!1)},swipe.apply(-player.width,t,function(){swipe.applyCallback()}))},swipe.prev=function(t){t=t||swipe.normal,swipe.cancelTap(),0==player.slideIndex?swipe.apply(0,t):(player.unblock(),player.prepAudio(player.slideIndex-1),swipe.animating=!0,swipe.applyCallback=function(){swipe.animating&&(player.showPreviousSlide(),swipe.animating=!1)},swipe.apply(player.width,t,function(){swipe.applyCallback()}))},swipe.applyCallback=function(){},swipe.apply=function(t,e,i){$(".slide").css("-webkit-transition-property","-webkit-transform"),$(".slide").css("-webkit-transition-duration",e+"ms"),$(".slide.prev").css("-webkit-transform","translate3d("+(t-player.width)+"px,0px,0px) scale(1.0)"),$(".slide.in").css("-webkit-transform","translate3d("+t+"px,0px,0px) scale(1.0)"),$(".slide.next").css("-webkit-transform","translate3d("+(t+player.width)+"px,0px,0px) scale(1.0)"),i&&($(".slide.in").unbind("webkitTransitionEnd"),$(".slide.in").bind("webkitTransitionEnd",function(){$(".slide.in").unbind("webkitTransitionEnd"),i()}))},swipe.undo=function(){setTimeout(function(){swipe.swiping||swipe.apply(0,300)},1e3)},swipe.setSlideIndex=function(t){player.slideIndex=t;var e=$(".slide");e.removeClass("in out next prev before after"),t>0&&($(e[t-1]).addClass("prev"),player.slideIndex--,story.allSlides[player.slideIndex].update(0,!0),player.slideIndex++),$(e[t]).addClass("in"),t<story.allSlides.length-1&&($(e[t+1]).addClass("next"),player.slideIndex++,story.allSlides[player.slideIndex].update(0,!0),player.slideIndex--),swipe.apply(0,0)},swipe.init=function(){$(document.body).bind("mousedown",function(t){swipe.start(t)}),$(document.body).bind("touchstart",function(t){swipe.start(t)}),$(document.body).bind("mousemove",function(t){swipe.swiping&&(swipe.move(t),t.preventDefault())}),$(document.body).bind("touchmove",function(t){swipe.move(t),t.preventDefault()}),$(document.body).bind("mouseup",function(t){swipe.end(t)}),$(document.body).bind("touchend",function(t){swipe.end(t)}),$(document.body).bind("dragstart",function(t){t.preventDefault()}),player.useSwipeJiggle&&(swipe.jiggleInterval=setInterval(function(){swipe.swiping||swipe.animating||(swipe.jiggleDelta=0==swipe.jiggleDelta?1:0,swipe.apply(swipe.jiggleDelta,0))},100)),player.showInstrumentation&&(swipe.lastJiggle=new Date,swipe.jiggleInterval=setInterval(function(){if(!swipe.swiping&&!swipe.animating){var t=new Date-swipe.lastJiggle;t>200&&(player.mediaMonitor||(player.mediaMonitor=$("<div class='narrowmonitor'></div>"),$(document.body).append(player.mediaMonitor)),player.mediaMonitor.html(t+"<br>"+player.mediaMonitor.html())),player.useSwipeJiggle&&(swipe.jiggleDelta=0==swipe.jiggleDelta?1:0,swipe.apply(swipe.jiggleDelta,0)),swipe.lastJiggle=new Date}},10))},BitMask.showDebug=!1,BitMask.debugOnly=!1,BitMask.max=function(t,e){return t>e?t:e},BitMask.min=function(t,e){return e>t?t:e},BitMask.prototype.loadFromImageUrl=function(t,e){var i=this,r=new Image;r.onload=function(){i.loadFromImage(r),e&&e(r)},r.src=t},BitMask.prototype.loadFromImage=function(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height,this.width=t.width,this.height=t.height,e=e.getContext("2d"),e.drawImage(t,0,0),this.loadFromContext(e,t.width,t.height)},BitMask.prototype.loadFromContext=function(t){this.pixels=[];for(var t=t.getImageData(0,0,this.width,this.height).data,e=0,i=0;i<this.height;i++){for(var r=[],a=0;a<this.width;a++)r.push(0!=t[e]||0!=t[e+1]||0!=t[e+2]||0!=t[e+3]),e+=4;this.pixels.push(r)}},BitMask.prototype.loadFromRLE=function(t){this.pixels=[];var e=t.indexOf("X")>t.indexOf("O");-1==t.indexOf("O")&&(e=!1);for(var t=t.replace(/O/gi,"X").split("X"),i=[],r=0;r<t.length;r++){var a=parseInt(t[r],16);for(isNaN(a)&&(a=0),e=!e;a>=0;)i.length>this.sourceWidth-1&&(this.pixels.push(i),i=[]),i.push(e),a--}this.pixels.push(i),(this.sourceWidth!=this.width||this.sourceHeight!=this.height)&&this.fixScale()},BitMask.prototype.fixScale=function(){for(var t=[],e=0;e<this.height;e++){for(var i=this.pixels[parseInt(e*this.sourceHeight/this.height)],r=[],a=0;a<this.width;a++){var s=parseInt(a*this.sourceWidth/this.width);r[a]=i[s]}t[e]=r}this.pixels=t},BitMask.prototype.resize=function(t,e,i,r){for(var a=0;a<this.height&&a<this.pixels.length;a++){for(var s=0;i>s;s++)this.pixels[a].unshift(0),this.pixels[a].push(0);for(;this.pixels[a].length<t;)this.pixels[a].push(0)}for(this.pixels[this.pixels.length-1].length<this.width&&this.pixels.pop(),i=[],s=0;t>s;s++)i.push(0);for(a=0;r>a;a++)this.pixels.unshift(i),this.pixels.push(i);for(;this.pixels.length<e;)this.pixels.push(i);this.width=t,this.height=e},BitMask.prototype.testOverlap=function(t,e,i,r){var a=this.width>e&&t.width>-e&&this.height>i&&t.height>-i;return!a||this.isOpaque&&t.isOpaque?a:this.testPixelOverlap(t,e,i,r)},BitMask.prototype.testPixelOverlap=function(t,e,i,r){var e=parseInt(e),i=parseInt(i),a=0,s=BitMask.min(t.width+e,this.width);e>0&&(a=e,s=BitMask.min(this.width,this.width+e));var n=BitMask.min(s-a,t.width),o=0,l=BitMask.min(t.height+i,this.height);i>0&&(o=i,s=BitMask.min(this.height,this.height+i)),s=BitMask.min(l-o,t.height),BitMask.showDebug&&(BitMask.testCanvas||(BitMask.testCanvas=$("<canvas id='test' width='1000' height='1000' style='position:absolute;z-index:200;left:0px;top:0px;'></canvas>"),$(document.body).append(BitMask.testCanvas),BitMask.testContext=BitMask.testCanvas.get(0).getContext("2d"),BitMask.testContext.fillStyle="rgba(255,255,0,0.5)"),BitMask.testCanvas.show(),clearTimeout(BitMask.testCanvasClear),BitMask.testCanvasClear=setTimeout(function(){BitMask.testCanvas.hide()},1e3)),BitMask.showDebug&&(BitMask.testContext.fillStyle="rgba(255,255,0,0.5)",BitMask.testContext.clearRect(0,0,1e3,1e3),BitMask.testContext.fillRect(a,o,n,s)),l=parseInt(10*Math.random())+30,BitMask.debugOnly&&(l=1);for(var h=0,p=o;o+s>p;p++){for(h=a+h;a+n>h;h+=l){var c=this.isPointActive(h,p),d=t.isPointActive(h-e,p-i);if(c&&d&&(c=r&&r(h,p),BitMask.showDebug&&(c?(BitMask.testContext.fillStyle="rgba(255,0,0,0.9)",BitMask.testContext.fillRect(h-1,p-1,2,2)):(BitMask.testContext.fillStyle="rgba(0,255,0,0.9)",BitMask.testContext.fillRect(h-2,p-2,4,4))),!c&&!BitMask.debugOnly))return!0}h=h%n%l}return!1},BitMask.prototype.isPointActive=function(t,e){return this.isOpaque?!0:(t=parseInt(t),e=parseInt(e),0>t||t>=this.width||0>e||e>=this.height||e>=this.pixels.length||t>=this.pixels[e].length?!1:this.pixels[e][t])},BitMask.prototype.drawDebug=function(t){if(!this.isOpaque)if(t=t.getContext("2d"),this.isOpaque)t.fillStyle="#f00",t.fillRect(0,0,this.width,this.height);else for(var e=0;e<this.height&&e<this.pixels.length;e++)for(var i=0;i<this.width&&i<this.pixels[e].length;i++)t.fillStyle=this.pixels[e][i]?"#00f":"#000",t.fillRect(i,e,1,1)};var ResumeParser=function(){};ResumeParser.dump=function(t,e){for(var e=e||0,i=new bwChunk(t),r=0;e>r;r++);i.Data()&&ResumeParser.dump(i.Data(),e+1),i.Remainder()&&ResumeParser.dump(i.Remainder(),e)};var ProgressBar=function(t,e,i){this.container=t||$(document.body),this.ref=e,this.draggable=i,this.dragging=!1,this.index=0,this.zoomModifier=this.count=1,this.onDragUpdate=null,this.ref||this.createRef(),i&&this.bindDragEvents()};ProgressBar.prototype.createRef=function(){this.ref=$('<div class="progress-container"><div class="progress-bar"></div></div>'),this.container.append(this.ref)},ProgressBar.prototype.show=function(){this.ref.show()},ProgressBar.prototype.hide=function(){this.ref.hide()},ProgressBar.prototype.update=function(){if(player.currentWindow&&player.currentWindow.progressBar&&this==player.progressBar)player.currentWindow.progressBar.update();else{var t=parseInt(100*(this.index/this.count));t>100&&(t=100);var e=t+"%";this.ref.children(".progress-bar").css("width",e),this.ref.children(".seek_bar_fill").css("width",e),this.ref.children(".seek_bar_progress").css("left",e),
this.index==this.count||100==t?this.ref.children().addClass("full"):this.ref.children().removeClass("full")}},ProgressBar.prototype.bindDragEvents=function(){var t=this;t.dragging=!1;var e=function(e){if(t.dragging){var i=t.ref.offset().left,r=t.ref.width()*t.zoomModifier;swipe.parseEventCoords(e),e=(swipe.x-i)/r,0>e&&(e=0),e>1&&(e=1),t.onDragUpdate&&t.onDragUpdate(e)}},i=function(i){t.dragging&&(e(i),t.dragging=!1,t.wasPlaying&&player.play())};$(this.ref).bind("mousedown touchstart",function(i){t.dragging=!0,t.wasPlaying=player.playing,e(i),t.wasPlaying&&player.activeTimeline.pause()}),$(window).bind("mousemove touchmove",e),$(this.ref).bind("mouseup touchend",i),$(document.body).bind("mouseup touchend",i),$(window).bind("mouseup touchend",i)},ProgressBar.getCurrentProgressBar=function(){return player.currentWindow&&player.currentWindow.progressBar?player.currentWindow.progressBar:player.progressBar};var VolumeSlider=function(t){this.button=t,this.visible=this.dragging=!1,this.volume=80,this.onDragUpdate=null,this.createRef(),this.bindDragEvents(),VolumeSlider.sliderList.push(this)};VolumeSlider.sliderList=[],VolumeSlider.prototype.createRef=function(){this.button.find(".volume-slider").remove(),this.ref=$('<div class="volume-slider"><div class="volume-handle"></div></div>'),this.handle=this.ref.children().first(),this.icon=this.button.children().first(),this.button.prepend(this.ref)},VolumeSlider.prototype.toggle=function(){this.visible?this.hide():this.show()},VolumeSlider.prototype.show=function(){this.button.addClass("volume-open"),this.visible=!0},VolumeSlider.prototype.hide=function(){this.button.removeClass("volume-open"),this.visible=this.dragging=!1},VolumeSlider.prototype.setVolume=function(t){this.volume=t,this.update()},VolumeSlider.prototype.update=function(){this.handle.css("top",parseInt(100-this.volume)+"%")},VolumeSlider.prototype.bindDragEvents=function(){var t=this;t.dragging=!1;var e=function(e){if(t.dragging){var i=t.ref.offset().top,r=t.ref.height();swipe.parseEventCoords(e),e=1-(swipe.rawY-i)/r,0>e&&(e=0),e>1&&(e=1),t.volume=parseInt(100*e),t.update(),t.onDragUpdate&&t.onDragUpdate(e),$.each(VolumeSlider.sliderList,function(e,i){i!=t&&(i.volume=t.volume,i.update())})}},i=function(i){return t.dragging&&(e(i),i=t.dragging,t.dragging=!1,i)?!1:void 0};$(this.ref).bind("mousedown touchstart",function(i){t.dragging=!0,e(i)}),$(window).bind("mousemove touchmove",e),$(this.ref).bind("mouseup touchend",i),$(document.body).bind("mouseup touchend",i),$(window).bind("mouseup touchend",i),this.button.bind("click",function(e){return t.toggle(),MouseEvents.processHideables(e),!1}),MouseEvents.addHideable(".volume-slider",".volume-slider,.icon.volume",function(){t.hide()})},ppRect.prototype.GetWidth=function(){return this.right-this.left},ppRect.prototype.GetHeight=function(){return this.bottom-this.top},ppRect.prototype.Clone=function(){return new ppRect(this.left,this.top,this.right,this.bottom)},ppRect.prototype.Translate=function(t,e){this.left+=t,this.right+=t,this.top+=e,this.bottom+=e},ppRect.prototype.Widen=function(t,e){this.left-=t,this.right+=t,this.top-=e,this.bottom+=e},ppRect.prototype.AddRect=function(t){this.left>t.left&&(this.left=t.left),this.right<t.right&&(this.right=t.right),this.top>t.top&&(this.top=t.top),this.bottom<t.bottom&&(this.bottom=t.bottom)},ppRect.prototype.RotateRect=function(t){var t=t*Math.PI/180,e=this.GetWidth(),i=this.GetHeight(),r=Math.cos(t),a=Math.sin(t),t=0*r+0*a,s=-0*a+0*r,n=e*r+0*a,o=e*a+0*r,l=e*r-i*a,h=e*a+i*r,e=0*r-i*a,a=-0*a+i*r,i=Math.min(s,o,h,a),r=Math.min(t,n,l,e),s=Math.max(s,o,h,a),t=Math.max(t,n,l,e);return console.warn(r+", "+t+" : "+i+", "+s),new ppRect(r,i,t,s)},window.ppFudge=.5,ppGraphics.prototype.Destroy=function(){},ppGraphics.prototype.GetOffset=function(){return this.m_ptOffset},ppGraphics.prototype.ResizeCanvas=function(t,e,i){function r(t,e,i,r,a){var s=(i-t.width)/2,n=(r-t.height)/2,o=e.getImageData(0,0,t.width,t.height);t.width=i,t.height=r,a?e.putImageData(o,s,n):e.putImageData(o,0,0)}r(this.m_oFillCanvas,this.m_oFillContext,t,e,i),r(this.m_oStrokeCanvas,this.m_oStrokeContext,t,e,i)},ppGraphics.prototype.ResizeCanvasBox=function(t){function e(t,e,r){var a=Math.min(r.left,0),s=Math.min(r.top,0),n=Math.max(r.right,t.width),r=Math.max(r.bottom,t.height),o=e.getImageData(0,0,t.width,t.height);t.width=n,t.height=r,i.m_nWidth=Math.max(i.m_nWidth,t.width),i.m_nHeight=Math.max(i.m_nHeight,t.height),e.putImageData(o,-a,-s)}var i=this;e(this.m_oFillCanvas,this.m_oFillContext,t),e(this.m_oStrokeCanvas,this.m_oStrokeContext,t)},ppGraphics.prototype.DumpDebugCanvas=function(){var t=document.createElement("canvas");t.width=this.m_nWidth,t.height=this.m_nHeight;var e=t.getContext("2d"),i=this.m_oFillContext.getImageData(0,0,t.width,t.height);e.putImageData(i,0,0),t.style.border="dashed 1px blue",document.body.appendChild(t),document.body.style.backgroundColor="red"},ppGraphics.prototype.GetFinalCanvas=function(t){null==t&&(t=!1);var e=new ppRect(0,0,this.m_nWidth,this.m_nHeight);if(!t)for(var i=null,i=null,r=0,a=0,s=0;s<this.m_arrShadows.length;s++)i=this.m_arrShadows[s],i.bInner?this.DrawInnerShadow(i):(this.DrawShadow(i),r=(this.m_nWidth-i.canvas.width)/2,a=(this.m_nHeight-i.canvas.height)/2,i.nXPos=r+i.nXOffset,i.nYPos=a+i.nYOffset,i=new ppRect(i.nXPos,i.nYPos,i.nXPos+i.canvas.width,i.nYPos+i.canvas.height),e.AddRect(i));if(this.finalCanvas=document.createElement("canvas"),r=this.finalCanvas.getContext("2d"),!t&&this.m_bHasShadow)for(this.m_nWidth=e.GetWidth(),this.m_nHeight=e.GetHeight(),this.m_ptOffset.x=-e.left,this.m_ptOffset.y=-e.top,this.finalCanvas.width=this.m_nWidth,this.finalCanvas.height=this.m_nHeight,s=0;s<this.m_arrShadows.length;s++)i=this.m_arrShadows[s],i.bInner||(r.drawImage(i.canvas,i.nXPos-e.left,i.nYPos-e.top),i.canvas.width=1,i.canvas.height=1);else this.finalCanvas.width=this.m_nWidth,this.finalCanvas.height=this.m_nHeight;for(r.drawImage(this.m_oFillCanvas,-e.left,-e.top),t||(this.m_oFillCanvas.width=1,this.m_oFillCanvas.height=1,this.m_oFillCanvas=null),s=0;s<this.m_arrStrokeCanvases.length;s++)r.drawImage(this.m_arrStrokeCanvases[s],-e.left,-e.top),t||(this.m_arrStrokeCanvases[s].width=1,this.m_arrStrokeCanvases[s].height=1,this.m_arrStrokeCanvases[s]=null);if(!t&&this.m_bHasInnerShadow){for(r.save(),s=0;s<this.m_arrShadows.length;s++)i=this.m_arrShadows[s],i.bInner&&(r.shadowOffsetX=i.nXOffset,r.shadowOffsetY=i.nYOffset,r.shadowBlur=i.nBlur,r.shadowColor=ppArt.GetColor(i.nColor,i.nAlpha),r.globalCompositeOperation="source-atop",r.drawImage(i.canvas,-10,-10),i.canvas.width=1,i.canvas.height=1);r.restore()}return this.finalCanvas},ppGraphics.prototype.AddImage=function(t,e,i,r,a,s){this.m_bFillStarted&&this.FillContext(this.m_oFillContext),(0==this.m_oFillCanvas.width||0==this.m_oFillCanvas.height)&&(this.m_oFillCanvas.width=t.width*r,this.m_oFillCanvas.height=t.height*a,this.m_oStrokeCanvas.width=this.m_oFillCanvas.width,this.m_oStrokeCanvas.height=this.m_oFillCanvas.height,this.m_nWidth=this.m_oFillCanvas.width,this.m_nHeight=this.m_oFillCanvas.height);var n=t.naturalWidth||t.width,o=t.naturalHeight||t.height;this.m_oFillCanvas.width<Math.ceil(n*r)+e+(this.m_nXOffset+ppArt.currentFudge)&&(this.m_oFillCanvas.width=Math.ceil(n*r)+e+(this.m_nXOffset+ppArt.currentFudge),this.m_nWidth=this.m_oStrokeCanvas.width=this.m_oFillCanvas.width),this.m_oFillCanvas.height<Math.ceil(o*a)+i+(this.m_nYOffset+ppArt.currentFudge)&&(this.m_oFillCanvas.height=Math.ceil(o*a)+i+(this.m_nYOffset+ppArt.currentFudge),this.m_nHeight=this.m_oStrokeCanvas.height=this.m_oFillCanvas.height),this.m_bFillStarted=!1,this.m_oFillContext.beginPath(),this.m_oFillContext.globalAlpha=s,e-=ppArt.currentFudge,i-=ppArt.currentFudge,this.m_oFillContext.drawImage(t,0,0,n,o,e+(this.m_nXOffset+ppArt.currentFudge),i+(this.m_nYOffset+ppArt.currentFudge),Math.ceil(n*r),Math.ceil(o*a)),this.m_oFillContext.globalAlpha=1},ppGraphics.prototype.StartSolidFill=function(t,e){this.m_bFillStarted&&this.FillContext(this.m_oFillContext),this.m_oFillContext.beginPath(),this.m_oFillContext.fillStyle=ppArt.GetColor(t,e),this.m_bFillStarted=!0},ppGraphics.prototype.StartGradientFill=function(t){this.m_bFillStarted&&this.FillContext(this.m_oFillContext),this.m_oFillContext.beginPath(),this.m_oFillContext.fillStyle=t,this.m_bFillStarted=!0},ppGraphics.prototype.EndFill=function(){this.m_bFillStarted&&this.FillContext(this.m_oFillContext),this.m_bFillStarted=!1},ppGraphics.prototype.StartImageFill=function(t){this.m_bFillStarted&&this.FillContext(this.m_oFillContext),this.m_oFillContext.beginPath(),this.m_oFillContext.fillStyle=t,this.m_bFillStarted=!0},ppGraphics.prototype.StartRotatedImageFill=function(t,e,i,r,a,s){this.m_bFillStarted&&this.FillContext(this.m_oFillContext),this.m_nFillRotation=e,this.m_nFillXPos=i,this.m_nFillYPos=r,this.m_nFillScaleX=a,this.m_nFillScaleY=s,this.m_bRotatedFill=!0,this.m_oFillContext.beginPath(),this.m_oFillContext.fillStyle=t,this.m_bFillStarted=!0},ppGraphics.prototype.SetLineStyle=function(t,e,i,r,a){this.CreateNewStrokeCanvas(),this.m_bStrokeStarted=!0,this.strokeStyle=ppArt.GetColor(e,i),this.lineWidth=t,this.lineJoin=r,this.lineCap=a,t%2>0&&(ppArt.currentFudge=window.ppFudge),this.m_oStrokeContext.strokeStyle=this.strokeStyle,this.m_oStrokeContext.lineWidth=this.lineWidth,this.m_oStrokeContext.lineJoin=this.lineJoin},ppGraphics.prototype.SetGradientLineStyle=function(t,e,i,r){this.CreateNewStrokeCanvas(),this.m_bStrokeStarted=!0,this.strokeStyle=e,this.lineWidth=t,this.lineJoin=i,this.lineCap=r,t%2>0&&(ppArt.currentFudge=window.ppFudge),this.m_oStrokeContext.strokeStyle=e,this.m_oStrokeContext.lineWidth=this.lineWidth,this.m_oStrokeContext.lineJoin=this.lineJoin,this.m_bStrokeStarted=!0},ppGraphics.prototype.ClearLineStyle=function(){this.CreateNewStrokeCanvas(),this.m_bStrokeStarted=!1},ppGraphics.prototype.CreateNewStrokeCanvas=function(){ppArt.currentFudge=0,1==this.m_bLineDrawn&&(this.m_bStrokeStarted&&this.m_oStrokeContext.stroke(),this.m_oStrokeContext.beginPath(),this.m_bLineDrawn=!1)},ppGraphics.prototype.AddShadow=function(t,e,i,r,a,s,n,o,l){var h={};h.nXOffset=t,h.nYOffset=e,h.nBlur=i,h.nColor=r,h.nAlpha=a,h.nScale=s,h.nStrength=n,h.nQuality=o,h.bInner=l,this.m_arrShadows.push(h)},ppGraphics.prototype.DrawShadow=function(t){var e=t.nBlur,i=t.nScale,r=this.GetFinalCanvas(!0),a=document.createElement("canvas"),s=a.getContext("2d");for(a.height=2*r.height*i+4*e,a.width=r.width*i+2*e,s.shadowOffsetX=0,s.shadowOffsetY=r.height*i+2*e,s.shadowBlur=e,s.shadowColor=ppArt.GetColor(t.nColor,t.nAlpha*(1+(t.nStrength-1)/2)),s.drawImage(r,0,0,r.width,r.height,e,e,r.width*i,r.height*i),t.canvas=document.createElement("canvas"),t.context=t.canvas.getContext("2d"),this.m_bHasShadow=!0,t.canvas.height=r.height*i+2*e,t.canvas.width=r.width*i+2*e,t.context.drawImage(a,0,r.height*i+2*e,a.width,a.height-(r.height*i+2*e),0,0,a.width,a.height-(r.height*i+2*e)),s=1;s<t.nStrength;s++)t.context.drawImage(a,0,r.height*i+2*e,a.width,a.height-(r.height*i+2*e),0,0,a.width,a.height-(r.height*i+2*e));a.width=1,a.height=1,r.width=1,r.height=1},ppGraphics.prototype.DrawInnerShadow=function(t){var e=this.GetFinalCanvas(!0);this.m_bHasInnerShadow=!0,t.canvas=document.createElement("canvas"),t.canvas.width=e.width+20,t.canvas.height=e.height+20,t.context=t.canvas.getContext("2d"),t.context.fillStyle=ppArt.GetColor(t.nColor,t.nAlpha),t.context.moveTo(0,0),t.context.lineTo(t.canvas.width,0),t.context.lineTo(t.canvas.width,t.canvas.height),t.context.lineTo(0,t.canvas.height),t.context.lineTo(0,0),t.context.fill(),t.context.globalCompositeOperation="destination-out",t.context.drawImage(e,10,10),t.context.globalCompositeOperation="source-over",e.width=1,e.height=1},ppGraphics.prototype.fill=function(){this.m_bFillStarted&&this.FillContext(this.m_oFillContext),this.m_oFillContext.beginPath()},ppGraphics.prototype.FillContext=function(t){t.save(),t.translate(this.m_nXOffset+ppArt.currentFudge,this.m_nYOffset+ppArt.currentFudge),this.m_bRotatedFill&&(t.scale(this.m_nFillScaleX,this.m_nFillScaleY),t.translate(this.m_nFillXPos,this.m_nFillYPos),t.rotate(this.m_nFillRotation)),t.fill(),this.m_bRotatedFill=!1,t.restore()},ppGraphics.prototype.stroke=function(){this.m_bStrokeStarted&&this.m_oStrokeContext.stroke()},ppGraphics.prototype.beginPath=function(){this.m_oFillContext.beginPath(),this.m_oStrokeContext.beginPath(),this.m_bLineDrawn=this.m_bFillStarted=this.m_bStrokeStarted=!1},ppGraphics.prototype.closePath=function(){this.m_oFillContext.closePath(),this.m_oStrokeContext.closePath(),this.m_oFillContext.drawImage(this.m_oStrokeCanvas,0,0),this.m_oStrokeContext.clearRect(0,0,this.m_oStrokeCanvas.width,this.m_oStrokeCanvas.height)},ppGraphics.prototype.lineTo=function(t,e){this.m_bForMask&&(t=Math.round(t),e=Math.round(e)),this.m_bFillStarted&&this.m_oFillContext.lineTo(t+(this.m_nXOffset+ppArt.currentFudge),e+(this.m_nYOffset+ppArt.currentFudge)),this.m_bStrokeStarted&&(this.m_bLineDrawn=!0,this.m_oStrokeContext.lineTo(t+(this.m_nXOffset+ppArt.currentFudge),e+(this.m_nYOffset+ppArt.currentFudge))),this.m_nCurXPos=t+(this.m_nXOffset+ppArt.currentFudge),this.m_nCurYPos=e+(this.m_nYOffset+ppArt.currentFudge)},ppGraphics.prototype.moveTo=function(t,e){this.m_bForMask&&(t=Math.round(t),e=Math.round(e)),this.m_oFillContext.moveTo(t+(this.m_nXOffset+ppArt.currentFudge),e+(this.m_nYOffset+ppArt.currentFudge)),this.m_oStrokeContext.moveTo(t+(this.m_nXOffset+ppArt.currentFudge),e+(this.m_nYOffset+ppArt.currentFudge)),this.m_nCurXPos=t+(this.m_nXOffset+ppArt.currentFudge),this.m_nCurYPos=e+(this.m_nYOffset+ppArt.currentFudge)},ppGraphics.prototype.bezierCurveTo=function(t,e,i,r,a,s){this.m_bForMask&&(t=Math.round(t),e=Math.round(e),i=Math.round(i),r=Math.round(r),a=Math.round(a),s=Math.round(s)),this.m_bFillStarted&&this.m_oFillContext.bezierCurveTo(t+(this.m_nXOffset+ppArt.currentFudge),e+(this.m_nYOffset+ppArt.currentFudge),i+(this.m_nXOffset+ppArt.currentFudge),r+(this.m_nYOffset+ppArt.currentFudge),a+(this.m_nXOffset+ppArt.currentFudge),s+(this.m_nYOffset+ppArt.currentFudge)),this.m_bStrokeStarted&&(this.m_bLineDrawn=!0,this.m_oStrokeContext.bezierCurveTo(t+(this.m_nXOffset+ppArt.currentFudge),e+(this.m_nYOffset+ppArt.currentFudge),i+(this.m_nXOffset+ppArt.currentFudge),r+(this.m_nYOffset+ppArt.currentFudge),a+(this.m_nXOffset+ppArt.currentFudge),s+(this.m_nYOffset+ppArt.currentFudge))),this.m_nCurXPos=a+(this.m_nXOffset+ppArt.currentFudge),this.m_nCurYPos=s+(this.m_nYOffset+ppArt.currentFudge)},ppGraphics.prototype.createLinearGradient=function(t,e,i,r){return this.m_oFillContext.createLinearGradient(t+(this.m_nXOffset+ppArt.currentFudge),e+(this.m_nYOffset+ppArt.currentFudge),i+(this.m_nXOffset+ppArt.currentFudge),r+(this.m_nYOffset+ppArt.currentFudge))},ppGraphics.prototype.createRadialGradient=function(t,e,i,r,a,s){return this.m_oFillContext.createRadialGradient(t+(this.m_nXOffset+ppArt.currentFudge),e+(this.m_nYOffset+ppArt.currentFudge),i,r+(this.m_nXOffset+ppArt.currentFudge),a+(this.m_nYOffset+ppArt.currentFudge),s)},ppGraphics.prototype.createPattern=function(t,e){return this.m_oFillContext.createPattern(t,e)};var ppArt={CMD_CREATE_SHAPE:"0",CMD_CREATE_MASK:"1",CMD_END_PATH:"2",CMD_CLOSE_PATH:"3",CMD_ADD_TEXT:"4",CMD_ADD_IMAGE:"5",CMD_ROTATION_DATA:"6",CMD_START_SOLID_FILL:"A",CMD_START_GRADIENT_FILL:"B",CMD_START_BITMAP_FILL:"C",CMD_START_SLIDEBG_FILL:"D",CMD_END_FILL:"E",CMD_START_BITMAP_TILE_FILL:"F",CMD_REPEAT_FILL:"G",CMD_LINE_STYLE:"N",CMD_GRADIENT_LINE_STYLE:"O",CMD_CLEAR_LINE_STYLE:"P",CMD_REPEAT_LINE_STYLE:"Q",CMD_DEFAULT_HOT:"Z",CMD_DRAW_ARC:"a",CMD_DRAW_ELLIPSE:"b",CMD_DRAW_RECTANGLE:"c",CMD_DRAW_LINE:"d",CMD_DRAW_LINES:"e",CMD_DRAW_POLYGON:"f",CMD_DRAW_CURVE:"g",CMD_DRAW_CLOSED_CURVE:"h",CMD_DRAW_TEXT:"i",CMD_DRAW_SHADOW:"t",CMD_DRAW_SHAPE_SHADOW:"u",CMD_DRAW_REFLECTION:"v",CMD_SOFTEN_EDGES:"w",CMD_DRAW_PERSPECTIVE_SHADOW:"x",LINE_CAP_SQUARE:1,LINE_CAP_FLAT:2,LINE_CAP_ROUND:4,LINE_JOIN_ROUND:8,LINE_JOIN_BEVEL:16,LINE_JOIN_MITER:32,DEGREE_MULTIPLIER:2*Math.PI/360,BASE_NUMBER:64,BASE_POW:6,m_strPath:"",m_nPos:0,m_bPathStarted:!1,m_bShapeStarted:!1,m_bReverseCurve:!1,m_bResetReverse:!1,m_nStartX:0,m_nStartY:0,m_nCurX:0,m_nCurY:0,m_arrGraphics:null,m_listTextOffsets:null,m_arrShadows:null,m_oGraphics:null,m_bDebug:!1,m_nReflectionIndex:-1,m_nLastLineStyle:-1,m_nLastFill:-1,m_nLineWidth:0,rectRotated:null,polyRotated:null,m_nRotationDistance:0,m_o64to10:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35,A:36,B:37,C:38,D:39,E:40,F:41,G:42,H:43,I:44,J:45,K:46,L:47,M:48,N:49,O:50,P:51,Q:52,R:53,S:54,T:55,U:56,V:57,W:58,X:59,Y:60,Z:61,_:62,$:63},UBaseNto10:function(t,e){for(var i=0,r=0,a=t;t+e>a;a++)i+=this.m_o64to10[this.m_strPath.charAt(this.m_nPos+a)]<<this.BASE_POW*r,r++;return i},BaseNto10:function(t,e){for(var i=0,r=0,a=t;t+e>a;a++)i+=this.m_o64to10[this.m_strPath.charAt(this.m_nPos+a)]<<this.BASE_POW*r,r++;return i-2047},FBaseNto10:function(t,e){var i=0,i=0,r=this.UBaseNto10(t+2,e-2);return"00"==this.m_strPath.substr(t+this.m_nPos,2)?i=-r/4095:(i=this.BaseNto10(t,2),i+=r/4095),Math.round(1e3*i)/1e3},GetColor:function(t,e){void 0==e&&(e=100);var i;return i=e/100,0==i&&(i=.01),"rgba("+(t>>16)+","+(t>>8&255)+","+(255&t)+", "+i+")"},GetCommandDescription:function(t){var e="Unknown: "+t;switch(t){case this.CMD_ROTATION_DATA:e="CMD_ROTATION_DATA";break;case this.CMD_DRAW_TEXT:e="CMD_DRAW_TEXT";break;case this.CMD_DEFAULT_HOT:e="CMD_DEFAULT_HOT";break;case this.CMD_DRAW_LINE:e="CMD_DRAW_LINE";break;case this.CMD_DRAW_LINES:e="CMD_DRAW_LINES";break;case this.CMD_DRAW_POLYGON:e="CMD_DRAW_POLYGON";break;case this.CMD_DRAW_CURVE:e="CMD_DRAW_CURVE";break;case this.CMD_DRAW_CLOSED_CURVE:e="**** implement CMD_DRAW_CLOSED_CURVE";break;case this.CMD_ADD_TEXT:e="CMD_ADD_TEXT";break;case this.CMD_ADD_IMAGE:e="CMD_ADD_IMAGE";break;case this.CMD_END_PATH:e="CMD_END_PATH";break;case this.CMD_CLOSE_PATH:e="CMD_CLOSE_PATH";break;case this.CMD_CREATE_SHAPE:e="**** implement CMD_CREATE_SHAPE";break;case this.CMD_CREATE_MASK:e="CMD_CREATE_MASK";break;case this.CMD_LINE_STYLE:e="CMD_LINE_STYLE";break;case this.CMD_GRADIENT_LINE_STYLE:e="**** implement CMD_GRADIENT_LINE_STYLE";break;case this.CMD_CLEAR_LINE_STYLE:e="CMD_CLEAR_LINE_STYLE";break;case this.CMD_REPEAT_LINE_STYLE:e="**** implement CMD_REPEAT_LINE_STYLE";break;case this.CMD_START_SLIDEBG_FILL:e="**** implement CMD_START_SLIDEBG_FILL";break;case this.CMD_START_BITMAP_FILL:e="**** implement CMD_START_BITMAP_FILL";break;case this.CMD_START_BITMAP_TILE_FILL:e="CMD_START_BITMAP_TILE_FILL";break;case this.CMD_START_GRADIENT_FILL:e="CMD_START_GRADIENT_FILL";break;case this.CMD_START_SOLID_FILL:e="CMD_START_SOLID_FILL";break;case this.CMD_END_FILL:e="CMD_END_FILL";break;case this.CMD_REPEAT_FILL:e="**** implement CMD_REPEAT_FILL";break;case this.CMD_DRAW_ELLIPSE:e="CMD_DRAW_ELLIPSE";break;case this.CMD_DRAW_RECTANGLE:e="CMD_DRAW_RECTANGLE";break;case this.CMD_DRAW_SHADOW:e="CMD_DRAW_SHADOW";break;case this.CMD_DRAW_ARC:case this.CMD_DRAW_SHAPE_SHADOW:e="**** implement CMD_DRAW_SHAPE_SHADOW";break;case this.CMD_DRAW_PERSPECTIVE_SHADOW:e="**** implement CMD_DRAW_PERSPECTIVE_SHADOW";break;case this.CMD_SOFTEN_EDGES:e="CMD_SOFTEN_EDGES";break;case this.CMD_DRAW_REFLECTION:e="CMD_DRAW_REFLECTION"}return e},m_arrColors:[16711680,16776960,16777215,65280,65535,255,16711935,0],m_nCurColor:0,DrawVector:function(t,e,i,r,a,s){if(null!=this.m_arrGraphics)for(var n=0;n<this.m_arrGraphics.length;n++)this.m_arrGraphics[n].Destroy();this.m_arrGraphics=[],this.m_listTextOffsets={},t.rectShape||(t.rectShape=new ppRect(-1,-1,t.m_nWidth+1,t.m_nHeight+1)),this.rectShape=t.rectShape,this.m_nRotation=t.rotation,this.m_oGraphics=new ppGraphics(t.rectShape),this.m_arrGraphics.push(this.m_oGraphics),this.m_nPos=0,this.m_bShapeStarted=this.m_bPathStarted=!1,this.m_nReflectionIndex=-1,this.m_bResetReverse=this.m_bReverseCurve=!1,this.m_arrShadows=null,this.DrawPath(e,0,0,i,r,a,s),e=t.canvas.getContext("2d"),e.save();for(var o=[],s=null,a=r=0,i={x:0,y:0},n=0;n<this.m_arrGraphics.length;n++){if(1==this.m_arrGraphics.length&&null!=this.m_arrShadows){for(var l=this.m_arrGraphics[0],s=null,h=0;h<this.m_arrShadows.length;h++)s=this.m_arrShadows[h],l.AddShadow(s.nXOffset,s.nYOffset,s.nBlurX,s.nColor,s.nAlpha,s.nScale,s.nStrength,s.nQuality,s.bInner);this.m_arrShadows=null}s={},s.canvas=this.m_arrGraphics[n].GetFinalCanvas(),s.offset=this.m_arrGraphics[n].GetOffset(),s.width=this.m_oGraphics.m_nWidth,s.height=this.m_oGraphics.m_nHeight,r<s.canvas.height&&(r=s.canvas.height),a<s.canvas.width&&(a=s.canvas.width),o.push(s),i.x<o[n].offset.x&&(i.x=o[n].offset.x),i.y<o[n].offset.y&&(i.y=o[n].offset.y)}if(s=null,1==o.length)s=o[0].canvas,i=o[0].offset;else for(s=document.createElement("canvas"),s.width=a,s.height=r,l=s.getContext("2d"),n=0;n<o.length;n++)l.drawImage(o[n].canvas,i.x-o[n].offset.x,i.y-o[n].offset.y);if(null!=this.m_arrShadows){for(l=new ppGraphics(new ppRect(0,0,a,r)),l.AddImage(s,0,0,1,1,100),n=0;n<this.m_arrShadows.length;n++)s=this.m_arrShadows[n],l.AddShadow(s.nXOffset,s.nYOffset,s.nBlurX,s.nColor,s.nAlpha,s.nScale,s.nStrength,s.nQuality,s.bInner);s=l.GetFinalCanvas(),a=s.width,r=s.height,n=l.GetOffset(),0<n.x&&(i.x+=n.x),0<n.y&&(i.y+=n.y)}n=new ppRect(0,0,a,r),r=new ppRect(0,0,a,r),a={x:0,y:0},0<=this.m_nReflectionIndex&&(this.m_nPos=this.m_nReflectionIndex,this.AdjustReflectionBounds(n,a,t.rectShape,this.rectRotated,t.rotation,t.rotatexpos,t.rotateypos,this.m_nRotationDistance)),t.canvas.width=n.GetWidth(),t.canvas.height=n.GetHeight(),e.drawImage(s,0,0,r.right,r.bottom,a.x,a.y,r.right,r.bottom),e.restore(),0<=this.m_nReflectionIndex&&(this.m_nPos=this.m_nReflectionIndex,this.DrawReflection(e,t.canvas,t.rectShape,a,this.rectRotated,this.polyRotated,t.rotation,t.rotatexpos,t.rotateypos,this.m_nRotationDistance)),t.m_nXOffset=t.rectShape.left-(a.x+i.x),t.m_nYOffset=t.rectShape.top-(a.y+i.y);for(var p in this.m_listTextOffsets)this.m_listTextOffsets[p].x+=a.x+i.x,this.m_listTextOffsets[p].y+=a.y+i.y;-1<location.search.indexOf("info=1")&&e.fillRect(t.rectShape.left,t.rectShape.top,t.rectShape.left+10,t.rectShape.top+10)},DrawPath:function(t,e,i,r,a,s,n){for(this.m_strPath=t,this.m_oGraphics.beginPath();this.m_nPos<this.m_strPath.length;)t=this.m_strPath.charAt(this.m_nPos),this.m_nPos++,this.m_bResetReverse&&(this.m_bReverseCurve=!1),this.m_bResetReverse=!0,this.ExecuteCmd(t,e,i,r,a,s,n);this.m_oGraphics.fill(),this.m_oGraphics.stroke()},ExecuteCmd:function(t,e,i,r,a,s,n){switch(t){case this.CMD_ROTATION_DATA:this.m_nPos+=this.StoreRotationData();break;case this.CMD_CREATE_SHAPE:e=this.m_nPos,this.m_oGraphics.fill(),this.m_oGraphics.stroke(),this.m_oGraphics=new ppGraphics(this.rectShape),this.m_arrGraphics.push(this.m_oGraphics),this.m_nPos=e+1;break;case this.CMD_END_PATH:this.m_oGraphics.fill(),this.m_oGraphics.stroke(),this.m_bPathStarted=this.m_bShapeStarted=!1,this.m_nCurY=this.m_nCurX=0;break;case this.CMD_CLOSE_PATH:this.m_bResetReverse=!1,this.m_oGraphics.lineTo(this.m_nStartX,this.m_nStartY),this.m_oGraphics.closePath(),this.m_bShapeStarted=!0,this.m_bPathStarted=!1,this.m_nCurY=this.m_nCurX=0;break;case this.CMD_ADD_IMAGE:this.m_nPos+=this.AddImage(e,i,s);break;case this.CMD_START_SOLID_FILL:this.m_nLastFill=this.m_nPos-1,this.m_nPos+=this.StartSolidFill();break;case this.CMD_START_GRADIENT_FILL:this.m_nLastFill=this.m_nPos-1,this.m_oGraphics.fill(),this.m_nPos+=this.StartGradientFill(e,i);break;case this.CMD_START_BITMAP_FILL:this.m_nLastFill=this.m_nPos-1,this.m_oGraphics.fill(),this.m_nPos+=this.StartBitmapFill(e,i,s);break;case this.CMD_START_SLIDEBG_FILL:this.m_nLastFill=this.m_nPos-1,this.m_oGraphics.fill();break;case this.CMD_END_FILL:this.m_oGraphics.EndFill();break;case this.CMD_START_BITMAP_TILE_FILL:this.m_nLastFill=this.m_nPos-1,this.m_nPos+=this.StartBitmapTileFill(e,i,s);break;case this.CMD_REPEAT_FILL:t=this.m_nPos,this.m_nPos=this.m_nLastFill,n=this.m_strPath.charAt(this.m_nPos),this.m_nPos++,this.ExecuteCmd(n,e,i,r,a,s),this.m_nPos=t;break;case this.CMD_LINE_STYLE:this.m_nLastLineStyle=this.m_nPos-1,this.m_nPos+=this.SetLineStyle();break;case this.CMD_GRADIENT_LINE_STYLE:this.m_nLastLineStyle=this.m_nPos-1,this.m_nPos+=this.SetGradientLineStyle();break;case this.CMD_CLEAR_LINE_STYLE:this.m_nLineWidth=0,this.m_oGraphics.ClearLineStyle();break;case this.CMD_REPEAT_LINE_STYLE:t=this.m_nPos,this.m_nPos=this.m_nLastLineStyle,n=this.m_strPath.charAt(this.m_nPos),this.m_nPos++,this.ExecuteCmd(n,e,i,r,a,s),this.m_nPos=t;break;case this.CMD_DEFAULT_HOT:this.item&&(this.item.vectorHot=!0);break;case this.CMD_DRAW_ELLIPSE:this.m_nPos+=this.DrawEllipse(e,i),this.m_oGraphics.closePath(),this.m_bPathStarted=!1;break;case this.CMD_DRAW_RECTANGLE:this.m_nPos+=this.DrawRectangle(e,i),this.m_oGraphics.closePath(),this.m_bPathStarted=!1;break;case this.CMD_DRAW_LINE:this.m_nPos+=this.DrawLine(e,i);break;case this.CMD_DRAW_LINES:this.m_nPos+=this.DrawLines(e,i);break;case this.CMD_DRAW_POLYGON:this.m_nPos+=this.DrawPolygon(e,i),this.m_oGraphics.closePath(),this.m_bPathStarted=!1;break;case this.CMD_DRAW_CURVE:this.m_bResetReverse=!1,this.m_nPos+=this.DrawCurve(e,i);break;case this.CMD_DRAW_CLOSED_CURVE:this.m_bResetReverse=!1,this.m_nPos+=this.DrawCurve(e,i),this.m_oGraphics.closePath(),this.m_bPathStarted=!1;break;case this.CMD_DRAW_SHADOW:this.m_nPos+=this.DrawGlobalShadow();break;case this.CMD_DRAW_SHAPE_SHADOW:this.m_nPos+=this.DrawShadow();break;case this.CMD_DRAW_REFLECTION:this.m_nReflectionIndex=this.m_nPos,this.m_nPos+=12;break;case this.CMD_DRAW_PERSPECTIVE_SHADOW:this.m_nPos+=37;break;case this.CMD_DRAW_TEXT:this.m_nPos+=this.DrawVectorText(e,i,a);break;case this.CMD_ADD_TEXT:this.m_nPos+=this.AddText(e,i,r,a,n)}},GetGradientLine:function(t,e,i,r,a){for(var s=!1;a>=180;)a-=180,s=!s;var a=a*Math.PI/180,n=0,o=0,i=i/2,r=r/2;return a<=Math.atan2(r,i)?(n=i,o=Math.tan(a)*i):a<=Math.PI/2?(n=Math.tan(Math.PI/2-a)*r,o=r):a<=Math.PI/2+Math.atan2(i,r)?(n=Math.tan(Math.PI/2-a)*r,o=r):a<=Math.PI&&(n=-i,o=Math.tan(a)*-i),s&&(n=-n,o=-o),{x1:t+i-n,y1:e+r-o,x2:t+i+n,y2:e+r+o}},StartGradientFill:function(){var t=this.UBaseNto10(0,1),e=this.BaseNto10(1,2),i=this.BaseNto10(3,2),r=this.BaseNto10(5,2),a=this.BaseNto10(7,2),s=360*this.UBaseNto10(9,2)/4095,n=this.UBaseNto10(11,1);if(2==t?(t=r,r>a&&(t=a),e=this.m_oGraphics.createRadialGradient(e+r/2,i+a/2,0,e+r/2,i+a/2,t/2)):(e=this.GetGradientLine(e,i,r,a,s),e=this.m_oGraphics.createLinearGradient(e.x1,e.y1,e.x2,e.y2)),null!=e){for(var o=12,t=-1,s=0;n>s;s++)i=this.UBaseNto10(o,4),o+=4,r=this.UBaseNto10(o,2),o+=2,a=this.UBaseNto10(o,2),o+=2,a!=t&&e.addColorStop(a/255,this.GetColor(i,r)),t=a;this.m_oGraphics.StartGradientFill(e)}return o},SetGradientLineStyle:function(){var t=this.UBaseNto10(0,2),e=this.UBaseNto10(2,1),i=this.UBaseNto10(3,1),r=this.BaseNto10(4,2),a=this.BaseNto10(6,2),s=this.BaseNto10(8,2),n=this.BaseNto10(10,2),o=360*this.UBaseNto10(12,2)/4095,l=this.UBaseNto10(14,1),h="round",p="round";if(e&this.LINE_CAP_FLAT?h="butt":e&this.LINE_CAP_ROUND?h="round":e&this.LINE_CAP_SQUARE&&(h="square"),e&this.LINE_JOIN_BEVEL?p="bevel":e&this.LINE_JOIN_MITER?p="miter":e&this.LINE_JOIN_ROUND&&(p="round"),e=15,2==i?(i=s,s>n&&(i=n),r=this.m_oGraphics.createRadialGradient(r+s/2,a+n/2,0,r+s/2,a+n/2,i/2)):(r=this.GetGradientLine(r,a,s,n,o),r=this.m_oGraphics.createLinearGradient(r.x1,r.y1,r.x2,r.y2)),null!=r){for(i=0;l>i;i++)a=this.UBaseNto10(e,4),e+=4,s=this.UBaseNto10(e,2),e+=2,n=this.UBaseNto10(e,2),e+=2,r.addColorStop(n/255,this.GetColor(a,s));this.m_oGraphics.SetGradientLineStyle(t,r,p,h)}return e},SetLineStyle:function(){var t=this.UBaseNto10(0,2),e=this.UBaseNto10(2,4),i=this.UBaseNto10(6,2),r=this.UBaseNto10(8,1),a="round",s="round";return this.m_nLineWidth=t,r&this.LINE_CAP_FLAT?a="butt":r&this.LINE_CAP_ROUND?a="round":r&this.LINE_CAP_SQUARE&&(a="square"),r&this.LINE_JOIN_BEVEL?s="bevel":r&this.LINE_JOIN_MITER?s="miter":r&this.LINE_JOIN_ROUND&&(s="round"),this.m_oGraphics.SetLineStyle(t,e,i,s,a),9},AdjustShadowBounds:function(t){var e=this.FBaseNto10(0,4),i=this.FBaseNto10(4,4)-this.m_nRotation,r=this.UBaseNto10(14,2);this.UBaseNto10(16,2);var a=this.FBaseNto10(22,4),s=this.rectShape.GetWidth(),r=r+(s*a-s)/2,a={x:0,y:0},s=e*Math.cos(i*this.DEGREE_MULTIPLIER),i=e*Math.sin(i*this.DEGREE_MULTIPLIER),e=Math.floor(t.left+s-r),s=Math.ceil(t.right+s+r),n=Math.floor(t.top+i-r),r=Math.ceil(t.bottom+i+r);return e<t.left&&(t.left=e,a.x=-e),n<t.top&&(t.top=n,a.y=-n),s>t.right&&(t.right=s),r>t.bottom&&(t.bottom=r),a},DrawGlobalShadow:function(){null==this.m_arrShadows&&(this.m_arrShadows=[]);var t=this.FBaseNto10(0,4),e=this.FBaseNto10(4,4)-this.m_nRotation,i=this.UBaseNto10(8,4),r=this.UBaseNto10(12,2),a=this.UBaseNto10(14,2);this.UBaseNto10(16,2);var s=this.UBaseNto10(18,2),n=this.UBaseNto10(20,1),o="1"==this.m_strPath.substr(this.m_nPos+21,1),l=this.FBaseNto10(22,4),h=t*Math.cos(e*this.DEGREE_MULTIPLIER),t=t*Math.sin(e*this.DEGREE_MULTIPLIER),e={};return e.nXOffset=h,e.nYOffset=t,e.nBlurX=a,e.nColor=i,e.nAlpha=r,e.nScale=l,e.nStrength=s,e.nQuality=n,e.bInner=o,this.m_arrShadows.push(e),26},DrawShadow:function(){var t=this.FBaseNto10(0,4),e=this.FBaseNto10(4,4)-this.m_nRotation,i=this.UBaseNto10(8,4),r=this.UBaseNto10(12,2),a=this.UBaseNto10(14,2);this.UBaseNto10(16,2);var s=this.UBaseNto10(18,2),n=this.UBaseNto10(20,1),o="1"==this.m_strPath.substr(this.m_nPos+21,1),l=this.FBaseNto10(22,4),h=t*Math.cos(e*this.DEGREE_MULTIPLIER),t=t*Math.sin(e*this.DEGREE_MULTIPLIER);return this.m_oGraphics.AddShadow(h,t,a,i,r,l,s,n,o),26},StoreRotationData:function(){return this.m_nRotationDistance=this.BaseNto10(0,2),this.rectRotated=new ppRect(this.BaseNto10(2,2),this.BaseNto10(4,2),this.BaseNto10(6,2),this.BaseNto10(8,2)),this.polyRotated=[{x:this.BaseNto10(10,2),y:this.BaseNto10(12,2)},{x:this.BaseNto10(14,2),y:this.BaseNto10(16,2)},{x:this.BaseNto10(18,2),y:this.BaseNto10(20,2)},{x:this.BaseNto10(22,2),y:this.BaseNto10(24,2)}],0==this.rectRotated.left&&0==this.rectRotated.right&&0==this.rectRotated.top&&0==this.rectRotated.bottom&&(this.rectRotated=this.rectShape.Clone(),this.polyRotated=[{x:this.rectShape.left-10,y:this.rectShape.top-10},{x:this.rectShape.right+10,y:this.rectShape.top-10},{x:this.rectShape.right+10,y:this.rectShape.bottom+10},{x:this.rectShape.left-10,y:this.rectShape.bottom+10}]),26},AdjustReflectionBounds:function(t,e,i,r,a,s,n,o){var l=this.UBaseNto10(0,2);if(0<this.UBaseNto10(10,2)/100){var h=0,p=0,c=i.bottom;0!=a&&(h=(o+l/2)/Math.sin(a*this.DEGREE_MULTIPLIER),p=h*Math.cos(2*a*this.DEGREE_MULTIPLIER),c=h*Math.sin(2*a*this.DEGREE_MULTIPLIER)),o=i.left+Math.sin(2*a*this.DEGREE_MULTIPLIER)*i.left,i=i.top+Math.cos(2*a*this.DEGREE_MULTIPLIER)*i.left,s=s+h-p-(s-r.left)-o,n=n+c-(n-r.top)-i,c=r.GetWidth()-o,p=r.GetHeight()-i,r=Math.floor(s),h=Math.floor(n),c=Math.ceil(s+c),n=Math.ceil(n+p),t.left>r&&(e.x=-r,t.left=r),t.top>h&&(e.y=-h,t.top=h),t.bottom<n&&(t.bottom=n),t.right<c&&(t.right=c)}},DrawReflection:function(t,e,i,r,a,s,n,o,l,h){var p=this.UBaseNto10(0,2),c=[this.UBaseNto10(2,2),this.UBaseNto10(4,2)],d=[this.UBaseNto10(6,2)/100,this.UBaseNto10(8,2)/100],u=this.UBaseNto10(10,2)/100;if(u>0){var f=document.createElement("canvas");f.style.border="red 1px dashed",f.width=a.GetWidth(),f.height=a.GetHeight();var m=f.getContext("2d");m.save(),m.translate(o-a.left,i.GetHeight()-(l-i.top)-(i.bottom-a.bottom)),m.scale(1,-1),m.rotate(2*n*this.DEGREE_MULTIPLIER),m.translate(-(o-i.left),-(l-i.top)),m.drawImage(e,r.x,r.y,e.width-r.x,e.height-r.y,0,0,e.width-r.x,e.height-r.y),m.restore(),Math.sqrt((s[3].x-s[0].x)*(s[3].x-s[0].x)+(s[3].y-s[0].y)*(s[3].y-s[0].y)),e=m.createLinearGradient(s[0].x,s[0].y,s[3].x,s[3].y),m.save(),e.addColorStop(c[0]/255,"rgba(255, 255, 255, "+(1-d[0])+")"),e.addColorStop(c[1]/255*u,"rgba(255, 255, 255, "+(1-d[1])+")"),e.addColorStop(c[1]/255*u+1e-4,"rgba(255, 255, 255, 100)"),m.fillStyle=e,m.globalCompositeOperation="destination-out",m.moveTo(s[0].x,s[0].y),m.lineTo(s[1].x,s[1].y),
m.lineTo(s[2].x,s[2].y),m.lineTo(s[3].x,s[3].y),m.lineTo(s[0].x,s[0].y),m.fill(),c=s=0,d=this.rectShape.bottom+p,0!=n&&(s=(h+p/2)/Math.sin(n*this.DEGREE_MULTIPLIER),c=s*Math.cos(2*n*this.DEGREE_MULTIPLIER),d=s*Math.sin(2*n*this.DEGREE_MULTIPLIER)),t.drawImage(f,0,0,f.width,f.height,s+r.x+o-i.left-c-(o+i.left-a.left)+i.left,r.y+l-i.top+d-(i.GetHeight()-l-(i.bottom-a.bottom)),f.width,f.height),f.width=1,f.height=1}return 12},StartBitmapFill:function(t,e,i){var r=this.m_strPath.substr(this.m_nPos,2);this.BaseNto10(2,2),this.BaseNto10(4,2);var a=this.BaseNto10(6,2),s=this.BaseNto10(8,2),t=this.BaseNto10(10,2),e=this.BaseNto10(12,2),n=this.FBaseNto10(14,4),o=this.FBaseNto10(18,4),l=360*this.UBaseNto10(22,2)/4095;this.UBaseNto10(24,2);var h=i.GetImage(r),i=h.imgNode,r=document.createElement("canvas");return r.width=a,r.height=s,a=r.getContext("2d"),n=h.nWidth*n/i.naturalWidth,o=h.nHeight*o/i.naturalHeight,s=i.naturalWidth*n/2,h=i.naturalHeight*o/2,a.translate(s+t,h+e),a.rotate(l*this.DEGREE_MULTIPLIER),a.translate(-s,-h),a.scale(n,o),a.drawImage(i,0,0),this.m_oGraphics.StartImageFill(this.m_oGraphics.createPattern(r,"no-repeat")),r.width=1,r.height=1,26},StartBitmapTileFill:function(t,e,i){var r=this.m_strPath.substr(this.m_nPos,2),t=this.BaseNto10(2,2)+t,e=this.BaseNto10(4,2)+e,a=this.FBaseNto10(6,4),s=this.FBaseNto10(10,4),n=360*this.UBaseNto10(14,2)/4095;this.UBaseNto10(16,2);var o,l=this.UBaseNto10(18,1),h=i.GetImage(r),i=h.imgNode,r=h.nWidth*a/i.naturalWidth,s=h.nHeight*s/i.naturalHeight;switch(l){case 0:o=document.createElement("canvas"),o.width=i.naturalWidth,o.height=i.naturalHeight,l=o.getContext("2d"),l.drawImage(i,0,0);break;case 1:o=document.createElement("canvas"),o.width=2*i.naturalWidth,o.height=i.naturalHeight,l=o.getContext("2d"),l.drawImage(i,0,0),l.save(),l.translate(i.naturalWidth,0),l.scale(-1,1),l.drawImage(i,-i.naturalWidth,0),l.restore();break;case 2:o=document.createElement("canvas"),o.width=i.naturalWidth,o.height=2*i.naturalHeight,l=o.getContext("2d"),l.drawImage(i,0,0),l.save(),l.translate(0,i.naturalHeight),l.scale(1,-1),l.drawImage(i,0,-i.naturalHeight),l.restore();break;case 4:o=document.createElement("canvas"),o.width=2*i.naturalWidth,o.height=2*i.naturalHeight,l=o.getContext("2d"),l.drawImage(i,0,0),l.save(),l.translate(0,i.naturalHeight),l.scale(1,-1),l.drawImage(i,0,-i.naturalHeight),l.restore(),l.save(),l.translate(i.naturalWidth,0),l.scale(-1,1),l.drawImage(i,-i.naturalWidth,0),l.restore(),l.save(),l.translate(i.naturalWidth,i.naturalHeight),l.scale(-1,-1),l.drawImage(i,-i.naturalWidth,-i.naturalHeight),l.restore()}return this.m_oGraphics.StartRotatedImageFill(this.m_oGraphics.createPattern(o,"repeat"),n*this.DEGREE_MULTIPLIER,t,e,r,s),o.width=1,o.height=1,19},AddImage:function(t,e,i){var r=this.m_strPath.substr(this.m_nPos,2),t=this.FBaseNto10(2,4)+t,e=this.FBaseNto10(6,4)+e,a=this.FBaseNto10(10,4),s=this.FBaseNto10(14,4),n=this.UBaseNto10(18,2)/100;return ppDebug.debug_trace(r+": "+t+", "+e+" :: "+a+", "+s+" :: Alpha = "+n),i=i.GetImage(r),r=i.imgNode,a=Math.round(1e3*(i.nWidth*a/r.naturalWidth))/1e3,s=Math.round(1e3*(i.nHeight*s/r.naturalHeight))/1e3,this.m_oGraphics.AddImage(r,t+i.nDX,e+i.nDY,a,s,n),20},StartSolidFill:function(){var t=this.UBaseNto10(0,4),e=this.UBaseNto10(4,2);return this.m_oGraphics.StartSolidFill(t,e),6},AddText:function(t,e,i,r,a){var s=this.m_strPath.substr(this.m_nPos,2),n=this.BaseNto10(2,2),o=this.BaseNto10(4,2),l=this.FBaseNto10(6,4);this.m_strPath.substr(this.m_nPos+10,1);var h=i.GetPathById(s,a),p=this.m_nPos,c=this.m_strPath;return this.m_nPos=0,this.m_strPath=h,this.m_oGraphics.stroke(),this.m_oGraphics.fill(),this.m_listTextOffsets[s]={id:s,x:n+t,y:o+e},this.item.textOffset={x:0,y:0},0!=l&&(this.m_oGraphics.m_oStrokeContext.save(),this.m_oGraphics.m_oFillContext.save(),s=this.item.getAABB_simple(l,!0),(0>s.top||0>s.left||s.right>this.m_oGraphics.m_oFillCanvas.width||s.bottom>this.m_oGraphics.m_oFillCanvas.height)&&(s.bottom+=Math.max(s.bottom-this.m_oGraphics.m_oFillCanvas.height,0),s.right+=Math.max(s.right-this.m_oGraphics.m_oFillCanvas.width,0),this.item.textOffset.x=Math.min(s.left,0),this.item.textOffset.y=Math.min(s.top,0),this.item.textOffset.box=s,this.m_oGraphics.ResizeCanvasBox(s),this.m_oGraphics.m_oFillContext.translate(-this.item.textOffset.x,-this.item.textOffset.y),this.m_oGraphics.m_oStrokeContext.translate(-this.item.textOffset.x,-this.item.textOffset.y)),this.m_oGraphics.m_oFillContext.translate(n,o),this.m_oGraphics.m_oFillContext.rotate(l*Math.PI/180),this.m_oGraphics.m_oFillContext.translate(-n,-o),this.m_oGraphics.m_oStrokeContext.translate(n,o),this.m_oGraphics.m_oStrokeContext.rotate(l*Math.PI/180),this.m_oGraphics.m_oStrokeContext.translate(-n,-o)),this.DrawPath(h,n+t,o+e,i,r,a),0!=l&&(this.m_oGraphics.m_oFillContext.restore(),this.m_oGraphics.m_oStrokeContext.restore()),this.m_nPos=p,this.m_strPath=c,11},DrawPolygon:function(t,e){var i=this.UBaseNto10(0,2),r=this.FBaseNto10(2,4)+t,a=this.FBaseNto10(6,4)+e,s=r,n=a;this.m_oGraphics.moveTo(s,n);for(var o=10,l=1;i>l;l++)r=this.FBaseNto10(o,4)+t,o+=4,a=this.FBaseNto10(o,4)+e,o+=4,this.m_oGraphics.lineTo(r,a);return this.m_oGraphics.lineTo(s,n),o},DrawLine:function(t,e){var i=this.FBaseNto10(0,4)+t,r=this.FBaseNto10(4,4)+e,a=this.FBaseNto10(8,4)+t,s=this.FBaseNto10(12,4)+e;return this.m_bPathStarted?this.m_oGraphics.lineTo(i,r):(this.m_bPathStarted=!0,this.m_oGraphics.moveTo(i,r),this.m_nStartX=i,this.m_nStartY=r),this.m_oGraphics.lineTo(a,s),this.m_nCurX=a,this.m_nCurY=s,16},DrawLines:function(t,e){var i=this.UBaseNto10(0,2),r=this.FBaseNto10(2,4)+t,a=this.FBaseNto10(6,4)+e;this.m_bPathStarted?this.m_oGraphics.lineTo(r,a):(this.m_bPathStarted=!0,this.m_oGraphics.moveTo(r,a),this.m_nStartX=r,this.m_nStartY=a);for(var s=10,n=1;i>n;n++)r=this.FBaseNto10(s,4)+t,s+=4,a=this.FBaseNto10(s,4)+e,s+=4,this.m_oGraphics.lineTo(r,a);return this.m_nCurX=r,this.m_nCurY=a,s},DrawCurve:function(t,e){var i,r,a,s,n,o,l=(this.UBaseNto10(0,2)-1)/3,h=this.FBaseNto10(2,4)+t,p=this.FBaseNto10(6,4)+e,c=0;if(this.m_bReverseCurve){for(var d=this.m_nCurX,u=this.m_nCurY,f=!1,m=[],y=10,c=0;l>c;c++)i={},i.nControlAX=this.FBaseNto10(y,4)+t,y+=4,i.nControlAY=this.FBaseNto10(y,4)+e,y+=4,i.nControlBX=this.FBaseNto10(y,4)+t,y+=4,i.nControlBY=this.FBaseNto10(y,4)+e,y+=4,i.nX=this.FBaseNto10(y,4)+t,y+=4,i.nY=this.FBaseNto10(y,4)+e,y+=4,m.push(i);for(this.m_bPathStarted?(this.m_oGraphics.moveTo(i.nX,i.nY),f=!0):(this.m_bPathStarted=!0,this.m_oGraphics.moveTo(i.nX,i.nY),this.m_nStartX=i.nX,this.m_nStartY=i.nY),this.m_nCurX=i.nX,this.m_nCurY=i.nY,c=m.length-1;c>=0;c--)i=m[c].nControlAX,r=m[c].nControlAY,a=m[c].nControlBX,s=m[c].nControlBY,0!=c?(n=m[c-1].nX,o=m[c-1].nY):(n=h,o=p),this.m_oGraphics.bezierCurveTo(a,s,i,r,n,o);f&&this.m_oGraphics.lineTo(d,u),this.m_oGraphics.moveTo(this.m_nCurX,this.m_nCurY)}else for(this.m_bPathStarted?this.m_oGraphics.lineTo(h,p):(this.m_bPathStarted=!0,this.m_oGraphics.moveTo(h,p),this.m_nStartX=h,this.m_nStartY=p),this.m_nCurX=h,this.m_nCurY=p,y=10,c=0;l>c;c++)i=this.FBaseNto10(y,4)+t,y+=4,r=this.FBaseNto10(y,4)+e,y+=4,a=this.FBaseNto10(y,4)+t,y+=4,s=this.FBaseNto10(y,4)+e,y+=4,n=this.FBaseNto10(y,4)+t,y+=4,o=this.FBaseNto10(y,4)+e,y+=4,this.m_oGraphics.bezierCurveTo(i,r,a,s,n,o),this.m_nCurX=n,this.m_nCurY=o;return y},DrawRectangle:function(t,e){var i=this.FBaseNto10(0,4)+t,r=this.FBaseNto10(4,4)+e,a=this.FBaseNto10(8,4),s=this.FBaseNto10(12,4);return this.m_oGraphics.moveTo(i,r),this.m_oGraphics.lineTo(i+a,r),this.m_oGraphics.lineTo(i+a,r+s),this.m_oGraphics.lineTo(i,r+s),this.m_oGraphics.lineTo(i,r),16},DrawVectorText:function(t,e){(this.m_bPathStarted||this.m_bShapeStarted)&&(this.m_oGraphics.fill(),this.m_oGraphics.stroke(),this.m_bShapeStarted=this.m_bPathStarted=!1);for(var i=0,r=this.m_strPath.substr(this.m_nPos,2),i=i+2,a=this.FBaseNto10(i,4),i=i+4,s=this.UBaseNto10(i,4),i=i+4,n=this.UBaseNto10(i,1),i=i+1,o=this.UBaseNto10(i,2),i=i+2,l=[],h=null,p=0;o>p;p++)h={},h.CharCount=this.UBaseNto10(i,2),i+=2,h.XPos=this.FBaseNto10(i,4),i+=4,h.YPos=this.FBaseNto10(i,4),i+=4,l.push(h);for(var c,d=0,u=0,f=0,m=0,p=0;p<l.length;p++){h=l[p],o=h.XPos+t+this.m_oGraphics.m_nXOffset-.5,c=h.YPos+e+this.m_oGraphics.m_nYOffset-.5;for(var y=0;y<h.CharCount;y++){if(d=this.FBaseNto10(i,4),i+=4,u=this.UBaseNto10(i,n),i+=n,this.m_oGraphics.beginPath(),this.m_oGraphics.SetLineStyle(1,16711680,100,"round"),""!=r){var g=g_listFonts[r];this.m_oGraphics.StartSolidFill(s,255),g.DrawGlyph(u,this.m_oGraphics.m_oFillContext,o,c,a),this.m_oGraphics.fill()}else ppDebug.debug_trace("Could not find the font with id: "+r);o+=d}o>f&&(f=o),c>m&&(m=c)}return this.m_oGraphics.beginPath(),i},DrawEllipse:function(t,e){var i=this.FBaseNto10(0,4)+t,r=this.FBaseNto10(4,4)+e,a=this.FBaseNto10(8,4),s=this.FBaseNto10(12,4),n=.5522848*(a/2),o=.5522848*(s/2),l=i+a,h=r+s,a=i+a/2,s=r+s/2;return this.m_oGraphics.moveTo(i,s),this.m_oGraphics.bezierCurveTo(i,s-o,a-n,r,a,r),this.m_oGraphics.bezierCurveTo(a+n,r,l,s-o,l,s),this.m_oGraphics.bezierCurveTo(l,s+o,a+n,h,a,h),this.m_oGraphics.bezierCurveTo(a-n,h,i,s+o,i,s),16}},g_listFonts={};ppFont.prototype.LoadFontXML=function(){var t;window.XMLHttpRequest?t=new XMLHttpRequest:window.ActiveXObject&&(t=new ActiveXObject("MSXML2.XMLHTTP")),t.oOwner=this,this.m_xmlRequest=t,t.onreadystatechange=function(){4==t.readyState&&this.oOwner.OnReady(t.responseXML)},t.open("GET",this.m_strFileName,!0),t.send(null)},ppFont.prototype.GetGlyphData=function(t){var e="";return null!=this.m_xmlData[t]?e=this.GetAttrStr(this.m_xmlData[t],"p"):ppDebug.debug_error("Glyph index out of range"),e},ppFont.prototype.GetAttrStr=function(t,e){return t.attributes.getNamedItem(e).value},ppFont.prototype.DrawGlyph=function(t,e,i,r,a){var s=this.m_listGlyphs[t];null==s&&(this.CreateGlyphData(t),s=this.m_listGlyphs[t]);for(var n=s.length,o=0;n>o;o++)switch(t=s[o],t.cmd){case 0:e.quadraticCurveTo(a*t.x1+i,a*t.y1+r,a*t.x2+i,a*t.y2+r);break;case 1:e.lineTo(a*t.x1+i,a*t.y1+r);break;case 2:e.moveTo(a*t.x1+i,a*t.y1+r)}},ppFont.prototype.CreateGlyphData=function(t){this.m_strPath=this.GetGlyphData(t),this.m_nPos=0;var e=this.m_strPath.charAt(this.m_nPos);this.m_nPos++;var i="",r=[];for(this.m_listGlyphs[t]=r;this.m_nPos<this.m_strPath.length;)switch(i=this.m_strPath.charAt(this.m_nPos),this.m_nPos++,i){case this.CMD_CURVE:r.push(new ppGlyphCmd(0,this.BaseNto10(0,2),this.BaseNto10(2,2),this.BaseNto10(4,2),this.BaseNto10(6,2))),this.m_nPos+=8;break;case this.CMD_LINE:r.push(new ppGlyphCmd(1,this.BaseNto10(0,2),this.BaseNto10(2,2))),this.m_nPos+=4;break;case this.CMD_MOVE:r.push(new ppGlyphCmd(2,this.BaseNto10(0,2),this.BaseNto10(2,2))),this.m_nPos+=4;break;case this.CMD_CURVE_E:r.push(new ppGlyphCmd(0,this.BaseNto10(0,3),this.BaseNto10(3,3),this.BaseNto10(6,3),this.BaseNto10(9,3))),this.m_nPos+=12;break;case this.CMD_LINE_E:r.push(new ppGlyphCmd(1,this.BaseNto10(0,3),this.BaseNto10(3,3),0,0)),this.m_nPos+=6;break;case this.CMD_MOVE_E:r.push(new ppGlyphCmd(2,this.BaseNto10(0,3),this.BaseNto10(3,3),0,0)),this.m_nPos+=6;break;default:this.m_nPos--,e==this.CMD_CURVE?(r.push(new ppGlyphCmd(0,this.BaseNto10(0,2),this.BaseNto10(2,2),this.BaseNto10(4,2),this.BaseNto10(6,2))),this.m_nPos+=8):(r.push(new ppGlyphCmd(1,this.BaseNto10(0,2),this.BaseNto10(2,2))),this.m_nPos+=4)}},ppFont.prototype.UBaseNto10=function(t,e){for(var i=0,r="",a=0,s=t;t+e>s;s++)r="v"+this.m_strPath.charAt(this.m_nPos+s),i+=parseInt(this.m_o64to10[r])<<this.BASE_POW*a,a++;return i},ppFont.prototype.BaseNto10=function(t,e){var i=2047;return 3==e&&(i=131071),this.UBaseNto10(t,e)-i},ppFontLib.prototype.CreateFonts=function(t){null!=this.m_strFontUrl&&0<this.m_strFontUrl.length?AddFont(this.m_strBasePath+this.m_strFontUrl,t):t()},ppTextLib.prototype.GetPathById=function(t,e){var i="",r="";if(this.m_bHasXML)try{for(var a=0;a<this.m_xmlData.length;a++)if(i=this.m_xmlData[a].attributes.getNamedItem("id").value,i==t){if(i=!1,null!=e)for(var s=this.m_xmlData[a].getElementsByTagName("link"),n=0;n<s.length;n++)if(strCurLinkId=s[n].attributes.getNamedItem("id").value,strCurLinkId==e){var i=!0,o=s[n].getElementsByTagName("pr");s[n].getElementsByTagName("path"),r=0<o.length?PathLib.getPathFromXML(o[0]):s[n].getElementsByTagName("path")[0].firstChild.nodeValue;break}i||(o=this.m_xmlData[a].getElementsByTagName("pr"),this.m_xmlData[a].getElementsByTagName("path"),r=0<o.length?PathLib.getPathFromXML(o[0]):this.m_xmlData[a].getElementsByTagName("path")[0].firstChild.nodeValue);break}}catch(l){ppDebug.debug_trace("Text data is null");try{r=this.m_xmlData[0].getElementsByTagName("path")[0].firstChild.nodeValue,ppDebug.debug_trace("  fell back on path: "+r)}catch(h){r=""}}return r},ppImageLib.prototype.AddImage=function(t,e,i,r,a,s,n){var o={};return o.Id=t,o.strType=e,o.imgNode=i,o.nWidth=Number(r),o.nHeight=Number(a),o.nDX=Number(s),o.nDY=Number(n),this.m_listImages[t]=o,this.m_nCount++,o},ppImageLib.prototype.GetImage=function(t){return this.m_listImages[t]},ppImageLib.prototype.Destroy=function(){for(var t in this.m_listImages)ppDebug.debug_trace("Destroy: "+this.m_listImages[t].Id),this.m_listImages[t]="";this.m_listImages=null};var Frame=function(){this.control_layouts={},this.ready=!1,this.options={},this.colorGroups={},this.sidebarItems={},this.visibleSidebarItems={},this.hasLinksRight=this.hasLinksLeft=!1,this.defaultControlLayout=null,this.hasBottomBar=!1,this.controlOptions={}};Frame.controlMap={},Frame.iconSrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANYAAAAQCAYAAABqUoGHAAAI0klEQVRoQ+1aV6gUSxCtBf1QEBVEBRUTiAExYvwwJ8woigEDigkxYkAxY0DMghmzoJgwICYMCAbEiAERc0YUERFBoV6dfttNT+/M7MzsvQ/h7fzcuTM9XdVVdapOV2+K8lfeAv8TC6xevZovXbpE3759MysuVaoU9erVi4YPH56Ka4aJEyfy2rVrfb+LPVlc4fnxeQvkaAF2vndjNtt7unv3Lg8dOpTu3bsXqEq9evVo165dVL9+/UiYkPkY4+XKAytHB+c/T2gBBCE+lexOUiEiBa4lKhtwQt9LdWKA5tWrV9SzZ08aNmwYdDDTv3z5knbu3EmXL1+mypUrK/Bl09ECVTxg7dixQykbpTyOGTPGLKxs2bLUqFEjLMAYz35frlw5atKkCXXt2tX3ve23TZs2pfS3uLffffr0iefNm6ceue9sefY7/bxz584o/WZuN1ZsubVq1SIp9xm6wgFwVNDVtm1b6tevX2gAhdn4+/fvPGHCBLp9+zaVKVOGunTpQtOmTVPz+dnk9evXvGTJEmMP0Y2XLl1q1CtdujS1bNmSunXr5mt3UCGxi3l38eJFPnDggPkeNrl//z5v2LBBPYMNT58+Hbh+1ycyUMUIAhp+mzx5chxw5QQsARUDLOJHADtQbqtWrRjgkr8AmccW9kIBwnSl0o/NWFkbL1iwQP2fIQgOF0Cpj+Q+K7jatGmjeKt7gceWLFkyJZdrGDWUmZXsKlWqsF+Q4n2FChX4/fv3JNyYJk2aZHSdOnUqr1q1CkFGGzdu9KxhwIABvH//fiVD3mGMet+pUyc+e/YsHTlyhHr37p0Kk3v48GHu27evR88TJ05wjx49zLOgdWEA5Pfv3z/QiWE2fvDgAdetWzfDntpeWq7+HwMBJFmP0U2yMFetWjVjjtq1a9PDhw//dbzll/bt29O5c+eMvt27d+eTJ0+a7yFLgpOFJlGxYsVo79691KdPn4z59QNbt/QzTwyggqxZs4YkdqIALDGwbDujMomNAuWhssGGiFsn7n3j11p8ygIUxmYCy1YEH4KXCjpDF6+BhSAeNGgQdejQgW7cuEE1atSgJ0+eGGDB2PI/16xZU+m0ePFimjVrlglwZEAJfo8smZPHjRtH5cuXpw8fPph3OijevHlDFStWDASWDeAgYPnJxXcNGzbkO3fuACAAilnHtWvXqFmzZkbm7t27FX9HJZZ1RwkU2FXzc2UL25GtW7dWmXPkyJG0detWNd/58+dZgt8DiKjAwrhHjx5xnTp1lKyghGfP5yYNF1g/f/4065TqzFLhCNVs7NixQev3DU5QM9DDsIAXlRMDS1ehKHGc9oMqKtDr2LFjei1ZgZXWEeMzgeWCKlvp1Ii1gYXqIIHHLVq0MNnTzbASgHzz5s1IwLIzq3b8jx8/uESJEmZ+N23qirVo0SKaM2eOcpzQqlRcYP3584eLFi2qpp8yZQqhQgqVIqlcnuBJAizMme4oGfU1uIS2MYJfqB8tX748I1DjViy30n38+JGEkptEkQ4iunXrFpKJAaFN9woLWFg86CFiTVMo159JgSXrYgGHmc4Bi48YlXTY2n/lDiwXVFEooB+w4IwhQ4bQlStXqHnz5nT16lXjQAQKuC7oGC6XClavXt0stnjx4iScXi1MKh8/ffrUZMS5c+cyQDN+/Hhav359RuBpYG3btk1lfS0rCFhBcvHd/PnzwZmNXj4Uh5ICy86QWgDsDhshGeCCbitXrvTsWeMCC3M8e/ZMzQf6dujQIU/lQwWGrwYOHEj79u1LjRgxgrdv304XLlwg7BW1/WwqWFAVy47ukKqSqGIBJNgvwZ6gnmAB2ZoSaX20vNyBZVMTIBZ7pqhtx6A9lpsptRHBYwGUIkWKKMX99jrYY2hg6cDFdy9evEgJx+dfv36BGoIihgLr69evNH36dFqxYoUCdLY9li0XugkNZnSR9FXQwEIbWKifOVfRwYVqtm7dOiPXpplxgWUH76hRo2jz5s0ZlNKeM+i+sIHlNg0svRMBC99jr5meNxvdVOIKvGJh0qTg0sCS/ZIq640bN/ZsSrWjfv/+rTLm8ePHCcEkvNwDrKC9DnQLcrYdNPrerliSfU3F7Nixoy+wositVq0aPX/+3LdKJq1YQaCy1ySdPp49e7Z6hE6UsAHPnlWPxVwNGjQw1cVuXuhkIPScUZ2kY0ejR4/2zCNMg8+cOUPYs1aqVEl1xiS5esYUJrDSVDCooiQGll98hD3TzM0BedY9VtbmRRJwuXssV3EbFMgIaP3icqlgWIBL0LAEDy1btoxmzpyJDiE6hb4bZRdYkvkZjosLLDkS4FOnTqmNLDbm0qFUer99+xb3OTUvooBK21EDAmufMWOGCXbsUyWJKT0kqan2OiiPzJ3yA5ZUXtUw0baz/SK0j9u1a6feoVuHdUuLv9CBFfFQ9j8Bln3eFbYVchtPyPvaV6HtdvvDkPJs8BMHWPhIzmX4y5cv2L/gTMN0BQcPHuzB5J49e4zCdvsbgz5//ox5IgHLrni4d9vtfnKFjyuKZicAqRYsOhHO6uQcLSdg6W4V5nf3FhLcLN1TdEjp8ePHtGXLFqWHtMlJ2uUpOR/jgwcPqmfYa757905VIVxC80jongdYWB/mAxBxSYeRBEQZlc/uBPq19guyYsU8z0oMLLuFjgSJxOK3z7J/mZE+owzt7iY+II5zUh4XWLIxZqFoJmjDzpNspPk53oPE9D9uxcJjCU4W+qNGRDnH0rJ0R1HL0c/RUJBOoTJ+EioIh6OK4nKPMzQts9cmlQrV2jhbjjQYALEvaXWjsqoxQedYCxcuRKfUt22v2/xNmzal69evZ4wpKGCFBbifP+VZYmBhPpsdoEIioeMcU8sC/ZMDa7XPjdNfyP+kKcBbf/tj/JoCv7qQDmlg9owy5m9YJ4IQB7QI6oiHwrbaOQELE9kdwiB7xOwcqmnS4PL1T2jJ+xucktfhf2+BnIGlwXX06FEFbvuXPqB+6SoWtR0fySF5YEUyU35Q3gLxLPAPX1/vay7xMHUAAAAASUVORK5CYII=",Frame.prototype.loadFromXML=function(t){var e=this;e.xml=t,this.defaultLayoutName=$(t).find("bwFrame").attr("default_layout"),this.textdirection=$(t).find("bwFrame").attr("textdirection"),this.parseOptionGroups(t),this.parseColorSchemes(t),this.applyColorSchemes(),$(t).find("control_layouts").children("control_layout").each(function(t,i){var r={controls:{}},a=$(i).attr("name");$(i).children("control").each(function(t,e){r.controls[$(e).attr("name")]="true"==$(e).attr("enabled")}),e.control_layouts[a]=r,e.defaultControlLayout||(e.defaultControlLayout=r)}),Frame.controlMap={previous:$("#control-previous"),next:$("#control-next"),submit:$("#control-submit"),volume:$("#control-volume"),seekbar:$("#control-progress"),replay:$(".icon.restart"),pauseplay:$("#control-pauseplay"),resources:$(".label.resources"),glossary:$(".label.glossary"),transcript:$(".label.transcript"),outline:$(".label.outline,#slide_list"),search:$(".label.outline")},player.slideList=new SlideList,Frame.navLinks=this.parseNavLinks($(t).children().children("nav_data").children("outline")),player.slideList.build(Frame.navLinks),player.slideList.build(Frame.navLinks,$("#slide_list_portrait")),this.ready=!0},Frame.prototype.parseNavLinks=function(t){var e=this,i=[],r=0;return $(t).children("links").children("slidelink,slidedrawref").each(function(t,a){var s={type:a.tagName,slideid:$(a).attr("slideid"),drawid:$(a).attr("drawid"),displaytext:$(a).attr("displaytext"),expand:"true"==$(a).attr("expand")};"slidedrawref"!=s.type||s.displaytext||(s.displaytext="Draw from Question Bank "+ ++r),0<$(a).children("links").length&&(s.links=e.parseNavLinks(a)),i.push(s);var n=story.parseObjref(s.slideid).target;n&&n.navLinks&&n.navLinks.push(s)}),i},Frame.prototype.setVisibility=function(t,e){e||t.hide()},Frame.prototype.parseOptionGroups=function(t){var e=this;$(t).children().children("control_options").children("optiongroups").children("optiongroup").each(function(t,i){var r=$(i).attr("name");e.parseOptions(i,r)}),e.options.title_enabled||e.options.sidebar_enabled||e.cant_hide_topbar||(e.top_bar_hidden=!0),e.top_bar_hidden&&$(".top_bar").hide(),$("#menu_tabs li:first-child span").addClass("active"),$("#menu_container>ul:first-child, #menu_container>div:first-child").addClass("active")},Frame.prototype.parseOptions=function(t,e){var i=this;$(t).children("options").children().each(function(t,r){$(r).get(0);var a=$(r).attr("name"),s=$(r).attr("value"),n="true"==s;switch(i.options[a]=s,("true"==s||"false"==s)&&(i.options[a]=n),a){case"title_enabled":i.setVisibility($("#storytitle"),n);break;case"title_text":story.title=s,$("#storytitle").text(s),document.title=s;break;case"logo_enabled":n&&($(".landscape_menu").removeClass("no_logo"),$(".logo_background").show());break;case"logo_url":i.logoRef=$("<img/>"),0<$(r).find("property[name='width']").length?(i.options.logo_width=parseInt($(r).find("property[name='width']").attr("value")),i.options.logo_height=parseInt($(r).find("property[name='height']").attr("value")),i.logoRef.css("width",i.options.logo_width),i.logoRef.css("height",i.options.logo_height)):i.logoRef.bind("load",function(){i.options.logo_width=i.logoRef.height(),i.options.logo_height=i.logoRef.height(),i.updateLayout()}),$(".logo_background").append(i.logoRef),i.logoSrc&&i.logoRef.attr("src",i.logoSrc);break;case"html5_logo_url":i.logoSrc=player.basepath+s,i.logoRef&&i.logoRef.attr("src",i.logoSrc);break;case"sidebar_enabled":player.forceMenu||(i.setVisibility($("#control-menu"),n),i.setVisibility($("#portrait_menu"),n),i.setVisibility($(".landscape_menu"),n));break;case"sidebarpos":$(".landscape_menu").addClass(s);break;case"tabs":$(r).children("listitems").children("listitem").each(function(t,e){var r=$(e).attr("name"),a="true"==$(e).attr("value"),s=$(e).attr("group");if(a)switch(a=function(t,e,r,a){i.addTopTab(t,e,r,a)},"sidebar"==s&&(a=function(t,e,r,a){i.addSideTab(t,e,r,a)},i.sidebarItems[r]=!0),r){case"outline":a(s,"Menu",$("#slide_list"),r);break;case"glossary":i.glossaryPanel=new GlossaryPanel,i.glossaryPanel.loadFromXML($(i.xml).find("glossary_data").first()),a(s,"Glossary",i.glossaryPanel.ref,r);break;case"resources":i.resourcesPanel=new ResourcesPanel,i.resourcesPanel.loadFromXML($(i.xml).find("resource_data").first()),a(s,"Resources",i.resourcesPanel.ref,r);break;case"transcript":i.transcriptPanel=new TranscriptPanel,i.transcriptPanel.loadFromXML($(i.xml).find("transcript_data").first()),a(s,"Notes",i.transcriptPanel.ref,r);break;case"customlink":var n=$(e).find("property[name='title']").attr("value"),o=$(e).find("property[name='data']").attr("value");a(s,n,o,r)}});break;case"seekbar":n||($(".player_controls").css("display","none!important"),$("#control-progress").css("display","none"));break;case"bottombar_enabled":i.setVisibility($(".bottom_bar"),n),i.setVisibility($("#controls"),n),n&&(i.hasBottomBar=!0)}i.parseOptions(r,e)})},Frame.prototype.addTopTab=function(t,e,i,r){var a=this;if("customlink"==r)return a.addTopLink(t,e,i);a.top_bar_hidden=!1,a.cant_hide_topbar=!0;var s=$('<div class="toptab"><span class="label '+r+'">'+e+'</span><div class="menu_container"></div></div>');s.children(".menu_container").append(i),"linkright"==t?($("#toplinks_right").prepend(s),a.hasLinksRight=!0):($("#toplinks_left").append(s),a.hasLinksLeft=!0),s.children("span").first().bind("click",function(t){return s.hasClass("active")?s.removeClass("active"):(MouseEvents.processHideables(t),$("#topbar .active").removeClass("active"),s.addClass("active"),a.registeredTopBar||(MouseEvents.addHideable(".toptab.active",".toptab .menu_container, #frameswitch",function(){$(".toptab.active").removeClass("active")}),a.registeredTopBar=!0)),!1})},Frame.prototype.addSideTab=function(t,e,i,r){t=$('<li><span class="left label '+r+'">'+e+"</span></li>"),$("#menu_tabs").append(t),$("#menu_container").append(i);var a=t.children("span").first();t.bind("click",function(){return $("#topbar .active").removeClass("active"),$("#menu_tabs .active").removeClass("active"),$("#menu_container .active").removeClass("active"),a.addClass("active"),i.addClass("active"),!1})},Frame.prototype.addTopLink=function(t,e,i){e=$('<div class="toptab customlink"><span class="label '+name+'">'+e+"</span></div>"),"linkright"==t?($("#toplinks_right").prepend(e),this.hasLinksRight=!0):($("#toplinks_left").append(e),this.hasLinksLeft=!0),e.children("span").first().bind("click",function(){return story.handleEvent("onobjectevent",i,null,!1,!1,!0),!1})},Frame.prototype.parseColorSchemes=function(t){var e=this;$(t).children().children("colorschemes").children("colorscheme").children("color_group").each(function(t,i){var r=$(i).attr("name");e.parseColorGroup(i,r)})},Frame.prototype.parseColorGroup=function(t,e){var i={};$(t).children("group_colors").children("color").each(function(t,e){var r=$(e).attr("name"),a=new Background;a.loadFromXML($(e),"fill"),i[r]=a}),this.colorGroups[e]=i},Frame.prototype.applyColorSchemes=function(){if(!player.noframe&&!player.noframecolor&&($.each(story.children,function(t,e){if("Window"==e.innerType&&"LightboxWnd"!=e.id&&"LightboxControlsWnd"!=e.id&&e.ref&&player.frame.colorGroups.window&&player.frame.colorGroups.window.bg)try{e.ref.css("background-color",player.frame.colorGroups.window.bg.toCssString()),e.ref.css("color",player.frame.colorGroups.window.text.toCssString()),e.ref.find("h1").css("color",player.frame.colorGroups.window.text.toCssString()),e.ref.css("border-color",player.frame.colorGroups.window.divb.toCssString()),e.ref.find("hr").css("border-color",player.frame.colorGroups.window.divb.toCssString())}catch(i){}}),player.isHTML5)){var t=new CustomStyleSheet,e=function(e,i,r){if(player.frame.colorGroups[e]&&player.frame.colorGroups[e][i]){var a=player.frame.colorGroups[e][i].toCssString(),e=player.frame.colorGroups[e][i].toColorString();t.add(r,"background",e),t.add(r,"background",a),t.add(r,"background",a.replace("-webkit","-moz")),t.add(r,"background",a.replace("-webkit","-ms")),(player.isIE8||player.isIE9)&&a.indexOf("progid")}},i=function(e,i,r){if(player.frame.colorGroups[e]&&player.frame.colorGroups[e][i]){var a=player.frame.colorGroups[e][i];switch(a.backgroundType){case"fill":t.add(r,"border-color",a.stops[0].color),1<a.stops.length&&player.frame.colorGroups[e][i].toCssString()}}},r=function(e,i,r,a,s,n){if(player.frame.colorGroups[e]&&player.frame.colorGroups[e][i])switch(e=player.frame.colorGroups[e][i],e.backgroundType){case"fill":e=e.toColorString(),n&&(e=n+e),s&&(e+=s),t.add(r,a,e)}};e("base","bg","#slidebg"),e("base","slide_bg",".framewrap,.bg"),e("base","slide_bg",".window.LightboxControlsWnd"),e("base","menu_shade",".landscape_menu"),i("base","border",".framewrap"),i("base","border",".landscape_menu"),r("base","text","a,body","color"),e("button","btn_bg",".controlbar-button"),i("button","btn_border",".controlbar-button"),r("button","btn_glow",".controlbar-button.right","box-shadow"," 0px 0px 1px 1px"),player.isIOS||e("button","btn_hover",".controlbar-button.right:hover"),e("button","btn_down",".controlbar-button.right.pressed"),e("seekcontrol","seek_bg","#progressbar"),e("seekcontrol","seek_position",".progress-bar"),i("seekcontrol","seek_border","#progressbar,.progress-bar"),e("seekcontrol","bg","#control-progress"),i("seekcontrol","border","#control-progress"),e("volume","thumb_bg",".volume-handle"),e("volume","slider_bg",".volume-slider"),i("volume","thumb_border",".volume-handle"),i("volume","slider_border",".volume-slider"),r("volume","thumb_inner",".volume-handle","-webkit-box-shadow"," 0px 0px 1px 1px","inset "),r("volume","thumb_inner",".volume-handle","-moz-box-shadow"," 0px 0px 1px 1px","inset "),r("volume","thumb_inner",".volume-handle","-ms-box-shadow"," 0px 0px 1px 1px","inset "),r("volume","thumb_inner",".volume-handle","box-shadow"," 0px 0px 1px 1px","inset "),e("menu","bg",".menu_container"),r("listitem","text","ul.menu_list a","color"),r("listitem","text","ul.slidelist li","color"),player.isIOS||(e("listitem","hover","li.has_children.open li>a:hover"),e("listitem","hover","ul.slidelist li:hover")),e("listitem","selected","ul.menu_list li.selected, ul.menu_list li.selected > a, ul.menu_list li.selected > a:hover"),e("listitem","selected","ul.slidelist li.selected, ul.slidelist li.selected > a:hover"),r("listitem","lines","ul.menu_list>li","border-top-color"),r("listitem","lines","ul.slidelist li.divider","border-bottom-color"),r("listitem","viewed","ul.menu_list li.visited > a","color"),r("listitem","viewed","ul.slidelist li.visited","color"),r("listitem","selected_text","ul.menu_list li.selected > a","color"),r("listitem","selected_text","ul.slidelist li.selected","color"),r("listitem","text","ul.menu_list li.has_children > span","border-left-color"),r("listitem","text","ul.menu_list li.has_children.open > span","border-top-color"),r("listitem","text","ul.slidelist li>span","border-left-color"),r("listitem","text","ul.slidelist li.open>span","border-top-color"),e("tabs","bg","ul.menu_nav li span.active, .toptab.active>span"),r("tabs","text","ul.menu_nav li span","color"),r("tabs","selected","ul.menu_nav li span.active, .toptab.active>span","color"),i("window","divb",".toptab.active>span,.toptab .menu_container"),i("window","divb",".resources_container hr"),r("menu","shadow",".toptab .menu_container","-webkit-box-shadow"," 0px 0px 20px"),r("menu","shadow",".toptab .menu_container","-moz-box-shadow"," 0px 0px 20px"),r("menu","shadow",".toptab .menu_container","-ms-box-shadow"," 0px 0px 20px"),r("menu","shadow",".toptab .menu_container","box-shadow"," 0px 0px 20px"),e("glossary","bg",".glossary_section"),e("tabs","bg",".glossary_section_header"),player.isIOS||e("glossary","hover",".glossary_section li:hover"),e("glossary","selected",".glossary_section li.active"),r("glossary","selected",".glossary_section li.active","color"),r("glossary","diva",".glossary_section_header, .glossary_section:first-child","border-bottom-color"),r("glossary","divc",".glossary_section_header","border-top-color"),e("logo","bg",".logo_background"),player.frame.colorGroups.button&&player.frame.colorGroups.button.btn_icon_color&&(e=player.frame.colorGroups.button.btn_text_shadow.stops[0],i=player.frame.colorGroups.seekcontrol.btn_icon_hover.stops[0],this.prepIconSprite(".controlbar-button .icon",player.frame.colorGroups.button.btn_icon_color.stops[0],e,t),player.isIOS||this.prepIconSprite("#control-progress .icon:hover",i,e,t),r("button","btn_icon_color",".controlbar-button .label","color"),r("button","btn_text_shadow",".controlbar-button .label","text-shadow","","0px 1px 1px ")),t.build()}},Frame.parseRGB=function(t){return t=t.replace("#",""),[parseInt(t.substr(0,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(4,2),16)]},Frame.prototype.prepIconSprite=function(t,e,i,r){var a=Frame.parseRGB(e.rawcolor),s=Frame.parseRGB(i.rawcolor);a.push(e.alpha),s.push(i.alpha);var n=new Image;$(n).bind("load",function(){var e=document.createElement("canvas");e.width=230,e.height=16;var i=e.getContext("2d");i.drawImage(n,0,0);for(var o=i.getImageData(0,0,e.width,e.height),l=0;l<o.data.length-4;l+=4){var h=o.data[l];0!=o.data[l+3]&&(o.data[l]=a[0],o.data[l+1]=a[1],o.data[l+2]=a[2],o.data[l+3]=255-h)}i.clearRect(o,0,0,e.width,e.height),i.putImageData(o,0,0),i.shadowColor="rgba("+s[0]+","+s[1]+","+s[2]+","+s[3]+")",i.shadowOffsetX=0,i.shadowOffsetY=1,i.shadowBlur=1,i.clearRect(o,0,0,e.width,e.height),i.drawImage(e,0,0),e=e.toDataURL("image/png"),r&&r.add(t,"background-image","url("+e+")"),r.build()}),n.src=Frame.iconSrc},Frame.prototype.set_window_control_layout=function(t){Frame.windowControlMap={previous:$(".window.LightboxControlsWnd #control-previous"),next:$(".window.LightboxControlsWnd #control-next"),submit:$(".window.LightboxControlsWnd #control-submit"),volume:$(".window.LightboxControlsWnd #control-volume"),seekbar:$(".window.LightboxControlsWnd #control-progress"),replay:$(".window.LightboxControlsWnd .icon.restart"),pauseplay:$(".window.LightboxControlsWnd #control-pauseplay"),resources:$(".label.resources"),glossary:$(".label.glossary"),transcript:$(".window.LightboxControlsWnd #TODO-resources"),outline:$(".window.LightboxControlsWnd #TODO-resources"),search:$(".window.LightboxControlsWnd #TODO-resources")},player.currentWindow&&this.set_frame_layout(t,Frame.windowControlMap)},Frame.prototype.set_frame_layout=function(t,e){var e=e||Frame.controlMap,i=ProgressBar.getCurrentProgressBar().ref.parent().parent(),r=this,a=$(t).attr("name");if(r.currentLayoutName=a,a=r.control_layouts[a],a||(a=r.control_layouts[r.defaultLayoutName],r.currentLayoutName=r.defaultLayoutName),a||(a=r.defaultControlLayout),a){r.updateTextLabels();var s=0,n=!1;if(r.visibleSidebarItems={},$.each(a.controls,function(t,i){var a=e[t];a&&(i?(a.show(),("previous"==t||"next"==t||"submit"==t)&&s++,"volume"==t&&(n=!0)):a.hide()),i&&r.sidebarItems[t]&&(r.visibleSidebarItems[t]=!0)}),this.reorient(!0),player.isHTML5){var o=30+7*s;$.each(["#control-previous","#control-next","#control-submit"],function(t,e){var i=$(e);"block"==i.css("display")&&(o+=i.get(0).offsetWidth)}),n&&(o+=40),a=this.availableWidth-o,i.find("#control-progress").css("width",a),i.find("#control-progress .progress-container").css("width",a-59)}i=$(".landscape_menu #menu_tabs>li>span"),3==i.length?(i.css("width","59px"),i.last().css("width","60px")):3<i.length&&$("ul.menu_nav li span").css("padding","0px 4px"),this.updateLayout()}},Frame.prototype.isSidebarVisible=function(){for(key in this.visibleSidebarItems)return!0;return!1;
},Frame.prototype.ensureHasActiveSidebarItem=function(){var t=null,e=null,i=!1;for(key in this.visibleSidebarItems){var r=Frame.controlMap[key];t||(t=r),r.hasClass("active")&&(e=r),i=i||r.hasClass("active")}t&&!i?t.click():e&&e.click()},Frame.prototype.initOrientation=function(){this.updateLayout()},Frame.prototype.reorient=function(t){1!=player.width&&this.updateLayout(t)},Frame.prototype.updateLayout=function(){this.updateFrameLayout(),this.updatePlayerLayout()},Frame.prototype.updatePlayerLayout=function(){if($("#loadingSpinner").css("left",Math.floor(window.innerWidth/2)-50),$("#loadingSpinner").css("top",Math.floor(window.innerHeight/2)-50),$(".blocked").css("left",Math.floor(window.innerWidth/2)-50),$(".blocked").css("top",Math.floor(window.innerHeight/2)-50),!player.noframe){var t=player.frame.top_bar_hidden?0:33;player.frame.top_bar_hidden?$("#topbar").addClass("empty"):this.options.title_enabled?($("#storytitle").removeClass("alone"),$(".toptab").removeClass("alone"),$(".toptab").removeClass("notitle"),$("#topbar").removeClass("empty"),this.hasLinksLeft&&this.hasLinksRight||(!this.hasLinksLeft||this.hasLinksRight)&&(!this.hasLinksLeft&&this.hasLinksRight?($("#storytitle").addClass("alone"),$(".toptab").addClass("alone")):!this.hasLinksLeft&&!this.hasLinksRight&&(t=10))):($("#storytitle").removeClass("alone"),$(".toptab").removeClass("alone"),$("#topbar").removeClass("empty"),$(".toptab").addClass("notitle"),t=10,!this.hasLinksLeft&&!this.hasLinksRight&&(t=-10,$("#topbar").addClass("empty")));var e=player.frame.options.sidebar_enabled&&this.isSidebarVisible();player.frame.ensureHasActiveSidebarItem();var i=player.frame.bottom_bar_hidden||!player.frame.hasBottomBar?0:41,r=e?239:0,r=e?240:0,a="left"==player.frame.options.sidebarpos?r:0,s=this.containerHeight,n=this.containerWidth-r-20+1,i=s-t-i-20+1;this.availableWidth=n,this.availableHeight=i;var o="left"==player.frame.options.sidebarpos?0:n+20,r="left"==player.frame.options.sidebarpos?r+10:10;$(".landscape_menu").css("left",o),$("#controls").css("left",r),$("#controls").css("width",n),this.setVisibility($("#controls"),this.hasBottomBar),$("#topbar").css("left",r),$("#topbar").css("width",n),$(".toptab .menu_container").css("height",parseInt(.8*i));var l=n/i,r=10,o=a+10-1,s=s-20+2,h=0;player.frame.options.logo_enabled&&(h=player.frame.options.logo_height+20+10),h=s-h-25,$(".landscape_menu .menu_container").css("height",h+"px"),player.aspectRatio>l?(n=(i-1*player.height)/2,n>0&&(r=n+10+2)):(n=(n-1*player.width)/2,n>0&&(o=n+a+10)),t="#slideframe{margin-left:"+o+"px!important;margin-top:"+r+"px!important;top:"+t+"px!important;}#slideframe, .slide{width:"+player.width+"px;height:"+player.height+"px;}.landscape_menu{height: "+s+"px;}.landscape_menu{display: "+(e?"block":"none")+";}.interstitial{height:"+window.innerHeight+"px;}",player.frame.options.seekbar||(t+=".player_controls{display:none!important;}"),player.rotateLandscapeStyleSheet||(player.rotateLandscapeStyleSheet=document.createElement("style"),document.body.appendChild(player.rotateLandscapeStyleSheet)),player.rotateLandscapeStyleSheet.innerHTML=t,player.landscapeScale=1,player.zoom=1}},Frame.prototype.updateFrameLayout=function(){if(!player.isIOS){var t=window.innerWidth,e=window.innerHeight,i=story.frameWidth-2,r=story.frameHeight-2,a=1;player.scaleToFit&&(a=story.frameWidth/story.frameHeight>t/e?t/story.frameWidth:e/story.frameHeight,$("document.body").css("overflow","hidden")),e=parseInt((e-r*a)/2-1),0>e&&(e=0),t=parseInt((t-i*a)/2-1),0>t&&(t=0),this.containerWidth=i,this.containerHeight=r,this.containerLeft=t,this.containerTop=e,this.aspectRatio=i/r,$(".framewrap").css("width",i),$(".framewrap").css("height",r),$(".framewrap").css("top",e),$(".framewrap").css("left",t),i=".framewrap{-webkit-transform-origin:top left;-webkit-transform:translate3d(0px,0px,0px) scale("+a+");-moz-transform-origin:top left;-moz-transform:translate3d(0px,0px,0px) scale("+a+");-ms-transform-origin:top left;-ms-transform:translate(0px,0px) scale("+a+");}",player.frameLandscapeStyleSheet||(player.frameLandscapeStyleSheet=document.createElement("style"),document.body.appendChild(player.frameLandscapeStyleSheet)),player.frameLandscapeStyleSheet.innerHTML=i,player.frameScale=a}},Frame.prototype.updateTextLabels=function(){$(this.xml).find("string_table").first().children("string").each(function(t,e){var i=$(e).attr("id"),r=$(e).text(),e=$(".label."+i);0<e.length&&(e.text(r),e.parent().hasClass("controlbar-button")&&(i=player.isIOS?.88:.9,i=e.get(0).offsetWidth*(1-i),0!=i&&e.css("margin-right",-i+"px")))})},Frame.prototype.debugTopNav=function(){var t=this;this.topNavSelector=$("<div class='topnavselector'></div>"),$(document.body).append(this.topNavSelector);var e=function(e){var i=$("<input id='box_"+e+"' type='checkbox'><label for='box_"+e+"'>"+e+"</label>");i.first()[0].checked=player.frame[e],i.click(function(){var t=i.first()[0].checked;player.frame[e]=t,player.frame.updateLayout()}),t.topNavSelector.append(i)};e("top_bar_hidden"),e("hasLinksLeft"),e("hasLinksRight"),$("#topbar").css("background-color","aqua"),$("#toplinks_right").css("background-color","yellow"),$("#toplinks_left").css("background-color","orange"),$("#topbar > #storytitle").css("background-color","lime")},Frame.prototype.setControlEnabled=function(t,e){var i=Frame.controlMap[t];i&&(e?i.removeClass("disabled"):i.addClass("disabled"))},Frame.findCurrentFrame=function(){var t=null;if(self!=top&&!player.isCrossDomainFrame)try{$.each(top.document.getElementsByTagName("iframe"),function(e,i){i.contentWindow==self&&(t=i)}),$.each(top.document.getElementsByTagName("frame"),function(e,i){i.contentWindow==self&&(t=i)})}catch(e){}return t},ResourcesPanel.prototype.loadFromXML=function(t){var e=this;this.xml=t,this.description=$(t).attr("description"),this.resources=[],$(t).children("resources").children("resource").each(function(t,i){var r={};r.url=$(i).attr("url"),r.image=player.basepath+$(i).attr("image"),r.title=$(i).attr("title"),e.resources.push(r)}),this.createRef()},ResourcesPanel.prototype.createRef=function(){var t=$("<div class='resources_container'></div>");t.append($("<div class='resources_description'>"+this.description+"</div>")),t.append($("<hr/>"));var e=$("<ul></ul>");$.each(this.resources,function(t,i){var r=$("<li><a href='"+i.url+"' target='_blank'><img src='"+i.image+"' class='resources_icon'/>"+i.title+"</a></li>");e.append(r)}),t.append(e),this.ref=t},GlossaryPanel.prototype.loadFromXML=function(t){var e=this;this.xml=t,this.terms=[],$(t).children("terms").children("term").each(function(t,i){var r={};r.title=$(i).attr("title"),r.definition=$(i).text(),e.terms.push(r)}),this.createRef()},GlossaryPanel.prototype.createRef=function(){var t=$("<div class='glossary_container'></div>"),e=$("<div id='glossaryscroll' class='glossary_section scrollarea'></div>");e.append($("<div class='glossary_section_header label terms'>Terms</div>"));var i=$("<ul></ul>");$.each(this.terms,function(t,e){var r=$("<li><a href='javascript:void(null);' >"+e.title+"</a></li>");r.click(function(){$(".definitiontext").hide(),$(".glossary_container .active").removeClass("active"),e.defref&&(r.addClass("active"),e.defref.show())}),i.append(r)}),e.append(i),t.append(e),e=$("<div class='glossary_section'></div>"),e.append($("<div class='glossary_section_header label definition'>Definition</div>")),$.each(this.terms,function(t,i){var r=$("<div class='definitiontext'>"+i.definition+"</div>");i.defref=r,e.append(r)}),t.append(e),this.ref=t},TranscriptPanel.prototype.loadFromXML=function(t){var e=this;this.xml=t,this.transcripts=[],$(t).children("slidetranscripts").children("slidetranscript").each(function(t,i){var r={};r.slideid=$(i).attr("slideid"),r.slidebank="true"==$(i).attr("slidebank"),r.content=$(i).text(),e.transcripts.push(r);var a=story.parseObjref(r.slideid).target;a.transcript=r,r.show=function(){e.titleref.html(a.title),$(".transcript_content").hide(),r.contentref&&r.contentref.show()}}),this.createRef()},TranscriptPanel.prototype.createRef=function(){var t=$("<div class='transcript_container'></div>");this.titleref=$("<div class='transcript_title'></div>"),t.append(this.titleref),$.each(this.transcripts,function(e,i){var r=$("<div class='transcript_content'><hr/>"+i.content+"</div>");i.contentref=r,t.append(r)}),this.ref=t},CustomStyleSheet.prototype.add=function(t,e,i){if(this.ruleLookup[t])this.ruleLookup[t].add(e,i);else{var r=new StyleRule(t);r.add(e,i),this.ruleLookup[t]=r,this.rules.push(r)}},CustomStyleSheet.prototype.build=function(){this.sheet||(this.sheet=document.createElement("style"),document.body.appendChild(this.sheet));var t="";$.each(this.rules,function(e,i){t+=i.toString()}),this.sheet.innerHTML=t},StyleRule.prototype.add=function(t,e){this.attributes.push({name:t,value:e})},StyleRule.prototype.toString=function(){var t=this.selector+"\r\n{\r\n";return $.each(this.attributes,function(e,i){t+="	"+i.name+": "+i.value+";\r\n"}),t+="}\r\n\r\n"};var MouseEvents={hideables:[]};MouseEvents.addHideable=function(t,e,i){MouseEvents.hideables.push({selector:t,exclude:e,callback:i})},MouseEvents.processHideables=function(t){$.each(MouseEvents.hideables,function(e,i){!(i.exclude&&t&&t.target&&0<$(t.target).closest(i.exclude).length||!$.each($(i.selector),function(t,e){i.callback($(e))}))})},MouseEvents.init=function(){var t=function(t){return null!=t.dropArea};player.allowRightClick||$(window).bind("contextmenu",function(){return!1});var e=player.isIOS?"touchstart":"mousedown",i=player.isIOS?"touchend":"mouseup",r=player.isIOS?"touchmove":"mousemove";$(window).bind(e,function(t){if(player.lastEvent=t,player.currentSlide()){swipe.parseEventCoords(t);var e=swipe.getSlideCoords(player.currentSlide());return player.currentSlide().deepEach(function(t,i){var r=!1;i.button&&(r=i.button.testOver(e.x,e.y)),!(player.modalLayer&&player.modalLayer!=i.layer||r||"true"==i.variables._disabled||null==i.isPointActive||!i.hasEvent("onclickoutside")||i.testOver(e.x,e.y)&&i.isPointActive(e.x,e.y)&&!i.isPointObscured(e.x,e.y)||!i.handleEvent("onclickoutside",null,null,!1,!1,!0))},function(t){return t.visible||"ShuffleGroup"==t.innerType}),!0}}),$(window).bind("click",function(t){MouseEvents.processHideables(t)}),$(document.body).bind(e,function(t){if(player.lastEvent=t,player.currentSlide()&&player.currentSlide().ref){swipe.parseEventCoords(t);var e=swipe.getSlideCoords(player.currentSlide());swipe.noteDownCoords();var i=!1;player.currentSlide().deepEach(function(r,a){i||player.modalLayer&&player.modalLayer!=a.layer||"true"==a.variables._disabled||!a.visible||!a.testOver||!(a.hasEvent("onpress")||a.hasEvent("onrelease")||a.hasEvent("onlink")||a.isDragItem||player.canChangeMonitoringItem)||!a.isPointActive(e.x,e.y)||a.isPointObscured(e.x,e.y)||(a.isDragItem?(a.mousedown(t),i=!0):a.hasEvent("onpress")&&(a.handleEvent("onpress",null,null,!1,!1,!0),i=!0),a.hasEvent("onrelease")&&a.ref&&a.ref.addClass("hasmousedown"),$.each(a.children,function(t,e){e.hasEvent("onrelease")&&e.ref&&e.ref.addClass("hasmousedown")}),player.canChangeMonitoringItem&&player.updateItemInfo(a)),"textinput"==a.innerType&&a.testOver(e.x,e.y)&&!a.isPointObscured(e.x,e.y)&&(i=!0,setTimeout(function(){a.input.get(0).focus()},0))},function(t){return t.visible||"ShuffleGroup"==t.innerType})}}),$(document.body).bind(i,function(e){player.lastEvent=e;var i=swipe.hasMoved();if(player.currentSlide()&&player.currentSlide().ref){swipe.parseEventCoords(e);var r=swipe.getSlideCoords(player.currentSlide()),a=!1;player.currentSlide().deepEach(function(e,s){a||player.modalLayer&&player.modalLayer!=s.layer||"true"==s.variables._disabled||!s.visible||!s.hasEvent("onrelease")&&!s.hasEvent("onlinkrelease")||!(!i||s.ref&&s.ref.hasClass("hasmousedown"))||!s.isPointActive(r.x,r.y)||s.isPointObscured(r.x,r.y,null,t)||(a=!0,s.handleEvent("onrelease",null,null,!1,!1,!0),s.hasEvent("onlinkrelease")&&$.each(s.links,function(t,e){e.handleIfOver("onlinkrelease",r,!1)}),s.prepDownstreamMedia(),a=!0)},function(t){return t.visible||"ShuffleGroup"==t.innerType}),!a&&player.currentSlide().testOver(r.x,r.y)&&player.currentSlide().handleEvent("onclickoutsideobjects",null,null,!1,!1,!0),$(".hasmousedown").removeClass("hasmousedown")}}),$(".menu_container").bind("mouseup",function(){return!1}),$(document.body).bind(r,function(e){if(player.lastEvent=e,player.currentSlide()&&player.currentSlide().ref){swipe.parseEventCoords(e);var i=swipe.getSlideCoords(player.currentSlide());player.followMouseCursor&&(player.mouseFollowDiv||(player.mouseFollowDiv=$("<div class='mousecursorfollow'></div>")),player.currentSlide().ref.append(player.mouseFollowDiv),player.mouseFollowDiv.css("left",i.x),player.mouseFollowDiv.css("top",i.y-5)),player.currentSlide().deepEach(function(r,a){if(!a.isMouseOver||player.modalLayer&&player.modalLayer!=a.layer||"true"==a.variables._disabled||!a.isPointActive||0!=a.dragX||0!=a.dragY||!(a.hasEvent("onrollout")||a.hasEvent("onpress")||a.hasEvent("onrelease")||a.hasEvent("ondoubleclick",!0)||a.hasEvent("onlinkrelease",!0)||a.isDragItem)||a.isPointActive(i.x,i.y)&&!a.isPointObscured(i.x,i.y,null,t)||(a.isMouseOver=!1,a.hasEvent("onrollout")&&a.handleEvent("onrollout",null,null,!1,!1,!0),$(e.target).removeClass("pointercursor"),a.hasEvent("onlinkrelease")&&$.each(a.links,function(t,e){e.render("onrollout")})),(!a.isMouseOver||a.hasEvent("onlinkrelease",!0))&&(!player.modalLayer||player.modalLayer==a.layer)&&(a.hasEvent("onrollover",!0)||a.hasEvent("onpress",!0)||a.hasEvent("onrelease",!0)||a.hasEvent("ondoubleclick",!0)||a.hasEvent("onlinkrelease",!0)||a.isDragItem)&&"true"!=a.variables._disabled&&a.isPointActive&&a.isPointActive(i.x,i.y)&&!a.isPointObscured(i.x,i.y,null,t))if(a.isMouseOver=!0,a.hasEvent("onrollover")&&a.handleEvent("onrollover",null,null,!1,!1,!0),a.hasEvent("onlinkrelease")){var s=!1;$.each(a.links,function(t,e){e.handleIfOver("onrollover",i,!0)&&(s=!0),e.handleIfOut("onrollout",i)}),s?$(e.target).addClass("pointercursor"):$(e.target).removeClass("pointercursor")}else $(e.target).addClass("pointercursor")},function(t){return t.visible||"ShuffleGroup"==t.innerType})}})};var player={slideIndex:0,currentTime:0,interval:null,showingInterstitial:!0,ready:!1,fontready:!1,playing:!1,paused:!0,blocked:!1,playall:!1,autoplay:!0,autoplaySlides:!0,loopable:!1,simplenav:!0,mediaCount:0,loadedMediaCount:0,deferredLoadingIndex:0,width:1,height:1,aspectRatio:720/540,windowZoomModifier:1,transitionSeconds:.4,maxTransitionSeconds:1.2,clipVolume:1,progressBar:null,zoomed:!1,basepath:"",currentClip:null,currentClipStartTime:0,animations:"pan",showControls:!1,slideList:null,fileList:null,swipeMode:"follow",useCanvas:!0,useCompactResume:!0,simplifySlides:!0,suppressCaptureAnimations:!1,hasUserScript:!1,startTime:new Date,useActiveTimeline:!0,simulateIOSPlayer:!1,logActivity:!1,fontlib:null,textlib:null,history:[],windowStack:[],webAudioClips:{}},g_oFontLib;if(player.TICK_DURATION=100,player.isIOS=-1<navigator.userAgent.indexOf("AppleWebKit/")&&-1<navigator.userAgent.indexOf("Mobile/"),player.isIOSFrame=!1,player.isWebKit=-1<navigator.userAgent.indexOf("AppleWebKit/"),player.canAnimate=-1<navigator.userAgent.indexOf("AppleWebKit/"),player.isIE=-1<navigator.userAgent.indexOf("MSIE "),player.isIE8=player.isIE&&-1<navigator.appVersion.indexOf("MSIE 8"),player.isIE9=player.isIE&&-1<navigator.appVersion.indexOf("MSIE 9"),player.isFF=-1<navigator.userAgent.indexOf("Firefox/"),player.isChrome=-1<navigator.userAgent.indexOf("Chrome/"),player.isMac=-1<navigator.userAgent.indexOf("Macintosh;"),player.isCrossDomainFrame=!1,self!=top){var meta=$('<meta name="viewport" id="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>');try{top.document.getElementsByTagName("head")[0].appendChild(meta.get(0))}catch(e$$53){player.isCrossDomainFrame=!0}}player.activeTimeline=player,player.tick=function(){if(ProgressBar.getCurrentProgressBar().dragging&&player.currentClip)player.currentClip.currentTime=(player.activeTimeline.currentTime-player.currentClipStartTime)/1e3;else if(player.blocked||player.currentSlide()&&player.currentSlide().tickLayers(),player.playing){player.currentTime+=player.TICK_DURATION;var t=0;if(player.correctMedia(),player.currentClip&&!player.currentClip.paused){var t=parseInt(1e3*player.currentClip.currentTime),e=parseInt(1e3*player.currentClip.duration);!player.layerPlaying&&player.currentClipSyncToTimeline&&t!=player.activeTimeline.currentTime-player.currentClipStartTime&&player.activeTimeline.currentTime<e&&!ProgressBar.getCurrentProgressBar().dragging&&(player.activeTimeline.currentTime=t+player.currentClipStartTime+1)}player.update(),player.currentTime>player.currentSlide().duration&&(player.playall&&player.slideIndex+1<story.allSlides.length?(player.showNextSlide(),player.currentTime=0,player.update()):(player.currentTime=player.currentSlide().duration,player.update(),player.pause(!0,!1,!0))),player.currentSlide().currentTime=player.currentTime}else player.currentSlide()&&player.currentSlide().updateLayers()},player.correctMedia=function(){},player.update=function(t){function e(t){var e=(Math.floor(t/1e3)%60+100+"").substr(1,2),i=Math.floor(t/1e3/60),r="";return 0>t&&(e=(Math.floor(t/1e3)%60-100+"").substr(2,2),i=Math.ceil(t/1e3/60),r="-"),r+Math.abs(i)+":"+e}player.activeTimeline==player&&(ProgressBar.getCurrentProgressBar().index=player.activeTimeline.currentTime,ProgressBar.getCurrentProgressBar().count=player.currentSlide().duration,ProgressBar.getCurrentProgressBar().update(),player.paused?($(".controlbar-button").find(".wait").hide(),$(".controlbar-button").find(".pause").hide(),$(".controlbar-button").find(".play").show()):($(".controlbar-button").find(".wait").hide(),$(".controlbar-button").find(".play").hide(),$(".controlbar-button").find(".pause").show())),player.currentSlide().update(player.currentTime,!1,t),$(".time_elapsed").text(e(player.currentTime)),$(".time_remaining").text(e(player.currentTime-player.currentSlide().duration))},player.wait=function(){$(".toolbar-button").find(".wait").parent().show(),$(".toolbar-button").find(".play").parent().hide(),$(".toolbar-button").find(".pause").parent().hide()},player.showSlideID=function(t,e,i){if(t=story.parseObjref(t).target,t==player.currentSlide())return!1;if("Scene"==t.innerType&&(t=story.parseObjref(t.startingslide).target),"SlideDraw"==t.innerType)t.showFirst();else{if(isNaN(t.slideIndex))return!1;player.showSlideIndex(t.slideIndex,null,e,i)}return!0},player.showSlideIndex=function(t,e,i,r){var a=story.allSlides[t];player.currentSlide().handleEvent("onbeforeslidejump",null,null,!1,!0),StoryEvent.cancelEvent||(a.loadContentFromXML(),player.prepAudio(t),a.blockAndLoad(function(){player.frame.setControlEnabled("previous",!0),player.frame.setControlEnabled("next",!0),player.frame.setControlEnabled("submit",!0),player.loadingSpinner.hide(),null!=player.currentWindow&&(player.previousWindow=player.currentWindow),player.currentWindow=null,DragItem.cancelDrag();var s=player.currentSlide().slideIndex;if(t!=s){player.currentSlide().saveIfNecessary(),i&&-1==player.currentSlide().parent.id.indexOf("MsgScene")&&(player.currentWindow?player.currentWindow.history.push(s):player.history.push(s)),player.setSlideIndex(t,e),player.onSelectSlide&&player.onSelectSlide(story.allSlides[t]),player.isIOSFrame&&($("#slideframe").css("-webkit-box-shadow","0 0 30px rgba(0,0,0,0.35)"),$("#slideframe").css("-moz-box-shadow","0 0 30px rgba(0,0,0,0.35)"),$("#slideframe").css("-ms-box-shadow","0 0 30px rgba(0,0,0,0.35)"),$("#slideframe").css("box-shadow","0 0 30px rgba(0,0,0,0.35)")),story.saveToLocalStorage(),player.currentSlide().deferredFrameLayoutXML&&player.currentSlide().set_frame_layout(a.deferredFrameLayoutXML);var n=0;setTimeout(function(){20<n++||a.slideIndex+1<story.allSlides.length&&story.allSlides[a.slideIndex+1].loadContentFromXML()},2e3)}r&&r()}))},player.showNextSlide=function(){if(player.slideIndex==story.allSlides.length-1)return Transition.bounce([$(".slide.in")],1),!1;if($(".icon.next-slide").hasClass("disabled"))return!1;for(var t=(player.slideIndex+1)%story.allSlides.length;t!=player.slideIndex;t=(t+1)%story.allSlides.length)if(story.allSlides[t].active){player.showSlideIndex(t,2,!0);break}},player.showPreviousSlide=function(){if(player.slideIndex==story.startingSlideIndex)return Transition.bounce([$(".slide.in")],2),!1;if($(".icon.previous-slide").hasClass("disabled"))return!1;for(var t=(player.slideIndex+story.allSlides.length-1)%story.allSlides.length;t!=player.slideIndex;t=(t+story.allSlides.length-1)%story.allSlides.length)if(story.allSlides[t]&&story.allSlides[t].active){player.showSlideIndex(t,1,!0);break}},player.setSlideIndex=function(t,e){if(player.zoomed&&player.tapZoom(),MouseEvents.processHideables(),clearTimeout(player.mediaTimeout),player.blockedOn=null,player.unblock(),player.pause(!1,!0),!isNaN(t)){var i=player.currentSlide();player.slideIndex=t,player.currentTime=0,player.currentTime=player.currentSlide().currentTime,player.currentSlide()&&(player.currentSlide().resetInteractions(),player.currentSlide().variables.Visited=!0,player.currentSlide().viewedCurrent=!0,player.lmsManager.handleSlideViewed(player.currentSlide()),player.slideList.markVisited(i),player.slideList.collapse(player.currentSlide(),i),player.currentSlide().currentTime=0,player.currentSlide().show(player.autoplaySlides,e,function(){i.slideIndex!=player.currentSlide().slideIndex&&i.reduce(),i.resetSlide(!1,!0),player.hideInactiveSlides(function(){}),i.unloadContent()}),i.handleEvent("ontransitionout",null,null,!1,!0),i.deepEach(function(t,e){e.handleEvent&&e.handleEvent("ontransitionout",null,null,!1,!0)}),i.variables.WindowId="_frame",player.currentSlide().variables.WindowId="_frame"),player.loopable||($(".icon.disabled").removeClass("disabled"),player.slideIndex==story.startingSlideIndex&&$(".icon.previous-slide").addClass("disabled"),player.slideIndex==story.allSlides.length-1&&$(".icon.next-slide").addClass("disabled")),$(".item").css("-webkit-animation-name",""),$(".item").css("-webkit-animation-duration","0s"),$("ul.menu_list li").removeClass("selected"),$("ul.slidelist li").removeClass("selected");var r=player.currentSlide();r.slideBank&&(r=r.slideBank),$.each(r.navLinks,function(t,e){$.each(e.listitems,function(t,e){e.addClass("selected")})}),player.slideList.scrollSelectedIntoView()}},player.hideInactiveSlides=function(t){var e=player.currentSlide();$.each(story.allSlides,function(t,i){i.slideIndex!=e.slideIndex&&(i.hide(),i.unloadContent())}),t&&t()},player.currentSlide=function(){return 0==story.allSlides.length?null:player.currentWindow?player.currentWindowSlide:story.allSlides[player.slideIndex]},player.currentZoom=function(){return player.zoom*player.windowZoomModifier},player.elapsedTime=function(){return new Date-player.startTime},player.play=function(t,e,i){var r=player.currentSlide();if(r){if(!(player.interval&&player.playing&&!player.paused||(r.currentTime>=r.duration&&!e&&player.restart(),player.interval&&window.clearInterval(player.interval),player.playing=!0,player.paused=!1,player.nointervals||(player.interval=setInterval(player.tick,player.TICK_DURATION)),player.zeroTime=new Date,player.showControls&&player.frame.hasBottomBar&&$("#controls").show(),i)))for(e=0;e<r.currentIndex&&e<r.timelineEvents.length;e++){var i=r.timelineEvents[e],a=i.getMediaDuration();(0==a||i.time+a>player.currentTime)&&i.act(!1,t||e>0)}$(".controlbar-button").find(".wait").hide(),$(".controlbar-button").find(".play").hide(),$(".controlbar-button").find(".pause").show(),$(".play_button").removeClass("play"),$(".play_button").addClass("pause"),$(document.body).removeClass("paused"),player.onPlay&&player.onPlay()}},player.pause=function(t,e,i){player.unblock(),player.playing=!1,player.paused=!0,$.each(player.currentSlide().clips,function(i,r){!e&&t&&r.layered||r.ref&&(e||player.currentClipSyncToTimeline)&&(r.pauseClip(),player.scheduledMediaSrc==r.content.src&&(clearTimeout(player.mediaTimeout),player.scheduledMediaSrc=null))}),$.each(player.webAudioClips,function(t,e){e.slide==player.currentSlide()&&e.pauseClip(i)}),player.useActiveTimeline&&$.each(player.currentSlide().children,function(i,r){"Layer"==r.innerType&&(e||!t)&&r.pause()}),$(".controlbar-button").find(".wait").hide(),$(".controlbar-button").find(".pause").hide(),$(".controlbar-button").find(".play").show()},player.pauseClips=function(){clearTimeout(player.mediaTimeout),player.scheduledMediaSrc=null,$.each(player.currentSlide().clips,function(t,e){e.pauseClip(),player.scheduledMediaSrc==e.content.src&&(clearTimeout(player.mediaTimeout),player.scheduledMediaSrc=null)}),$("audio,video").each(function(t,e){e.get&&e.get(0)&&e.get(0).pause&&e.get(0).pause()}),$.each(player.webAudioClips,function(t,e){e.pauseClip()})},player.block=function(){player.blocknotice||(player.blocknotice=$('<div class="blocked">loading...</div>'),$(".blocked").css("left",Math.floor(window.innerWidth/2)-50),$(".blocked").css("top",Math.floor(window.innerHeight/2)-50),$(document.body).append(player.blocknotice)),player.blocknotice.show(),player.playing=!1,player.blocked=!0,clearTimeout(player.blockedTimeout),player.hasWebAudio||(player.blockedTimeout=setTimeout(function(){player.blocked&&(player.currentSlide().currentIndex+=1,player.unblock())},4e3))},player.unblock=function(t){clearTimeout(player.blockedTimeout),$(".blocked").hide(),!player.interval||player.paused||t||(player.playing=!0,player.blockedOn&&player.blockedOn.playClip()),player.blocked=!1,player.blockedOn=null},player.restart=function(){player.currentSlide().resume||(player.currentTime=0,player.update(player.currentTime),player.currentSlide().resetSlide(),player.pause(),player.play())},player.initLoadQueue=function(){player.slideLoadQueue=[],player.slideLoadQueueExhausted=!1;for(var t=0;t<story.allSlides.length;t++)player.slideLoadQueue.push(t);player.slideLoadQueue.promote=function(t){if(t=player.slideLoadQueue.indexOf(t),t>0)for(t=player.slideLoadQueue.splice(t,player.slideLoadQueue.length-t);t.length;)player.slideLoadQueue.unshift(t.pop());player.slideLoadQueue.restart()},player.slideLoadQueue.restart=function(){player.slideLoadQueueExhausted&&(player.slideLoadQueueExhausted=!1,player.loadResourcesForNextSlide())},player.slideLoadQueue.promote(story.startingSlideIndex)},player.loadResourcesForNextSlide=function(){slideIndex=player.slideLoadQueue.shift(),void 0!=slideIndex?player.loadResources(slideIndex):player.slideLoadQueueExhausted=!0},player.loadResources=function(t){if(!(0>t||t>story.allSlides.length)){var e=0,i=story.allSlides[t],r=function(){var r=i.resources.length,a=0;$.each(i.resources,function(s,n){a=player.simplifySlides&&n.item.canSimplify||n.item.deferLoading?a+10:a+100,setTimeout(function(){n.load(s,function(){++e>=r&&(i.ready=!0,t==story.startingSlideIndex&&(player.ready=!0),setTimeout(function(){player.loadResourcesForNextSlide()},1e3))},!0)},a)})};player.simplifySlides?i.simplify(r):r(),0==i.resources.length&&(i.ready=!0,t==story.startingSlideIndex&&(player.ready=!0),player.loadResourcesForNextSlide())}},player.unloadResources=function(){$.each(story.allSlides,function(t,e){(t<player.slideIndex-1||t>player.slideIndex+1)&&$.each(e.resources,function(t,e){e.unload()})})},player.prepAudio=function(t){if(!Resource.justPrepped){Resource.justPrepped=!0,setTimeout(function(){Resource.justPrepped=!1},100);var e=!1;$.each(story.allSlides[t].resources,function(t,i){"audio"!=i.item.type&&"video"!=i.item.type||e||i.prepared||(i.prep(function(){}),e=!0)})}},player.updateMediaMonitor=function(){player.showMediaMonitor&&(player.mediaMonitor||(player.mediaMonitor=$("<div class='monitor'>hey</div>"),$(document.body).append(player.mediaMonitor)),player.mediaMonitor.empty(),$.each(story.allSlides,function(t,e){player.mediaMonitor.append("<h2>"+e.title+"</h2>");var i=$("<ul></ul>");$.each(e.resources,function(t,e){if(("audio"==e.item.type||"video"==e.item.type)&&e.item.ref){var r=$("<li>"+e.prepared+", "+e.item.ref.get(0).networkState+", "+e.item.ref.get(0).readyState+", "+e.item.ref.get(0).paused+", "+e.item.ref.get(0).ended+", "+e.item.ref.get(0).error+", "+e.item.getCurrentTime()+", "+e.src+"</li>");!e.item.ref.get(0).paused&&!e.item.ref.get(0).ended&&r.css("background-color","yellow"),e.item.id==player.nextPreparedClipID&&r.css("color","green"),player.currentClip&&e.item.ref&&player.currentClip==e.item.ref.get(0)&&r.css("text-decoration","underline"),i.append(r)}}),player.mediaMonitor.append(i)}))},player.onLoadedData=function(){player.loadedMediaCount++,player.loadedMediaCount==player.mediaCount&&(player.pause(),$("#slideframe").css("-webkit-transition-property","opacity"),$("#slideframe").css("-webkit-transition-duration","1s"),$("#slideframe").css("opacity","1.0"),player.showSlideID(story.startingslide))},player.reorient=function(t){player.frame.reorient(t)},player.maximize=function(t){t&&!player.maximized?(player.width/=2,player.height/=2,player.reorient(!0)):!t&&player.maximized&&(player.width*=2,player.height*=2,player.reorient(!0)),player.maximized=t},player.revealPostInterstitial=function(){SlideDraw.populateDraws(),$("#slideframe").css("-webkit-transition-property","opacity"),$("#slideframe").css("-webkit-transition-duration","1s"),$("#slideframe").css("opacity","1.0"),$(".launch").remove(),player.showSlideID(story.startingslide),player.currentSlide().prepDownstreamMedia(),player.reorient(!0),player.showControls&&$("#controls").show(),setTimeout(function(){player.showingInterstitial=!1},500),$(".interstitial").hide(),player.playButton.hide(),!player.isIOS&&player.isChrome&&player.forceRepaint(),clearInterval(player.win7kick),Audio.iOSPrepare&&Audio.iOSPrepare()},player.showInterstitial=function(){player.showIOSLaunch()},player.addDiagnosticButton=function(t,e){var i=$('<div class="diagnosticbutton">'+t+"</div>");i.click(e),$("#topbar").append(i)},player.sniffParameters=function(){location.search.split("&"),$.each(location.search.split("&"),function(t,e){var i=unescape(e.replace("?","")).split("=");switch(i[0].toLowerCase()){case"file":player.filename=i[1];break;case"name":player.storyName=i[1],player.basepath="/UserData/Upload/"+i[1]+"/";break;case"controls":player.showControls=!1,player.swipeMode="follow",player.animations="all";break;case"usexml":player.loadFromScript=!1;break;case"lms":player.useLMS=!0;break;case"ao":globals.bAOSupport=!0,window.g_bAOSupport=!0,player.useAO=!0,player.forceAO=!0;break;case"tincan":globals.bTinCan=!0,window.g_bTinCan=!0,player.useTinCan=!0;break;case"anim":player.animations=i[1];break;case"page":player.paging=i[1];break;case"zoom":player.tapZoomEnabled=!0;break;case"lockzoom":player.lockzoom=!player.lockzoom;break;case"scale":player.scaleToFit=!player.scaleToFit;break;case"swipe":player.swipeMode=i[1];break;case"rightclick":player.allowRightClick=!player.allowRightClick;break;case"menu":player.forceMenu=!0;break;case"jiggle":player.useSwipeJiggle=!0;break;case"heartbeat":setInterval(function(){$(".framewrap").hide(),player.uselessOffsetHeight=$(".framewrap").get(0).offsetHeight,$(".framewrap").show()},i[1]||1e3);break;case"noimg":player.noImg=!0;break;case"bak":player.backOnly=!0;break;case"simplify":player.simplifySlides=!1;break;case"preload":player.preload=!0;break;case"ppfudge":window.ppFudge=parseFloat(i[1]);break;case"nocanvas":player.useCanvas=!1,player.renderVectorShapes=!1,player.renderVectorsAsSVG=!1;break;case"safecanvas":player.useSafeCanvas=!0;break;case"basiccanvas":ppArt=ppArtBasic;break;case"oldnav":player.simplenav=!1;break;case"compact":player.useCompactResume=!player.useCompactResume;break;case"svg":player.useCanvas=!0,player.renderVectorShapes=!0,player.renderVectorsAsSVG=!0;break;case"console":console.suppress=!console.suppress;break;case"noconsole":console.suppress=!0;break;case"datestamp":var r=$("<div class='datestamp'>"+window.buildDate+"<div>");r.click(function(){alert(window.buildDate)}),$(document.body).append(r);break;case"silent":Audio.setSilentMode();break;case"media":
player.showMediaMonitor=!0,setInterval(player.updateMediaMonitor,500);break;case"medialist":var a=$("<div class='medialist'></div>");$(document.body).append(a),setTimeout(function(){story.xml.find("video").find("videodata").each(function(t,e){a.append("<a href='"+player.basepath+$(e).attr("url")+"' target='_blank'>"+$(e).attr("url")+"</a><br>")})},2e3);break;case"resources":var s=$("<ul class='resourcelist'></ul>");$(document.body).append(s),setInterval(function(){s.empty();var t=$("<li class='ttotal'>total: <b>"+Resource.TotalPixels+"</b> ("+Resource.LoadedImageCount+")</li>");s.append(t)},100);break;case"monitor":player.showInstrumentation=!0;break;case"follow":player.followMouseCursor=!0;break;case"info":player.showItemInfo=!0,player.canChangeMonitoringItem=!0,player.originalMonitoringItemID=i[1],setInterval(player.updateItemInfo,1e3),setTimeout(function(){var t=story.findDescendantById(i[1]);t&&player.updateItemInfo(t)},1e3),$(".framewrap").addClass("info");break;case"trap":window.onerror=function(){};break;case"placeholder":player.usePlaceholderVideo=!0;break;case"novideo":player.noVideo=!0;break;case"noaudiocache":player.noAudioCache=!0;break;case"filter":console.filter=i[1];break;case"overlap":player.showDebugOverlap=!0,BitMask.showDebug=!0;break;case"persist":player.showDebugOverlapPersistent=!0;break;case"overlapdebug":player.showDebugOverlap=!0,BitMask.showDebug=!0,BitMask.debugOnly=!0;break;case"matrixdebug":player.showMatrixDebug=!0;break;case"maskdebug":player.drawMaskDebugShapes=!0;break;case"dumpcanvas":player.dumpCanvas=!0,player.canvasCommandLog=[];break;case"linkareas":player.showLinkAreas=!0;break;case"maximize":player.canMaximize=!0,player.maximized=!0;break;case"stresstest":player.setupStressTest();break;case"navtest":setTimeout(function(){player.frame.debugTopNav()},1e3);break;case"nointervals":player.nointervals=!0;break;case"noframe":player.noframe=!0;break;case"noframecolor":player.noframecolor=!0;break;case"bgcolor":globals.strBgColor="#"+i[1],$(document.body).css("background","#"+i[1]);break;case"resumedata":player.overrideResumeData=i[1];break;case"suppresscapture":player.suppressCaptureAnimations=!player.suppressCaptureAnimations;break;case"active":player.useActiveTimeline=!player.useActiveTimeline;break;case"iosplayer":player.simulateIOSPlayer=!player.simulateIOSPlayer;break;case"notouch":player.addDiagnosticButton("disable",function(){alert($("#glossaryscroll").get(0).className)});break;case"logging":player.logActivity=!player.logActivity}})},player.setupStressTest=function(){var t=$("<a style='position:absolute;left:0px;top:10px;z-index:10000;background-color:#fff'>stress single</a>");t.click(function(){var e=0,i=player.currentSlide(),r=i.container,a=function(){setTimeout(function(){i.destroyRef(),setTimeout(function(){i.createRef(r),a()},50)},50),e++,t.html(e)};a()}),$(document.body).append(t);var e=$("<a style='position:absolute;left:0px;top:50px;z-index:10000;background-color:#fff'>stress cycle</a>");e.click(function(){var t=0,i=function(){setTimeout(function(){player.setSlideIndex((player.slideIndex+1)%story.allSlides.length),i()},100),t++,e.html(t)};i()}),$(document.body).append(e)},player.prepSlides=function(){},player.loadFonts=function(t){player.fontlib=new ppFontLib(player.basepath,$(t).find("bwContent").attr("iosfonts")),g_oFontLib=player.fontlib,player.fontlib.CreateFonts(function(){player.fontready=!0})},player.parseFrameData=function(t){player.frame.loadFromXML($(t)),player.slideList.refresh(),player.frame.initOrientation()},player.loadFrame=function(){if(player.frameData)player.parseFrameData(player.frameData);else if(player.loadFromScript){player.parseDataOnLoad=!0;var t=$("<script></script>");t.attr("src",player.basepath+"story_content/frame.js"),$(document.body).append(t),setTimeout(function(){player.createdFrameData||(player.loadFromScript=!1,player.loadFrame(),$(document.body).append($("<div class='framefailed'></div>")))},5e3)}else t="?random="+Math.random(),$.ajax({url:player.basepath+"story_content/frame.xml"+t,dataType:"xml",cache:!1,success:function(t){player.parseFrameData(t)},error:function(){player.frame.ready=!0}})},player.loadUserScript=function(){$.ajax({url:player.basepath+"story_content/user.js",dataType:"script",cache:!1,success:function(){},error:function(){return!1}})},player.loadMasks=function(){player.maskData?player.parseMaskData(player.maskData):player.loadFromScript&&(player.parseDataOnLoad=!0)},player.parseMaskData=function(t){player.bitmasks={},$(t).find("maskdata").each(function(t,e){var i=$(e).attr("i"),r=$(e).attr("m");player.bitmasks[i]=r})},player.load=function(t){if(player.isIOSFrame&&(480>=window.innerWidth||480>=window.innerHeight)){$(".interstitial").show(),$(".wrap").hide(),$(".loading").hide(),$(".interstitial_play").hide(),$(".wrap").remove(),$(".loading").remove(),$(".interstitial_play").remove();var e=$("<div class='incompatible'><h1>Not yet</h1>Small device support is coming soon.</div>");$(document.body).append(e)}else player.parseStoryData=function(e){if("string"==typeof e){var i,e=e.replace(/[\u000a\u000b\u000c\u000d\u0085\u2028\u2029]/g,""),e=e.replace(/&#x[0-8bcef];/gi,"");-1<location.search.indexOf("dumpxml=1")&&console.log(e),window.ActiveXObject?(i=new ActiveXObject("Microsoft.XMLDOM"),i.loadXML(e)):i=(new DOMParser).parseFromString(e,"text/xml"),e=i}$(e).find("fontlib")&&0>location.search.indexOf("nocanvas")&&(player.useCanvas=!0,player.renderVectorShapes=!0,player.renderVectorsAsSVG=!1),story.loadFromXML($(e)),player.loadFrame(),player.loadMasks(),player.initLoadQueue(),player.loadResourcesForNextSlide(),player.loadFonts($(e)),window.ExecuteScript||(window.ExecuteScript=function(){},player.hasUserScript=0<$(story.xml).find("exe_javascript").length,player.hasUserScript&&player.loadUserScript());var r=player.lmsManager.initResume(),a=setInterval(function(){if(player.ready&&player.frame.ready&&player.fontready&&0==story.pendingSceneCount&&player.lmsManager.isReady()){if(player.loadingSpinner.hide(),player.pause(),player.prepSlides(),window.clearInterval(a),player.showControls&&$("#controls").show(),!player.frame.defaultLayoutName){var i=$(e).find("set_frame_layout").first().attr("name");i&&(player.frame.defaultLayoutName=i)}player.frame.set_frame_layout(),player.frame.updateLayout(),player.frame.set_frame_layout();var i=player.hasLMS&&story.resumeLMS||player.lmsManager.hasAO&&player.aoResumeData&&story.resumeLMS||player.lmsManager.hasTinCan&&player.tinCanResumeData&&story.resumeLMS||!player.hasLMS&&!player.lmsManager.hasAO&&story.resumeFlash,s="";if(player.overrideResumeData&&(s=player.overrideResumeData),player.hasLMS&&story.resumeLMS?(s=r,player.overrideResumeData&&(s=player.overrideResumeData)):player.lmsManager.hasAO&&player.aoResumeData&&story.resumeLMS?s=player.aoResumeData:player.lmsManager.hasTinCan&&player.tinCanResumeData&&story.resumeLMS?s=player.tinCanResumeData:story.resumeFlash&&(s=localStorageAlias[story.resumeID],player.overrideResumeData)&&(s=player.overrideResumeData),player.hasLMS&&!s&&story.resumeFlash?(s=localStorageAlias[story.resumeID],player.overrideResumeData&&(s=player.overrideResumeData)):player.lmsManager.hasAO&&!s&&story.resumeFlash?(s=localStorageAlias[story.resumeID],player.overrideResumeData&&(s=player.overrideResumeData)):player.lmsManager.hasTinCan&&!s&&story.resumeFlash?(s=localStorageAlias[story.resumeID],player.overrideResumeData&&(s=player.overrideResumeData)):player.lmsManager.hasAO||player.lmsManager.hasTinCan||player.hasLMS||(s=localStorageAlias[story.resumeID],!player.overrideResumeData)||(s=player.overrideResumeData),(player.resumeData=s)&&i&&!story.resumePrompt){if(player.overrideResumeData&&(s=player.overrideResumeData),player.useCompactResume)try{resumeSuccess=story.updateFromCompactData(s)}catch(n){}else try{story.updateFromData(JSON.parse(s))}catch(o){}player.isIOS&&player.showInterstitial()}if(player.automate)setTimeout(function(){player.revealPostInterstitial(),player.automate()},1);else if(s&&story.resumePrompt){if(i=story.parseObjref(story.resumeWindow).target,s=story.parseObjref(story.resumeSlideID).target,player.isIOSFrame){var l=new ResumePrompt;l.loadFromXML(i.xml),l.createRef(),story.children[i.id]=l,l.showSlide(s)}else i.showSlide(s);$(".interstitial").hide(),$("#slideframe").css("opacity","1.0"),$("#control-progress").hide(),player.reorient(!0)}else player.isIOS?player.showInterstitial():setTimeout(function(){player.simulateIOSPlayer?player.showInterstitial():player.revealPostInterstitial()},1);t&&t()}},100)},player.storyData?player.parseStoryData(player.storyData):player.loadFromScript?(player.parseDataOnLoad=!0,e=$("<script></script>"),e.attr("src",player.basepath+"mobile/data.js"),$(document.body).append(e),setTimeout(function(){player.createdStoryData||($(document.body).append($("<div class='datafailed'></div>")),player.loadFromScript=!1,player.load())},5e3)):$.ajax({url:player.basepath+"story_content/data.xml",dataType:"xml",cache:!1,success:function(t){player.parseStoryData(t)},error:function(t,e){alert("Error loading "+player.basepath+"story_content/data.xml: "+e)}})},player.tapPause=function(){player.hasReleasedFinger=!1,player.pausenotice||(player.pausenotice=$('<div class="interstitial light"></div><div class="pausemessage"></div>'),$(document.body).append(player.pausenotice),player.pausenotice.bind("click touchstart mousedown",function(){player.hasReleasedFinger&&(player.showingInterstitial=!1,player.pausenotice.hide(),player.play(!0)),player.hasReleasedFinger=!0})),player.showingInterstitial=!0,player.pause(),player.pausenotice.show(),player.hasReleasedFinger=!1,swipe.cancel()},player.tapZoom=function(t){var e=player.currentSlide().ref;if(player.zoomed)e.css("-webkit-transition-property","none"),e.css("-webkit-transition-duration","0s"),e.css("zoom",1),e.css("-webkit-transform",player.lastSlideTransform),e.css("width","720px"),e.css("height","540px"),setTimeout(function(){e.css("-webkit-transition-property","-webkit-transform"),e.css("-webkit-transition-duration","0.4s"),e.css("-webkit-transform-origin","top left"),e.css("-webkit-transform","translate3d(0px,0px,0px) scale(1.0)")},0);else{if(!t)return;var i=e.offset(),r=$("#slideframe").css("zoom"),a=(t.originalEvent.changedTouches[0].pageY-i.top)/r,s=parseInt((t.originalEvent.changedTouches[0].pageX-i.left)/r/2),n=parseInt(a/2),t="scale(2.0) translate3d(-"+s+"px,-"+n+"px,0px) ";e.css("-webkit-transition-property","-webkit-transform"),e.css("-webkit-transition-duration","0.4s"),e.css("-webkit-transform-origin","top left"),e.css("-webkit-transform",t),e.css("width","1440px"),e.css("height","1080px"),player.lastSlideTransform=t,setTimeout(function(){player.zoomed&&(e.css("-webkit-transition-property","none"),e.css("-webkit-transition-duration","0s"),e.css("zoom",2),e.css("-webkit-transform","translate3d(-"+s+"px,-"+n+"px,0px)"))},400)}player.zoomed=!player.zoomed},player.updateItemInfo=function(t){if(player.showItemInfo)if(player.itemInfoMonitor||(player.itemInfoMonitor=$("<div class='monitor'></div>"),$(document.body).append(player.itemInfoMonitor)),player.canChangeMonitoringItem&&t&&(player.monitoringItem=t||player.monitoringItem,player.canChangeMonitoringItem=!1),t=player.monitoringItem,player.itemInfoMonitor.empty(),player.itemInfoMonitor.append($("<p>currentTime:"+player.currentTime+", currentLayerTime: "+player.currentLayerTime+"</p>")),t){$(".item.monitoring").removeClass("monitoring"),t.ref&&t.ref.addClass("monitoring");var e=$("<h2>"+t.id+"</h2>");e.bind("click",function(){alert(t.id)}),player.itemInfoMonitor.append(e),player.itemInfoMonitor.append($("<h3>"+t.innerType+" (visible:"+t.visible+")</h3>")),player.itemInfoMonitor.append($("<p>x: "+t.x+" y: "+t.y+" w: "+t.width+" h: "+t.height+" z: "+t.depth+" xoff: "+t.xoffset+" yoff: "+t.yoffset+" dragX: "+t.dragX+" dragY: "+t.dragY+" ox: "+t.originalX+" oy: "+t.originalY+" sx: "+t.shuffleX+" sy: "+t.shuffleY+" vis: "+t.visible+" </p>")),e=$("<a>toggle&nbsp;</a>"),e.click(function(){t.visible?t.hide():t.show()}),player.itemInfoMonitor.append(e),e=$("<a>&nbsp;render</a>"),e.click(function(){t.render(t.lastRenderedState,!0,null,"info pane")}),player.itemInfoMonitor.append(e),t.content&&player.itemInfoMonitor.append($("<span>"+t.content.src+"</span>")),e=function(t,e){if(t){var i=$("<table></table>");$.each(t,function(t,r){var a=r;e&&(a="function"==typeof e?e(t,r):r[e]),a=$("<tr><td>"+t+":</td><td>"+a+"</td></tr>"),i.append(a)}),player.itemInfoMonitor.append(i)}},player.itemInfoMonitor.append("<p/><a href='javascript:void(null);' onclick='player.monitoringItem=null;player.canChangeMonitoringItem=true;player.updateItemInfo();'>change</a>"),player.monitoringItem.parent&&player.itemInfoMonitor.append("(<a href='javascript:void(null);' onclick='player.monitoringItem=player.monitoringItem.parent;player.updateItemInfo();'>parent</a>)"),player.itemInfoMonitor.append("<p/><a href='javascript:void(null);' onclick='player.monitoringItem=null;player.canChangeMonitoringItem=true;player.updateItemInfo(player.currentSlide());'>slide</a>");var i=$("<a href='javascript:void(null);'>log</a>");if(i.click(function(){console.log(t)}),player.itemInfoMonitor.append("<p/>"),player.itemInfoMonitor.append(i),e(t.variables),e(t.children,function(t,e){return"<a href='javascript:void(null);' onclick='player.monitoringItem=player.monitoringItem.children[\""+e.id+"\"];player.updateItemInfo();'>_"+e.innerType+"_</a>"}),e(t.events,"trigger"),e(t.states),e(t.actionGroups),player.logActivity?e(t.log):t.content?(player.itemInfoMonitor.append($("<span onclick='alert(this.innerHTML)'>"+t.content.path+"</span><br/>")),t.content.src&&t.content.src!=Element.PixelSrc?player.itemInfoMonitor.append($("<img src='"+t.content.src+"' style='opacity:0.8;border:solid 1px green'>")):player.itemInfoMonitor.append($("<span>NO IMAGE</span>")),t.canvas&&t.canvas.toDataURL&&0==location.href.indexOf("http")&&(e=t.canvas.toDataURL("image/png"),player.itemInfoMonitor.append($("<img src='"+e+"' style='opacity:0.8;border:solid 1px yellow'>")))):player.itemInfoMonitor.append($("NO CONTENT")),t.bitMask&&player.showDebugOverlap){var r=function(t){var e=$("<canvas></canvas>");e.attr("width",t.width),e.attr("height",t.height),e.css("position","relative"),player.itemInfoMonitor.append(e),t.drawDebug(e.get(0))};r(t.bitMask),t.stateMasks&&$.each(t.stateMasks,function(t,e){r(e)})}else player.itemInfoMonitor.append($("NO BITMASK"))}else player.itemInfoMonitor.append($("<h2>select an item to monitor</h2>"))};var story,tq;$("#loadingSpinner").css("left",Math.floor(window.innerWidth/2)-50),$("#loadingSpinner").css("top",Math.floor(window.innerHeight/2)-50),$(".blocked").css("left",Math.floor(window.innerWidth/2)-50),$(".blocked").css("top",Math.floor(window.innerHeight/2)-50),$(document).ready(function(){if(player.loadingSpinner=$("#loadingSpinner"),player.playButton=$("#playButton"),player.container=$("#slidecontainer"),story=new Storyline(player.container),player.frame=new Frame,player.showControls=!0,player.swipeMode="none",player.animations="all",player.simplifySlides=!1,player.loadFromScript=!0,player.lockzoom=!1,player.startTime=new Date,player.sniffParameters(),player.lmsManager=new LMSManager,player.lmsManager.init(),player.initIOS&&player.initIOS(),player.load(),"follow"!=player.swipeMode){if($(".submit-slide").parent().bind("click",function(){player.currentSlide()&&player.currentSlide().forceRepaint(!0),player.currentWindow||0<$(".modalfence:visible").length||story.handleEvent("onobjectevent","submit_pressed",null,!1,!1,!0)}),$(".next-slide").parent().bind("click",function(){story.handleEvent("onobjectevent","next_pressed",null,!1,!1,!0)}),$(".previous-slide").parent().bind("click",function(){story.handleEvent("onobjectevent","prev_pressed",null,!1,!1,!0)}),player.isIOS){var t=function(){player.currentSlide().hasSimpleNavigation&&player.pause()};$(".next-slide").parent().bind("touchend",t),$(".previous-slide").parent().bind("touchend",t)}$("#control-menu").bind("click",function(){player.slideList.toggle()}),$(".button,.controlbar-button").bind("mousedown touchstart",function(){$(this).addClass("pressed")}),$(".button,.controlbar-button").bind("mouseup mouseout touchend",function(){$(this).removeClass("pressed")})}else console.log("swipe.init()");$("#control-pauseplay .play").bind("click",function(){player.activeTimeline.play()}),$("#control-pauseplay .pause").bind("click",function(){player.activeTimeline.pause()}),player.volumeSlider=new VolumeSlider($("#control-volume")),player.volumeSlider.onDragUpdate=function(t){$("audio,video").each(function(e,i){i.volume=Math.min(t*player.clipVolume,1)}),Audio.setMasterVolume&&Audio.setMasterVolume(t)},"all"==player.paging&&$(document.body).bind("tap",function(t){!player.showingInterstitial&&!player.zoomed&&(t=t.originalEvent.touches?t.originalEvent.changedTouches[0].pageX:t.pageX,t<.1*window.innerWidth?player.showPreviousSlide():t>.9*window.innerWidth&&player.showNextSlide())}),$(document.body).bind("touchstart",function(t){t&&t.originalEvent&&t.originalEvent.touches&&1==t.originalEvent.touches.length&&(player.touchStart={left:t.originalEvent.touches[0].pageX,top:t.originalEvent.touches[0].pageY},player.touchFlickDirection=null,player.startMatrix=player.currentSlide()&&player.currentSlide().ref?new WebKitCSSMatrix(window.getComputedStyle(player.currentSlide().ref.get(0)).webkitTransform):new WebKitCSSMatrix)}),$(document.body).bind("gesturechange",function(){}),$(document.body).bind("touchmove",function(t){if(player.tapZoomEnabled&&player.zoomed&&1==t.originalEvent.touches.length){player.justTapped=!1;var e=t.originalEvent.touches[0],i=parseInt(e.pageX-player.touchStart.left),r=parseInt(e.pageY-player.touchStart.top),e=player.startMatrix.translate(i,r,0);0<e.e&&(e.e=0),0<e.f&&(e.f=0),e.e<-player.width&&(e.e=-player.width),e.f<-player.height&&(e.f=-player.height),player.currentSlide().ref.css("-webkit-transform",e)}for(i=!1,e=t.target,r=t.originalEvent.touches;!i&&e;){if(i=$(e).hasClass("scrollarea"),(inSlideList=$(e).hasClass("slidelist"))&&2==r.length)return!0;if(i&&player.touchStart)return i=parseInt(t.originalEvent.touches[0].pageX-player.touchStart.left),r=parseInt(t.originalEvent.touches[0].pageY-player.touchStart.top),player.touchFlickDirection||(player.touchFlickDirection=Math.abs(i)>Math.abs(r)?"horizontal":"vertical"),"horizontal"==player.touchFlickDirection||0>=e.scrollTop&&r>0||e.scrollTop>=e.scrollHeight-e.offsetHeight&&0>r?!1:!0;e=e.parentNode}return 1==player.isFramedOffset}),$(window).bind("scroll",function(){return!1}),$(window).unbind("keydown"),$(window).bind("keydown",function(t){var e,i=player.currentSlide();if(i){var r=t.keyCode,a=String.fromCharCode(t.keyCode);(90<t.keyCode||!/\w/.test(a))&&(r=-1),story.properties.LastKeyCode=r,story.properties.LastKeyCodeString=a,setTimeout(function(){player.modalLayer&&player.modalLayer.visible&&(i=player.modalLayer),e=i.handleEvent("onkeypress",t,null,!1,!0,!0)&&e,e=i.handleEvent("onanykeypress",t,null,!1,!0,!0)&&e,i.deepEach(function(i,r){r.handleEvent&&(e=r.handleEvent("onkeypress",t,null,!1,!0,!0)&&e,e=r.handleEvent("onanykeypress",t,null,!1,!0,!0)&&e)})},0)}return 13==t.keyCode?t.target&&t.target.item&&t.target.item.content&&t.target.item.content.multiline?!0:!1:void 0}),MouseEvents.init(),player.progressBar=new ProgressBar(null,$("#progressbar"),!0),player.progressBar.onDragUpdate=function(t){var e=player.activeTimeline==player?player.currentSlide().duration:player.activeTimeline.duration;player.activeTimeline.currentTime=parseInt(e*t),player.activeTimeline==player&&player.currentClip&&player.currentTime>player.currentClipStartTime&&player.currentTime<1e3*player.currentClip.duration+player.currentClipStartTime&&(player.currentClip.currentTime=(player.currentTime-player.currentClipStartTime)/1e3),player.activeTimeline.update(!0)},player.lastOrientation=-1,!player.nointervals&&player.isIOS&&setInterval(player.frame.reorient,100),player.frame.reorient(!0),player.isIOS||($(window).bind("resize",function(){player.reorient(!0)}),$(document.body).bind("dragstart",function(t){t.preventDefault()}));var e=0;player.win7kick=null,player.isChrome&&(player.win7kick=setInterval(function(){player.forceRepaint(),5<e++&&clearInterval(player.win7kick)},1e3))}),player.forceRepaint=function(){$(".framewrap").hide(),player.uselessOffsetHeight=$(".framewrap").get(0).offsetHeight,$(".framewrap").show()},player.initGlobals=function(){$(document.body).css("background-color",globals.strBgColor),player.scaleToFit="noscale"!=globals.strScale},player.restrictUnsupportedBrowsers=function(){},window.CreateData=function(t,e){if(e=e||"storyData","string"==typeof t){t=t.replace(/[\u000a\u000b\u000c\u000d\u0085\u2028\u2029]/g,""),t=t.replace(/&#x[0-8bcef];/gi,""),-1<location.search.indexOf("dumpxml=1")&&console.log(t);var i;window.ActiveXObject?(i=new ActiveXObject("Microsoft.XMLDOM"),i.loadXML(t)):i=(new DOMParser).parseFromString(t,"text/xml"),t=i}player[e]=t,player.parseDataOnLoad&&"storyData"==e&&(player.createdStoryData=!0,player.parseStoryData(player.storyData))},window.CreateFrameData=function(t){player.createdFrameData=!0,CreateData(t,"frameData"),player.parseDataOnLoad&&player.parseFrameData(player.frameData)},window.CreateMaskData=function(t){player.createdMaskData=!0,CreateData(t,"maskData"),player.parseDataOnLoad&&player.parseMaskData(player.maskData)},window.GetPlayer=function(){return player},player.GetVar=function(t){return story.extractVariable(t)},player.SetVar=function(t,e){story.setVariable(t,e)},window.player=player,window.$=$,window.story=story;var IE6=!1;if(window.IE6=!1,window.IE6=!1,!window.g_bWarnOnCommitFail){var g_bWarnOnCommitFail=!1;window.g_bWarnOnCommitFail=!1,window.g_bWarnOnCommitFail=!1}if(window.localStorageAlias=window.localStorage,document.all&&!window.localStorage&&(window.localStorageAlias={},window.localStorageAlias.removeItem=function(){}),player.meta={title:"",description:"",thumburl:""},player.initIOS=function(){},(player.isIOS||-1<location.search.indexOf("iosplayer=1"))&&(player.initIOS=function(){player.loadMetaData()},player.loadMetaData=function(){var t="?random="+Math.random();$.ajax({url:player.basepath+"meta.xml"+t,dataType:"xml",cache:!1,success:function(t){player.parseMetaData(t)},error:function(){}})},player.parseMetaData=function(t){t=$(t).children("meta").children("project"),player.meta.title=t.attr("title"),player.meta.thumburl=t.attr("thumburl"),player.meta.description=t.children("description").text(),player.populateIOSLaunch()},player.showIOSLaunch=function(){if(player.launch=$('<div class="launch">&nbsp;<div class="launchwrap"><div class="container"><div class="launch_meta"><h1/><p/><a class="button"" title="play">Play</a></div><div class="screenshot"><img/></div></div></div></div>'),$(document.body).prepend(player.launch),player.launch.show(),player.launch.find("a").first().click(player.revealPostInterstitial),player.populateIOSLaunch(),500>window.innerWidth){var t=player.launch.find(".screenshot"),e=player.launch.find("h1"),i=player.launch.find(".container"),r=function(){var r=window.orientation/180==parseInt(window.orientation/180);player.isCrossDomainFrame||(r=top.window.orientation/180==parseInt(top.window.orientation/180)),r?t.insertAfter(e):i.append(t)};window.addEventListener("orientationchange",r),r()}},player.populateIOSLaunch=function(){player.launch&&(player.launch.find("h1").text(player.meta.title),player.launch.find("p").first().text(player.meta.description),player.launch.find("img").first().attr("src",player.basepath+player.meta.thumburl))}),player.isFramed=top!=self,player.isFramed){var myFrame=Frame.findCurrentFrame();myFrame&&(player.isFramedOffset=0<myFrame.offsetWidth||0<myFrame.offsetHeight)}if((player.isIOS||-1<location.search.indexOf("iosorient=1"))&&(Frame.prototype.initOrientation=function(){var t=window.orientation/180==parseInt(window.orientation/180),e=t?window.innerHeight:window.innerWidth,i=t?window.innerWidth:window.innerHeight,r=t?window.innerWidth:window.innerHeight,a=t?window.innerHeight:window.innerWidth,s=window.innerWidth,n=window.innerHeight,o=document.createElement("meta");self==top||player.isCrossDomainFrame?(o.setAttribute("id","viewport"),o.setAttribute("name","viewport"),o.setAttribute("content","width=device-width, user-scalable=yes"),document.getElementsByTagName("head")[0].appendChild(o)):(o=top.document.createElement("meta"),o.setAttribute("id","viewport"),o.setAttribute("name","viewport"),o.setAttribute("content","width=device-width, user-scalable=yes"),top.document.getElementsByTagName("head")[0].appendChild(o),(t=top.window.orientation/180==parseInt(top.window.orientation/180))&&$(document.body).addClass("portrait"),top.window.scrollTo(0,0),e=t?top.window.innerHeight:top.window.innerWidth,i=t?top.window.innerWidth:top.window.innerHeight,r=t?top.window.innerWidth:top.window.innerHeight,a=t?top.window.innerHeight:top.window.innerWidth,s=top.window.innerWidth,n=top.window.innerHeight),window.scrollTo(0,0);var o=story.frameWidth-2,l=story.frameHeight-2;setTimeout(function(){},5e3),this.containerWidth=o,this.containerHeight=l,$(".framewrap").css("width",o),$(".framewrap").css("height",l),t||1024!=s?t&&768==s?(i=768-(1024-n),e=1024):t||480!=s?t&&480>=s&&(i=268,e=480):(a=720-(320-n),r=480):(a=1024-(768-n),r=768),t=1,t=o/l>e/i?e/o:i/l,s=parseInt((i-l*t)/2-1),0>s&&(s=0),n=parseInt((e-o*t)/2-1),0>n&&(n=0),e=".framewrap{-webkit-transform-origin:top left;-webkit-transform:translate3d(0px,0px,0px) scale("+t+");width:"+o+"px;height:"+l+"px;top:"+s+"px!important;left:"+n+"px!important;.interstitial{height:"+i+"px;width:"+e+"px;}}",player.landscapeFrameScale=t,t=1,t=o/l>r/a?r/o:a/l,s=parseInt((a-l*t)/2-1),0>s&&(s=0),n=parseInt((r-o*t)/2-1),0>n&&(n=0),r=".framewrap{-webkit-transform-origin:top left;-moz-transform-origin:top left;-ms-transform-origin:top left;-webkit-transform:translate3d(0px,0px,0px) scale("+t+");-moz-transform:translate3d(0px,0px,0px) scale("+t+");-ms-transform:translate(0px,0px) scale("+t+");width:"+o+"px;height:"+l+"px;top:"+s+"px!important;left:"+n+"px!important;.interstitial{height:"+a+"px;width:"+r+"px;}}",player.rotatePortraitStyleSheet=document.createElement("style"),player.rotatePortraitStyleSheet.innerHTML=r,document.body.appendChild(player.rotatePortraitStyleSheet),player.portraitFrameScale=t,player.frameLandscapeStyleSheet=document.createElement("style"),player.frameLandscapeStyleSheet.media="only screen and (max-device-width: 1024px) and (orientation:landscape)",player.frameLandscapeStyleSheet.innerHTML=e,document.body.appendChild(player.frameLandscapeStyleSheet),self!=top&&(r=r.replace("framewrap","portrait .framewrap").replace("interstitial","portrait .interstitial"),player.rotatePortraitFramedStyleSheet=document.createElement("style"),player.rotatePortraitFramedStyleSheet.innerHTML=r,document.body.appendChild(player.rotatePortraitFramedStyleSheet))},Frame.prototype.reorient=function(t){if($("#loadingSpinner").css("left",Math.floor(window.innerWidth/2)-50),$("#loadingSpinner").css("top",Math.floor(window.innerHeight/2)-50),$(".blocked").css("left",Math.floor(window.innerWidth/2)-50),$(".blocked").css("top",Math.floor(window.innerHeight/2)-50),1!=player.width){var e=player.isCrossDomainFrame?window.orientation:top.window.orientation,i=e/180==parseInt(e/180);(t||e!=player.lastOrientation)&&(window.scrollTo(0,0),player.isCrossDomainFrame||top.window.scrollTo(0,0),Frame.findCurrentFrame(),i?(player.frameScale=player.portraitFrameScale,$(document.body).addClass("portrait")):(player.frameScale=player.landscapeFrameScale,$(document.body).removeClass("portrait")),player.lastOrientation=e)}}),-1<location.search.indexOf("iosmarker=1")&&(player.isIOSMarkers=!0),(player.isIOS||player.isIOSMarkers)&&(ExpandingLabel.prototype.togglecontent=function(){this.visible=!this.visible,this.variables.Expanded=this.visible.toString(),this.visible?($(".above").removeClass("above"),$(".showing").removeClass("showing"),this.hideOthers(),this.showContent=!0,this.render(null,!0,this.width,this.height),this.show(),this.ref.addClass("above showing"),this.button.ref.addClass("above showing"),this.bringtofront(),this.button.bringtofront(),this.handleEvent("onobjectevent","contentin",null,!1,!1,!0)):(this.hide(),$(".above").removeClass("above"),this.handleEvent("onobjectevent","contentout",null,!1,!1,!0))},ExpandingLabel.prototype.hidecomplete=function(){this.variables.Expanded="false",this.hide(),$(".above").removeClass("above")},ExpandingLabel.prototype.showtitle=function(){},ExpandingLabel.prototype.hidetitle=function(){}),player.forceBitMaskTesting=-1<location.search.indexOf("&pixel="),player.isLocalFileSystem="file:"==window.location.protocol,player.usePixelTesting=(player.isIOS||!player.isLocalFileSystem)&&!player.forceBitMaskTesting,player.usePixelTesting&&(VectorShape.prototype.isPointActive=function(t,e){if(!this.visible||!this.vectorHot)return!1;var i=this.getCanvasPoint(t,e);return 0>=i.x||0>=i.y||i.x>=this.canvas.width||i.y>=this.canvas.height?!1:0!=this.context.getImageData(i.x,i.y,1,1).data[3]},StageItem.prototype.testOverlap=function(t){if(0<$(".modalfence:visible").length)return!1;var e=this;if("ItemGroup"==t.innerType||"StateGroup"==t.innerType){var i=!1;return $.each(t.children,function(t,r){i=i||e.testOverlap(r)}),i}if("ItemGroup"==e.innerType||"StateGroup"==e.innerType)return i=!1,$.each(e.children,function(r,a){a.testOverlap&&(a.setElementProperty("dragX",e.dragX,!0),a.setElementProperty("dragY",e.dragY,!0),i=i||a.testOverlap(t))}),i;var r=this.getAABB(),a=t.getAABB(),i=!0;return(r.right<a.left||r.left>a.right||r.bottom<a.top||r.top>a.bottom)&&(i=!1),this.isRotated?i&&this.testRotatedOverlap(t):i&&this.testPixelOverlap&&t.testPixelOverlap?this.testPixelOverlap(t):i},VectorShape.prototype.testPixelOverlap=function(t){player.showDebugOverlap&&(player.testCanvas||(player.testCanvas=$("<canvas id='test' width='1000' height='1000' style='position:absolute;z-index:200;left:0px;top:0px;'></canvas>"),$("#slideframe").append(player.testCanvas),player.testContext=player.testCanvas.get(0).getContext("2d"),player.testContext.fillStyle="rgba(255,255,0,0.5)"),player.testCanvas.show(),clearTimeout(player.testCanvasClear),player.testCanvasClear=setTimeout(function(){player.testCanvas.hide()},1e3));var e=this.slideX()+this.dragX,i=this.slideY()+this.dragY,r=0,a=0,s=0,n=0;if(t.slideX()>e?(r=t.slideX(),a=e+this.width):(r=e,a=t.slideX()+t.width),t.slideY()>i?(s=t.slideY(),n=i+this.height):(s=i,n=t.slideY()+t.height),e=a-r,i=n-s,!(0>=e||0>=i)){!player.showDebugOverlap||console.filter&&this.id!=console.filter&&t.id!=console.filter||(player.testContext.fillStyle="rgba(255,255,0,0.5)",player.testContext.clearRect(0,0,1e3,1e3),player.testContext.fillRect(r,s,e,i));for(var i=this.getCanvasPoint(r,s),i=this.context.getImageData(i.x,i.y,a-r,n-s).data,o=t.getCanvasPoint(r,s),a=t.context.getImageData(o.x,o.y,a-r,n-s).data,n=0;n<i.length-4;n+=256)if(0!=i[n+3]&&0!=a[n+3]){var o=r+n/4%e,l=s+Math.floor(n/4/e),h=t.isPointObscured(o,l,this,function(t){return t.dropArea});if(!player.showDebugOverlap||console.filter&&this.id!=console.filter&&t.id!=console.filter||(h?(player.testContext.fillStyle="rgba(255,0,0,0.9)",player.testContext.fillRect(o-1,l-1,2,2)):(player.testContext.fillStyle="rgba(0,255,0,0.9)",player.testContext.fillRect(o-2,l-2,4,4))),!h)return!0}return!1}}),-1<location.search.indexOf("iosscroll=1")&&(player.isIOSScroll=!0),window.webkitAudioContext&&!player.isLocalFileSystem&&-1==location.search.indexOf("nowebaudio=1"))try{player.audioContext=new webkitAudioContext,player.hasWebAudio=!0}catch(e$$56){}player.webAudioClips={},player.audioContext&&(Audio.masterVolume=.8,Audio.playbackStates={UNSCHEDULED:0,SCHEDULED:1,PLAYING:2,FINISHED:3},Audio.prototype.loadClip=function(){var t=this;t.source=null;var e=t.content.src;player.noAudioCache&&(e+="?rand="+Math.random());var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer";var r=function(){player.blocked&&player.blockedOn==t&&(player.currentSlide().currentIndex+=1,
t.canPlayThrough=!0,player.unblock())};i.onload=function(){player.audioContext.decodeAudioData(i.response,function(e){t.buffer=e,t.canPlayThrough=!0,t.prepared=!0,r()},function(){t.failedLoad=!0,r()})},i.onerror=function(){r()},i.send(),this.loadStarted=!0},Audio.prototype.createRef=function(){this.loadStarted||(this.loadClip(),player.webAudioClips[this.getFullObjref()]=this,this.currentTime=0)},Audio.prototype.prep=function(){},Audio.prototype.playClip=function(){var t=this;this.failedLoad||(this.prepared?(this.source&&this.source.noteOff(0),!isNaN(player.currentClipStartTime)&&player.currentClipSyncToTimeline&&player.currentClip==this&&(this.currentTime=(player.activeTimeline.currentTime-player.currentClipStartTime)/1e3),this.source=player.audioContext.createBufferSource(),this.source.buffer=this.buffer,this.volume=player.audioContext.createGainNode(),this.source.connect(this.volume),this.volume.connect(player.audioContext.destination),this.volume.gain.value=Audio.masterVolume*player.clipVolume,0==this.currentTime?this.source.noteOn(0):this.source.noteGrainOn(0,this.currentTime,this.content.duration/1e3-this.currentTime),this.playing=!0,this.interval&&window.clearInterval(this.interval),this.interval=window.setInterval(function(){t.source.playbackState==Audio.playbackStates.FINISHED&&(window.clearInterval(t.interval),t.playing)&&(t.handleEvent("onmediacomplete"),t.playing=!1)},10)):(player.block(),player.blockedOn=this))},Audio.prototype.pauseClip=function(t){this.source&&(this.interval&&window.clearInterval(this.interval),this.source.noteOff(0),this.playing&&t&&(this.handleEvent("onmediacomplete"),this.playing=!1),this.playing=!1)},Audio.prototype.getCurrentTime=function(){return 0},Audio.prototype.getScheduled=function(){return this.scheduled},Audio.prototype.setScheduled=function(t){this.scheduled=t},Audio.prototype.setCurrentTime=function(t){this.currentTime=t},Audio.prototype.getClip=function(){return this.propertyInterval||(this.propertyInterval=setInterval(function(){},200)),this},Audio.prototype.getIsPlaying=function(){return this.playing},Audio.prototype.mediaReady=function(){return this.failedLoad?!0:this.prepared},Audio.iOSPrepare=function(){var t=player.audioContext.createOscillator();t.type=0;var e=player.audioContext.createGainNode();t.connect(e),e.connect(player.audioContext.destination),e.gain.value=0,t.noteOn(0),t.noteOff(0)},Audio.setMasterVolume=function(t){Audio.masterVolume=t,$.each(player.webAudioClips,function(t,e){e.volume&&(e.volume.gain.value=Audio.masterVolume*player.clipVolume)})});